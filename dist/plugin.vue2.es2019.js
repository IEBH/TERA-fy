var I0=Object.create;var Li=Object.defineProperty;var A0=Object.getOwnPropertyDescriptor;var x0=Object.getOwnPropertyNames;var S0=Object.getPrototypeOf,R0=Object.prototype.hasOwnProperty;var P0=(r,e,t)=>e in r?Li(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var _=(r,e)=>()=>(r&&(e=r(r=0)),e);var ot=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),Ir=(r,e)=>{for(var t in e)Li(r,t,{get:e[t],enumerable:!0})},wp=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of x0(e))!R0.call(r,i)&&i!==t&&Li(r,i,{get:()=>e[i],enumerable:!(n=A0(e,i))||n.enumerable});return r};var vp=(r,e,t)=>(t=r!=null?I0(S0(r)):{},wp(e||!r||!r.__esModule?Li(t,"default",{value:r,enumerable:!0}):t,r)),C0=r=>wp(Li({},"__esModule",{value:!0}),r);var ae=(r,e,t)=>P0(r,typeof e!="symbol"?e+"":e,t);var k0,bo,yu=_(()=>{k0=typeof global=="object"&&global&&global.Object===Object&&global,bo=k0});var D0,O0,he,Je=_(()=>{yu();D0=typeof self=="object"&&self&&self.Object===Object&&self,O0=bo||D0||Function("return this")(),he=O0});var N0,Ve,nn=_(()=>{Je();N0=he.Symbol,Ve=N0});function M0(r){var e=V0.call(r,Mi),t=r[Mi];try{r[Mi]=void 0;var n=!0}catch{}var i=L0.call(r);return n&&(e?r[Mi]=t:delete r[Mi]),i}var bp,V0,L0,Mi,Tp,Ep=_(()=>{nn();bp=Object.prototype,V0=bp.hasOwnProperty,L0=bp.toString,Mi=Ve?Ve.toStringTag:void 0;Tp=M0});function U0(r){return j0.call(r)}var F0,j0,Ip,Ap=_(()=>{F0=Object.prototype,j0=F0.toString;Ip=U0});function q0(r){return r==null?r===void 0?$0:B0:xp&&xp in Object(r)?Tp(r):Ip(r)}var B0,$0,xp,tt,sn=_(()=>{nn();Ep();Ap();B0="[object Null]",$0="[object Undefined]",xp=Ve?Ve.toStringTag:void 0;tt=q0});function z0(r){return r!=null&&typeof r=="object"}var Le,Kt=_(()=>{Le=z0});function K0(r){return typeof r=="symbol"||Le(r)&&tt(r)==G0}var G0,Ht,Fi=_(()=>{sn();Kt();G0="[object Symbol]";Ht=K0});function H0(r,e){for(var t=-1,n=r==null?0:r.length,i=Array(n);++t<n;)i[t]=e(r[t],t,r);return i}var Sp,Rp=_(()=>{Sp=H0});var W0,fe,rt=_(()=>{W0=Array.isArray,fe=W0});function kp(r){if(typeof r=="string")return r;if(fe(r))return Sp(r,kp)+"";if(Ht(r))return Cp?Cp.call(r):"";var e=r+"";return e=="0"&&1/r==-Q0?"-0":e}var Q0,Pp,Cp,Dp,Op=_(()=>{nn();Rp();rt();Fi();Q0=1/0,Pp=Ve?Ve.prototype:void 0,Cp=Pp?Pp.toString:void 0;Dp=kp});function Y0(r){for(var e=r.length;e--&&J0.test(r.charAt(e)););return e}var J0,Np,Vp=_(()=>{J0=/\s/;Np=Y0});function Z0(r){return r&&r.slice(0,Np(r)+1).replace(X0,"")}var X0,Lp,Mp=_(()=>{Vp();X0=/^\s+/;Lp=Z0});function eI(r){var e=typeof r;return r!=null&&(e=="object"||e=="function")}var ee,Ge=_(()=>{ee=eI});function sI(r){if(typeof r=="number")return r;if(Ht(r))return Fp;if(ee(r)){var e=typeof r.valueOf=="function"?r.valueOf():r;r=ee(e)?e+"":e}if(typeof r!="string")return r===0?r:+r;r=Lp(r);var t=rI.test(r);return t||nI.test(r)?iI(r.slice(2),t?2:8):tI.test(r)?Fp:+r}var Fp,tI,rI,nI,iI,_u,jp=_(()=>{Mp();Ge();Fi();Fp=NaN,tI=/^[-+]0x[0-9a-f]+$/i,rI=/^0b[01]+$/i,nI=/^0o[0-7]+$/i,iI=parseInt;_u=sI});function oI(r){return r}var on,To=_(()=>{on=oI});function hI(r){if(!ee(r))return!1;var e=tt(r);return e==lI||e==uI||e==aI||e==cI}var aI,lI,uI,cI,Eo,wu=_(()=>{sn();Ge();aI="[object AsyncFunction]",lI="[object Function]",uI="[object GeneratorFunction]",cI="[object Proxy]";Eo=hI});var dI,Io,Up=_(()=>{Je();dI=he["__core-js_shared__"],Io=dI});function fI(r){return!!Bp&&Bp in r}var Bp,$p,qp=_(()=>{Up();Bp=function(){var r=/[^.]+$/.exec(Io&&Io.keys&&Io.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}();$p=fI});function gI(r){if(r!=null){try{return mI.call(r)}catch{}try{return r+""}catch{}}return""}var pI,mI,It,vu=_(()=>{pI=Function.prototype,mI=pI.toString;It=gI});function II(r){if(!ee(r)||$p(r))return!1;var e=Eo(r)?EI:_I;return e.test(It(r))}var yI,_I,wI,vI,bI,TI,EI,zp,Gp=_(()=>{wu();qp();Ge();vu();yI=/[\\^$.*+?()[\]{}|]/g,_I=/^\[object .+?Constructor\]$/,wI=Function.prototype,vI=Object.prototype,bI=wI.toString,TI=vI.hasOwnProperty,EI=RegExp("^"+bI.call(TI).replace(yI,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");zp=II});function AI(r,e){return r==null?void 0:r[e]}var Kp,Hp=_(()=>{Kp=AI});function xI(r,e){var t=Kp(r,e);return zp(t)?t:void 0}var je,Wt=_(()=>{Gp();Hp();je=xI});var SI,Ao,Wp=_(()=>{Wt();Je();SI=je(he,"WeakMap"),Ao=SI});var Qp,RI,Jp,Yp=_(()=>{Ge();Qp=Object.create,RI=function(){function r(){}return function(e){if(!ee(e))return{};if(Qp)return Qp(e);r.prototype=e;var t=new r;return r.prototype=void 0,t}}(),Jp=RI});function PI(r,e,t){switch(t.length){case 0:return r.call(e);case 1:return r.call(e,t[0]);case 2:return r.call(e,t[0],t[1]);case 3:return r.call(e,t[0],t[1],t[2])}return r.apply(e,t)}var Xp,Zp=_(()=>{Xp=PI});function CI(r,e){var t=-1,n=r.length;for(e||(e=Array(n));++t<n;)e[t]=r[t];return e}var em,tm=_(()=>{em=CI});function NI(r){var e=0,t=0;return function(){var n=OI(),i=DI-(n-t);if(t=n,i>0){if(++e>=kI)return arguments[0]}else e=0;return r.apply(void 0,arguments)}}var kI,DI,OI,rm,nm=_(()=>{kI=800,DI=16,OI=Date.now;rm=NI});function VI(r){return function(){return r}}var im,sm=_(()=>{im=VI});var LI,an,bu=_(()=>{Wt();LI=function(){try{var r=je(Object,"defineProperty");return r({},"",{}),r}catch{}}(),an=LI});var MI,om,am=_(()=>{sm();bu();To();MI=an?function(r,e){return an(r,"toString",{configurable:!0,enumerable:!1,value:im(e),writable:!0})}:on,om=MI});var FI,lm,um=_(()=>{am();nm();FI=rm(om),lm=FI});function jI(r,e){for(var t=-1,n=r==null?0:r.length;++t<n&&e(r[t],t,r)!==!1;);return r}var cm,hm=_(()=>{cm=jI});function $I(r,e){var t=typeof r;return e=e==null?UI:e,!!e&&(t=="number"||t!="symbol"&&BI.test(r))&&r>-1&&r%1==0&&r<e}var UI,BI,Qt,ji=_(()=>{UI=9007199254740991,BI=/^(?:0|[1-9]\d*)$/;Qt=$I});function qI(r,e,t){e=="__proto__"&&an?an(r,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):r[e]=t}var ln,xo=_(()=>{bu();ln=qI});function zI(r,e){return r===e||r!==r&&e!==e}var at,un=_(()=>{at=zI});function HI(r,e,t){var n=r[e];(!(KI.call(r,e)&&at(n,t))||t===void 0&&!(e in r))&&ln(r,e,t)}var GI,KI,cn,So=_(()=>{xo();un();GI=Object.prototype,KI=GI.hasOwnProperty;cn=HI});function WI(r,e,t,n){var i=!t;t||(t={});for(var s=-1,a=e.length;++s<a;){var l=e[s],u=n?n(t[l],r[l],l,t,r):void 0;u===void 0&&(u=r[l]),i?ln(t,l,u):cn(t,l,u)}return t}var Jt,Ui=_(()=>{So();xo();Jt=WI});function QI(r,e,t){return e=dm(e===void 0?r.length-1:e,0),function(){for(var n=arguments,i=-1,s=dm(n.length-e,0),a=Array(s);++i<s;)a[i]=n[e+i];i=-1;for(var l=Array(e+1);++i<e;)l[i]=n[i];return l[e]=t(a),Xp(r,this,l)}}var dm,fm,pm=_(()=>{Zp();dm=Math.max;fm=QI});function JI(r,e){return lm(fm(r,e,on),r+"")}var mm,gm=_(()=>{To();pm();um();mm=JI});function XI(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=YI}var YI,hn,Ro=_(()=>{YI=9007199254740991;hn=XI});function ZI(r){return r!=null&&hn(r.length)&&!Eo(r)}var Yt,Bi=_(()=>{wu();Ro();Yt=ZI});function eA(r,e,t){if(!ee(t))return!1;var n=typeof e;return(n=="number"?Yt(t)&&Qt(e,t.length):n=="string"&&e in t)?at(t[e],r):!1}var ym,_m=_(()=>{un();Bi();ji();Ge();ym=eA});function rA(r){var e=r&&r.constructor,t=typeof e=="function"&&e.prototype||tA;return r===t}var tA,Xt,$i=_(()=>{tA=Object.prototype;Xt=rA});function nA(r,e){for(var t=-1,n=Array(r);++t<r;)n[t]=e(t);return n}var wm,vm=_(()=>{wm=nA});function sA(r){return Le(r)&&tt(r)==iA}var iA,Tu,bm=_(()=>{sn();Kt();iA="[object Arguments]";Tu=sA});var Tm,oA,aA,lA,dn,Po=_(()=>{bm();Kt();Tm=Object.prototype,oA=Tm.hasOwnProperty,aA=Tm.propertyIsEnumerable,lA=Tu(function(){return arguments}())?Tu:function(r){return Le(r)&&oA.call(r,"callee")&&!aA.call(r,"callee")},dn=lA});function uA(){return!1}var Em,Im=_(()=>{Em=uA});var Sm,Am,cA,xm,hA,dA,At,qi=_(()=>{Je();Im();Sm=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Am=Sm&&typeof module=="object"&&module&&!module.nodeType&&module,cA=Am&&Am.exports===Sm,xm=cA?he.Buffer:void 0,hA=xm?xm.isBuffer:void 0,dA=hA||Em,At=dA});function MA(r){return Le(r)&&hn(r.length)&&!!le[tt(r)]}var fA,pA,mA,gA,yA,_A,wA,vA,bA,TA,EA,IA,AA,xA,SA,RA,PA,CA,kA,DA,OA,NA,VA,LA,le,Rm,Pm=_(()=>{sn();Ro();Kt();fA="[object Arguments]",pA="[object Array]",mA="[object Boolean]",gA="[object Date]",yA="[object Error]",_A="[object Function]",wA="[object Map]",vA="[object Number]",bA="[object Object]",TA="[object RegExp]",EA="[object Set]",IA="[object String]",AA="[object WeakMap]",xA="[object ArrayBuffer]",SA="[object DataView]",RA="[object Float32Array]",PA="[object Float64Array]",CA="[object Int8Array]",kA="[object Int16Array]",DA="[object Int32Array]",OA="[object Uint8Array]",NA="[object Uint8ClampedArray]",VA="[object Uint16Array]",LA="[object Uint32Array]",le={};le[RA]=le[PA]=le[CA]=le[kA]=le[DA]=le[OA]=le[NA]=le[VA]=le[LA]=!0;le[fA]=le[pA]=le[xA]=le[mA]=le[SA]=le[gA]=le[yA]=le[_A]=le[wA]=le[vA]=le[bA]=le[TA]=le[EA]=le[IA]=le[AA]=!1;Rm=MA});function FA(r){return function(e){return r(e)}}var fn,Co=_(()=>{fn=FA});var Cm,zi,jA,Eu,UA,xt,ko=_(()=>{yu();Cm=typeof exports=="object"&&exports&&!exports.nodeType&&exports,zi=Cm&&typeof module=="object"&&module&&!module.nodeType&&module,jA=zi&&zi.exports===Cm,Eu=jA&&bo.process,UA=function(){try{var r=zi&&zi.require&&zi.require("util").types;return r||Eu&&Eu.binding&&Eu.binding("util")}catch{}}(),xt=UA});var km,BA,pn,Do=_(()=>{Pm();Co();ko();km=xt&&xt.isTypedArray,BA=km?fn(km):Rm,pn=BA});function zA(r,e){var t=fe(r),n=!t&&dn(r),i=!t&&!n&&At(r),s=!t&&!n&&!i&&pn(r),a=t||n||i||s,l=a?wm(r.length,String):[],u=l.length;for(var h in r)(e||qA.call(r,h))&&!(a&&(h=="length"||i&&(h=="offset"||h=="parent")||s&&(h=="buffer"||h=="byteLength"||h=="byteOffset")||Qt(h,u)))&&l.push(h);return l}var $A,qA,Oo,Iu=_(()=>{vm();Po();rt();qi();ji();Do();$A=Object.prototype,qA=$A.hasOwnProperty;Oo=zA});function GA(r,e){return function(t){return r(e(t))}}var No,Au=_(()=>{No=GA});var KA,Dm,Om=_(()=>{Au();KA=No(Object.keys,Object),Dm=KA});function QA(r){if(!Xt(r))return Dm(r);var e=[];for(var t in Object(r))WA.call(r,t)&&t!="constructor"&&e.push(t);return e}var HA,WA,Vo,xu=_(()=>{$i();Om();HA=Object.prototype,WA=HA.hasOwnProperty;Vo=QA});function JA(r){return Yt(r)?Oo(r):Vo(r)}var Ce,Ar=_(()=>{Iu();xu();Bi();Ce=JA});function YA(r){var e=[];if(r!=null)for(var t in Object(r))e.push(t);return e}var Nm,Vm=_(()=>{Nm=YA});function ex(r){if(!ee(r))return Nm(r);var e=Xt(r),t=[];for(var n in r)n=="constructor"&&(e||!ZA.call(r,n))||t.push(n);return t}var XA,ZA,Lm,Mm=_(()=>{Ge();$i();Vm();XA=Object.prototype,ZA=XA.hasOwnProperty;Lm=ex});function tx(r){return Yt(r)?Oo(r,!0):Lm(r)}var Zt,Gi=_(()=>{Iu();Mm();Bi();Zt=tx});function ix(r,e){if(fe(r))return!1;var t=typeof r;return t=="number"||t=="symbol"||t=="boolean"||r==null||Ht(r)?!0:nx.test(r)||!rx.test(r)||e!=null&&r in Object(e)}var rx,nx,mn,Lo=_(()=>{rt();Fi();rx=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,nx=/^\w*$/;mn=ix});var sx,St,Ki=_(()=>{Wt();sx=je(Object,"create"),St=sx});function ox(){this.__data__=St?St(null):{},this.size=0}var Fm,jm=_(()=>{Ki();Fm=ox});function ax(r){var e=this.has(r)&&delete this.__data__[r];return this.size-=e?1:0,e}var Um,Bm=_(()=>{Um=ax});function hx(r){var e=this.__data__;if(St){var t=e[r];return t===lx?void 0:t}return cx.call(e,r)?e[r]:void 0}var lx,ux,cx,$m,qm=_(()=>{Ki();lx="__lodash_hash_undefined__",ux=Object.prototype,cx=ux.hasOwnProperty;$m=hx});function px(r){var e=this.__data__;return St?e[r]!==void 0:fx.call(e,r)}var dx,fx,zm,Gm=_(()=>{Ki();dx=Object.prototype,fx=dx.hasOwnProperty;zm=px});function gx(r,e){var t=this.__data__;return this.size+=this.has(r)?0:1,t[r]=St&&e===void 0?mx:e,this}var mx,Km,Hm=_(()=>{Ki();mx="__lodash_hash_undefined__";Km=gx});function gn(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}var Su,Wm=_(()=>{jm();Bm();qm();Gm();Hm();gn.prototype.clear=Fm;gn.prototype.delete=Um;gn.prototype.get=$m;gn.prototype.has=zm;gn.prototype.set=Km;Su=gn});function yx(){this.__data__=[],this.size=0}var Qm,Jm=_(()=>{Qm=yx});function _x(r,e){for(var t=r.length;t--;)if(at(r[t][0],e))return t;return-1}var er,Hi=_(()=>{un();er=_x});function bx(r){var e=this.__data__,t=er(e,r);if(t<0)return!1;var n=e.length-1;return t==n?e.pop():vx.call(e,t,1),--this.size,!0}var wx,vx,Ym,Xm=_(()=>{Hi();wx=Array.prototype,vx=wx.splice;Ym=bx});function Tx(r){var e=this.__data__,t=er(e,r);return t<0?void 0:e[t][1]}var Zm,eg=_(()=>{Hi();Zm=Tx});function Ex(r){return er(this.__data__,r)>-1}var tg,rg=_(()=>{Hi();tg=Ex});function Ix(r,e){var t=this.__data__,n=er(t,r);return n<0?(++this.size,t.push([r,e])):t[n][1]=e,this}var ng,ig=_(()=>{Hi();ng=Ix});function yn(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}var tr,Wi=_(()=>{Jm();Xm();eg();rg();ig();yn.prototype.clear=Qm;yn.prototype.delete=Ym;yn.prototype.get=Zm;yn.prototype.has=tg;yn.prototype.set=ng;tr=yn});var Ax,rr,Mo=_(()=>{Wt();Je();Ax=je(he,"Map"),rr=Ax});function xx(){this.size=0,this.__data__={hash:new Su,map:new(rr||tr),string:new Su}}var sg,og=_(()=>{Wm();Wi();Mo();sg=xx});function Sx(r){var e=typeof r;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?r!=="__proto__":r===null}var ag,lg=_(()=>{ag=Sx});function Rx(r,e){var t=r.__data__;return ag(e)?t[typeof e=="string"?"string":"hash"]:t.map}var nr,Qi=_(()=>{lg();nr=Rx});function Px(r){var e=nr(this,r).delete(r);return this.size-=e?1:0,e}var ug,cg=_(()=>{Qi();ug=Px});function Cx(r){return nr(this,r).get(r)}var hg,dg=_(()=>{Qi();hg=Cx});function kx(r){return nr(this,r).has(r)}var fg,pg=_(()=>{Qi();fg=kx});function Dx(r,e){var t=nr(this,r),n=t.size;return t.set(r,e),this.size+=t.size==n?0:1,this}var mg,gg=_(()=>{Qi();mg=Dx});function _n(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}var xr,Fo=_(()=>{og();cg();dg();pg();gg();_n.prototype.clear=sg;_n.prototype.delete=ug;_n.prototype.get=hg;_n.prototype.has=fg;_n.prototype.set=mg;xr=_n});function Ru(r,e){if(typeof r!="function"||e!=null&&typeof e!="function")throw new TypeError(Ox);var t=function(){var n=arguments,i=e?e.apply(this,n):n[0],s=t.cache;if(s.has(i))return s.get(i);var a=r.apply(this,n);return t.cache=s.set(i,a)||s,a};return t.cache=new(Ru.Cache||xr),t}var Ox,yg,_g=_(()=>{Fo();Ox="Expected a function";Ru.Cache=xr;yg=Ru});function Vx(r){var e=yg(r,function(n){return t.size===Nx&&t.clear(),n}),t=e.cache;return e}var Nx,wg,vg=_(()=>{_g();Nx=500;wg=Vx});var Lx,Mx,Fx,bg,Tg=_(()=>{vg();Lx=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Mx=/\\(\\)?/g,Fx=wg(function(r){var e=[];return r.charCodeAt(0)===46&&e.push(""),r.replace(Lx,function(t,n,i,s){e.push(i?s.replace(Mx,"$1"):n||t)}),e}),bg=Fx});function jx(r){return r==null?"":Dp(r)}var Eg,Ig=_(()=>{Op();Eg=jx});function Ux(r,e){return fe(r)?r:mn(r,e)?[r]:bg(Eg(r))}var wn,jo=_(()=>{rt();Lo();Tg();Ig();wn=Ux});function $x(r){if(typeof r=="string"||Ht(r))return r;var e=r+"";return e=="0"&&1/r==-Bx?"-0":e}var Bx,lt,vn=_(()=>{Fi();Bx=1/0;lt=$x});function qx(r,e){e=wn(e,r);for(var t=0,n=e.length;r!=null&&t<n;)r=r[lt(e[t++])];return t&&t==n?r:void 0}var Uo,Pu=_(()=>{jo();vn();Uo=qx});function zx(r,e,t){var n=r==null?void 0:Uo(r,e);return n===void 0?t:n}var Ji,Cu=_(()=>{Pu();Ji=zx});function Gx(r,e){for(var t=-1,n=e.length,i=r.length;++t<n;)r[i+t]=e[t];return r}var Bo,ku=_(()=>{Bo=Gx});var Kx,$o,Du=_(()=>{Au();Kx=No(Object.getPrototypeOf,Object),$o=Kx});function Hx(){this.__data__=new tr,this.size=0}var Ag,xg=_(()=>{Wi();Ag=Hx});function Wx(r){var e=this.__data__,t=e.delete(r);return this.size=e.size,t}var Sg,Rg=_(()=>{Sg=Wx});function Qx(r){return this.__data__.get(r)}var Pg,Cg=_(()=>{Pg=Qx});function Jx(r){return this.__data__.has(r)}var kg,Dg=_(()=>{kg=Jx});function Xx(r,e){var t=this.__data__;if(t instanceof tr){var n=t.__data__;if(!rr||n.length<Yx-1)return n.push([r,e]),this.size=++t.size,this;t=this.__data__=new xr(n)}return t.set(r,e),this.size=t.size,this}var Yx,Og,Ng=_(()=>{Wi();Mo();Fo();Yx=200;Og=Xx});function bn(r){var e=this.__data__=new tr(r);this.size=e.size}var ir,qo=_(()=>{Wi();xg();Rg();Cg();Dg();Ng();bn.prototype.clear=Ag;bn.prototype.delete=Sg;bn.prototype.get=Pg;bn.prototype.has=kg;bn.prototype.set=Og;ir=bn});function Zx(r,e){return r&&Jt(e,Ce(e),r)}var Vg,Lg=_(()=>{Ui();Ar();Vg=Zx});function eS(r,e){return r&&Jt(e,Zt(e),r)}var Mg,Fg=_(()=>{Ui();Gi();Mg=eS});function rS(r,e){if(e)return r.slice();var t=r.length,n=Bg?Bg(t):new r.constructor(t);return r.copy(n),n}var $g,jg,tS,Ug,Bg,qg,zg=_(()=>{Je();$g=typeof exports=="object"&&exports&&!exports.nodeType&&exports,jg=$g&&typeof module=="object"&&module&&!module.nodeType&&module,tS=jg&&jg.exports===$g,Ug=tS?he.Buffer:void 0,Bg=Ug?Ug.allocUnsafe:void 0;qg=rS});function nS(r,e){for(var t=-1,n=r==null?0:r.length,i=0,s=[];++t<n;){var a=r[t];e(a,t,r)&&(s[i++]=a)}return s}var Gg,Kg=_(()=>{Gg=nS});function iS(){return[]}var zo,Ou=_(()=>{zo=iS});var sS,oS,Hg,aS,Tn,Go=_(()=>{Kg();Ou();sS=Object.prototype,oS=sS.propertyIsEnumerable,Hg=Object.getOwnPropertySymbols,aS=Hg?function(r){return r==null?[]:(r=Object(r),Gg(Hg(r),function(e){return oS.call(r,e)}))}:zo,Tn=aS});function lS(r,e){return Jt(r,Tn(r),e)}var Wg,Qg=_(()=>{Ui();Go();Wg=lS});var uS,cS,Ko,Nu=_(()=>{ku();Du();Go();Ou();uS=Object.getOwnPropertySymbols,cS=uS?function(r){for(var e=[];r;)Bo(e,Tn(r)),r=$o(r);return e}:zo,Ko=cS});function hS(r,e){return Jt(r,Ko(r),e)}var Jg,Yg=_(()=>{Ui();Nu();Jg=hS});function dS(r,e,t){var n=e(r);return fe(r)?n:Bo(n,t(r))}var Ho,Vu=_(()=>{ku();rt();Ho=dS});function fS(r){return Ho(r,Ce,Tn)}var Yi,Lu=_(()=>{Vu();Go();Ar();Yi=fS});function pS(r){return Ho(r,Zt,Ko)}var Xg,Zg=_(()=>{Vu();Nu();Gi();Xg=pS});var mS,Wo,ey=_(()=>{Wt();Je();mS=je(he,"DataView"),Wo=mS});var gS,Qo,ty=_(()=>{Wt();Je();gS=je(he,"Promise"),Qo=gS});var yS,Jo,ry=_(()=>{Wt();Je();yS=je(he,"Set"),Jo=yS});var ny,_S,iy,sy,oy,ay,wS,vS,bS,TS,ES,Sr,nt,En=_(()=>{ey();Mo();ty();ry();Wp();sn();vu();ny="[object Map]",_S="[object Object]",iy="[object Promise]",sy="[object Set]",oy="[object WeakMap]",ay="[object DataView]",wS=It(Wo),vS=It(rr),bS=It(Qo),TS=It(Jo),ES=It(Ao),Sr=tt;(Wo&&Sr(new Wo(new ArrayBuffer(1)))!=ay||rr&&Sr(new rr)!=ny||Qo&&Sr(Qo.resolve())!=iy||Jo&&Sr(new Jo)!=sy||Ao&&Sr(new Ao)!=oy)&&(Sr=function(r){var e=tt(r),t=e==_S?r.constructor:void 0,n=t?It(t):"";if(n)switch(n){case wS:return ay;case vS:return ny;case bS:return iy;case TS:return sy;case ES:return oy}return e});nt=Sr});function xS(r){var e=r.length,t=new r.constructor(e);return e&&typeof r[0]=="string"&&AS.call(r,"index")&&(t.index=r.index,t.input=r.input),t}var IS,AS,ly,uy=_(()=>{IS=Object.prototype,AS=IS.hasOwnProperty;ly=xS});var SS,In,Mu=_(()=>{Je();SS=he.Uint8Array,In=SS});function RS(r){var e=new r.constructor(r.byteLength);return new In(e).set(new In(r)),e}var An,Yo=_(()=>{Mu();An=RS});function PS(r,e){var t=e?An(r.buffer):r.buffer;return new r.constructor(t,r.byteOffset,r.byteLength)}var cy,hy=_(()=>{Yo();cy=PS});function kS(r){var e=new r.constructor(r.source,CS.exec(r));return e.lastIndex=r.lastIndex,e}var CS,dy,fy=_(()=>{CS=/\w*$/;dy=kS});function DS(r){return my?Object(my.call(r)):{}}var py,my,gy,yy=_(()=>{nn();py=Ve?Ve.prototype:void 0,my=py?py.valueOf:void 0;gy=DS});function OS(r,e){var t=e?An(r.buffer):r.buffer;return new r.constructor(t,r.byteOffset,r.length)}var _y,wy=_(()=>{Yo();_y=OS});function ZS(r,e,t){var n=r.constructor;switch(e){case $S:return An(r);case NS:case VS:return new n(+r);case qS:return cy(r,t);case zS:case GS:case KS:case HS:case WS:case QS:case JS:case YS:case XS:return _y(r,t);case LS:return new n;case MS:case US:return new n(r);case FS:return dy(r);case jS:return new n;case BS:return gy(r)}}var NS,VS,LS,MS,FS,jS,US,BS,$S,qS,zS,GS,KS,HS,WS,QS,JS,YS,XS,vy,by=_(()=>{Yo();hy();fy();yy();wy();NS="[object Boolean]",VS="[object Date]",LS="[object Map]",MS="[object Number]",FS="[object RegExp]",jS="[object Set]",US="[object String]",BS="[object Symbol]",$S="[object ArrayBuffer]",qS="[object DataView]",zS="[object Float32Array]",GS="[object Float64Array]",KS="[object Int8Array]",HS="[object Int16Array]",WS="[object Int32Array]",QS="[object Uint8Array]",JS="[object Uint8ClampedArray]",YS="[object Uint16Array]",XS="[object Uint32Array]";vy=ZS});function eR(r){return typeof r.constructor=="function"&&!Xt(r)?Jp($o(r)):{}}var Ty,Ey=_(()=>{Yp();Du();$i();Ty=eR});function rR(r){return Le(r)&&nt(r)==tR}var tR,Iy,Ay=_(()=>{En();Kt();tR="[object Map]";Iy=rR});var xy,nR,Sy,Ry=_(()=>{Ay();Co();ko();xy=xt&&xt.isMap,nR=xy?fn(xy):Iy,Sy=nR});function sR(r){return Le(r)&&nt(r)==iR}var iR,Py,Cy=_(()=>{En();Kt();iR="[object Set]";Py=sR});var ky,oR,Dy,Oy=_(()=>{Cy();Co();ko();ky=xt&&xt.isSet,oR=ky?fn(ky):Py,Dy=oR});function Xo(r,e,t,n,i,s){var a,l=e&aR,u=e&lR,h=e&uR;if(t&&(a=i?t(r,n,i,s):t(r)),a!==void 0)return a;if(!ee(r))return r;var f=fe(r);if(f){if(a=ly(r),!l)return em(r,a)}else{var m=nt(r),g=m==Vy||m==pR;if(At(r))return qg(r,l);if(m==Ly||m==Ny||g&&!i){if(a=u||g?{}:Ty(r),!l)return u?Jg(r,Mg(a,r)):Wg(r,Vg(a,r))}else{if(!ie[m])return i?r:{};a=vy(r,m,l)}}s||(s=new ir);var I=s.get(r);if(I)return I;s.set(r,a),Dy(r)?r.forEach(function(P){a.add(Xo(P,e,t,P,r,s))}):Sy(r)&&r.forEach(function(P,V){a.set(V,Xo(P,e,t,V,r,s))});var C=h?u?Xg:Yi:u?Zt:Ce,k=f?void 0:C(r);return cm(k||r,function(P,V){k&&(V=P,P=r[V]),cn(a,V,Xo(P,e,t,V,r,s))}),a}var aR,lR,uR,Ny,cR,hR,dR,fR,Vy,pR,mR,gR,Ly,yR,_R,wR,vR,bR,TR,ER,IR,AR,xR,SR,RR,PR,CR,kR,DR,ie,My,Fy=_(()=>{qo();hm();So();Lg();Fg();zg();tm();Qg();Yg();Lu();Zg();En();uy();by();Ey();rt();qi();Ry();Ge();Oy();Ar();Gi();aR=1,lR=2,uR=4,Ny="[object Arguments]",cR="[object Array]",hR="[object Boolean]",dR="[object Date]",fR="[object Error]",Vy="[object Function]",pR="[object GeneratorFunction]",mR="[object Map]",gR="[object Number]",Ly="[object Object]",yR="[object RegExp]",_R="[object Set]",wR="[object String]",vR="[object Symbol]",bR="[object WeakMap]",TR="[object ArrayBuffer]",ER="[object DataView]",IR="[object Float32Array]",AR="[object Float64Array]",xR="[object Int8Array]",SR="[object Int16Array]",RR="[object Int32Array]",PR="[object Uint8Array]",CR="[object Uint8ClampedArray]",kR="[object Uint16Array]",DR="[object Uint32Array]",ie={};ie[Ny]=ie[cR]=ie[TR]=ie[ER]=ie[hR]=ie[dR]=ie[IR]=ie[AR]=ie[xR]=ie[SR]=ie[RR]=ie[mR]=ie[gR]=ie[Ly]=ie[yR]=ie[_R]=ie[wR]=ie[vR]=ie[PR]=ie[CR]=ie[kR]=ie[DR]=!0;ie[fR]=ie[Vy]=ie[bR]=!1;My=Xo});function VR(r){return My(r,OR|NR)}var OR,NR,sr,jy=_(()=>{Fy();OR=1,NR=4;sr=VR});function MR(r){return this.__data__.set(r,LR),this}var LR,Uy,By=_(()=>{LR="__lodash_hash_undefined__";Uy=MR});function FR(r){return this.__data__.has(r)}var $y,qy=_(()=>{$y=FR});function Zo(r){var e=-1,t=r==null?0:r.length;for(this.__data__=new xr;++e<t;)this.add(r[e])}var zy,Gy=_(()=>{Fo();By();qy();Zo.prototype.add=Zo.prototype.push=Uy;Zo.prototype.has=$y;zy=Zo});function jR(r,e){for(var t=-1,n=r==null?0:r.length;++t<n;)if(e(r[t],t,r))return!0;return!1}var Ky,Hy=_(()=>{Ky=jR});function UR(r,e){return r.has(e)}var Wy,Qy=_(()=>{Wy=UR});function qR(r,e,t,n,i,s){var a=t&BR,l=r.length,u=e.length;if(l!=u&&!(a&&u>l))return!1;var h=s.get(r),f=s.get(e);if(h&&f)return h==e&&f==r;var m=-1,g=!0,I=t&$R?new zy:void 0;for(s.set(r,e),s.set(e,r);++m<l;){var C=r[m],k=e[m];if(n)var P=a?n(k,C,m,e,r,s):n(C,k,m,r,e,s);if(P!==void 0){if(P)continue;g=!1;break}if(I){if(!Ky(e,function(V,F){if(!Wy(I,F)&&(C===V||i(C,V,t,n,s)))return I.push(F)})){g=!1;break}}else if(!(C===k||i(C,k,t,n,s))){g=!1;break}}return s.delete(r),s.delete(e),g}var BR,$R,ea,Fu=_(()=>{Gy();Hy();Qy();BR=1,$R=2;ea=qR});function zR(r){var e=-1,t=Array(r.size);return r.forEach(function(n,i){t[++e]=[i,n]}),t}var Jy,Yy=_(()=>{Jy=zR});function GR(r){var e=-1,t=Array(r.size);return r.forEach(function(n){t[++e]=n}),t}var Xy,Zy=_(()=>{Xy=GR});function sP(r,e,t,n,i,s,a){switch(t){case iP:if(r.byteLength!=e.byteLength||r.byteOffset!=e.byteOffset)return!1;r=r.buffer,e=e.buffer;case nP:return!(r.byteLength!=e.byteLength||!s(new In(r),new In(e)));case WR:case QR:case XR:return at(+r,+e);case JR:return r.name==e.name&&r.message==e.message;case ZR:case tP:return r==e+"";case YR:var l=Jy;case eP:var u=n&KR;if(l||(l=Xy),r.size!=e.size&&!u)return!1;var h=a.get(r);if(h)return h==e;n|=HR,a.set(r,e);var f=ea(l(r),l(e),n,i,s,a);return a.delete(r),f;case rP:if(ju)return ju.call(r)==ju.call(e)}return!1}var KR,HR,WR,QR,JR,YR,XR,ZR,eP,tP,rP,nP,iP,e_,ju,t_,r_=_(()=>{nn();Mu();un();Fu();Yy();Zy();KR=1,HR=2,WR="[object Boolean]",QR="[object Date]",JR="[object Error]",YR="[object Map]",XR="[object Number]",ZR="[object RegExp]",eP="[object Set]",tP="[object String]",rP="[object Symbol]",nP="[object ArrayBuffer]",iP="[object DataView]",e_=Ve?Ve.prototype:void 0,ju=e_?e_.valueOf:void 0;t_=sP});function uP(r,e,t,n,i,s){var a=t&oP,l=Yi(r),u=l.length,h=Yi(e),f=h.length;if(u!=f&&!a)return!1;for(var m=u;m--;){var g=l[m];if(!(a?g in e:lP.call(e,g)))return!1}var I=s.get(r),C=s.get(e);if(I&&C)return I==e&&C==r;var k=!0;s.set(r,e),s.set(e,r);for(var P=a;++m<u;){g=l[m];var V=r[g],F=e[g];if(n)var B=a?n(F,V,g,e,r,s):n(V,F,g,r,e,s);if(!(B===void 0?V===F||i(V,F,t,n,s):B)){k=!1;break}P||(P=g=="constructor")}if(k&&!P){var K=r.constructor,X=e.constructor;K!=X&&"constructor"in r&&"constructor"in e&&!(typeof K=="function"&&K instanceof K&&typeof X=="function"&&X instanceof X)&&(k=!1)}return s.delete(r),s.delete(e),k}var oP,aP,lP,n_,i_=_(()=>{Lu();oP=1,aP=Object.prototype,lP=aP.hasOwnProperty;n_=uP});function dP(r,e,t,n,i,s){var a=fe(r),l=fe(e),u=a?o_:nt(r),h=l?o_:nt(e);u=u==s_?ta:u,h=h==s_?ta:h;var f=u==ta,m=h==ta,g=u==h;if(g&&At(r)){if(!At(e))return!1;a=!0,f=!1}if(g&&!f)return s||(s=new ir),a||pn(r)?ea(r,e,t,n,i,s):t_(r,e,u,t,n,i,s);if(!(t&cP)){var I=f&&a_.call(r,"__wrapped__"),C=m&&a_.call(e,"__wrapped__");if(I||C){var k=I?r.value():r,P=C?e.value():e;return s||(s=new ir),i(k,P,t,n,s)}}return g?(s||(s=new ir),n_(r,e,t,n,i,s)):!1}var cP,s_,o_,ta,hP,a_,l_,u_=_(()=>{qo();Fu();r_();i_();En();rt();qi();Do();cP=1,s_="[object Arguments]",o_="[object Array]",ta="[object Object]",hP=Object.prototype,a_=hP.hasOwnProperty;l_=dP});function c_(r,e,t,n,i){return r===e?!0:r==null||e==null||!Le(r)&&!Le(e)?r!==r&&e!==e:l_(r,e,t,n,c_,i)}var xn,ra=_(()=>{u_();Kt();xn=c_});function mP(r,e,t,n){var i=t.length,s=i,a=!n;if(r==null)return!s;for(r=Object(r);i--;){var l=t[i];if(a&&l[2]?l[1]!==r[l[0]]:!(l[0]in r))return!1}for(;++i<s;){l=t[i];var u=l[0],h=r[u],f=l[1];if(a&&l[2]){if(h===void 0&&!(u in r))return!1}else{var m=new ir;if(n)var g=n(h,f,u,r,e,m);if(!(g===void 0?xn(f,h,fP|pP,n,m):g))return!1}}return!0}var fP,pP,h_,d_=_(()=>{qo();ra();fP=1,pP=2;h_=mP});function gP(r){return r===r&&!ee(r)}var na,Uu=_(()=>{Ge();na=gP});function yP(r){for(var e=Ce(r),t=e.length;t--;){var n=e[t],i=r[n];e[t]=[n,i,na(i)]}return e}var f_,p_=_(()=>{Uu();Ar();f_=yP});function _P(r,e){return function(t){return t==null?!1:t[r]===e&&(e!==void 0||r in Object(t))}}var ia,Bu=_(()=>{ia=_P});function wP(r){var e=f_(r);return e.length==1&&e[0][2]?ia(e[0][0],e[0][1]):function(t){return t===r||h_(t,r,e)}}var m_,g_=_(()=>{d_();p_();Bu();m_=wP});function vP(r,e){return r!=null&&e in Object(r)}var y_,__=_(()=>{y_=vP});function bP(r,e,t){e=wn(e,r);for(var n=-1,i=e.length,s=!1;++n<i;){var a=lt(e[n]);if(!(s=r!=null&&t(r,a)))break;r=r[a]}return s||++n!=i?s:(i=r==null?0:r.length,!!i&&hn(i)&&Qt(a,i)&&(fe(r)||dn(r)))}var w_,v_=_(()=>{jo();Po();rt();ji();Ro();vn();w_=bP});function TP(r,e){return r!=null&&w_(r,e,y_)}var b_,T_=_(()=>{__();v_();b_=TP});function AP(r,e){return mn(r)&&na(e)?ia(lt(r),e):function(t){var n=Ji(t,r);return n===void 0&&n===e?b_(t,r):xn(e,n,EP|IP)}}var EP,IP,E_,I_=_(()=>{ra();Cu();T_();Lo();Uu();Bu();vn();EP=1,IP=2;E_=AP});function xP(r){return function(e){return e==null?void 0:e[r]}}var A_,x_=_(()=>{A_=xP});function SP(r){return function(e){return Uo(e,r)}}var S_,R_=_(()=>{Pu();S_=SP});function RP(r){return mn(r)?A_(lt(r)):S_(r)}var P_,C_=_(()=>{x_();R_();Lo();vn();P_=RP});function PP(r){return typeof r=="function"?r:r==null?on:typeof r=="object"?fe(r)?E_(r[0],r[1]):m_(r):P_(r)}var k_,D_=_(()=>{g_();I_();To();rt();C_();k_=PP});function CP(r){return function(e,t,n){for(var i=-1,s=Object(e),a=n(e),l=a.length;l--;){var u=a[r?l:++i];if(t(s[u],u,s)===!1)break}return e}}var O_,N_=_(()=>{O_=CP});var kP,V_,L_=_(()=>{N_();kP=O_(),V_=kP});function DP(r,e){return r&&V_(r,e,Ce)}var M_,F_=_(()=>{L_();Ar();M_=DP});var OP,sa,j_=_(()=>{Je();OP=function(){return he.Date.now()},sa=OP});function MP(r,e,t){var n,i,s,a,l,u,h=0,f=!1,m=!1,g=!0;if(typeof r!="function")throw new TypeError(NP);e=_u(e)||0,ee(t)&&(f=!!t.leading,m="maxWait"in t,s=m?VP(_u(t.maxWait)||0,e):s,g="trailing"in t?!!t.trailing:g);function I($){var E=n,y=i;return n=i=void 0,h=$,a=r.apply(y,E),a}function C($){return h=$,l=setTimeout(V,e),f?I($):a}function k($){var E=$-u,y=$-h,b=e-E;return m?LP(b,s-y):b}function P($){var E=$-u,y=$-h;return u===void 0||E>=e||E<0||m&&y>=s}function V(){var $=sa();if(P($))return F($);l=setTimeout(V,k($))}function F($){return l=void 0,g&&n?I($):(n=i=void 0,a)}function B(){l!==void 0&&clearTimeout(l),h=0,n=u=i=l=void 0}function K(){return l===void 0?a:F(sa())}function X(){var $=sa(),E=P($);if(n=arguments,i=this,u=$,E){if(l===void 0)return C(u);if(m)return clearTimeout(l),l=setTimeout(V,e),I(u)}return l===void 0&&(l=setTimeout(V,e)),a}return X.cancel=B,X.flush=K,X}var NP,VP,LP,U_,B_=_(()=>{Ge();j_();jp();NP="Expected a function",VP=Math.max,LP=Math.min;U_=MP});var $_,FP,jP,oa,q_=_(()=>{gm();un();_m();Gi();$_=Object.prototype,FP=$_.hasOwnProperty,jP=mm(function(r,e){r=Object(r);var t=-1,n=e.length,i=n>2?e[2]:void 0;for(i&&ym(e[0],e[1],i)&&(n=1);++t<n;)for(var s=e[t],a=Zt(s),l=-1,u=a.length;++l<u;){var h=a[l],f=r[h];(f===void 0||at(f,$_[h])&&!FP.call(r,h))&&(r[h]=s[h])}return r}),oa=jP});function zP(r){if(r==null)return!0;if(Yt(r)&&(fe(r)||typeof r=="string"||typeof r.splice=="function"||At(r)||pn(r)||dn(r)))return!r.length;var e=nt(r);if(e==UP||e==BP)return!r.size;if(Xt(r))return!Vo(r).length;for(var t in r)if(qP.call(r,t))return!1;return!0}var UP,BP,$P,qP,$u,z_=_(()=>{xu();En();Po();rt();Bi();qi();$i();Do();UP="[object Map]",BP="[object Set]",$P=Object.prototype,qP=$P.hasOwnProperty;$u=zP});function GP(r,e){return xn(r,e)}var qu,G_=_(()=>{ra();qu=GP});function KP(r,e){var t={};return e=k_(e,3),M_(r,function(n,i,s){ln(t,e(n,i,s),n)}),t}var zu,K_=_(()=>{xo();F_();D_();zu=KP});function HP(r,e,t,n){if(!ee(r))return r;e=wn(e,r);for(var i=-1,s=e.length,a=s-1,l=r;l!=null&&++i<s;){var u=lt(e[i]),h=t;if(u==="__proto__"||u==="constructor"||u==="prototype")return r;if(i!=a){var f=l[u];h=n?n(f,u,l):void 0,h===void 0&&(h=ee(f)?f:Qt(e[i+1])?[]:{})}cn(l,u,h),l=l[u]}return r}var H_,W_=_(()=>{So();jo();ji();Ge();vn();H_=HP});function WP(r,e,t){return r==null?r:H_(r,e,t)}var or,Q_=_(()=>{W_();or=WP});function JP(r,e,t){var n=!0,i=!0;if(typeof r!="function")throw new TypeError(QP);return ee(t)&&(n="leading"in t?!!t.leading:n,i="trailing"in t?!!t.trailing:i),U_(r,e,{leading:n,maxWait:e,trailing:i})}var QP,Gu,J_=_(()=>{B_();Ge();QP="Expected a function";Gu=JP});var aa=_(()=>{jy();q_();Cu();z_();G_();Ge();Ar();K_();Q_();J_();});function ZP(){if(typeof self!="undefined")return self;if(typeof window!="undefined")return window;if(typeof global!="undefined")return global;throw new Error("Unable to locate global object.")}function rw(r,e){if(r.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let t={alg:"none",type:"JWT"},n=e||"demo-project",i=r.iat||0,s=r.sub||r.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let a=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},r);return[Xi(JSON.stringify(t)),Xi(JSON.stringify(a)),""].join(".")}function nw(){return typeof navigator!="undefined"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function iC(){var r;let e=(r=Hu())===null||r===void 0?void 0:r.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function iw(){return!iC()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Qu(){try{return typeof indexedDB=="object"}catch{return!1}}function sw(){return new Promise((r,e)=>{try{let t=!0,n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(n),r(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}function oC(r,e){return r.replace(aC,(t,n)=>{let i=e[n];return i!=null?String(i):`<${n}?>`})}function es(r,e){if(r===e)return!0;let t=Object.keys(r),n=Object.keys(e);for(let i of t){if(!n.includes(i))return!1;let s=r[i],a=e[i];if(Y_(s)&&Y_(a)){if(!es(s,a))return!1}else if(s!==a)return!1}for(let i of n)if(!t.includes(i))return!1;return!0}function Y_(r){return r!==null&&typeof r=="object"}function Pt(r){return r&&r._delegate?r._delegate:r}var X_,YP,Z_,Ku,XP,Xi,ew,eC,tC,rC,Hu,nC,tw,Wu,la,sC,Rt,Zi,aC,NB,ts=_(()=>{X_=function(r){let e=[],t=0;for(let n=0;n<r.length;n++){let i=r.charCodeAt(n);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(i=65536+((i&1023)<<10)+(r.charCodeAt(++n)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},YP=function(r){let e=[],t=0,n=0;for(;t<r.length;){let i=r[t++];if(i<128)e[n++]=String.fromCharCode(i);else if(i>191&&i<224){let s=r[t++];e[n++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){let s=r[t++],a=r[t++],l=r[t++],u=((i&7)<<18|(s&63)<<12|(a&63)<<6|l&63)-65536;e[n++]=String.fromCharCode(55296+(u>>10)),e[n++]=String.fromCharCode(56320+(u&1023))}else{let s=r[t++],a=r[t++];e[n++]=String.fromCharCode((i&15)<<12|(s&63)<<6|a&63)}}return e.join("")},Z_={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,e){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let i=0;i<r.length;i+=3){let s=r[i],a=i+1<r.length,l=a?r[i+1]:0,u=i+2<r.length,h=u?r[i+2]:0,f=s>>2,m=(s&3)<<4|l>>4,g=(l&15)<<2|h>>6,I=h&63;u||(I=64,a||(g=64)),n.push(t[f],t[m],t[g],t[I])}return n.join("")},encodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(r):this.encodeByteArray(X_(r),e)},decodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(r):YP(this.decodeStringToByteArray(r,e))},decodeStringToByteArray(r,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let i=0;i<r.length;){let s=t[r.charAt(i++)],l=i<r.length?t[r.charAt(i)]:0;++i;let h=i<r.length?t[r.charAt(i)]:64;++i;let m=i<r.length?t[r.charAt(i)]:64;if(++i,s==null||l==null||h==null||m==null)throw new Ku;let g=s<<2|l>>4;if(n.push(g),h!==64){let I=l<<4&240|h>>2;if(n.push(I),m!==64){let C=h<<6&192|m;n.push(C)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}},Ku=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},XP=function(r){let e=X_(r);return Z_.encodeByteArray(e,!0)},Xi=function(r){return XP(r).replace(/\./g,"")},ew=function(r){try{return Z_.decodeString(r,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};eC=()=>ZP().__FIREBASE_DEFAULTS__,tC=()=>{if(typeof process=="undefined"||typeof process.env=="undefined")return;let r=process.env.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},rC=()=>{if(typeof document=="undefined")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=r&&ew(r[1]);return e&&JSON.parse(e)},Hu=()=>{try{return eC()||tC()||rC()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},nC=r=>{var e,t;return(t=(e=Hu())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[r]},tw=r=>{let e=nC(r);if(!e)return;let t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let n=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),n]:[e.substring(0,t),n]},Wu=()=>{var r;return(r=Hu())===null||r===void 0?void 0:r.config};la=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,n))}}};sC="FirebaseError",Rt=class r extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name=sC,Object.setPrototypeOf(this,r.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Zi.prototype.create)}},Zi=class{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){let n=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],a=s?oC(s,n):"Error",l=`${this.serviceName}: ${a} (${i}).`;return new Rt(i,l,n)}};aC=/\{\$([^}]+)}/g;NB=4*60*60*1e3;});function lC(r){return r===Rr?void 0:r}function uC(r){return r.instantiationMode==="EAGER"}var Ct,Rr,Ju,ua,Yu=_(()=>{ts();Ct=class{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};Rr="[DEFAULT]";Ju=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let n=new la;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{let i=this.getOrInitializeService({instanceIdentifier:t});i&&n.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(uC(e))try{this.getOrInitializeService({instanceIdentifier:Rr})}catch{}for(let[t,n]of this.instancesDeferred.entries()){let i=this.normalizeInstanceIdentifier(t);try{let s=this.getOrInitializeService({instanceIdentifier:i});n.resolve(s)}catch{}}}}clearInstance(e=Rr){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Rr){return this.instances.has(e)}getOptions(e=Rr){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(let[s,a]of this.instancesDeferred.entries()){let l=this.normalizeInstanceIdentifier(s);n===l&&a.resolve(i)}return i}onInit(e,t){var n;let i=this.normalizeInstanceIdentifier(t),s=(n=this.onInitCallbacks.get(i))!==null&&n!==void 0?n:new Set;s.add(e),this.onInitCallbacks.set(i,s);let a=this.instances.get(i);return a&&e(a,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){let n=this.onInitCallbacks.get(t);if(n)for(let i of n)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:lC(e),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=Rr){return this.component?this.component.multipleInstances?e:Rr:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};ua=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new Ju(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}});var cC,Q,hC,dC,fC,pC,Sn,Xu=_(()=>{cC=[];(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})(Q||(Q={}));hC={debug:Q.DEBUG,verbose:Q.VERBOSE,info:Q.INFO,warn:Q.WARN,error:Q.ERROR,silent:Q.SILENT},dC=Q.INFO,fC={[Q.DEBUG]:"log",[Q.VERBOSE]:"log",[Q.INFO]:"info",[Q.WARN]:"warn",[Q.ERROR]:"error"},pC=(r,e,...t)=>{if(e<r.logLevel)return;let n=new Date().toISOString(),i=fC[e];if(i)console[i](`[${n}]  ${r.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},Sn=class{constructor(e){this.name=e,this._logLevel=dC,this._logHandler=pC,this._userLogHandler=null,cC.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Q))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?hC[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Q.DEBUG,...e),this._logHandler(this,Q.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Q.VERBOSE,...e),this._logHandler(this,Q.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Q.INFO,...e),this._logHandler(this,Q.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Q.WARN,...e),this._logHandler(this,Q.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Q.ERROR,...e),this._logHandler(this,Q.ERROR,...e)}}});function gC(){return ow||(ow=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function yC(){return aw||(aw=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}function _C(r){let e=new Promise((t,n)=>{let i=()=>{r.removeEventListener("success",s),r.removeEventListener("error",a)},s=()=>{t(ut(r.result)),i()},a=()=>{n(r.error),i()};r.addEventListener("success",s),r.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&lw.set(t,r)}).catch(()=>{}),rc.set(e,r),e}function wC(r){if(ec.has(r))return;let e=new Promise((t,n)=>{let i=()=>{r.removeEventListener("complete",s),r.removeEventListener("error",a),r.removeEventListener("abort",a)},s=()=>{t(),i()},a=()=>{n(r.error||new DOMException("AbortError","AbortError")),i()};r.addEventListener("complete",s),r.addEventListener("error",a),r.addEventListener("abort",a)});ec.set(r,e)}function cw(r){tc=r(tc)}function vC(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let n=r.call(ca(this),e,...t);return uw.set(n,e.sort?e.sort():[e]),ut(n)}:yC().includes(r)?function(...e){return r.apply(ca(this),e),ut(lw.get(this))}:function(...e){return ut(r.apply(ca(this),e))}}function bC(r){return typeof r=="function"?vC(r):(r instanceof IDBTransaction&&wC(r),mC(r,gC())?new Proxy(r,tc):r)}function ut(r){if(r instanceof IDBRequest)return _C(r);if(Zu.has(r))return Zu.get(r);let e=bC(r);return e!==r&&(Zu.set(r,e),rc.set(e,r)),e}var mC,ow,aw,lw,ec,uw,Zu,rc,tc,ca,nc=_(()=>{mC=(r,e)=>e.some(t=>r instanceof t);lw=new WeakMap,ec=new WeakMap,uw=new WeakMap,Zu=new WeakMap,rc=new WeakMap;tc={get(r,e,t){if(r instanceof IDBTransaction){if(e==="done")return ec.get(r);if(e==="objectStoreNames")return r.objectStoreNames||uw.get(r);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return ut(r[e])},set(r,e,t){return r[e]=t,!0},has(r,e){return r instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in r}};ca=r=>rc.get(r)});function dw(r,e,{blocked:t,upgrade:n,blocking:i,terminated:s}={}){let a=indexedDB.open(r,e),l=ut(a);return n&&a.addEventListener("upgradeneeded",u=>{n(ut(a.result),u.oldVersion,u.newVersion,ut(a.transaction),u)}),t&&a.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),l.then(u=>{s&&u.addEventListener("close",()=>s()),i&&u.addEventListener("versionchange",h=>i(h.oldVersion,h.newVersion,h))}).catch(()=>{}),l}function hw(r,e){if(!(r instanceof IDBDatabase&&!(e in r)&&typeof e=="string"))return;if(ic.get(e))return ic.get(e);let t=e.replace(/FromIndex$/,""),n=e!==t,i=EC.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(i||TC.includes(t)))return;let s=async function(a,...l){let u=this.transaction(a,i?"readwrite":"readonly"),h=u.store;return n&&(h=h.index(l.shift())),(await Promise.all([h[t](...l),i&&u.done]))[0]};return ic.set(e,s),s}var TC,EC,ic,fw=_(()=>{nc();nc();TC=["get","getKey","getAll","getAllKeys","count"],EC=["put","add","delete","clear"],ic=new Map;cw(r=>({...r,get:(e,t,n)=>hw(e,t)||r.get(e,t,n),has:(e,t)=>!!hw(e,t)||r.has(e,t)}))});function IC(r){let e=r.getComponent();return(e==null?void 0:e.type)==="VERSION"}function mw(r,e){try{r.container.addComponent(e)}catch(t){kt.debug(`Component ${e.name} failed to register with FirebaseApp ${r.name}`,t)}}function rs(r){let e=r.name;if(uc.has(e))return kt.debug(`There were multiple attempts to register component ${e}.`),!1;uc.set(e,r);for(let t of ha.values())mw(t,r);for(let t of ZC.values())mw(t,r);return!0}function ww(r,e){let t=r.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),r.container.getProvider(e)}function vw(r){return r==null?!1:r.settings!==void 0}function fc(r,e={}){let t=r;typeof e!="object"&&(e={name:e});let n=Object.assign({name:lc,automaticDataCollectionEnabled:!1},e),i=n.name;if(typeof i!="string"||!i)throw ar.create("bad-app-name",{appName:String(i)});if(t||(t=Wu()),!t)throw ar.create("no-options");let s=ha.get(i);if(s){if(es(t,s.options)&&es(n,s.config))return s;throw ar.create("duplicate-app",{appName:i})}let a=new ua(i);for(let u of uc.values())a.addComponent(u);let l=new cc(t,n,a);return ha.set(i,l),l}function Tw(r=lc){let e=ha.get(r);if(!e&&r===lc&&Wu())return fc();if(!e)throw ar.create("no-app",{appName:r});return e}function lr(r,e,t){var n;let i=(n=XC[r])!==null&&n!==void 0?n:r;t&&(i+=`-${t}`);let s=i.match(/\s|\//),a=e.match(/\s|\//);if(s||a){let l=[`Unable to register library "${i}" with version "${e}":`];s&&l.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&a&&l.push("and"),a&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),kt.warn(l.join(" "));return}rs(new Ct(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}function Ew(){return sc||(sc=dw(tk,rk,{upgrade:(r,e)=>{switch(e){case 0:try{r.createObjectStore(ns)}catch(t){console.warn(t)}}}}).catch(r=>{throw ar.create("idb-open",{originalErrorMessage:r.message})})),sc}async function nk(r){try{let t=(await Ew()).transaction(ns),n=await t.objectStore(ns).get(Iw(r));return await t.done,n}catch(e){if(e instanceof Rt)kt.warn(e.message);else{let t=ar.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});kt.warn(t.message)}}}async function gw(r,e){try{let n=(await Ew()).transaction(ns,"readwrite");await n.objectStore(ns).put(e,Iw(r)),await n.done}catch(t){if(t instanceof Rt)kt.warn(t.message);else{let n=ar.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});kt.warn(n.message)}}}function Iw(r){return`${r.name}!${r.options.appId}`}function yw(){return new Date().toISOString().substring(0,10)}function ok(r,e=ik){let t=[],n=r.slice();for(let i of r){let s=t.find(a=>a.agent===i.agent);if(s){if(s.dates.push(i.date),_w(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),_w(t)>e){t.pop();break}n=n.slice(1)}return{heartbeatsToSend:t,unsentEntries:n}}function _w(r){return Xi(JSON.stringify({version:2,heartbeats:r})).length}function ak(r){if(r.length===0)return-1;let e=0,t=r[0].date;for(let n=1;n<r.length;n++)r[n].date<t&&(t=r[n].date,e=n);return e}function lk(r){rs(new Ct("platform-logger",e=>new oc(e),"PRIVATE")),rs(new Ct("heartbeat",e=>new hc(e),"PRIVATE")),lr(ac,pw,r),lr(ac,pw,"esm2017"),lr("fire-js","")}var oc,ac,pw,kt,AC,xC,SC,RC,PC,CC,kC,DC,OC,NC,VC,LC,MC,FC,jC,UC,BC,$C,qC,zC,GC,KC,HC,WC,QC,JC,YC,lc,XC,ha,ZC,uc,ek,ar,cc,bw,tk,rk,ns,sc,ik,sk,hc,dc,da=_(()=>{Yu();Xu();ts();ts();fw();oc=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(IC(t)){let n=t.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(t=>t).join(" ")}};ac="@firebase/app",pw="0.11.1";kt=new Sn("@firebase/app"),AC="@firebase/app-compat",xC="@firebase/analytics-compat",SC="@firebase/analytics",RC="@firebase/app-check-compat",PC="@firebase/app-check",CC="@firebase/auth",kC="@firebase/auth-compat",DC="@firebase/database",OC="@firebase/data-connect",NC="@firebase/database-compat",VC="@firebase/functions",LC="@firebase/functions-compat",MC="@firebase/installations",FC="@firebase/installations-compat",jC="@firebase/messaging",UC="@firebase/messaging-compat",BC="@firebase/performance",$C="@firebase/performance-compat",qC="@firebase/remote-config",zC="@firebase/remote-config-compat",GC="@firebase/storage",KC="@firebase/storage-compat",HC="@firebase/firestore",WC="@firebase/vertexai",QC="@firebase/firestore-compat",JC="firebase",YC="11.3.1";lc="[DEFAULT]",XC={[ac]:"fire-core",[AC]:"fire-core-compat",[SC]:"fire-analytics",[xC]:"fire-analytics-compat",[PC]:"fire-app-check",[RC]:"fire-app-check-compat",[CC]:"fire-auth",[kC]:"fire-auth-compat",[DC]:"fire-rtdb",[OC]:"fire-data-connect",[NC]:"fire-rtdb-compat",[VC]:"fire-fn",[LC]:"fire-fn-compat",[MC]:"fire-iid",[FC]:"fire-iid-compat",[jC]:"fire-fcm",[UC]:"fire-fcm-compat",[BC]:"fire-perf",[$C]:"fire-perf-compat",[qC]:"fire-rc",[zC]:"fire-rc-compat",[GC]:"fire-gcs",[KC]:"fire-gcs-compat",[HC]:"fire-fst",[QC]:"fire-fst-compat",[WC]:"fire-vertex","fire-js":"fire-js",[JC]:"fire-js-all"};ha=new Map,ZC=new Map,uc=new Map;ek={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ar=new Zi("app","Firebase",ek);cc=class{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Ct("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ar.create("app-deleted",{appName:this._name})}};bw=YC;tk="firebase-heartbeat-database",rk=1,ns="firebase-heartbeat-store",sc=null;ik=1024,sk=30,hc=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new dc(t),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){var e,t;try{let i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=yw();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(a=>a.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats.length>sk){let a=ak(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(n){kt.warn(n)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let t=yw(),{heartbeatsToSend:n,unsentEntries:i}=ok(this._heartbeatsCache.heartbeats),s=Xi(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return kt.warn(t),""}}};dc=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Qu()?sw().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){let t=await nk(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){let i=await this.read();return gw(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){let i=await this.read();return gw(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}};lk("")});var Aw,xw,Dt,pc,Sw=_(()=>{Aw=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},xw={};(function(){var r;function e(E,y){function b(){}b.prototype=y.prototype,E.D=y.prototype,E.prototype=new b,E.prototype.constructor=E,E.C=function(T,A,S){for(var w=Array(arguments.length-2),bt=2;bt<arguments.length;bt++)w[bt-2]=arguments[bt];return y.prototype[A].apply(T,w)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(n,t),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(E,y,b){b||(b=0);var T=Array(16);if(typeof y=="string")for(var A=0;16>A;++A)T[A]=y.charCodeAt(b++)|y.charCodeAt(b++)<<8|y.charCodeAt(b++)<<16|y.charCodeAt(b++)<<24;else for(A=0;16>A;++A)T[A]=y[b++]|y[b++]<<8|y[b++]<<16|y[b++]<<24;y=E.g[0],b=E.g[1],A=E.g[2];var S=E.g[3],w=y+(S^b&(A^S))+T[0]+3614090360&4294967295;y=b+(w<<7&4294967295|w>>>25),w=S+(A^y&(b^A))+T[1]+3905402710&4294967295,S=y+(w<<12&4294967295|w>>>20),w=A+(b^S&(y^b))+T[2]+606105819&4294967295,A=S+(w<<17&4294967295|w>>>15),w=b+(y^A&(S^y))+T[3]+3250441966&4294967295,b=A+(w<<22&4294967295|w>>>10),w=y+(S^b&(A^S))+T[4]+4118548399&4294967295,y=b+(w<<7&4294967295|w>>>25),w=S+(A^y&(b^A))+T[5]+1200080426&4294967295,S=y+(w<<12&4294967295|w>>>20),w=A+(b^S&(y^b))+T[6]+2821735955&4294967295,A=S+(w<<17&4294967295|w>>>15),w=b+(y^A&(S^y))+T[7]+4249261313&4294967295,b=A+(w<<22&4294967295|w>>>10),w=y+(S^b&(A^S))+T[8]+1770035416&4294967295,y=b+(w<<7&4294967295|w>>>25),w=S+(A^y&(b^A))+T[9]+2336552879&4294967295,S=y+(w<<12&4294967295|w>>>20),w=A+(b^S&(y^b))+T[10]+4294925233&4294967295,A=S+(w<<17&4294967295|w>>>15),w=b+(y^A&(S^y))+T[11]+2304563134&4294967295,b=A+(w<<22&4294967295|w>>>10),w=y+(S^b&(A^S))+T[12]+1804603682&4294967295,y=b+(w<<7&4294967295|w>>>25),w=S+(A^y&(b^A))+T[13]+4254626195&4294967295,S=y+(w<<12&4294967295|w>>>20),w=A+(b^S&(y^b))+T[14]+2792965006&4294967295,A=S+(w<<17&4294967295|w>>>15),w=b+(y^A&(S^y))+T[15]+1236535329&4294967295,b=A+(w<<22&4294967295|w>>>10),w=y+(A^S&(b^A))+T[1]+4129170786&4294967295,y=b+(w<<5&4294967295|w>>>27),w=S+(b^A&(y^b))+T[6]+3225465664&4294967295,S=y+(w<<9&4294967295|w>>>23),w=A+(y^b&(S^y))+T[11]+643717713&4294967295,A=S+(w<<14&4294967295|w>>>18),w=b+(S^y&(A^S))+T[0]+3921069994&4294967295,b=A+(w<<20&4294967295|w>>>12),w=y+(A^S&(b^A))+T[5]+3593408605&4294967295,y=b+(w<<5&4294967295|w>>>27),w=S+(b^A&(y^b))+T[10]+38016083&4294967295,S=y+(w<<9&4294967295|w>>>23),w=A+(y^b&(S^y))+T[15]+3634488961&4294967295,A=S+(w<<14&4294967295|w>>>18),w=b+(S^y&(A^S))+T[4]+3889429448&4294967295,b=A+(w<<20&4294967295|w>>>12),w=y+(A^S&(b^A))+T[9]+568446438&4294967295,y=b+(w<<5&4294967295|w>>>27),w=S+(b^A&(y^b))+T[14]+3275163606&4294967295,S=y+(w<<9&4294967295|w>>>23),w=A+(y^b&(S^y))+T[3]+4107603335&4294967295,A=S+(w<<14&4294967295|w>>>18),w=b+(S^y&(A^S))+T[8]+1163531501&4294967295,b=A+(w<<20&4294967295|w>>>12),w=y+(A^S&(b^A))+T[13]+2850285829&4294967295,y=b+(w<<5&4294967295|w>>>27),w=S+(b^A&(y^b))+T[2]+4243563512&4294967295,S=y+(w<<9&4294967295|w>>>23),w=A+(y^b&(S^y))+T[7]+1735328473&4294967295,A=S+(w<<14&4294967295|w>>>18),w=b+(S^y&(A^S))+T[12]+2368359562&4294967295,b=A+(w<<20&4294967295|w>>>12),w=y+(b^A^S)+T[5]+4294588738&4294967295,y=b+(w<<4&4294967295|w>>>28),w=S+(y^b^A)+T[8]+2272392833&4294967295,S=y+(w<<11&4294967295|w>>>21),w=A+(S^y^b)+T[11]+1839030562&4294967295,A=S+(w<<16&4294967295|w>>>16),w=b+(A^S^y)+T[14]+4259657740&4294967295,b=A+(w<<23&4294967295|w>>>9),w=y+(b^A^S)+T[1]+2763975236&4294967295,y=b+(w<<4&4294967295|w>>>28),w=S+(y^b^A)+T[4]+1272893353&4294967295,S=y+(w<<11&4294967295|w>>>21),w=A+(S^y^b)+T[7]+4139469664&4294967295,A=S+(w<<16&4294967295|w>>>16),w=b+(A^S^y)+T[10]+3200236656&4294967295,b=A+(w<<23&4294967295|w>>>9),w=y+(b^A^S)+T[13]+681279174&4294967295,y=b+(w<<4&4294967295|w>>>28),w=S+(y^b^A)+T[0]+3936430074&4294967295,S=y+(w<<11&4294967295|w>>>21),w=A+(S^y^b)+T[3]+3572445317&4294967295,A=S+(w<<16&4294967295|w>>>16),w=b+(A^S^y)+T[6]+76029189&4294967295,b=A+(w<<23&4294967295|w>>>9),w=y+(b^A^S)+T[9]+3654602809&4294967295,y=b+(w<<4&4294967295|w>>>28),w=S+(y^b^A)+T[12]+3873151461&4294967295,S=y+(w<<11&4294967295|w>>>21),w=A+(S^y^b)+T[15]+530742520&4294967295,A=S+(w<<16&4294967295|w>>>16),w=b+(A^S^y)+T[2]+3299628645&4294967295,b=A+(w<<23&4294967295|w>>>9),w=y+(A^(b|~S))+T[0]+4096336452&4294967295,y=b+(w<<6&4294967295|w>>>26),w=S+(b^(y|~A))+T[7]+1126891415&4294967295,S=y+(w<<10&4294967295|w>>>22),w=A+(y^(S|~b))+T[14]+2878612391&4294967295,A=S+(w<<15&4294967295|w>>>17),w=b+(S^(A|~y))+T[5]+4237533241&4294967295,b=A+(w<<21&4294967295|w>>>11),w=y+(A^(b|~S))+T[12]+1700485571&4294967295,y=b+(w<<6&4294967295|w>>>26),w=S+(b^(y|~A))+T[3]+2399980690&4294967295,S=y+(w<<10&4294967295|w>>>22),w=A+(y^(S|~b))+T[10]+4293915773&4294967295,A=S+(w<<15&4294967295|w>>>17),w=b+(S^(A|~y))+T[1]+2240044497&4294967295,b=A+(w<<21&4294967295|w>>>11),w=y+(A^(b|~S))+T[8]+1873313359&4294967295,y=b+(w<<6&4294967295|w>>>26),w=S+(b^(y|~A))+T[15]+4264355552&4294967295,S=y+(w<<10&4294967295|w>>>22),w=A+(y^(S|~b))+T[6]+2734768916&4294967295,A=S+(w<<15&4294967295|w>>>17),w=b+(S^(A|~y))+T[13]+1309151649&4294967295,b=A+(w<<21&4294967295|w>>>11),w=y+(A^(b|~S))+T[4]+4149444226&4294967295,y=b+(w<<6&4294967295|w>>>26),w=S+(b^(y|~A))+T[11]+3174756917&4294967295,S=y+(w<<10&4294967295|w>>>22),w=A+(y^(S|~b))+T[2]+718787259&4294967295,A=S+(w<<15&4294967295|w>>>17),w=b+(S^(A|~y))+T[9]+3951481745&4294967295,E.g[0]=E.g[0]+y&4294967295,E.g[1]=E.g[1]+(A+(w<<21&4294967295|w>>>11))&4294967295,E.g[2]=E.g[2]+A&4294967295,E.g[3]=E.g[3]+S&4294967295}n.prototype.u=function(E,y){y===void 0&&(y=E.length);for(var b=y-this.blockSize,T=this.B,A=this.h,S=0;S<y;){if(A==0)for(;S<=b;)i(this,E,S),S+=this.blockSize;if(typeof E=="string"){for(;S<y;)if(T[A++]=E.charCodeAt(S++),A==this.blockSize){i(this,T),A=0;break}}else for(;S<y;)if(T[A++]=E[S++],A==this.blockSize){i(this,T),A=0;break}}this.h=A,this.o+=y},n.prototype.v=function(){var E=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);E[0]=128;for(var y=1;y<E.length-8;++y)E[y]=0;var b=8*this.o;for(y=E.length-8;y<E.length;++y)E[y]=b&255,b/=256;for(this.u(E),E=Array(16),y=b=0;4>y;++y)for(var T=0;32>T;T+=8)E[b++]=this.g[y]>>>T&255;return E};function s(E,y){var b=l;return Object.prototype.hasOwnProperty.call(b,E)?b[E]:b[E]=y(E)}function a(E,y){this.h=y;for(var b=[],T=!0,A=E.length-1;0<=A;A--){var S=E[A]|0;T&&S==y||(b[A]=S,T=!1)}this.g=b}var l={};function u(E){return-128<=E&&128>E?s(E,function(y){return new a([y|0],0>y?-1:0)}):new a([E|0],0>E?-1:0)}function h(E){if(isNaN(E)||!isFinite(E))return m;if(0>E)return P(h(-E));for(var y=[],b=1,T=0;E>=b;T++)y[T]=E/b|0,b*=4294967296;return new a(y,0)}function f(E,y){if(E.length==0)throw Error("number format error: empty string");if(y=y||10,2>y||36<y)throw Error("radix out of range: "+y);if(E.charAt(0)=="-")return P(f(E.substring(1),y));if(0<=E.indexOf("-"))throw Error('number format error: interior "-" character');for(var b=h(Math.pow(y,8)),T=m,A=0;A<E.length;A+=8){var S=Math.min(8,E.length-A),w=parseInt(E.substring(A,A+S),y);8>S?(S=h(Math.pow(y,S)),T=T.j(S).add(h(w))):(T=T.j(b),T=T.add(h(w)))}return T}var m=u(0),g=u(1),I=u(16777216);r=a.prototype,r.m=function(){if(k(this))return-P(this).m();for(var E=0,y=1,b=0;b<this.g.length;b++){var T=this.i(b);E+=(0<=T?T:4294967296+T)*y,y*=4294967296}return E},r.toString=function(E){if(E=E||10,2>E||36<E)throw Error("radix out of range: "+E);if(C(this))return"0";if(k(this))return"-"+P(this).toString(E);for(var y=h(Math.pow(E,6)),b=this,T="";;){var A=K(b,y).g;b=V(b,A.j(y));var S=((0<b.g.length?b.g[0]:b.h)>>>0).toString(E);if(b=A,C(b))return S+T;for(;6>S.length;)S="0"+S;T=S+T}},r.i=function(E){return 0>E?0:E<this.g.length?this.g[E]:this.h};function C(E){if(E.h!=0)return!1;for(var y=0;y<E.g.length;y++)if(E.g[y]!=0)return!1;return!0}function k(E){return E.h==-1}r.l=function(E){return E=V(this,E),k(E)?-1:C(E)?0:1};function P(E){for(var y=E.g.length,b=[],T=0;T<y;T++)b[T]=~E.g[T];return new a(b,~E.h).add(g)}r.abs=function(){return k(this)?P(this):this},r.add=function(E){for(var y=Math.max(this.g.length,E.g.length),b=[],T=0,A=0;A<=y;A++){var S=T+(this.i(A)&65535)+(E.i(A)&65535),w=(S>>>16)+(this.i(A)>>>16)+(E.i(A)>>>16);T=w>>>16,S&=65535,w&=65535,b[A]=w<<16|S}return new a(b,b[b.length-1]&-2147483648?-1:0)};function V(E,y){return E.add(P(y))}r.j=function(E){if(C(this)||C(E))return m;if(k(this))return k(E)?P(this).j(P(E)):P(P(this).j(E));if(k(E))return P(this.j(P(E)));if(0>this.l(I)&&0>E.l(I))return h(this.m()*E.m());for(var y=this.g.length+E.g.length,b=[],T=0;T<2*y;T++)b[T]=0;for(T=0;T<this.g.length;T++)for(var A=0;A<E.g.length;A++){var S=this.i(T)>>>16,w=this.i(T)&65535,bt=E.i(A)>>>16,yi=E.i(A)&65535;b[2*T+2*A]+=w*yi,F(b,2*T+2*A),b[2*T+2*A+1]+=S*yi,F(b,2*T+2*A+1),b[2*T+2*A+1]+=w*bt,F(b,2*T+2*A+1),b[2*T+2*A+2]+=S*bt,F(b,2*T+2*A+2)}for(T=0;T<y;T++)b[T]=b[2*T+1]<<16|b[2*T];for(T=y;T<2*y;T++)b[T]=0;return new a(b,0)};function F(E,y){for(;(E[y]&65535)!=E[y];)E[y+1]+=E[y]>>>16,E[y]&=65535,y++}function B(E,y){this.g=E,this.h=y}function K(E,y){if(C(y))throw Error("division by zero");if(C(E))return new B(m,m);if(k(E))return y=K(P(E),y),new B(P(y.g),P(y.h));if(k(y))return y=K(E,P(y)),new B(P(y.g),y.h);if(30<E.g.length){if(k(E)||k(y))throw Error("slowDivide_ only works with positive integers.");for(var b=g,T=y;0>=T.l(E);)b=X(b),T=X(T);var A=$(b,1),S=$(T,1);for(T=$(T,2),b=$(b,2);!C(T);){var w=S.add(T);0>=w.l(E)&&(A=A.add(b),S=w),T=$(T,1),b=$(b,1)}return y=V(E,A.j(y)),new B(A,y)}for(A=m;0<=E.l(y);){for(b=Math.max(1,Math.floor(E.m()/y.m())),T=Math.ceil(Math.log(b)/Math.LN2),T=48>=T?1:Math.pow(2,T-48),S=h(b),w=S.j(y);k(w)||0<w.l(E);)b-=T,S=h(b),w=S.j(y);C(S)&&(S=g),A=A.add(S),E=V(E,w)}return new B(A,E)}r.A=function(E){return K(this,E).h},r.and=function(E){for(var y=Math.max(this.g.length,E.g.length),b=[],T=0;T<y;T++)b[T]=this.i(T)&E.i(T);return new a(b,this.h&E.h)},r.or=function(E){for(var y=Math.max(this.g.length,E.g.length),b=[],T=0;T<y;T++)b[T]=this.i(T)|E.i(T);return new a(b,this.h|E.h)},r.xor=function(E){for(var y=Math.max(this.g.length,E.g.length),b=[],T=0;T<y;T++)b[T]=this.i(T)^E.i(T);return new a(b,this.h^E.h)};function X(E){for(var y=E.g.length+1,b=[],T=0;T<y;T++)b[T]=E.i(T)<<1|E.i(T-1)>>>31;return new a(b,E.h)}function $(E,y){var b=y>>5;y%=32;for(var T=E.g.length-b,A=[],S=0;S<T;S++)A[S]=0<y?E.i(S+b)>>>y|E.i(S+b+1)<<32-y:E.i(S+b);return new a(A,E.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,pc=xw.Md5=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=h,a.fromString=f,Dt=xw.Integer=a}).apply(typeof Aw!="undefined"?Aw:typeof self!="undefined"?self:typeof window!="undefined"?window:{})});var fa,Ot,mc,hk,Rn,gc,is,pa,yc,_c,wc,Rw=_(()=>{fa=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},Ot={};(function(){var r,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(o,c,d){return o==Array.prototype||o==Object.prototype||(o[c]=d.value),o};function t(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof fa=="object"&&fa];for(var c=0;c<o.length;++c){var d=o[c];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var n=t(this);function i(o,c){if(c)e:{var d=n;o=o.split(".");for(var p=0;p<o.length-1;p++){var x=o[p];if(!(x in d))break e;d=d[x]}o=o[o.length-1],p=d[o],c=c(p),c!=p&&c!=null&&e(d,o,{configurable:!0,writable:!0,value:c})}}function s(o,c){o instanceof String&&(o+="");var d=0,p=!1,x={next:function(){if(!p&&d<o.length){var R=d++;return{value:c(R,o[R]),done:!1}}return p=!0,{done:!0,value:void 0}}};return x[Symbol.iterator]=function(){return x},x}i("Array.prototype.values",function(o){return o||function(){return s(this,function(c,d){return d})}});var a=a||{},l=this||self;function u(o){var c=typeof o;return c=c!="object"?c:o?Array.isArray(o)?"array":c:"null",c=="array"||c=="object"&&typeof o.length=="number"}function h(o){var c=typeof o;return c=="object"&&o!=null||c=="function"}function f(o,c,d){return o.call.apply(o.bind,arguments)}function m(o,c,d){if(!o)throw Error();if(2<arguments.length){var p=Array.prototype.slice.call(arguments,2);return function(){var x=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(x,p),o.apply(c,x)}}return function(){return o.apply(c,arguments)}}function g(o,c,d){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:m,g.apply(null,arguments)}function I(o,c){var d=Array.prototype.slice.call(arguments,1);return function(){var p=d.slice();return p.push.apply(p,arguments),o.apply(this,p)}}function C(o,c){function d(){}d.prototype=c.prototype,o.aa=c.prototype,o.prototype=new d,o.prototype.constructor=o,o.Qb=function(p,x,R){for(var N=Array(arguments.length-2),ne=2;ne<arguments.length;ne++)N[ne-2]=arguments[ne];return c.prototype[x].apply(p,N)}}function k(o){let c=o.length;if(0<c){let d=Array(c);for(let p=0;p<c;p++)d[p]=o[p];return d}return[]}function P(o,c){for(let d=1;d<arguments.length;d++){let p=arguments[d];if(u(p)){let x=o.length||0,R=p.length||0;o.length=x+R;for(let N=0;N<R;N++)o[x+N]=p[N]}else o.push(p)}}class V{constructor(c,d){this.i=c,this.j=d,this.h=0,this.g=null}get(){let c;return 0<this.h?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function F(o){return/^[\s\xa0]*$/.test(o)}function B(){var o=l.navigator;return o&&(o=o.userAgent)?o:""}function K(o){return K[" "](o),o}K[" "]=function(){};var X=B().indexOf("Gecko")!=-1&&!(B().toLowerCase().indexOf("webkit")!=-1&&B().indexOf("Edge")==-1)&&!(B().indexOf("Trident")!=-1||B().indexOf("MSIE")!=-1)&&B().indexOf("Edge")==-1;function $(o,c,d){for(let p in o)c.call(d,o[p],p,o)}function E(o,c){for(let d in o)c.call(void 0,o[d],d,o)}function y(o){let c={};for(let d in o)c[d]=o[d];return c}let b="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function T(o,c){let d,p;for(let x=1;x<arguments.length;x++){p=arguments[x];for(d in p)o[d]=p[d];for(let R=0;R<b.length;R++)d=b[R],Object.prototype.hasOwnProperty.call(p,d)&&(o[d]=p[d])}}function A(o){var c=1;o=o.split(":");let d=[];for(;0<c&&o.length;)d.push(o.shift()),c--;return o.length&&d.push(o.join(":")),d}function S(o){l.setTimeout(()=>{throw o},0)}function w(){var o=Kl;let c=null;return o.g&&(c=o.g,o.g=o.g.next,o.g||(o.h=null),c.next=null),c}class bt{constructor(){this.h=this.g=null}add(c,d){let p=yi.get();p.set(c,d),this.h?this.h.next=p:this.g=p,this.h=p}}var yi=new V(()=>new zE,o=>o.reset());class zE{constructor(){this.next=this.g=this.h=null}set(c,d){this.h=c,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let _i,wi=!1,Kl=new bt,_f=()=>{let o=l.Promise.resolve(void 0);_i=()=>{o.then(GE)}};var GE=()=>{for(var o;o=w();){try{o.h.call(o.g)}catch(d){S(d)}var c=yi;c.j(o),100>c.h&&(c.h++,o.next=c.g,c.g=o)}wi=!1};function $t(){this.s=this.s,this.C=this.C}$t.prototype.s=!1,$t.prototype.ma=function(){this.s||(this.s=!0,this.N())},$t.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function xe(o,c){this.type=o,this.g=this.target=c,this.defaultPrevented=!1}xe.prototype.h=function(){this.defaultPrevented=!0};var KE=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var o=!1,c=Object.defineProperty({},"passive",{get:function(){o=!0}});try{let d=()=>{};l.addEventListener("test",d,c),l.removeEventListener("test",d,c)}catch{}return o}();function vi(o,c){if(xe.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var d=this.type=o.type,p=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=c,c=o.relatedTarget){if(X){e:{try{K(c.nodeName);var x=!0;break e}catch{}x=!1}x||(c=null)}}else d=="mouseover"?c=o.fromElement:d=="mouseout"&&(c=o.toElement);this.relatedTarget=c,p?(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=typeof o.pointerType=="string"?o.pointerType:HE[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&vi.aa.h.call(this)}}C(vi,xe);var HE={2:"touch",3:"pen",4:"mouse"};vi.prototype.h=function(){vi.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var bi="closure_listenable_"+(1e6*Math.random()|0),WE=0;function QE(o,c,d,p,x){this.listener=o,this.proxy=null,this.src=c,this.type=d,this.capture=!!p,this.ha=x,this.key=++WE,this.da=this.fa=!1}function no(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function io(o){this.src=o,this.g={},this.h=0}io.prototype.add=function(o,c,d,p,x){var R=o.toString();o=this.g[R],o||(o=this.g[R]=[],this.h++);var N=Wl(o,c,p,x);return-1<N?(c=o[N],d||(c.fa=!1)):(c=new QE(c,this.src,R,!!p,x),c.fa=d,o.push(c)),c};function Hl(o,c){var d=c.type;if(d in o.g){var p=o.g[d],x=Array.prototype.indexOf.call(p,c,void 0),R;(R=0<=x)&&Array.prototype.splice.call(p,x,1),R&&(no(c),o.g[d].length==0&&(delete o.g[d],o.h--))}}function Wl(o,c,d,p){for(var x=0;x<o.length;++x){var R=o[x];if(!R.da&&R.listener==c&&R.capture==!!d&&R.ha==p)return x}return-1}var Ql="closure_lm_"+(1e6*Math.random()|0),Jl={};function wf(o,c,d,p,x){if(p&&p.once)return bf(o,c,d,p,x);if(Array.isArray(c)){for(var R=0;R<c.length;R++)wf(o,c[R],d,p,x);return null}return d=eu(d),o&&o[bi]?o.K(c,d,h(p)?!!p.capture:!!p,x):vf(o,c,d,!1,p,x)}function vf(o,c,d,p,x,R){if(!c)throw Error("Invalid event type");var N=h(x)?!!x.capture:!!x,ne=Xl(o);if(ne||(o[Ql]=ne=new io(o)),d=ne.add(c,d,p,N,R),d.proxy)return d;if(p=JE(),d.proxy=p,p.src=o,p.listener=d,o.addEventListener)KE||(x=N),x===void 0&&(x=!1),o.addEventListener(c.toString(),p,x);else if(o.attachEvent)o.attachEvent(Ef(c.toString()),p);else if(o.addListener&&o.removeListener)o.addListener(p);else throw Error("addEventListener and attachEvent are unavailable.");return d}function JE(){function o(d){return c.call(o.src,o.listener,d)}let c=YE;return o}function bf(o,c,d,p,x){if(Array.isArray(c)){for(var R=0;R<c.length;R++)bf(o,c[R],d,p,x);return null}return d=eu(d),o&&o[bi]?o.L(c,d,h(p)?!!p.capture:!!p,x):vf(o,c,d,!0,p,x)}function Tf(o,c,d,p,x){if(Array.isArray(c))for(var R=0;R<c.length;R++)Tf(o,c[R],d,p,x);else p=h(p)?!!p.capture:!!p,d=eu(d),o&&o[bi]?(o=o.i,c=String(c).toString(),c in o.g&&(R=o.g[c],d=Wl(R,d,p,x),-1<d&&(no(R[d]),Array.prototype.splice.call(R,d,1),R.length==0&&(delete o.g[c],o.h--)))):o&&(o=Xl(o))&&(c=o.g[c.toString()],o=-1,c&&(o=Wl(c,d,p,x)),(d=-1<o?c[o]:null)&&Yl(d))}function Yl(o){if(typeof o!="number"&&o&&!o.da){var c=o.src;if(c&&c[bi])Hl(c.i,o);else{var d=o.type,p=o.proxy;c.removeEventListener?c.removeEventListener(d,p,o.capture):c.detachEvent?c.detachEvent(Ef(d),p):c.addListener&&c.removeListener&&c.removeListener(p),(d=Xl(c))?(Hl(d,o),d.h==0&&(d.src=null,c[Ql]=null)):no(o)}}}function Ef(o){return o in Jl?Jl[o]:Jl[o]="on"+o}function YE(o,c){if(o.da)o=!0;else{c=new vi(c,this);var d=o.listener,p=o.ha||o.src;o.fa&&Yl(o),o=d.call(p,c)}return o}function Xl(o){return o=o[Ql],o instanceof io?o:null}var Zl="__closure_events_fn_"+(1e9*Math.random()>>>0);function eu(o){return typeof o=="function"?o:(o[Zl]||(o[Zl]=function(c){return o.handleEvent(c)}),o[Zl])}function Se(){$t.call(this),this.i=new io(this),this.M=this,this.F=null}C(Se,$t),Se.prototype[bi]=!0,Se.prototype.removeEventListener=function(o,c,d,p){Tf(this,o,c,d,p)};function Oe(o,c){var d,p=o.F;if(p)for(d=[];p;p=p.F)d.push(p);if(o=o.M,p=c.type||c,typeof c=="string")c=new xe(c,o);else if(c instanceof xe)c.target=c.target||o;else{var x=c;c=new xe(p,o),T(c,x)}if(x=!0,d)for(var R=d.length-1;0<=R;R--){var N=c.g=d[R];x=so(N,p,!0,c)&&x}if(N=c.g=o,x=so(N,p,!0,c)&&x,x=so(N,p,!1,c)&&x,d)for(R=0;R<d.length;R++)N=c.g=d[R],x=so(N,p,!1,c)&&x}Se.prototype.N=function(){if(Se.aa.N.call(this),this.i){var o=this.i,c;for(c in o.g){for(var d=o.g[c],p=0;p<d.length;p++)no(d[p]);delete o.g[c],o.h--}}this.F=null},Se.prototype.K=function(o,c,d,p){return this.i.add(String(o),c,!1,d,p)},Se.prototype.L=function(o,c,d,p){return this.i.add(String(o),c,!0,d,p)};function so(o,c,d,p){if(c=o.i.g[String(c)],!c)return!0;c=c.concat();for(var x=!0,R=0;R<c.length;++R){var N=c[R];if(N&&!N.da&&N.capture==d){var ne=N.listener,Te=N.ha||N.src;N.fa&&Hl(o.i,N),x=ne.call(Te,p)!==!1&&x}}return x&&!p.defaultPrevented}function If(o,c,d){if(typeof o=="function")d&&(o=g(o,d));else if(o&&typeof o.handleEvent=="function")o=g(o.handleEvent,o);else throw Error("Invalid listener argument");return 2147483647<Number(c)?-1:l.setTimeout(o,c||0)}function Af(o){o.g=If(()=>{o.g=null,o.i&&(o.i=!1,Af(o))},o.l);let c=o.h;o.h=null,o.m.apply(null,c)}class XE extends $t{constructor(c,d){super(),this.m=c,this.l=d,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:Af(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ti(o){$t.call(this),this.h=o,this.g={}}C(Ti,$t);var xf=[];function Sf(o){$(o.g,function(c,d){this.g.hasOwnProperty(d)&&Yl(c)},o),o.g={}}Ti.prototype.N=function(){Ti.aa.N.call(this),Sf(this)},Ti.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var tu=l.JSON.stringify,ZE=l.JSON.parse,e0=class{stringify(o){return l.JSON.stringify(o,void 0)}parse(o){return l.JSON.parse(o,void 0)}};function ru(){}ru.prototype.h=null;function Rf(o){return o.h||(o.h=o.i())}function Pf(){}var Ei={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function nu(){xe.call(this,"d")}C(nu,xe);function iu(){xe.call(this,"c")}C(iu,xe);var vr={},Cf=null;function oo(){return Cf=Cf||new Se}vr.La="serverreachability";function kf(o){xe.call(this,vr.La,o)}C(kf,xe);function Ii(o){let c=oo();Oe(c,new kf(c))}vr.STAT_EVENT="statevent";function Df(o,c){xe.call(this,vr.STAT_EVENT,o),this.stat=c}C(Df,xe);function Ne(o){let c=oo();Oe(c,new Df(c,o))}vr.Ma="timingevent";function Of(o,c){xe.call(this,vr.Ma,o),this.size=c}C(Of,xe);function Ai(o,c){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){o()},c)}function xi(){this.g=!0}xi.prototype.xa=function(){this.g=!1};function t0(o,c,d,p,x,R){o.info(function(){if(o.g)if(R)for(var N="",ne=R.split("&"),Te=0;Te<ne.length;Te++){var Z=ne[Te].split("=");if(1<Z.length){var Re=Z[0];Z=Z[1];var Pe=Re.split("_");N=2<=Pe.length&&Pe[1]=="type"?N+(Re+"="+Z+"&"):N+(Re+"=redacted&")}}else N=null;else N=R;return"XMLHTTP REQ ("+p+") [attempt "+x+"]: "+c+`
`+d+`
`+N})}function r0(o,c,d,p,x,R,N){o.info(function(){return"XMLHTTP RESP ("+p+") [ attempt "+x+"]: "+c+`
`+d+`
`+R+" "+N})}function Zr(o,c,d,p){o.info(function(){return"XMLHTTP TEXT ("+c+"): "+i0(o,d)+(p?" "+p:"")})}function n0(o,c){o.info(function(){return"TIMEOUT: "+c})}xi.prototype.info=function(){};function i0(o,c){if(!o.g)return c;if(!c)return null;try{var d=JSON.parse(c);if(d){for(o=0;o<d.length;o++)if(Array.isArray(d[o])){var p=d[o];if(!(2>p.length)){var x=p[1];if(Array.isArray(x)&&!(1>x.length)){var R=x[0];if(R!="noop"&&R!="stop"&&R!="close")for(var N=1;N<x.length;N++)x[N]=""}}}}return tu(d)}catch{return c}}var ao={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Nf={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},su;function lo(){}C(lo,ru),lo.prototype.g=function(){return new XMLHttpRequest},lo.prototype.i=function(){return{}},su=new lo;function qt(o,c,d,p){this.j=o,this.i=c,this.l=d,this.R=p||1,this.U=new Ti(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Vf}function Vf(){this.i=null,this.g="",this.h=!1}var Lf={},ou={};function au(o,c,d){o.L=1,o.v=fo(Tt(c)),o.m=d,o.P=!0,Mf(o,null)}function Mf(o,c){o.F=Date.now(),uo(o),o.A=Tt(o.v);var d=o.A,p=o.R;Array.isArray(p)||(p=[String(p)]),Yf(d.i,"t",p),o.C=0,d=o.j.J,o.h=new Vf,o.g=mp(o.j,d?c:null,!o.m),0<o.O&&(o.M=new XE(g(o.Y,o,o.g),o.O)),c=o.U,d=o.g,p=o.ca;var x="readystatechange";Array.isArray(x)||(x&&(xf[0]=x.toString()),x=xf);for(var R=0;R<x.length;R++){var N=wf(d,x[R],p||c.handleEvent,!1,c.h||c);if(!N)break;c.g[N.key]=N}c=o.H?y(o.H):{},o.m?(o.u||(o.u="POST"),c["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,c)):(o.u="GET",o.g.ea(o.A,o.u,null,c)),Ii(),t0(o.i,o.u,o.A,o.l,o.R,o.m)}qt.prototype.ca=function(o){o=o.target;let c=this.M;c&&Et(o)==3?c.j():this.Y(o)},qt.prototype.Y=function(o){try{if(o==this.g)e:{let Pe=Et(this.g);var c=this.g.Ba();let rn=this.g.Z();if(!(3>Pe)&&(Pe!=3||this.g&&(this.h.h||this.g.oa()||ip(this.g)))){this.J||Pe!=4||c==7||(c==8||0>=rn?Ii(3):Ii(2)),lu(this);var d=this.g.Z();this.X=d;t:if(Ff(this)){var p=ip(this.g);o="";var x=p.length,R=Et(this.g)==4;if(!this.h.i){if(typeof TextDecoder=="undefined"){br(this),Si(this);var N="";break t}this.h.i=new l.TextDecoder}for(c=0;c<x;c++)this.h.h=!0,o+=this.h.i.decode(p[c],{stream:!(R&&c==x-1)});p.length=0,this.h.g+=o,this.C=0,N=this.h.g}else N=this.g.oa();if(this.o=d==200,r0(this.i,this.u,this.A,this.l,this.R,Pe,d),this.o){if(this.T&&!this.K){t:{if(this.g){var ne,Te=this.g;if((ne=Te.g?Te.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!F(ne)){var Z=ne;break t}}Z=null}if(d=Z)Zr(this.i,this.l,d,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,uu(this,d);else{this.o=!1,this.s=3,Ne(12),br(this),Si(this);break e}}if(this.P){d=!0;let et;for(;!this.J&&this.C<N.length;)if(et=s0(this,N),et==ou){Pe==4&&(this.s=4,Ne(14),d=!1),Zr(this.i,this.l,null,"[Incomplete Response]");break}else if(et==Lf){this.s=4,Ne(15),Zr(this.i,this.l,N,"[Invalid Chunk]"),d=!1;break}else Zr(this.i,this.l,et,null),uu(this,et);if(Ff(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Pe!=4||N.length!=0||this.h.h||(this.s=1,Ne(16),d=!1),this.o=this.o&&d,!d)Zr(this.i,this.l,N,"[Invalid Chunked Response]"),br(this),Si(this);else if(0<N.length&&!this.W){this.W=!0;var Re=this.j;Re.g==this&&Re.ba&&!Re.M&&(Re.j.info("Great, no buffering proxy detected. Bytes received: "+N.length),mu(Re),Re.M=!0,Ne(11))}}else Zr(this.i,this.l,N,null),uu(this,N);Pe==4&&br(this),this.o&&!this.J&&(Pe==4?hp(this.j,this):(this.o=!1,uo(this)))}else T0(this.g),d==400&&0<N.indexOf("Unknown SID")?(this.s=3,Ne(12)):(this.s=0,Ne(13)),br(this),Si(this)}}}catch{}finally{}};function Ff(o){return o.g?o.u=="GET"&&o.L!=2&&o.j.Ca:!1}function s0(o,c){var d=o.C,p=c.indexOf(`
`,d);return p==-1?ou:(d=Number(c.substring(d,p)),isNaN(d)?Lf:(p+=1,p+d>c.length?ou:(c=c.slice(p,p+d),o.C=p+d,c)))}qt.prototype.cancel=function(){this.J=!0,br(this)};function uo(o){o.S=Date.now()+o.I,jf(o,o.I)}function jf(o,c){if(o.B!=null)throw Error("WatchDog timer not null");o.B=Ai(g(o.ba,o),c)}function lu(o){o.B&&(l.clearTimeout(o.B),o.B=null)}qt.prototype.ba=function(){this.B=null;let o=Date.now();0<=o-this.S?(n0(this.i,this.A),this.L!=2&&(Ii(),Ne(17)),br(this),this.s=2,Si(this)):jf(this,this.S-o)};function Si(o){o.j.G==0||o.J||hp(o.j,o)}function br(o){lu(o);var c=o.M;c&&typeof c.ma=="function"&&c.ma(),o.M=null,Sf(o.U),o.g&&(c=o.g,o.g=null,c.abort(),c.ma())}function uu(o,c){try{var d=o.j;if(d.G!=0&&(d.g==o||cu(d.h,o))){if(!o.K&&cu(d.h,o)&&d.G==3){try{var p=d.Da.g.parse(c)}catch{p=null}if(Array.isArray(p)&&p.length==3){var x=p;if(x[0]==0){e:if(!d.u){if(d.g)if(d.g.F+3e3<o.F)_o(d),go(d);else break e;pu(d),Ne(18)}}else d.za=x[1],0<d.za-d.T&&37500>x[2]&&d.F&&d.v==0&&!d.C&&(d.C=Ai(g(d.Za,d),6e3));if(1>=$f(d.h)&&d.ca){try{d.ca()}catch{}d.ca=void 0}}else Er(d,11)}else if((o.K||d.g==o)&&_o(d),!F(c))for(x=d.Da.g.parse(c),c=0;c<x.length;c++){let Z=x[c];if(d.T=Z[0],Z=Z[1],d.G==2)if(Z[0]=="c"){d.K=Z[1],d.ia=Z[2];let Re=Z[3];Re!=null&&(d.la=Re,d.j.info("VER="+d.la));let Pe=Z[4];Pe!=null&&(d.Aa=Pe,d.j.info("SVER="+d.Aa));let rn=Z[5];rn!=null&&typeof rn=="number"&&0<rn&&(p=1.5*rn,d.L=p,d.j.info("backChannelRequestTimeoutMs_="+p)),p=d;let et=o.g;if(et){let vo=et.g?et.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(vo){var R=p.h;R.g||vo.indexOf("spdy")==-1&&vo.indexOf("quic")==-1&&vo.indexOf("h2")==-1||(R.j=R.l,R.g=new Set,R.h&&(hu(R,R.h),R.h=null))}if(p.D){let gu=et.g?et.g.getResponseHeader("X-HTTP-Session-Id"):null;gu&&(p.ya=gu,oe(p.I,p.D,gu))}}d.G=3,d.l&&d.l.ua(),d.ba&&(d.R=Date.now()-o.F,d.j.info("Handshake RTT: "+d.R+"ms")),p=d;var N=o;if(p.qa=pp(p,p.J?p.ia:null,p.W),N.K){qf(p.h,N);var ne=N,Te=p.L;Te&&(ne.I=Te),ne.B&&(lu(ne),uo(ne)),p.g=N}else up(p);0<d.i.length&&yo(d)}else Z[0]!="stop"&&Z[0]!="close"||Er(d,7);else d.G==3&&(Z[0]=="stop"||Z[0]=="close"?Z[0]=="stop"?Er(d,7):fu(d):Z[0]!="noop"&&d.l&&d.l.ta(Z),d.v=0)}}Ii(4)}catch{}}var o0=class{constructor(o,c){this.g=o,this.map=c}};function Uf(o){this.l=o||10,l.PerformanceNavigationTiming?(o=l.performance.getEntriesByType("navigation"),o=0<o.length&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Bf(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function $f(o){return o.h?1:o.g?o.g.size:0}function cu(o,c){return o.h?o.h==c:o.g?o.g.has(c):!1}function hu(o,c){o.g?o.g.add(c):o.h=c}function qf(o,c){o.h&&o.h==c?o.h=null:o.g&&o.g.has(c)&&o.g.delete(c)}Uf.prototype.cancel=function(){if(this.i=zf(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let o of this.g.values())o.cancel();this.g.clear()}};function zf(o){if(o.h!=null)return o.i.concat(o.h.D);if(o.g!=null&&o.g.size!==0){let c=o.i;for(let d of o.g.values())c=c.concat(d.D);return c}return k(o.i)}function a0(o){if(o.V&&typeof o.V=="function")return o.V();if(typeof Map!="undefined"&&o instanceof Map||typeof Set!="undefined"&&o instanceof Set)return Array.from(o.values());if(typeof o=="string")return o.split("");if(u(o)){for(var c=[],d=o.length,p=0;p<d;p++)c.push(o[p]);return c}c=[],d=0;for(p in o)c[d++]=o[p];return c}function l0(o){if(o.na&&typeof o.na=="function")return o.na();if(!o.V||typeof o.V!="function"){if(typeof Map!="undefined"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set!="undefined"&&o instanceof Set)){if(u(o)||typeof o=="string"){var c=[];o=o.length;for(var d=0;d<o;d++)c.push(d);return c}c=[],d=0;for(let p in o)c[d++]=p;return c}}}function Gf(o,c){if(o.forEach&&typeof o.forEach=="function")o.forEach(c,void 0);else if(u(o)||typeof o=="string")Array.prototype.forEach.call(o,c,void 0);else for(var d=l0(o),p=a0(o),x=p.length,R=0;R<x;R++)c.call(void 0,p[R],d&&d[R],o)}var Kf=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function u0(o,c){if(o){o=o.split("&");for(var d=0;d<o.length;d++){var p=o[d].indexOf("="),x=null;if(0<=p){var R=o[d].substring(0,p);x=o[d].substring(p+1)}else R=o[d];c(R,x?decodeURIComponent(x.replace(/\+/g," ")):"")}}}function Tr(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof Tr){this.h=o.h,co(this,o.j),this.o=o.o,this.g=o.g,ho(this,o.s),this.l=o.l;var c=o.i,d=new Ci;d.i=c.i,c.g&&(d.g=new Map(c.g),d.h=c.h),Hf(this,d),this.m=o.m}else o&&(c=String(o).match(Kf))?(this.h=!1,co(this,c[1]||"",!0),this.o=Ri(c[2]||""),this.g=Ri(c[3]||"",!0),ho(this,c[4]),this.l=Ri(c[5]||"",!0),Hf(this,c[6]||"",!0),this.m=Ri(c[7]||"")):(this.h=!1,this.i=new Ci(null,this.h))}Tr.prototype.toString=function(){var o=[],c=this.j;c&&o.push(Pi(c,Wf,!0),":");var d=this.g;return(d||c=="file")&&(o.push("//"),(c=this.o)&&o.push(Pi(c,Wf,!0),"@"),o.push(encodeURIComponent(String(d)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.s,d!=null&&o.push(":",String(d))),(d=this.l)&&(this.g&&d.charAt(0)!="/"&&o.push("/"),o.push(Pi(d,d.charAt(0)=="/"?d0:h0,!0))),(d=this.i.toString())&&o.push("?",d),(d=this.m)&&o.push("#",Pi(d,p0)),o.join("")};function Tt(o){return new Tr(o)}function co(o,c,d){o.j=d?Ri(c,!0):c,o.j&&(o.j=o.j.replace(/:$/,""))}function ho(o,c){if(c){if(c=Number(c),isNaN(c)||0>c)throw Error("Bad port number "+c);o.s=c}else o.s=null}function Hf(o,c,d){c instanceof Ci?(o.i=c,m0(o.i,o.h)):(d||(c=Pi(c,f0)),o.i=new Ci(c,o.h))}function oe(o,c,d){o.i.set(c,d)}function fo(o){return oe(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function Ri(o,c){return o?c?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function Pi(o,c,d){return typeof o=="string"?(o=encodeURI(o).replace(c,c0),d&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function c0(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var Wf=/[#\/\?@]/g,h0=/[#\?:]/g,d0=/[#\?]/g,f0=/[#\?@]/g,p0=/#/g;function Ci(o,c){this.h=this.g=null,this.i=o||null,this.j=!!c}function zt(o){o.g||(o.g=new Map,o.h=0,o.i&&u0(o.i,function(c,d){o.add(decodeURIComponent(c.replace(/\+/g," ")),d)}))}r=Ci.prototype,r.add=function(o,c){zt(this),this.i=null,o=en(this,o);var d=this.g.get(o);return d||this.g.set(o,d=[]),d.push(c),this.h+=1,this};function Qf(o,c){zt(o),c=en(o,c),o.g.has(c)&&(o.i=null,o.h-=o.g.get(c).length,o.g.delete(c))}function Jf(o,c){return zt(o),c=en(o,c),o.g.has(c)}r.forEach=function(o,c){zt(this),this.g.forEach(function(d,p){d.forEach(function(x){o.call(c,x,p,this)},this)},this)},r.na=function(){zt(this);let o=Array.from(this.g.values()),c=Array.from(this.g.keys()),d=[];for(let p=0;p<c.length;p++){let x=o[p];for(let R=0;R<x.length;R++)d.push(c[p])}return d},r.V=function(o){zt(this);let c=[];if(typeof o=="string")Jf(this,o)&&(c=c.concat(this.g.get(en(this,o))));else{o=Array.from(this.g.values());for(let d=0;d<o.length;d++)c=c.concat(o[d])}return c},r.set=function(o,c){return zt(this),this.i=null,o=en(this,o),Jf(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[c]),this.h+=1,this},r.get=function(o,c){return o?(o=this.V(o),0<o.length?String(o[0]):c):c};function Yf(o,c,d){Qf(o,c),0<d.length&&(o.i=null,o.g.set(en(o,c),k(d)),o.h+=d.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";let o=[],c=Array.from(this.g.keys());for(var d=0;d<c.length;d++){var p=c[d];let R=encodeURIComponent(String(p)),N=this.V(p);for(p=0;p<N.length;p++){var x=R;N[p]!==""&&(x+="="+encodeURIComponent(String(N[p]))),o.push(x)}}return this.i=o.join("&")};function en(o,c){return c=String(c),o.j&&(c=c.toLowerCase()),c}function m0(o,c){c&&!o.j&&(zt(o),o.i=null,o.g.forEach(function(d,p){var x=p.toLowerCase();p!=x&&(Qf(this,p),Yf(this,x,d))},o)),o.j=c}function g0(o,c){let d=new xi;if(l.Image){let p=new Image;p.onload=I(Gt,d,"TestLoadImage: loaded",!0,c,p),p.onerror=I(Gt,d,"TestLoadImage: error",!1,c,p),p.onabort=I(Gt,d,"TestLoadImage: abort",!1,c,p),p.ontimeout=I(Gt,d,"TestLoadImage: timeout",!1,c,p),l.setTimeout(function(){p.ontimeout&&p.ontimeout()},1e4),p.src=o}else c(!1)}function y0(o,c){let d=new xi,p=new AbortController,x=setTimeout(()=>{p.abort(),Gt(d,"TestPingServer: timeout",!1,c)},1e4);fetch(o,{signal:p.signal}).then(R=>{clearTimeout(x),R.ok?Gt(d,"TestPingServer: ok",!0,c):Gt(d,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(x),Gt(d,"TestPingServer: error",!1,c)})}function Gt(o,c,d,p,x){try{x&&(x.onload=null,x.onerror=null,x.onabort=null,x.ontimeout=null),p(d)}catch{}}function _0(){this.g=new e0}function w0(o,c,d){let p=d||"";try{Gf(o,function(x,R){let N=x;h(x)&&(N=tu(x)),c.push(p+R+"="+encodeURIComponent(N))})}catch(x){throw c.push(p+"type="+encodeURIComponent("_badmap")),x}}function ki(o){this.l=o.Ub||null,this.j=o.eb||!1}C(ki,ru),ki.prototype.g=function(){return new po(this.l,this.j)},ki.prototype.i=function(o){return function(){return o}}({});function po(o,c){Se.call(this),this.D=o,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}C(po,Se),r=po.prototype,r.open=function(o,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=c,this.readyState=1,Oi(this)},r.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let c={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(c.body=o),(this.D||l).fetch(new Request(this.A,c)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Di(this)),this.readyState=0},r.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,Oi(this)),this.g&&(this.readyState=3,Oi(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream!="undefined"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Xf(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))};function Xf(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}r.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var c=o.value?o.value:new Uint8Array(0);(c=this.v.decode(c,{stream:!o.done}))&&(this.response=this.responseText+=c)}o.done?Di(this):Oi(this),this.readyState==3&&Xf(this)}},r.Ra=function(o){this.g&&(this.response=this.responseText=o,Di(this))},r.Qa=function(o){this.g&&(this.response=o,Di(this))},r.ga=function(){this.g&&Di(this)};function Di(o){o.readyState=4,o.l=null,o.j=null,o.v=null,Oi(o)}r.setRequestHeader=function(o,c){this.u.append(o,c)},r.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";let o=[],c=this.h.entries();for(var d=c.next();!d.done;)d=d.value,o.push(d[0]+": "+d[1]),d=c.next();return o.join(`\r
`)};function Oi(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(po.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function Zf(o){let c="";return $(o,function(d,p){c+=p,c+=":",c+=d,c+=`\r
`}),c}function du(o,c,d){e:{for(p in d){var p=!1;break e}p=!0}p||(d=Zf(d),typeof o=="string"?d!=null&&encodeURIComponent(String(d)):oe(o,c,d))}function ce(o){Se.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}C(ce,Se);var v0=/^https?$/i,b0=["POST","PUT"];r=ce.prototype,r.Ha=function(o){this.J=o},r.ea=function(o,c,d,p){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);c=c?c.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():su.g(),this.v=this.o?Rf(this.o):Rf(su),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(c,String(o),!0),this.B=!1}catch(R){ep(this,R);return}if(o=d||"",d=new Map(this.headers),p)if(Object.getPrototypeOf(p)===Object.prototype)for(var x in p)d.set(x,p[x]);else if(typeof p.keys=="function"&&typeof p.get=="function")for(let R of p.keys())d.set(R,p.get(R));else throw Error("Unknown input type for opt_headers: "+String(p));p=Array.from(d.keys()).find(R=>R.toLowerCase()=="content-type"),x=l.FormData&&o instanceof l.FormData,!(0<=Array.prototype.indexOf.call(b0,c,void 0))||p||x||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[R,N]of d)this.g.setRequestHeader(R,N);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{np(this),this.u=!0,this.g.send(o),this.u=!1}catch(R){ep(this,R)}};function ep(o,c){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=c,o.m=5,tp(o),mo(o)}function tp(o){o.A||(o.A=!0,Oe(o,"complete"),Oe(o,"error"))}r.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,Oe(this,"complete"),Oe(this,"abort"),mo(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),mo(this,!0)),ce.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?rp(this):this.bb())},r.bb=function(){rp(this)};function rp(o){if(o.h&&typeof a!="undefined"&&(!o.v[1]||Et(o)!=4||o.Z()!=2)){if(o.u&&Et(o)==4)If(o.Ea,0,o);else if(Oe(o,"readystatechange"),Et(o)==4){o.h=!1;try{let N=o.Z();e:switch(N){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var d;if(!(d=c)){var p;if(p=N===0){var x=String(o.D).match(Kf)[1]||null;!x&&l.self&&l.self.location&&(x=l.self.location.protocol.slice(0,-1)),p=!v0.test(x?x.toLowerCase():"")}d=p}if(d)Oe(o,"complete"),Oe(o,"success");else{o.m=6;try{var R=2<Et(o)?o.g.statusText:""}catch{R=""}o.l=R+" ["+o.Z()+"]",tp(o)}}finally{mo(o)}}}}function mo(o,c){if(o.g){np(o);let d=o.g,p=o.v[0]?()=>{}:null;o.g=null,o.v=null,c||Oe(o,"ready");try{d.onreadystatechange=p}catch{}}}function np(o){o.I&&(l.clearTimeout(o.I),o.I=null)}r.isActive=function(){return!!this.g};function Et(o){return o.g?o.g.readyState:0}r.Z=function(){try{return 2<Et(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(o){if(this.g){var c=this.g.responseText;return o&&c.indexOf(o)==0&&(c=c.substring(o.length)),ZE(c)}};function ip(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function T0(o){let c={};o=(o.g&&2<=Et(o)&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let p=0;p<o.length;p++){if(F(o[p]))continue;var d=A(o[p]);let x=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();let R=c[x]||[];c[x]=R,R.push(d)}E(c,function(p){return p.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ni(o,c,d){return d&&d.internalChannelParams&&d.internalChannelParams[o]||c}function sp(o){this.Aa=0,this.i=[],this.j=new xi,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Ni("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Ni("baseRetryDelayMs",5e3,o),this.cb=Ni("retryDelaySeedMs",1e4,o),this.Wa=Ni("forwardChannelMaxRetries",2,o),this.wa=Ni("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new Uf(o&&o.concurrentRequestLimit),this.Da=new _0,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=sp.prototype,r.la=8,r.G=1,r.connect=function(o,c,d,p){Ne(0),this.W=o,this.H=c||{},d&&p!==void 0&&(this.H.OSID=d,this.H.OAID=p),this.F=this.X,this.I=pp(this,null,this.W),yo(this)};function fu(o){if(op(o),o.G==3){var c=o.U++,d=Tt(o.I);if(oe(d,"SID",o.K),oe(d,"RID",c),oe(d,"TYPE","terminate"),Vi(o,d),c=new qt(o,o.j,c),c.L=2,c.v=fo(Tt(d)),d=!1,l.navigator&&l.navigator.sendBeacon)try{d=l.navigator.sendBeacon(c.v.toString(),"")}catch{}!d&&l.Image&&(new Image().src=c.v,d=!0),d||(c.g=mp(c.j,null),c.g.ea(c.v)),c.F=Date.now(),uo(c)}fp(o)}function go(o){o.g&&(mu(o),o.g.cancel(),o.g=null)}function op(o){go(o),o.u&&(l.clearTimeout(o.u),o.u=null),_o(o),o.h.cancel(),o.s&&(typeof o.s=="number"&&l.clearTimeout(o.s),o.s=null)}function yo(o){if(!Bf(o.h)&&!o.s){o.s=!0;var c=o.Ga;_i||_f(),wi||(_i(),wi=!0),Kl.add(c,o),o.B=0}}function E0(o,c){return $f(o.h)>=o.h.j-(o.s?1:0)?!1:o.s?(o.i=c.D.concat(o.i),!0):o.G==1||o.G==2||o.B>=(o.Va?0:o.Wa)?!1:(o.s=Ai(g(o.Ga,o,c),dp(o,o.B)),o.B++,!0)}r.Ga=function(o){if(this.s)if(this.s=null,this.G==1){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;let x=new qt(this,this.j,o),R=this.o;if(this.S&&(R?(R=y(R),T(R,this.S)):R=this.S),this.m!==null||this.O||(x.H=R,R=null),this.P)e:{for(var c=0,d=0;d<this.i.length;d++){t:{var p=this.i[d];if("__data__"in p.map&&(p=p.map.__data__,typeof p=="string")){p=p.length;break t}p=void 0}if(p===void 0)break;if(c+=p,4096<c){c=d;break e}if(c===4096||d===this.i.length-1){c=d+1;break e}}c=1e3}else c=1e3;c=lp(this,x,c),d=Tt(this.I),oe(d,"RID",o),oe(d,"CVER",22),this.D&&oe(d,"X-HTTP-Session-Id",this.D),Vi(this,d),R&&(this.O?c="headers="+encodeURIComponent(String(Zf(R)))+"&"+c:this.m&&du(d,this.m,R)),hu(this.h,x),this.Ua&&oe(d,"TYPE","init"),this.P?(oe(d,"$req",c),oe(d,"SID","null"),x.T=!0,au(x,d,null)):au(x,d,c),this.G=2}}else this.G==3&&(o?ap(this,o):this.i.length==0||Bf(this.h)||ap(this))};function ap(o,c){var d;c?d=c.l:d=o.U++;let p=Tt(o.I);oe(p,"SID",o.K),oe(p,"RID",d),oe(p,"AID",o.T),Vi(o,p),o.m&&o.o&&du(p,o.m,o.o),d=new qt(o,o.j,d,o.B+1),o.m===null&&(d.H=o.o),c&&(o.i=c.D.concat(o.i)),c=lp(o,d,1e3),d.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),hu(o.h,d),au(d,p,c)}function Vi(o,c){o.H&&$(o.H,function(d,p){oe(c,p,d)}),o.l&&Gf({},function(d,p){oe(c,p,d)})}function lp(o,c,d){d=Math.min(o.i.length,d);var p=o.l?g(o.l.Na,o.l,o):null;e:{var x=o.i;let R=-1;for(;;){let N=["count="+d];R==-1?0<d?(R=x[0].g,N.push("ofs="+R)):R=0:N.push("ofs="+R);let ne=!0;for(let Te=0;Te<d;Te++){let Z=x[Te].g,Re=x[Te].map;if(Z-=R,0>Z)R=Math.max(0,x[Te].g-100),ne=!1;else try{w0(Re,N,"req"+Z+"_")}catch{p&&p(Re)}}if(ne){p=N.join("&");break e}}}return o=o.i.splice(0,d),c.D=o,p}function up(o){if(!o.g&&!o.u){o.Y=1;var c=o.Fa;_i||_f(),wi||(_i(),wi=!0),Kl.add(c,o),o.v=0}}function pu(o){return o.g||o.u||3<=o.v?!1:(o.Y++,o.u=Ai(g(o.Fa,o),dp(o,o.v)),o.v++,!0)}r.Fa=function(){if(this.u=null,cp(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=Ai(g(this.ab,this),o)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ne(10),go(this),cp(this))};function mu(o){o.A!=null&&(l.clearTimeout(o.A),o.A=null)}function cp(o){o.g=new qt(o,o.j,"rpc",o.Y),o.m===null&&(o.g.H=o.o),o.g.O=0;var c=Tt(o.qa);oe(c,"RID","rpc"),oe(c,"SID",o.K),oe(c,"AID",o.T),oe(c,"CI",o.F?"0":"1"),!o.F&&o.ja&&oe(c,"TO",o.ja),oe(c,"TYPE","xmlhttp"),Vi(o,c),o.m&&o.o&&du(c,o.m,o.o),o.L&&(o.g.I=o.L);var d=o.g;o=o.ia,d.L=1,d.v=fo(Tt(c)),d.m=null,d.P=!0,Mf(d,o)}r.Za=function(){this.C!=null&&(this.C=null,go(this),pu(this),Ne(19))};function _o(o){o.C!=null&&(l.clearTimeout(o.C),o.C=null)}function hp(o,c){var d=null;if(o.g==c){_o(o),mu(o),o.g=null;var p=2}else if(cu(o.h,c))d=c.D,qf(o.h,c),p=1;else return;if(o.G!=0){if(c.o)if(p==1){d=c.m?c.m.length:0,c=Date.now()-c.F;var x=o.B;p=oo(),Oe(p,new Of(p,d)),yo(o)}else up(o);else if(x=c.s,x==3||x==0&&0<c.X||!(p==1&&E0(o,c)||p==2&&pu(o)))switch(d&&0<d.length&&(c=o.h,c.i=c.i.concat(d)),x){case 1:Er(o,5);break;case 4:Er(o,10);break;case 3:Er(o,6);break;default:Er(o,2)}}}function dp(o,c){let d=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(d*=2),d*c}function Er(o,c){if(o.j.info("Error code "+c),c==2){var d=g(o.fb,o),p=o.Xa;let x=!p;p=new Tr(p||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||co(p,"https"),fo(p),x?g0(p.toString(),d):y0(p.toString(),d)}else Ne(2);o.G=0,o.l&&o.l.sa(c),fp(o),op(o)}r.fb=function(o){o?(this.j.info("Successfully pinged google.com"),Ne(2)):(this.j.info("Failed to ping google.com"),Ne(1))};function fp(o){if(o.G=0,o.ka=[],o.l){let c=zf(o.h);(c.length!=0||o.i.length!=0)&&(P(o.ka,c),P(o.ka,o.i),o.h.i.length=0,k(o.i),o.i.length=0),o.l.ra()}}function pp(o,c,d){var p=d instanceof Tr?Tt(d):new Tr(d);if(p.g!="")c&&(p.g=c+"."+p.g),ho(p,p.s);else{var x=l.location;p=x.protocol,c=c?c+"."+x.hostname:x.hostname,x=+x.port;var R=new Tr(null);p&&co(R,p),c&&(R.g=c),x&&ho(R,x),d&&(R.l=d),p=R}return d=o.D,c=o.ya,d&&c&&oe(p,d,c),oe(p,"VER",o.la),Vi(o,p),p}function mp(o,c,d){if(c&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return c=o.Ca&&!o.pa?new ce(new ki({eb:d})):new ce(o.pa),c.Ha(o.J),c}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function gp(){}r=gp.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function wo(){}wo.prototype.g=function(o,c){return new ze(o,c)};function ze(o,c){Se.call(this),this.g=new sp(c),this.l=o,this.h=c&&c.messageUrlParams||null,o=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(o?o["X-WebChannel-Content-Type"]=c.messageContentType:o={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.va&&(o?o["X-WebChannel-Client-Profile"]=c.va:o={"X-WebChannel-Client-Profile":c.va}),this.g.S=o,(o=c&&c.Sb)&&!F(o)&&(this.g.m=o),this.v=c&&c.supportsCrossDomainXhr||!1,this.u=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!F(c)&&(this.g.D=c,o=this.h,o!==null&&c in o&&(o=this.h,c in o&&delete o[c])),this.j=new tn(this)}C(ze,Se),ze.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},ze.prototype.close=function(){fu(this.g)},ze.prototype.o=function(o){var c=this.g;if(typeof o=="string"){var d={};d.__data__=o,o=d}else this.u&&(d={},d.__data__=tu(o),o=d);c.i.push(new o0(c.Ya++,o)),c.G==3&&yo(c)},ze.prototype.N=function(){this.g.l=null,delete this.j,fu(this.g),delete this.g,ze.aa.N.call(this)};function yp(o){nu.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var c=o.__sm__;if(c){e:{for(let d in c){o=d;break e}o=void 0}(this.i=o)&&(o=this.i,c=c!==null&&o in c?c[o]:void 0),this.data=c}else this.data=o}C(yp,nu);function _p(){iu.call(this),this.status=1}C(_p,iu);function tn(o){this.g=o}C(tn,gp),tn.prototype.ua=function(){Oe(this.g,"a")},tn.prototype.ta=function(o){Oe(this.g,new yp(o))},tn.prototype.sa=function(o){Oe(this.g,new _p)},tn.prototype.ra=function(){Oe(this.g,"b")},wo.prototype.createWebChannel=wo.prototype.g,ze.prototype.send=ze.prototype.o,ze.prototype.open=ze.prototype.m,ze.prototype.close=ze.prototype.close,wc=Ot.createWebChannelTransport=function(){return new wo},_c=Ot.getStatEventTarget=function(){return oo()},yc=Ot.Event=vr,pa=Ot.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ao.NO_ERROR=0,ao.TIMEOUT=8,ao.HTTP_ERROR=6,is=Ot.ErrorCode=ao,Nf.COMPLETE="complete",gc=Ot.EventType=Nf,Pf.EventType=Ei,Ei.OPEN="a",Ei.CLOSE="b",Ei.ERROR="c",Ei.MESSAGE="d",Se.prototype.listen=Se.prototype.K,Rn=Ot.WebChannel=Pf,hk=Ot.FetchXmlHttpFactory=ki,ce.prototype.listenOnce=ce.prototype.L,ce.prototype.getLastError=ce.prototype.Ka,ce.prototype.getLastErrorCode=ce.prototype.Ba,ce.prototype.getStatus=ce.prototype.Z,ce.prototype.getResponseJson=ce.prototype.Oa,ce.prototype.getResponseText=ce.prototype.oa,ce.prototype.send=ce.prototype.ea,ce.prototype.setWithCredentials=ce.prototype.Ha,mc=Ot.XhrIo=ce}).apply(typeof fa!="undefined"?fa:typeof self!="undefined"?self:typeof window!="undefined"?window:{})});function Pn(){return Dr.logLevel}function L(r,...e){if(Dr.logLevel<=Q.DEBUG){let t=e.map(sd);Dr.debug(`Firestore (${Xn}): ${r}`,...t)}}function Nt(r,...e){if(Dr.logLevel<=Q.ERROR){let t=e.map(sd);Dr.error(`Firestore (${Xn}): ${r}`,...t)}}function Ln(r,...e){if(Dr.logLevel<=Q.WARN){let t=e.map(sd);Dr.warn(`Firestore (${Xn}): ${r}`,...t)}}function sd(r){if(typeof r=="string")return r;try{return function(t){return JSON.stringify(t)}(r)}catch{return r}}function j(r="Unexpected state"){let e=`FIRESTORE (${Xn}) INTERNAL ASSERTION FAILED: `+r;throw Nt(e),new Error(e)}function re(r,e){r||j()}function q(r,e){return r}function dk(r){let e=typeof self!="undefined"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}function J(r,e){return r<e?-1:r>e?1:0}function Mn(r,e,t){return r.length===e.length&&r.every((n,i)=>t(n,e[i]))}function pk(r,e){let t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=z.fromTimestamp(n===1e9?new Ee(t+1,0):new Ee(t,n));return new Or(i,U.empty(),e)}function mk(r){return new Or(r.readTime,r.key,cs)}function gk(r,e){let t=r.readTime.compareTo(e.readTime);return t!==0?t:(t=U.comparator(r.documentKey,e.documentKey),t!==0?t:J(r.largestBatchId,e.largestBatchId))}async function Zn(r){if(r.code!==O.FAILED_PRECONDITION||r.message!==yk)throw r;L("LocalStore","Unexpectedly lost primary lease")}function _k(r){let e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function ei(r){return r.name==="IndexedDbTransactionError"}function sl(r){return r==null}function hs(r){return r===0&&1/r==-1/0}function wk(r){return typeof r=="number"&&Number.isInteger(r)&&!hs(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}function vk(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e=Nw(e)),e=bk(r.get(t),e);return Nw(e)}function bk(r,e){let t=e,n=r.length;for(let i=0;i<n;i++){let s=r.charAt(i);switch(s){case"\0":t+="";break;case gv:t+="";break;default:t+=s}}return t}function Nw(r){return r+gv+""}function Vw(r){let e=0;for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function pr(r,e){for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function Cv(r){for(let e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}function Vt(r){if(re(!!r),typeof r=="string"){let e=0,t=Dk.exec(r);if(re(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:ue(r.seconds),nanos:ue(r.nanos)}}function ue(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function Lt(r){return typeof r=="string"?De.fromBase64String(r):De.fromUint8Array(r)}function ad(r){var e,t;return((t=(((e=r==null?void 0:r.mapValue)===null||e===void 0?void 0:e.fields)||{})[Dv])===null||t===void 0?void 0:t.stringValue)===kv}function ol(r){let e=r.mapValue.fields[Ov];return ad(e)?ol(e):e}function ds(r){let e=Vt(r.mapValue.fields[Nv].timestampValue);return new Ee(e.seconds,e.nanos)}function cr(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?ad(r)?4:Mv(r)?9007199254740991:Lv(r)?10:11:j()}function mt(r,e){if(r===e)return!0;let t=cr(r);if(t!==cr(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return ds(r).isEqual(ds(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let a=Vt(i.timestampValue),l=Vt(s.timestampValue);return a.seconds===l.seconds&&a.nanos===l.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return function(i,s){return Lt(i.bytesValue).isEqual(Lt(s.bytesValue))}(r,e);case 7:return r.referenceValue===e.referenceValue;case 8:return function(i,s){return ue(i.geoPointValue.latitude)===ue(s.geoPointValue.latitude)&&ue(i.geoPointValue.longitude)===ue(s.geoPointValue.longitude)}(r,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return ue(i.integerValue)===ue(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let a=ue(i.doubleValue),l=ue(s.doubleValue);return a===l?hs(a)===hs(l):isNaN(a)&&isNaN(l)}return!1}(r,e);case 9:return Mn(r.arrayValue.values||[],e.arrayValue.values||[],mt);case 10:case 11:return function(i,s){let a=i.mapValue.fields||{},l=s.mapValue.fields||{};if(Vw(a)!==Vw(l))return!1;for(let u in a)if(a.hasOwnProperty(u)&&(l[u]===void 0||!mt(a[u],l[u])))return!1;return!0}(r,e);default:return j()}}function fs(r,e){return(r.values||[]).find(t=>mt(t,e))!==void 0}function Un(r,e){if(r===e)return 0;let t=cr(r),n=cr(e);if(t!==n)return J(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return J(r.booleanValue,e.booleanValue);case 2:return function(s,a){let l=ue(s.integerValue||s.doubleValue),u=ue(a.integerValue||a.doubleValue);return l<u?-1:l>u?1:l===u?0:isNaN(l)?isNaN(u)?0:-1:1}(r,e);case 3:return Lw(r.timestampValue,e.timestampValue);case 4:return Lw(ds(r),ds(e));case 5:return J(r.stringValue,e.stringValue);case 6:return function(s,a){let l=Lt(s),u=Lt(a);return l.compareTo(u)}(r.bytesValue,e.bytesValue);case 7:return function(s,a){let l=s.split("/"),u=a.split("/");for(let h=0;h<l.length&&h<u.length;h++){let f=J(l[h],u[h]);if(f!==0)return f}return J(l.length,u.length)}(r.referenceValue,e.referenceValue);case 8:return function(s,a){let l=J(ue(s.latitude),ue(a.latitude));return l!==0?l:J(ue(s.longitude),ue(a.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return Mw(r.arrayValue,e.arrayValue);case 10:return function(s,a){var l,u,h,f;let m=s.fields||{},g=a.fields||{},I=(l=m[jn])===null||l===void 0?void 0:l.arrayValue,C=(u=g[jn])===null||u===void 0?void 0:u.arrayValue,k=J(((h=I==null?void 0:I.values)===null||h===void 0?void 0:h.length)||0,((f=C==null?void 0:C.values)===null||f===void 0?void 0:f.length)||0);return k!==0?k:Mw(I,C)}(r.mapValue,e.mapValue);case 11:return function(s,a){if(s===ma.mapValue&&a===ma.mapValue)return 0;if(s===ma.mapValue)return 1;if(a===ma.mapValue)return-1;let l=s.fields||{},u=Object.keys(l),h=a.fields||{},f=Object.keys(h);u.sort(),f.sort();for(let m=0;m<u.length&&m<f.length;++m){let g=J(u[m],f[m]);if(g!==0)return g;let I=Un(l[u[m]],h[f[m]]);if(I!==0)return I}return J(u.length,f.length)}(r.mapValue,e.mapValue);default:throw j()}}function Lw(r,e){if(typeof r=="string"&&typeof e=="string"&&r.length===e.length)return J(r,e);let t=Vt(r),n=Vt(e),i=J(t.seconds,n.seconds);return i!==0?i:J(t.nanos,n.nanos)}function Mw(r,e){let t=r.values||[],n=e.values||[];for(let i=0;i<t.length&&i<n.length;++i){let s=Un(t[i],n[i]);if(s)return s}return J(t.length,n.length)}function Bn(r){return Oc(r)}function Oc(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){let n=Vt(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(t){return Lt(t).toBase64()}(r.bytesValue):"referenceValue"in r?function(t){return U.fromName(t).toString()}(r.referenceValue):"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",i=!0;for(let s of t.values||[])i?i=!1:n+=",",n+=Oc(s);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){let n=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let a of n)s?s=!1:i+=",",i+=`${a}:${Oc(t.fields[a])}`;return i+"}"}(r.mapValue):j()}function _a(r){switch(cr(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let e=ol(r);return e?16+_a(e):16;case 5:return 2*r.stringValue.length;case 6:return Lt(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return function(n){return(n.values||[]).reduce((i,s)=>i+_a(s),0)}(r.arrayValue);case 10:case 11:return function(n){let i=0;return pr(n.fields,(s,a)=>{i+=s.length+_a(a)}),i}(r.mapValue);default:throw j()}}function Nc(r){return!!r&&"integerValue"in r}function cd(r){return!!r&&"arrayValue"in r}function Fw(r){return!!r&&"nullValue"in r}function jw(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function wa(r){return!!r&&"mapValue"in r}function Lv(r){var e,t;return((t=(((e=r==null?void 0:r.mapValue)===null||e===void 0?void 0:e.fields)||{})[ld])===null||t===void 0?void 0:t.stringValue)===ud}function os(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){let e={mapValue:{fields:{}}};return pr(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=os(n)),e}if(r.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=os(r.arrayValue.values[t]);return e}return Object.assign({},r)}function Mv(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue===Vv}function Fv(r){let e=[];return pr(r.fields,(t,n)=>{let i=new He([t]);if(wa(n)){let s=Fv(n.mapValue).fields;if(s.length===0)e.push(i);else for(let a of s)e.push(i.child(a))}else e.push(i)}),new Xe(e)}function Uw(r,e,t){let n=0;for(let i=0;i<r.position.length;i++){let s=e[i],a=r.position[i];if(s.field.isKeyField()?n=U.comparator(U.fromName(a.referenceValue),t.key):n=Un(a,t.data.field(s.field)),s.dir==="desc"&&(n*=-1),n!==0)break}return n}function Bw(r,e){if(r===null)return e===null;if(e===null||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!mt(r.position[t],e.position[t]))return!1;return!0}function Ok(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}function jv(r){return r.op==="and"}function Uv(r){return Nk(r)&&jv(r)}function Nk(r){for(let e of r.filters)if(e instanceof gt)return!1;return!0}function Vc(r){if(r instanceof we)return r.field.canonicalString()+r.op.toString()+Bn(r.value);if(Uv(r))return r.filters.map(e=>Vc(e)).join(",");{let e=r.filters.map(t=>Vc(t)).join(",");return`${r.op}(${e})`}}function Bv(r,e){return r instanceof we?function(n,i){return i instanceof we&&n.op===i.op&&n.field.isEqual(i.field)&&mt(n.value,i.value)}(r,e):r instanceof gt?function(n,i){return i instanceof gt&&n.op===i.op&&n.filters.length===i.filters.length?n.filters.reduce((s,a,l)=>s&&Bv(a,i.filters[l]),!0):!1}(r,e):void j()}function $v(r){return r instanceof we?function(t){return`${t.field.canonicalString()} ${t.op} ${Bn(t.value)}`}(r):r instanceof gt?function(t){return t.op.toString()+" {"+t.getFilters().map($v).join(" ,")+"}"}(r):"Filter"}function qv(r,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(n=>U.fromName(n.referenceValue))}function $w(r,e=null,t=[],n=[],i=null,s=null,a=null){return new qc(r,e,t,n,i,s,a)}function hd(r){let e=q(r);if(e.le===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>Vc(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>function(s){return s.field.canonicalString()+s.dir}(n)).join(","),sl(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>Bn(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>Bn(n)).join(",")),e.le=t}return e.le}function dd(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!Ok(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!Bv(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!Bw(r.startAt,e.startAt)&&Bw(r.endAt,e.endAt)}function zc(r){return U.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function Vk(r,e,t,n,i,s,a,l){return new zn(r,e,t,n,i,s,a,l)}function al(r){return new zn(r)}function qw(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function Lk(r){return r.collectionGroup!==null}function as(r){let e=q(r);if(e.he===null){e.he=[];let t=new Set;for(let s of e.explicitOrderBy)e.he.push(s),t.add(s.field.canonicalString());let n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let l=new be(He.comparator);return a.filters.forEach(u=>{u.getFlattenedFilters().forEach(h=>{h.isInequality()&&(l=l.add(h.field))})}),l})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.he.push(new qn(s,n))}),t.has(He.keyField().canonicalString())||e.he.push(new qn(He.keyField(),n))}return e.he}function dt(r){let e=q(r);return e.Pe||(e.Pe=Mk(e,as(r))),e.Pe}function Mk(r,e){if(r.limitType==="F")return $w(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new qn(i.field,s)});let t=r.endAt?new $n(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new $n(r.startAt.position,r.startAt.inclusive):null;return $w(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}function Gc(r,e,t){return new zn(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function ll(r,e){return dd(dt(r),dt(e))&&r.limitType===e.limitType}function zv(r){return`${hd(dt(r))}|lt:${r.limitType}`}function Cn(r){return`Query(target=${function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(i=>$v(i)).join(", ")}]`),sl(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(i=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(i)).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(i=>Bn(i)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(i=>Bn(i)).join(",")),`Target(${n})`}(dt(r))}; limitType=${r.limitType})`}function ul(r,e){return e.isFoundDocument()&&function(n,i){let s=i.key.path;return n.collectionGroup!==null?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):U.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(r,e)&&function(n,i){for(let s of as(n))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(r,e)&&function(n,i){for(let s of n.filters)if(!s.matches(i))return!1;return!0}(r,e)&&function(n,i){return!(n.startAt&&!function(a,l,u){let h=Uw(a,l,u);return a.inclusive?h<=0:h<0}(n.startAt,as(n),i)||n.endAt&&!function(a,l,u){let h=Uw(a,l,u);return a.inclusive?h>=0:h>0}(n.endAt,as(n),i))}(r,e)}function Fk(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function Gv(r){return(e,t)=>{let n=!1;for(let i of as(r)){let s=jk(i,e,t);if(s!==0)return s;n=n||i.field.isKeyField()}return 0}}function jk(r,e,t){let n=r.field.isKeyField()?U.comparator(e.key,t.key):function(s,a,l){let u=a.data.field(s),h=l.data.field(s);return u!==null&&h!==null?Un(u,h):j()}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return j()}}function Ft(){return Uk}function ss(...r){let e=Kv;for(let t of r)e=e.insert(t.key,t);return e}function Hv(r){let e=Kv;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function Pr(){return ls()}function Wv(){return ls()}function ls(){return new Mt(r=>r.toString(),(r,e)=>r.isEqual(e))}function W(...r){let e=$k;for(let t of r)e=e.add(t);return e}function zk(){return qk}function fd(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:hs(e)?"-0":e}}function Qv(r){return{integerValue:""+r}}function Gk(r,e){return wk(e)?Qv(e):fd(r,e)}function Kk(r,e,t){return r instanceof Kn?function(i,s){let a={fields:{[Dv]:{stringValue:kv},[Nv]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&ad(s)&&(s=ol(s)),s&&(a.fields[Ov]=s),{mapValue:a}}(t,e):r instanceof Nr?Yv(r,e):r instanceof Vr?Xv(r,e):function(i,s){let a=Jv(i,s),l=zw(a)+zw(i.Ie);return Nc(a)&&Nc(i.Ie)?Qv(l):fd(i.serializer,l)}(r,e)}function Hk(r,e,t){return r instanceof Nr?Yv(r,e):r instanceof Vr?Xv(r,e):t}function Jv(r,e){return r instanceof Hn?function(n){return Nc(n)||function(s){return!!s&&"doubleValue"in s}(n)}(e)?e:{integerValue:0}:null}function Yv(r,e){let t=Zv(e);for(let n of r.elements)t.some(i=>mt(i,n))||t.push(n);return{arrayValue:{values:t}}}function Xv(r,e){let t=Zv(e);for(let n of r.elements)t=t.filter(i=>!mt(i,n));return{arrayValue:{values:t}}}function zw(r){return ue(r.integerValue||r.doubleValue)}function Zv(r){return cd(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}function Wk(r,e){return r.field.isEqual(e.field)&&function(n,i){return n instanceof Nr&&i instanceof Nr||n instanceof Vr&&i instanceof Vr?Mn(n.elements,i.elements,mt):n instanceof Hn&&i instanceof Hn?mt(n.Ie,i.Ie):n instanceof Kn&&i instanceof Kn}(r.transform,e.transform)}function va(r,e){return r.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(r.updateTime):r.exists===void 0||r.exists===e.isFoundDocument()}function eb(r,e){if(!r.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return r.isNoDocument()?new Ca(r.key,ur.none()):new Lr(r.key,r.data,ur.none());{let t=r.data,n=Ke.empty(),i=new be(He.comparator);for(let s of e.fields)if(!i.has(s)){let a=t.field(s);a===null&&s.length>1&&(s=s.popLast(),a=t.field(s)),a===null?n.delete(s):n.set(s,a),i=i.add(s)}return new yt(r.key,n,new Xe(i.toArray()),ur.none())}}function Qk(r,e,t){r instanceof Lr?function(i,s,a){let l=i.value.clone(),u=Kw(i.fieldTransforms,s,a.transformResults);l.setAll(u),s.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(r,e,t):r instanceof yt?function(i,s,a){if(!va(i.precondition,s))return void s.convertToUnknownDocument(a.version);let l=Kw(i.fieldTransforms,s,a.transformResults),u=s.data;u.setAll(tb(i)),u.setAll(l),s.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(r,e,t):function(i,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function us(r,e,t,n){return r instanceof Lr?function(s,a,l,u){if(!va(s.precondition,a))return l;let h=s.value.clone(),f=Hw(s.fieldTransforms,u,a);return h.setAll(f),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),null}(r,e,t,n):r instanceof yt?function(s,a,l,u){if(!va(s.precondition,a))return l;let h=Hw(s.fieldTransforms,u,a),f=a.data;return f.setAll(tb(s)),f.setAll(h),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),l===null?null:l.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(m=>m.field))}(r,e,t,n):function(s,a,l){return va(s.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):l}(r,e,t)}function Jk(r,e){let t=null;for(let n of r.fieldTransforms){let i=e.data.field(n.field),s=Jv(n.transform,i||null);s!=null&&(t===null&&(t=Ke.empty()),t.set(n.field,s))}return t||null}function Gw(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&!!function(n,i){return n===void 0&&i===void 0||!(!n||!i)&&Mn(n,i,(s,a)=>Wk(s,a))}(r.fieldTransforms,e.fieldTransforms)&&(r.type===0?r.value.isEqual(e.value):r.type!==1||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask))}function tb(r){let e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let n=r.data.field(t);e.set(t,n)}}),e}function Kw(r,e,t){let n=new Map;re(r.length===t.length);for(let i=0;i<t.length;i++){let s=r[i],a=s.transform,l=e.data.field(s.field);n.set(s.field,Hk(a,l,t[i]))}return n}function Hw(r,e,t){let n=new Map;for(let i of r){let s=i.transform,a=t.data.field(i.field);n.set(i.field,Kk(s,a,e))}return n}function Yk(r){switch(r){case O.OK:return j();case O.CANCELLED:case O.UNKNOWN:case O.DEADLINE_EXCEEDED:case O.RESOURCE_EXHAUSTED:case O.INTERNAL:case O.UNAVAILABLE:case O.UNAUTHENTICATED:return!1;case O.INVALID_ARGUMENT:case O.NOT_FOUND:case O.ALREADY_EXISTS:case O.PERMISSION_DENIED:case O.FAILED_PRECONDITION:case O.ABORTED:case O.OUT_OF_RANGE:case O.UNIMPLEMENTED:case O.DATA_LOSS:return!0;default:return j()}}function rb(r){if(r===void 0)return Nt("GRPC error has no .code"),O.UNKNOWN;switch(r){case pe.OK:return O.OK;case pe.CANCELLED:return O.CANCELLED;case pe.UNKNOWN:return O.UNKNOWN;case pe.DEADLINE_EXCEEDED:return O.DEADLINE_EXCEEDED;case pe.RESOURCE_EXHAUSTED:return O.RESOURCE_EXHAUSTED;case pe.INTERNAL:return O.INTERNAL;case pe.UNAVAILABLE:return O.UNAVAILABLE;case pe.UNAUTHENTICATED:return O.UNAUTHENTICATED;case pe.INVALID_ARGUMENT:return O.INVALID_ARGUMENT;case pe.NOT_FOUND:return O.NOT_FOUND;case pe.ALREADY_EXISTS:return O.ALREADY_EXISTS;case pe.PERMISSION_DENIED:return O.PERMISSION_DENIED;case pe.FAILED_PRECONDITION:return O.FAILED_PRECONDITION;case pe.ABORTED:return O.ABORTED;case pe.OUT_OF_RANGE:return O.OUT_OF_RANGE;case pe.UNIMPLEMENTED:return O.UNIMPLEMENTED;case pe.DATA_LOSS:return O.DATA_LOSS;default:return j()}}function Xk(){return new TextEncoder}function Qw(r){let e=Xk().encode(r),t=new pc;return t.update(e),new Uint8Array(t.digest())}function Jw(r){let e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Dt([t,n],0),new Dt([i,s],0)]}function ga(){return new de(U.comparator)}function Yw(){return new de(U.comparator)}function th(r,e){return r.useProto3Json||sl(e)?e:{value:e}}function Va(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function nb(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function nD(r,e){return Va(r,e.toTimestamp())}function ft(r){return re(!!r),z.fromTimestamp(function(t){let n=Vt(t);return new Ee(n.seconds,n.nanos)}(r))}function pd(r,e){return rh(r,e).canonicalString()}function rh(r,e){let t=function(i){return new ge(["projects",i.projectId,"databases",i.database])}(r).child("documents");return e===void 0?t:t.child(e)}function ib(r){let e=ge.fromString(r);return re(ub(e)),e}function nh(r,e){return pd(r.databaseId,e.path)}function vc(r,e){let t=ib(e);if(t.get(1)!==r.databaseId.projectId)throw new M(O.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new M(O.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new U(ob(t))}function sb(r,e){return pd(r.databaseId,e)}function iD(r){let e=ib(r);return e.length===4?ge.emptyPath():ob(e)}function ih(r){return new ge(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function ob(r){return re(r.length>4&&r.get(4)==="documents"),r.popFirst(5)}function Xw(r,e,t){return{name:nh(r,e),fields:t.value.mapValue.fields}}function sD(r,e){let t;if("targetChange"in e){e.targetChange;let n=function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:j()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(h,f){return h.useProto3Json?(re(f===void 0||typeof f=="string"),De.fromBase64String(f||"")):(re(f===void 0||f instanceof Buffer||f instanceof Uint8Array),De.fromUint8Array(f||new Uint8Array))}(r,e.targetChange.resumeToken),a=e.targetChange.cause,l=a&&function(h){let f=h.code===void 0?O.UNKNOWN:rb(h.code);return new M(f,h.message||"")}(a);t=new Oa(n,i,s,l||null)}else if("documentChange"in e){e.documentChange;let n=e.documentChange;n.document,n.document.name,n.document.updateTime;let i=vc(r,n.document.name),s=ft(n.document.updateTime),a=n.document.createTime?ft(n.document.createTime):z.min(),l=new Ke({mapValue:{fields:n.document.fields}}),u=it.newFoundDocument(i,s,a,l),h=n.targetIds||[],f=n.removedTargetIds||[];t=new Nn(h,f,u.key,u)}else if("documentDelete"in e){e.documentDelete;let n=e.documentDelete;n.document;let i=vc(r,n.document),s=n.readTime?ft(n.readTime):z.min(),a=it.newNoDocument(i,s),l=n.removedTargetIds||[];t=new Nn([],l,a.key,a)}else if("documentRemove"in e){e.documentRemove;let n=e.documentRemove;n.document;let i=vc(r,n.document),s=n.removedTargetIds||[];t=new Nn([],s,i,null)}else{if(!("filter"in e))return j();{e.filter;let n=e.filter;n.targetId;let{count:i=0,unchangedNames:s}=n,a=new Yc(i,s),l=n.targetId;t=new Da(l,a)}}return t}function oD(r,e){let t;if(e instanceof Lr)t={update:Xw(r,e.key,e.value)};else if(e instanceof Ca)t={delete:nh(r,e.key)};else if(e instanceof yt)t={update:Xw(r,e.key,e.data),updateMask:mD(e.fieldMask)};else{if(!(e instanceof Hc))return j();t={verify:nh(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(s,a){let l=a.transform;if(l instanceof Kn)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof Nr)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof Vr)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof Hn)return{fieldPath:a.field.canonicalString(),increment:l.Ie};throw j()}(0,n))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:nD(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:j()}(r,e.precondition)),t}function aD(r,e){return r&&r.length>0?(re(e!==void 0),r.map(t=>function(i,s){let a=i.updateTime?ft(i.updateTime):ft(s);return a.isEqual(z.min())&&(a=ft(s)),new Kc(a,i.transformResults||[])}(t,e))):[]}function lD(r,e){return{documents:[sb(r,e.path)]}}function uD(r,e){let t={structuredQuery:{}},n=e.path,i;e.collectionGroup!==null?(i=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=sb(r,i);let s=function(h){if(h.length!==0)return lb(gt.create(h,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let a=function(h){if(h.length!==0)return h.map(f=>function(g){return{field:kn(g.field),direction:dD(g.dir)}}(f))}(e.orderBy);a&&(t.structuredQuery.orderBy=a);let l=th(r,e.limit);return l!==null&&(t.structuredQuery.limit=l),e.startAt&&(t.structuredQuery.startAt=function(h){return{before:h.inclusive,values:h.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(e.endAt)),{ht:t,parent:i}}function cD(r){let e=iD(r.parent),t=r.structuredQuery,n=t.from?t.from.length:0,i=null;if(n>0){re(n===1);let f=t.from[0];f.allDescendants?i=f.collectionId:e=e.child(f.collectionId)}let s=[];t.where&&(s=function(m){let g=ab(m);return g instanceof gt&&Uv(g)?g.getFilters():[g]}(t.where));let a=[];t.orderBy&&(a=function(m){return m.map(g=>function(C){return new qn(Dn(C.field),function(P){switch(P){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(C.direction))}(g))}(t.orderBy));let l=null;t.limit&&(l=function(m){let g;return g=typeof m=="object"?m.value:m,sl(g)?null:g}(t.limit));let u=null;t.startAt&&(u=function(m){let g=!!m.before,I=m.values||[];return new $n(I,g)}(t.startAt));let h=null;return t.endAt&&(h=function(m){let g=!m.before,I=m.values||[];return new $n(I,g)}(t.endAt)),Vk(e,i,a,s,l,"F",u,h)}function hD(r,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return j()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function ab(r){return r.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let n=Dn(t.unaryFilter.field);return we.create(n,"==",{doubleValue:NaN});case"IS_NULL":let i=Dn(t.unaryFilter.field);return we.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=Dn(t.unaryFilter.field);return we.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=Dn(t.unaryFilter.field);return we.create(a,"!=",{nullValue:"NULL_VALUE"});default:return j()}}(r):r.fieldFilter!==void 0?function(t){return we.create(Dn(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return j()}}(t.fieldFilter.op),t.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(t){return gt.create(t.compositeFilter.filters.map(n=>ab(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return j()}}(t.compositeFilter.op))}(r):j()}function dD(r){return eD[r]}function fD(r){return tD[r]}function pD(r){return rD[r]}function kn(r){return{fieldPath:r.canonicalString()}}function Dn(r){return He.fromServerFormat(r.fieldPath)}function lb(r){return r instanceof we?function(t){if(t.op==="=="){if(jw(t.value))return{unaryFilter:{field:kn(t.field),op:"IS_NAN"}};if(Fw(t.value))return{unaryFilter:{field:kn(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(jw(t.value))return{unaryFilter:{field:kn(t.field),op:"IS_NOT_NAN"}};if(Fw(t.value))return{unaryFilter:{field:kn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:kn(t.field),op:fD(t.op),value:t.value}}}(r):r instanceof gt?function(t){let n=t.getFilters().map(i=>lb(i));return n.length===1?n[0]:{compositeFilter:{op:pD(t.op),filters:n}}}(r):j()}function mD(r){let e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function ub(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}function gD(r){let e=cD({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?Gc(e,e.limit,"L"):e}function tv([r,e],[t,n]){let i=J(r,t);return i===0?J(e,n):i}function _D(r,e){return new ch(r,e)}function vD(r,e,t,n){return new xh(r,e,t,n)}async function hb(r,e){let t=q(r);return await t.persistence.runTransaction("Handle user change","readonly",n=>{let i;return t.mutationQueue.getAllMutationBatches(n).next(s=>(i=s,t.As(e),t.mutationQueue.getAllMutationBatches(n))).next(s=>{let a=[],l=[],u=W();for(let h of i){a.push(h.batchId);for(let f of h.mutations)u=u.add(f.key)}for(let h of s){l.push(h.batchId);for(let f of h.mutations)u=u.add(f.key)}return t.localDocuments.getDocuments(n,u).next(h=>({Rs:h,removedBatchIds:a,addedBatchIds:l}))})})}function bD(r,e){let t=q(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{let i=e.batch.keys(),s=t.ds.newChangeBuffer({trackRemovals:!0});return function(l,u,h,f){let m=h.batch,g=m.keys(),I=D.resolve();return g.forEach(C=>{I=I.next(()=>f.getEntry(u,C)).next(k=>{let P=h.docVersions.get(C);re(P!==null),k.version.compareTo(P)<0&&(m.applyToRemoteDocument(k,h),k.isValidDocument()&&(k.setReadTime(h.commitVersion),f.addEntry(k)))})}),I.next(()=>l.mutationQueue.removeMutationBatch(u,m))}(t,n,e,s).next(()=>s.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(l){let u=W();for(let h=0;h<l.mutationResults.length;++h)l.mutationResults[h].transformResults.length>0&&(u=u.add(l.batch.mutations[h].key));return u}(e))).next(()=>t.localDocuments.getDocuments(n,i))})}function db(r){let e=q(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Hr.getLastRemoteSnapshotVersion(t))}function TD(r,e){let t=q(r),n=e.snapshotVersion,i=t.Ts;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let a=t.ds.newChangeBuffer({trackRemovals:!0});i=t.Ts;let l=[];e.targetChanges.forEach((f,m)=>{let g=i.get(m);if(!g)return;l.push(t.Hr.removeMatchingKeys(s,f.removedDocuments,m).next(()=>t.Hr.addMatchingKeys(s,f.addedDocuments,m)));let I=g.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(m)!==null?I=I.withResumeToken(De.EMPTY_BYTE_STRING,z.min()).withLastLimboFreeSnapshotVersion(z.min()):f.resumeToken.approximateByteSize()>0&&(I=I.withResumeToken(f.resumeToken,n)),i=i.insert(m,I),function(k,P,V){return k.resumeToken.approximateByteSize()===0||P.snapshotVersion.toMicroseconds()-k.snapshotVersion.toMicroseconds()>=wD?!0:V.addedDocuments.size+V.modifiedDocuments.size+V.removedDocuments.size>0}(g,I,f)&&l.push(t.Hr.updateTargetData(s,I))});let u=Ft(),h=W();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(s,f))}),l.push(ED(s,a,e.documentUpdates).next(f=>{u=f.Vs,h=f.fs})),!n.isEqual(z.min())){let f=t.Hr.getLastRemoteSnapshotVersion(s).next(m=>t.Hr.setTargetsMetadata(s,s.currentSequenceNumber,n));l.push(f)}return D.waitFor(l).next(()=>a.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,u,h)).next(()=>u)}).then(s=>(t.Ts=i,s))}function ED(r,e,t){let n=W(),i=W();return t.forEach(s=>n=n.add(s)),e.getEntries(r,n).next(s=>{let a=Ft();return t.forEach((l,u)=>{let h=s.get(l);u.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(l)),u.isNoDocument()&&u.version.isEqual(z.min())?(e.removeEntry(l,u.readTime),a=a.insert(l,u)):!h.isValidDocument()||u.version.compareTo(h.version)>0||u.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(u),a=a.insert(l,u)):L(md,"Ignoring outdated watch update for ",l,". Current version:",h.version," Watch version:",u.version)}),{Vs:a,fs:i}})}function ID(r,e){let t=q(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(e===void 0&&(e=od),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function AD(r,e){let t=q(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return t.Hr.getTargetData(n,e).next(s=>s?(i=s,D.resolve(i)):t.Hr.allocateTargetId(n).next(a=>(i=new ms(e,a,"TargetPurposeListen",n.currentSequenceNumber),t.Hr.addTargetData(n,i).next(()=>i))))}).then(n=>{let i=t.Ts.get(n.targetId);return(i===null||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Ts=t.Ts.insert(n.targetId,n),t.Is.set(e,n.targetId)),n})}async function Sh(r,e,t){let n=q(r),i=n.Ts.get(e),s=t?"readwrite":"readwrite-primary";try{t||await n.persistence.runTransaction("Release target",s,a=>n.persistence.referenceDelegate.removeTarget(a,i))}catch(a){if(!ei(a))throw a;L(md,`Failed to update sequence numbers for target ${e}: ${a}`)}n.Ts=n.Ts.remove(e),n.Is.delete(i.target)}function rv(r,e,t){let n=q(r),i=z.min(),s=W();return n.persistence.runTransaction("Execute query","readwrite",a=>function(u,h,f){let m=q(u),g=m.Is.get(f);return g!==void 0?D.resolve(m.Ts.get(g)):m.Hr.getTargetData(h,f)}(n,a,dt(e)).next(l=>{if(l)return i=l.lastLimboFreeSnapshotVersion,n.Hr.getMatchingKeysForTargetId(a,l.targetId).next(u=>{s=u})}).next(()=>n.Ps.getDocumentsMatchingQuery(a,e,t?i:z.min(),t?s:W())).next(l=>(xD(n,Fk(e),l),{documents:l,gs:s})))}function xD(r,e,t){let n=r.Es.get(e)||z.min();t.forEach((i,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),r.Es.set(e,n)}function Ch(){return ya===null?ya=function(){return 268435456+Math.round(2147483648*Math.random())}():ya++,"0x"+ya.toString(16)}function Tc(){return typeof document!="undefined"?document:null}function cl(r){return new eh(r,!0)}async function hl(r){if(Fr(r))for(let e of r.G_)await e(!0)}async function As(r){for(let e of r.G_)await e(!1)}function fb(r,e){let t=q(r);t.U_.has(e.targetId)||(t.U_.set(e.targetId,e),wd(t)?_d(t):ti(t).c_()&&yd(t,e))}function gd(r,e){let t=q(r),n=ti(t);t.U_.delete(e),n.c_()&&pb(t,e),t.U_.size===0&&(n.c_()?n.P_():Fr(t)&&t.j_.set("Unknown"))}function yd(r,e){if(r.H_.Ne(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(z.min())>0){let t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}ti(r).y_(e)}function pb(r,e){r.H_.Ne(e),ti(r).w_(e)}function _d(r){r.H_=new Zc({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),lt:e=>r.U_.get(e)||null,it:()=>r.datastore.serializer.databaseId}),ti(r).start(),r.j_.B_()}function wd(r){return Fr(r)&&!ti(r).u_()&&r.U_.size>0}function Fr(r){return q(r).W_.size===0}function mb(r){r.H_=void 0}async function RD(r){r.j_.set("Online")}async function PD(r){r.U_.forEach((e,t)=>{yd(r,e)})}async function CD(r,e){mb(r),wd(r)?(r.j_.q_(e),_d(r)):r.j_.set("Unknown")}async function kD(r,e,t){if(r.j_.set("Online"),e instanceof Oa&&e.state===2&&e.cause)try{await async function(i,s){let a=s.cause;for(let l of s.targetIds)i.U_.has(l)&&(await i.remoteSyncer.rejectListen(l,a),i.U_.delete(l),i.H_.removeTarget(l))}(r,e)}catch(n){L(Mr,"Failed to remove targets %s: %s ",e.targetIds.join(","),n),await qa(r,n)}else if(e instanceof Nn?r.H_.We(e):e instanceof Da?r.H_.Ze(e):r.H_.je(e),!t.isEqual(z.min()))try{let n=await db(r.localStore);t.compareTo(n)>=0&&await function(s,a){let l=s.H_.ot(a);return l.targetChanges.forEach((u,h)=>{if(u.resumeToken.approximateByteSize()>0){let f=s.U_.get(h);f&&s.U_.set(h,f.withResumeToken(u.resumeToken,a))}}),l.targetMismatches.forEach((u,h)=>{let f=s.U_.get(u);if(!f)return;s.U_.set(u,f.withResumeToken(De.EMPTY_BYTE_STRING,f.snapshotVersion)),pb(s,u);let m=new ms(f.target,u,h,f.sequenceNumber);yd(s,m)}),s.remoteSyncer.applyRemoteEvent(l)}(r,t)}catch(n){L(Mr,"Failed to raise snapshot:",n),await qa(r,n)}}async function qa(r,e,t){if(!ei(e))throw e;r.W_.add(1),await As(r),r.j_.set("Offline"),t||(t=()=>db(r.localStore)),r.asyncQueue.enqueueRetryable(async()=>{L(Mr,"Retrying IndexedDB access"),await t(),r.W_.delete(1),await hl(r)})}function gb(r,e){return e().catch(t=>qa(r,t,e))}async function dl(r){let e=q(r),t=hr(e),n=e.K_.length>0?e.K_[e.K_.length-1].batchId:od;for(;DD(e);)try{let i=await ID(e.localStore,n);if(i===null){e.K_.length===0&&t.P_();break}n=i.batchId,OD(e,i)}catch(i){await qa(e,i)}yb(e)&&_b(e)}function DD(r){return Fr(r)&&r.K_.length<10}function OD(r,e){r.K_.push(e);let t=hr(r);t.c_()&&t.S_&&t.b_(e.mutations)}function yb(r){return Fr(r)&&!hr(r).u_()&&r.K_.length>0}function _b(r){hr(r).start()}async function ND(r){hr(r).C_()}async function VD(r){let e=hr(r);for(let t of r.K_)e.b_(t.mutations)}async function LD(r,e,t){let n=r.K_.shift(),i=Qc.from(n,e,t);await gb(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),await dl(r)}async function MD(r,e){e&&hr(r).S_&&await async function(n,i){if(function(a){return Yk(a)&&a!==O.ABORTED}(i.code)){let s=n.K_.shift();hr(n).h_(),await gb(n,()=>n.remoteSyncer.rejectFailedWrite(s.batchId,i)),await dl(n)}}(r,e),yb(r)&&_b(r)}async function sv(r,e){let t=q(r);t.asyncQueue.verifyOperationInProgress(),L(Mr,"RemoteStore received new credentials");let n=Fr(t);t.W_.add(3),await As(t),n&&t.j_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.W_.delete(3),await hl(t)}async function FD(r,e){let t=q(r);e?(t.W_.delete(2),await hl(t)):e||(t.W_.add(2),await As(t),t.j_.set("Unknown"))}function ti(r){return r.J_||(r.J_=function(t,n,i){let s=q(t);return s.M_(),new Nh(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{xo:RD.bind(null,r),No:PD.bind(null,r),Lo:CD.bind(null,r),p_:kD.bind(null,r)}),r.G_.push(async e=>{e?(r.J_.h_(),wd(r)?_d(r):r.j_.set("Unknown")):(await r.J_.stop(),mb(r))})),r.J_}function hr(r){return r.Y_||(r.Y_=function(t,n,i){let s=q(t);return s.M_(),new Vh(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{xo:()=>Promise.resolve(),No:ND.bind(null,r),Lo:MD.bind(null,r),D_:VD.bind(null,r),v_:LD.bind(null,r)}),r.G_.push(async e=>{e?(r.Y_.h_(),await dl(r)):(await r.Y_.stop(),r.K_.length>0&&(L(Mr,`Stopping write stream with ${r.K_.length} pending writes`),r.K_=[]))})),r.Y_}function vd(r,e){if(Nt("AsyncQueue",`${e}: ${r}`),ei(r))return new M(O.UNAVAILABLE,`${e}: ${r}`);throw r}function ov(){return new Mt(r=>zv(r),ll)}async function wb(r,e){let t=q(r),n=3,i=e.query,s=t.queries.get(i);s?!s.na()&&e.ra()&&(n=2):(s=new Bh,n=e.ra()?0:1);try{switch(n){case 0:s.ea=await t.onListen(i,!0);break;case 1:s.ea=await t.onListen(i,!1);break;case 2:await t.onFirstRemoteStoreListen(i)}}catch(a){let l=vd(a,`Initialization of query '${Cn(e.query)}' failed`);return void e.onError(l)}t.queries.set(i,s),s.ta.push(e),e.sa(t.onlineState),s.ea&&e.oa(s.ea)&&bd(t)}async function vb(r,e){let t=q(r),n=e.query,i=3,s=t.queries.get(n);if(s){let a=s.ta.indexOf(e);a>=0&&(s.ta.splice(a,1),s.ta.length===0?i=e.ra()?0:1:!s.na()&&e.ra()&&(i=2))}switch(i){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}}function jD(r,e){let t=q(r),n=!1;for(let i of e){let s=i.query,a=t.queries.get(s);if(a){for(let l of a.ta)l.oa(i)&&(n=!0);a.ea=i}}n&&bd(t)}function UD(r,e,t){let n=q(r),i=n.queries.get(e);if(i)for(let s of i.ta)s.onError(t);n.queries.delete(e)}function bd(r){r.ia.forEach(e=>{e.next()})}async function BD(r,e,t=!0){let n=xb(r),i,s=n.ka.get(e);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Na()):i=await bb(n,e,t,!0),i}async function $D(r,e){let t=xb(r);await bb(t,e,!0,!1)}async function bb(r,e,t,n){let i=await AD(r.localStore,dt(e)),s=i.targetId,a=r.sharedClientState.addLocalQueryTarget(s,t),l;return n&&(l=await qD(r,e,s,a==="current",i.resumeToken)),r.isPrimaryClient&&t&&fb(r.remoteStore,i),l}async function qD(r,e,t,n,i){r.Ha=(m,g,I)=>async function(k,P,V,F){let B=P.view.ba(V);B.ls&&(B=await rv(k.localStore,P.query,!1).then(({documents:E})=>P.view.ba(E,B)));let K=F&&F.targetChanges.get(P.targetId),X=F&&F.targetMismatches.get(P.targetId)!=null,$=P.view.applyChanges(B,k.isPrimaryClient,K,X);return uv(k,P.targetId,$.Ma),$.snapshot}(r,m,g,I);let s=await rv(r.localStore,e,!0),a=new zh(e,s.gs),l=a.ba(s.documents),u=ps.createSynthesizedTargetChangeForCurrentChange(t,n&&r.onlineState!=="Offline",i),h=a.applyChanges(l,r.isPrimaryClient,u);uv(r,t,h.Ma);let f=new Gh(e,t,a);return r.ka.set(e,f),r.qa.has(t)?r.qa.get(t).push(e):r.qa.set(t,[e]),h.snapshot}async function zD(r,e,t){let n=q(r),i=n.ka.get(e),s=n.qa.get(i.targetId);if(s.length>1)return n.qa.set(i.targetId,s.filter(a=>!ll(a,e))),void n.ka.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await Sh(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),t&&gd(n.remoteStore,i.targetId),Wh(n,i.targetId)}).catch(Zn)):(Wh(n,i.targetId),await Sh(n.localStore,i.targetId,!0))}async function GD(r,e){let t=q(r),n=t.ka.get(e),i=t.qa.get(n.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),gd(t.remoteStore,n.targetId))}async function KD(r,e,t){let n=ZD(r);try{let i=await function(a,l){let u=q(a),h=Ee.now(),f=l.reduce((I,C)=>I.add(C.key),W()),m,g;return u.persistence.runTransaction("Locally write mutations","readwrite",I=>{let C=Ft(),k=W();return u.ds.getEntries(I,f).next(P=>{C=P,C.forEach((V,F)=>{F.isValidDocument()||(k=k.add(V))})}).next(()=>u.localDocuments.getOverlayedDocuments(I,C)).next(P=>{m=P;let V=[];for(let F of l){let B=Jk(F,m.get(F.key).overlayedDocument);B!=null&&V.push(new yt(F.key,B,Fv(B.value.mapValue),ur.exists(!0)))}return u.mutationQueue.addMutationBatch(I,h,V,l)}).next(P=>{g=P;let V=P.applyToLocalDocumentSet(m,k);return u.documentOverlayCache.saveOverlays(I,P.batchId,V)})}).then(()=>({batchId:g.batchId,changes:Hv(m)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(i.batchId),function(a,l,u){let h=a.Wa[a.currentUser.toKey()];h||(h=new de(J)),h=h.insert(l,u),a.Wa[a.currentUser.toKey()]=h}(n,i.batchId,t),await xs(n,i.changes),await dl(n.remoteStore)}catch(i){let s=vd(i,"Failed to persist write");t.reject(s)}}async function Tb(r,e){let t=q(r);try{let n=await TD(t.localStore,e);e.targetChanges.forEach((i,s)=>{let a=t.Ka.get(s);a&&(re(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?a.Ba=!0:i.modifiedDocuments.size>0?re(a.Ba):i.removedDocuments.size>0&&(re(a.Ba),a.Ba=!1))}),await xs(t,n,e)}catch(n){await Zn(n)}}function lv(r,e,t){let n=q(r);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){let i=[];n.ka.forEach((s,a)=>{let l=a.view.sa(e);l.snapshot&&i.push(l.snapshot)}),function(a,l){let u=q(a);u.onlineState=l;let h=!1;u.queries.forEach((f,m)=>{for(let g of m.ta)g.sa(l)&&(h=!0)}),h&&bd(u)}(n.eventManager,e),i.length&&n.La.p_(i),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}async function HD(r,e,t){let n=q(r);n.sharedClientState.updateQueryState(e,"rejected",t);let i=n.Ka.get(e),s=i&&i.key;if(s){let a=new de(U.comparator);a=a.insert(s,it.newNoDocument(s,z.min()));let l=W().add(s),u=new ka(z.min(),new Map,new de(J),a,l);await Tb(n,u),n.$a=n.$a.remove(s),n.Ka.delete(e),Ed(n)}else await Sh(n.localStore,e,!1).then(()=>Wh(n,e,t)).catch(Zn)}async function WD(r,e){let t=q(r),n=e.batch.batchId;try{let i=await bD(t.localStore,e);Ib(t,n,null),Eb(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),await xs(t,i)}catch(i){await Zn(i)}}async function QD(r,e,t){let n=q(r);try{let i=await function(a,l){let u=q(a);return u.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let f;return u.mutationQueue.lookupMutationBatch(h,l).next(m=>(re(m!==null),f=m.keys(),u.mutationQueue.removeMutationBatch(h,m))).next(()=>u.mutationQueue.performConsistencyCheck(h)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(h,f,l)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,f)).next(()=>u.localDocuments.getDocuments(h,f))})}(n.localStore,e);Ib(n,e,t),Eb(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),await xs(n,i)}catch(i){await Zn(i)}}function Eb(r,e){(r.Ga.get(e)||[]).forEach(t=>{t.resolve()}),r.Ga.delete(e)}function Ib(r,e,t){let n=q(r),i=n.Wa[n.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),n.Wa[n.currentUser.toKey()]=i}}function Wh(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(let n of r.qa.get(e))r.ka.delete(n),t&&r.La.Ja(n,t);r.qa.delete(e),r.isPrimaryClient&&r.Ua.br(e).forEach(n=>{r.Ua.containsKey(n)||Ab(r,n)})}function Ab(r,e){r.Qa.delete(e.path.canonicalString());let t=r.$a.get(e);t!==null&&(gd(r.remoteStore,t),r.$a=r.$a.remove(e),r.Ka.delete(t),Ed(r))}function uv(r,e,t){for(let n of t)n instanceof Ha?(r.Ua.addReference(n.key,e),JD(r,n)):n instanceof Wa?(L(Td,"Document no longer in limbo: "+n.key),r.Ua.removeReference(n.key,e),r.Ua.containsKey(n.key)||Ab(r,n.key)):j()}function JD(r,e){let t=e.key,n=t.path.canonicalString();r.$a.get(t)||r.Qa.has(n)||(L(Td,"New document in limbo: "+t),r.Qa.add(n),Ed(r))}function Ed(r){for(;r.Qa.size>0&&r.$a.size<r.maxConcurrentLimboResolutions;){let e=r.Qa.values().next().value;r.Qa.delete(e);let t=new U(ge.fromString(e)),n=r.za.next();r.Ka.set(n,new Kh(t)),r.$a=r.$a.insert(t,n),fb(r.remoteStore,new ms(dt(al(t.path)),n,"TargetPurposeLimboResolution",Fn.ae))}}async function xs(r,e,t){let n=q(r),i=[],s=[],a=[];n.ka.isEmpty()||(n.ka.forEach((l,u)=>{a.push(n.Ha(u,e,t).then(h=>{var f;if((h||t)&&n.isPrimaryClient){let m=h?!h.fromCache:(f=t==null?void 0:t.targetChanges.get(u.targetId))===null||f===void 0?void 0:f.current;n.sharedClientState.updateQueryState(u.targetId,m?"current":"not-current")}if(h){i.push(h);let m=Eh.Yi(u.targetId,h);s.push(m)}}))}),await Promise.all(a),n.La.p_(i),await async function(u,h){let f=q(u);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",m=>D.forEach(h,g=>D.forEach(g.Hi,I=>f.persistence.referenceDelegate.addReference(m,g.targetId,I)).next(()=>D.forEach(g.Ji,I=>f.persistence.referenceDelegate.removeReference(m,g.targetId,I)))))}catch(m){if(!ei(m))throw m;L(md,"Failed to update sequence numbers: "+m)}for(let m of h){let g=m.targetId;if(!m.fromCache){let I=f.Ts.get(g),C=I.snapshotVersion,k=I.withLastLimboFreeSnapshotVersion(C);f.Ts=f.Ts.insert(g,k)}}}(n.localStore,s))}async function YD(r,e){let t=q(r);if(!t.currentUser.isEqual(e)){L(Td,"User change. New user:",e.toKey());let n=await hb(t.localStore,e);t.currentUser=e,function(s,a){s.Ga.forEach(l=>{l.forEach(u=>{u.reject(new M(O.CANCELLED,a))})}),s.Ga.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),await xs(t,n.Rs)}}function XD(r,e){let t=q(r),n=t.Ka.get(e);if(n&&n.Ba)return W().add(n.key);{let i=W(),s=t.qa.get(e);if(!s)return i;for(let a of s){let l=t.ka.get(a);i=i.unionWith(l.view.Sa)}return i}}function xb(r){let e=q(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=Tb.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=XD.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=HD.bind(null,e),e.La.p_=jD.bind(null,e.eventManager),e.La.Ja=UD.bind(null,e.eventManager),e}function ZD(r){let e=q(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=WD.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=QD.bind(null,e),e}async function Ec(r,e){r.asyncQueue.verifyOperationInProgress(),L(dr,"Initializing OfflineComponentProvider");let t=r.configuration;await e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(async i=>{n.isEqual(i)||(await hb(e.localStore,i),n=i)}),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e}async function cv(r,e){r.asyncQueue.verifyOperationInProgress();let t=await e1(r);L(dr,"Initializing OnlineComponentProvider"),await e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>sv(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>sv(e.remoteStore,i)),r._onlineComponents=e}async function e1(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){L(dr,"Using user provided OfflineComponentProvider");try{await Ec(r,r._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!function(i){return i.name==="FirebaseError"?i.code===O.FAILED_PRECONDITION||i.code===O.UNIMPLEMENTED:!(typeof DOMException!="undefined"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(t))throw t;Ln("Error using user provided cache. Falling back to memory cache: "+t),await Ec(r,new Jn)}}else L(dr,"Using default OfflineComponentProvider"),await Ec(r,new Qh(void 0));return r._offlineComponents}async function Sb(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(L(dr,"Using user provided OnlineComponentProvider"),await cv(r,r._uninitializedComponentsProvider._online)):(L(dr,"Using default OnlineComponentProvider"),await cv(r,new _s))),r._onlineComponents}function t1(r){return Sb(r).then(e=>e.syncEngine)}async function Yh(r){let e=await Sb(r),t=e.eventManager;return t.onListen=BD.bind(null,e.syncEngine),t.onUnlisten=zD.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=$D.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=GD.bind(null,e.syncEngine),t}function r1(r,e,t={}){let n=new ct;return r.asyncQueue.enqueueAndForget(async()=>function(s,a,l,u,h){let f=new Qa({next:g=>{f.su(),a.enqueueAndForget(()=>vb(s,m));let I=g.docs.has(l);!I&&g.fromCache?h.reject(new M(O.UNAVAILABLE,"Failed to get document because the client is offline.")):I&&g.fromCache&&u&&u.source==="server"?h.reject(new M(O.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(g)},error:g=>h.reject(g)}),m=new Ka(al(l.path),f,{includeMetadataChanges:!0,Ta:!0});return wb(s,m)}(await Yh(r),r.asyncQueue,e,t,n)),n.promise}function Rb(r){let e={};return r.timeoutSeconds!==void 0&&(e.timeoutSeconds=r.timeoutSeconds),e}function n1(r,e,t){if(!t)throw new M(O.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function i1(r,e,t,n){if(e===!0&&n===!0)throw new M(O.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)}function dv(r){if(!U.isDocumentKey(r))throw new M(O.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function Id(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{let e=function(n){return n.constructor?n.constructor.name:null}(r);return e?`a custom ${e} object`:"an object"}}return typeof r=="function"?"a function":j()}function pt(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new M(O.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Id(r);throw new M(O.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}function s1(r,e,t,n={}){var i;let s=(r=pt(r,ws))._getSettings(),a=`${e}:${t}`;if(s.host!==Pb&&s.host!==a&&Ln("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),n.mockUserToken){let l,u;if(typeof n.mockUserToken=="string")l=n.mockUserToken,u=ve.MOCK_USER;else{l=rw(n.mockUserToken,(i=r._app)===null||i===void 0?void 0:i.options.projectId);let h=n.mockUserToken.sub||n.mockUserToken.user_id;if(!h)throw new M(O.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new ve(h)}r._authCredentials=new Ac(new ba(l,u))}}function fl(r,e,...t){if(r=Pt(r),arguments.length===1&&(e=Ea.newId()),n1("doc","path",e),r instanceof ws){let n=ge.fromString(e,...t);return dv(n),new Ue(r,null,new U(n))}{if(!(r instanceof Ue||r instanceof vs))throw new M(O.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(ge.fromString(e,...t));return dv(n),new Ue(r.firestore,r instanceof vs?r.converter:null,new U(n))}}function mv(r){return function(t,n){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of n)if(s in i&&typeof i[s]=="function")return!0;return!1}(r,["next","error","complete"])}function Cb(r,e){let t=typeof r=="object"?r:Tw(),n=typeof r=="string"?r:e||Sa,i=ww(t,"firestore").getImmediate({identifier:n});if(!i._initialized){let s=tw("firestore");s&&s1(i,...s)}return i}function Ad(r){if(r._terminated)throw new M(O.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||o1(r),r._firestoreClient}function o1(r){var e,t,n;let i=r._freezeSettings(),s=function(l,u,h,f){return new Dc(l,u,h,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,Rb(f.experimentalLongPollingOptions),f.useFetchStreams)}(r._databaseId,((e=r._app)===null||e===void 0?void 0:e.options.appId)||"",r._persistenceKey,i);r._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((n=i.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(r._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),r._firestoreClient=new Jh(r._authCredentials,r._appCheckCredentials,r._queue,s,r._componentsProvider&&function(l){let u=l==null?void 0:l._online.build();return{_offline:l==null?void 0:l._offline.build(u),_online:u}}(r._componentsProvider))}function kb(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw j()}}function Db(r){let e=r._freezeSettings(),t=cl(r._databaseId);return new ed(r._databaseId,!!e.ignoreUndefinedProperties,t)}function l1(r,e,t,n,i,s={}){let a=r.ju(s.merge||s.mergeFields?2:0,e,t,i);xd("Data must be an object, but it was:",a,n);let l=Ob(n,a),u,h;if(s.merge)u=new Xe(a.fieldMask),h=a.fieldTransforms;else if(s.mergeFields){let f=[];for(let m of s.mergeFields){let g=td(e,m,t);if(!a.contains(g))throw new M(O.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);Vb(f,g)||f.push(g)}u=new Xe(f),h=a.fieldTransforms.filter(m=>u.covers(m.field))}else u=null,h=a.fieldTransforms;return new Xh(new Ke(l),u,h)}function u1(r,e,t,n){let i=r.ju(1,e,t);xd("Data must be an object, but it was:",i,n);let s=[],a=Ke.empty();pr(n,(u,h)=>{let f=Sd(e,u,t);h=Pt(h);let m=i.Ku(f);if(h instanceof el)s.push(f);else{let g=pl(h,m);g!=null&&(s.push(f),a.set(f,g))}});let l=new Xe(s);return new Za(a,l,i.fieldTransforms)}function c1(r,e,t,n,i,s){let a=r.ju(1,e,t),l=[td(e,n,t)],u=[i];if(s.length%2!=0)throw new M(O.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<s.length;g+=2)l.push(td(e,s[g])),u.push(s[g+1]);let h=[],f=Ke.empty();for(let g=l.length-1;g>=0;--g)if(!Vb(h,l[g])){let I=l[g],C=u[g];C=Pt(C);let k=a.Ku(I);if(C instanceof el)h.push(I);else{let P=pl(C,k);P!=null&&(h.push(I),f.set(I,P))}}let m=new Xe(h);return new Za(f,m,a.fieldTransforms)}function pl(r,e){if(Nb(r=Pt(r)))return xd("Unsupported field value:",e,r),Ob(r,e);if(r instanceof Ts)return function(n,i){if(!kb(i.Lu))throw i.Wu(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Wu(`${n._methodName}() is not currently supported inside arrays`);let s=n._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(r,e),null;if(r===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.Qu&&e.Lu!==4)throw e.Wu("Nested arrays are not supported");return function(n,i){let s=[],a=0;for(let l of n){let u=pl(l,i.Uu(a));u==null&&(u={nullValue:"NULL_VALUE"}),s.push(u),a++}return{arrayValue:{values:s}}}(r,e)}return function(n,i){if((n=Pt(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return Gk(i.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let s=Ee.fromDate(n);return{timestampValue:Va(i.serializer,s)}}if(n instanceof Ee){let s=new Ee(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Va(i.serializer,s)}}if(n instanceof Es)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof bs)return{bytesValue:nb(i.serializer,n._byteString)};if(n instanceof Ue){let s=i.databaseId,a=n.firestore._databaseId;if(!a.isEqual(s))throw i.Wu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:pd(n.firestore._databaseId||i.databaseId,n._key.path)}}if(n instanceof Is)return function(a,l){return{mapValue:{fields:{[ld]:{stringValue:ud},[jn]:{arrayValue:{values:a.toArray().map(h=>{if(typeof h!="number")throw l.Wu("VectorValues must only contain numeric values.");return fd(l.serializer,h)})}}}}}}(n,i);throw i.Wu(`Unsupported field value: ${Id(n)}`)}(r,e)}function Ob(r,e){let t={};return Cv(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):pr(r,(n,i)=>{let s=pl(i,e.qu(n));s!=null&&(t[n]=s)}),{mapValue:{fields:t}}}function Nb(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof Ee||r instanceof Es||r instanceof bs||r instanceof Ue||r instanceof Ts||r instanceof Is)}function xd(r,e,t){if(!Nb(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){let n=Id(t);throw n==="an object"?e.Wu(r+" a custom object"):e.Wu(r+" "+n)}}function td(r,e,t){if((e=Pt(e))instanceof Yn)return e._internalPath;if(typeof e=="string")return Sd(r,e);throw tl("Field path arguments must be of type string or ",r,!1,void 0,t)}function Sd(r,e,t){if(e.search(h1)>=0)throw tl(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new Yn(...e.split("."))._internalPath}catch{throw tl(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function tl(r,e,t,n,i){let s=n&&!n.isEmpty(),a=i!==void 0,l=`Function ${e}() called with invalid data`;t&&(l+=" (via `toFirestore()`)"),l+=". ";let u="";return(s||a)&&(u+=" (found",s&&(u+=` in field ${n}`),a&&(u+=` in document ${i}`),u+=")"),new M(O.INVALID_ARGUMENT,l+r+u)}function Vb(r,e){return r.some(t=>t.isEqual(e))}function Lb(r,e){return typeof e=="string"?Sd(r,e):e instanceof Yn?e._internalPath:e._delegate._internalPath}function d1(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new M(O.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}function f1(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}function p1(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return j()}}function Rd(r){r=pt(r,Ue);let e=pt(r.firestore,fr);return r1(Ad(e),r._key).then(t=>Bb(e,r,t))}function Mb(r,e,t){r=pt(r,Ue);let n=pt(r.firestore,fr),i=f1(r.converter,e,t);return Ub(n,[l1(Db(n),"setDoc",r._key,i,r.converter!==null,t).toMutation(r._key,ur.none())])}function Fb(r,e,t,...n){r=pt(r,Ue);let i=pt(r.firestore,fr),s=Db(i),a;return a=typeof(e=Pt(e))=="string"||e instanceof Yn?c1(s,"updateDoc",r._key,e,t,n):u1(s,"updateDoc",r._key,e),Ub(i,[a.toMutation(r._key,ur.exists(!0))])}function jb(r,...e){var t,n,i;r=Pt(r);let s={includeMetadataChanges:!1,source:"default"},a=0;typeof e[a]!="object"||mv(e[a])||(s=e[a],a++);let l={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(mv(e[a])){let m=e[a];e[a]=(t=m.next)===null||t===void 0?void 0:t.bind(m),e[a+1]=(n=m.error)===null||n===void 0?void 0:n.bind(m),e[a+2]=(i=m.complete)===null||i===void 0?void 0:i.bind(m)}let u,h,f;if(r instanceof Ue)h=pt(r.firestore,fr),f=al(r._key.path),u={next:m=>{e[a]&&e[a](Bb(h,r,m))},error:e[a+1],complete:e[a+2]};else{let m=pt(r,Ya);h=pt(m.firestore,fr),f=m._query;let g=new il(h);u={next:I=>{e[a]&&e[a](new id(h,g,m,I))},error:e[a+1],complete:e[a+2]},d1(r._query)}return function(g,I,C,k){let P=new Qa(k),V=new Ka(I,P,C);return g.asyncQueue.enqueueAndForget(async()=>wb(await Yh(g),V)),()=>{P.su(),g.asyncQueue.enqueueAndForget(async()=>vb(await Yh(g),V))}}(Ad(h),f,l,u)}function Ub(r,e){return function(n,i){let s=new ct;return n.asyncQueue.enqueueAndForget(async()=>KD(await t1(n),i,s)),s.promise}(Ad(r),e)}function Bb(r,e,t){let n=t.docs.get(e._key),i=new il(r);return new nl(r,i,e._key,n,new kr(t.hasPendingWrites,t.fromCache),e.converter)}var Pw,Cw,ve,Xn,Dr,O,M,ct,ba,Ic,Ac,xc,Sc,Rc,Ta,Pc,Ea,kw,Dw,Ee,z,Ow,Ia,ge,fk,He,U,cs,Cc,Or,yk,kc,D,Fn,od,gv,Tk,yv,_v,wv,vv,Ek,bv,Tv,Ev,Iv,Av,xv,Sv,Rv,Ik,Ak,xk,Pv,Sk,Rk,f$,Pk,Ck,kk,p$,de,On,ht,be,Aa,Xe,xa,De,Dk,kv,Dv,Ov,Nv,Dc,Sa,Ra,ld,Vv,ma,ud,jn,g$,Ke,it,$n,qn,Pa,we,gt,Lc,Mc,Fc,jc,Uc,Bc,$c,qc,zn,Mt,Uk,Kv,Bk,$k,qk,Gn,Kn,Nr,Vr,Hn,Kc,ur,Wn,Lr,yt,Ca,Hc,Wc,Qc,Jc,Yc,pe,Y,Ww,Zk,Xc,Cr,ka,ps,Nn,Da,Oa,Na,Zc,eD,tD,rD,eh,ms,sh,La,oh,ah,y$,Zw,cb,Ye,gs,ev,yD,lh,uh,ch,hh,dh,fh,ph,mh,gh,ys,me,yh,_h,wh,vh,Ma,bh,Th,Fa,Eh,Ih,Ah,md,wD,xh,ja,Rh,Ph,nv,Ua,ya,bc,SD,kh,Dh,ke,Oh,Ba,iv,$a,Nh,Vh,Lh,Mh,Fh,Mr,jh,Uh,za,Ga,Qn,Bh,$h,qh,av,Ka,Ha,Wa,zh,Td,Gh,Kh,Hh,Jn,Qh,_s,Qa,dr,Jh,hv,Pb,fv,Ja,ws,Ya,Ue,vs,pv,Xa,fr,bs,Yn,Ts,Es,Is,a1,Xh,Za,Zh,ed,el,h1,rl,rd,nd,kr,nl,Vn,id,il,$b=_(()=>{da();Yu();Xu();ts();Sw();Rw();Pw="@firebase/firestore",Cw="4.7.8";ve=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};ve.UNAUTHENTICATED=new ve(null),ve.GOOGLE_CREDENTIALS=new ve("google-credentials-uid"),ve.FIRST_PARTY=new ve("first-party-uid"),ve.MOCK_USER=new ve("mock-user");Xn="11.3.1";Dr=new Sn("@firebase/firestore");O={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},M=class extends Rt{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};ct=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};ba=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Ic=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ve.UNAUTHENTICATED))}shutdown(){}},Ac=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},xc=class{constructor(e){this.t=e,this.currentUser=ve.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){re(this.o===void 0);let n=this.i,i=u=>this.i!==n?(n=this.i,t(u)):Promise.resolve(),s=new ct;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new ct,e.enqueueRetryable(()=>i(this.currentUser))};let a=()=>{let u=s;e.enqueueRetryable(async()=>{await u.promise,await i(this.currentUser)})},l=u=>{L("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(u=>l(u)),setTimeout(()=>{if(!this.auth){let u=this.t.getImmediate({optional:!0});u?l(u):(L("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new ct)}},0),a()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(L("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(re(typeof n.accessToken=="string"),new ba(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return re(e===null||typeof e=="string"),new ve(e)}},Sc=class{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=ve.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);let e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}},Rc=class{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new Sc(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(ve.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Ta=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Pc=class{constructor(e,t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,vw(e)&&e.settings.appCheckToken&&(this.V=e.settings.appCheckToken)}start(e,t){re(this.o===void 0);let n=s=>{s.error!=null&&L("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let a=s.token!==this.R;return this.R=s.token,L("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>n(s))};let i=s=>{L("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):L("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new Ta(this.V));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(re(typeof t.token=="string"),this.R=t.token,new Ta(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};Ea=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516),n="";for(;n.length<20;){let i=dk(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<t&&(n+=e.charAt(i[s]%62))}return n}};kw=-62135596800,Dw=1e6,Ee=class r{static now(){return r.fromMillis(Date.now())}static fromDate(e){return r.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*Dw);return new r(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new M(O.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new M(O.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<kw)throw new M(O.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new M(O.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Dw}_compareTo(e){return this.seconds===e.seconds?J(this.nanoseconds,e.nanoseconds):J(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds-kw;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};z=class r{static fromTimestamp(e){return new r(e)}static min(){return new r(new Ee(0,0))}static max(){return new r(new Ee(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};Ow="__name__",Ia=class r{constructor(e,t,n){t===void 0?t=0:t>e.length&&j(),n===void 0?n=e.length-t:n>e.length-t&&j(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return r.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof r?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let i=0;i<n;i++){let s=r.compareSegments(e.get(i),t.get(i));if(s!==0)return s}return Math.sign(e.length-t.length)}static compareSegments(e,t){let n=r.isNumericId(e),i=r.isNumericId(t);return n&&!i?-1:!n&&i?1:n&&i?r.extractNumericId(e).compare(r.extractNumericId(t)):e<t?-1:e>t?1:0}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Dt.fromString(e.substring(4,e.length-2))}},ge=class r extends Ia{construct(e,t,n){return new r(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new M(O.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(i=>i.length>0))}return new r(t)}static emptyPath(){return new r([])}},fk=/^[_a-zA-Z][_a-zA-Z0-9]*$/,He=class r extends Ia{construct(e,t,n){return new r(e,t,n)}static isValidIdentifier(e){return fk.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),r.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Ow}static keyField(){return new r([Ow])}static fromServerFormat(e){let t=[],n="",i=0,s=()=>{if(n.length===0)throw new M(O.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},a=!1;for(;i<e.length;){let l=e[i];if(l==="\\"){if(i+1===e.length)throw new M(O.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let u=e[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new M(O.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=u,i+=2}else l==="`"?(a=!a,i++):l!=="."||a?(n+=l,i++):(s(),i++)}if(s(),a)throw new M(O.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new r(t)}static emptyPath(){return new r([])}};U=class r{constructor(e){this.path=e}static fromPath(e){return new r(ge.fromString(e))}static fromName(e){return new r(ge.fromString(e).popFirst(5))}static empty(){return new r(ge.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ge.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ge.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new r(new ge(e.slice()))}};cs=-1,Cc=class{constructor(e,t,n,i){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=i}};Cc.UNKNOWN_ID=-1;Or=class r{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new r(z.min(),U.empty(),cs)}static max(){return new r(z.max(),U.empty(),cs)}};yk="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",kc=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};D=class r{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&j(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new r((n,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(n,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof r?t:r.resolve(t)}catch(t){return r.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):r.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):r.reject(t)}static resolve(e){return new r((t,n)=>{t(e)})}static reject(e){return new r((t,n)=>{n(e)})}static waitFor(e){return new r((t,n)=>{let i=0,s=0,a=!1;e.forEach(l=>{++i,l.next(()=>{++s,a&&s===i&&t()},u=>n(u))}),a=!0,s===i&&t()})}static or(e){let t=r.resolve(!1);for(let n of e)t=t.next(i=>i?r.resolve(i):n());return t}static forEach(e,t){let n=[];return e.forEach((i,s)=>{n.push(t.call(this,i,s))}),this.waitFor(n)}static mapArray(e,t){return new r((n,i)=>{let s=e.length,a=new Array(s),l=0;for(let u=0;u<s;u++){let h=u;t(e[h]).next(f=>{a[h]=f,++l,l===s&&n(a)},f=>i(f))}})}static doWhile(e,t){return new r((n,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):n()};s()})}};Fn=class{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=n=>this.oe(n),this._e=n=>t.writeSequenceNumber(n))}oe(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this._e&&this._e(e),e}};Fn.ae=-1;od=-1;gv="";Tk="remoteDocuments",yv="owner",_v="mutationQueues",wv="mutations";vv="documentMutations",Ek="remoteDocumentsV14",bv="remoteDocumentGlobal",Tv="targets",Ev="targetDocuments",Iv="targetGlobal",Av="collectionParents",xv="clientMetadata",Sv="bundles",Rv="namedQueries",Ik="indexConfiguration",Ak="indexState",xk="indexEntries",Pv="documentOverlays",Sk="globals",Rk=[_v,wv,vv,Tk,Tv,yv,Iv,Ev,xv,bv,Av,Sv,Rv],f$=[...Rk,Pv],Pk=[_v,wv,vv,Ek,Tv,yv,Iv,Ev,xv,bv,Av,Sv,Rv,Pv],Ck=Pk,kk=[...Ck,Ik,Ak,xk],p$=[...kk,Sk];de=class r{constructor(e,t){this.comparator=e,this.root=t||ht.EMPTY}insert(e,t){return new r(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ht.BLACK,null,null))}remove(e){return new r(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ht.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let i=this.comparator(e,n.key);if(i===0)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new On(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new On(this.root,e,this.comparator,!1)}getReverseIterator(){return new On(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new On(this.root,e,this.comparator,!0)}},On=class{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},ht=class r{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=n!=null?n:r.RED,this.left=i!=null?i:r.EMPTY,this.right=s!=null?s:r.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,s){return new r(e!=null?e:this.key,t!=null?t:this.value,n!=null?n:this.color,i!=null?i:this.left,s!=null?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this,s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return r.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return r.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,r.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,r.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw j();let e=this.left.check();if(e!==this.right.check())throw j();return e+(this.isRed()?0:1)}};ht.EMPTY=null,ht.RED=!0,ht.BLACK=!1;ht.EMPTY=new class{constructor(){this.size=0}get key(){throw j()}get value(){throw j()}get color(){throw j()}get left(){throw j()}get right(){throw j()}copy(e,t,n,i,s){return this}insert(e,t,n){return new ht(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};be=class r{constructor(e){this.comparator=e,this.data=new de(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Aa(this.data.getIterator())}getIteratorFrom(e){return new Aa(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof r)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=n.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new r(this.comparator);return t.data=e,t}},Aa=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};Xe=class r{constructor(e){this.fields=e,e.sort(He.comparator)}static empty(){return new r([])}unionWith(e){let t=new be(He.comparator);for(let n of this.fields)t=t.add(n);for(let n of e)t=t.add(n);return new r(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Mn(this.fields,e.fields,(t,n)=>t.isEqual(n))}};xa=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};De=class r{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(s){throw typeof DOMException!="undefined"&&s instanceof DOMException?new xa("Invalid base64 string: "+s):s}}(e);return new r(t)}static fromUint8Array(e){let t=function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s}(e);return new r(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return J(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};De.EMPTY_BYTE_STRING=new De("");Dk=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);kv="server_timestamp",Dv="__type__",Ov="__previous_value__",Nv="__local_write_time__";Dc=class{constructor(e,t,n,i,s,a,l,u,h){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=l,this.longPollingOptions=u,this.useFetchStreams=h}},Sa="(default)",Ra=class r{constructor(e,t){this.projectId=e,this.database=t||Sa}static empty(){return new r("","")}get isDefaultDatabase(){return this.database===Sa}isEqual(e){return e instanceof r&&e.projectId===this.projectId&&e.database===this.database}};ld="__type__",Vv="__max__",ma={mapValue:{fields:{__type__:{stringValue:Vv}}}},ud="__vector__",jn="value";g$={mapValue:{fields:{[ld]:{stringValue:ud},[jn]:{arrayValue:{}}}}};Ke=class r{constructor(e){this.value=e}static empty(){return new r({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!wa(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=os(t)}setAll(e){let t=He.emptyPath(),n={},i=[];e.forEach((a,l)=>{if(!t.isImmediateParentOf(l)){let u=this.getFieldsMap(t);this.applyChanges(u,n,i),n={},i=[],t=l.popLast()}a?n[l.lastSegment()]=os(a):i.push(l.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,n,i)}delete(e){let t=this.field(e.popLast());wa(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return mt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];wa(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){pr(t,(i,s)=>e[i]=s);for(let i of n)delete e[i]}clone(){return new r(os(this.value))}};it=class r{constructor(e,t,n,i,s,a,l){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=s,this.data=a,this.documentState=l}static newInvalidDocument(e){return new r(e,0,z.min(),z.min(),z.min(),Ke.empty(),0)}static newFoundDocument(e,t,n,i){return new r(e,1,t,z.min(),n,i,0)}static newNoDocument(e,t){return new r(e,2,t,z.min(),z.min(),Ke.empty(),0)}static newUnknownDocument(e,t){return new r(e,3,t,z.min(),z.min(),Ke.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(z.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ke.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ke.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=z.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof r&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new r(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};$n=class{constructor(e,t){this.position=e,this.inclusive=t}};qn=class{constructor(e,t="asc"){this.field=e,this.dir=t}};Pa=class{},we=class r extends Pa{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new Lc(e,t,n):t==="array-contains"?new jc(e,n):t==="in"?new Uc(e,n):t==="not-in"?new Bc(e,n):t==="array-contains-any"?new $c(e,n):new r(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new Mc(e,n):new Fc(e,n)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Un(t,this.value)):t!==null&&cr(this.value)===cr(t)&&this.matchesComparison(Un(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return j()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},gt=class r extends Pa{constructor(e,t){super(),this.filters=e,this.op=t,this.ce=null}static create(e,t){return new r(e,t)}matches(e){return jv(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}};Lc=class extends we{constructor(e,t,n){super(e,t,n),this.key=U.fromName(n.referenceValue)}matches(e){let t=U.comparator(e.key,this.key);return this.matchesComparison(t)}},Mc=class extends we{constructor(e,t){super(e,"in",t),this.keys=qv("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},Fc=class extends we{constructor(e,t){super(e,"not-in",t),this.keys=qv("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};jc=class extends we{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return cd(t)&&fs(t.arrayValue,this.value)}},Uc=class extends we{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&fs(this.value.arrayValue,t)}},Bc=class extends we{constructor(e,t){super(e,"not-in",t)}matches(e){if(fs(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!fs(this.value.arrayValue,t)}},$c=class extends we{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!cd(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>fs(this.value.arrayValue,n))}};qc=class{constructor(e,t=null,n=[],i=[],s=null,a=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=a,this.endAt=l,this.le=null}};zn=class{constructor(e,t=null,n=[],i=[],s=null,a="F",l=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=a,this.startAt=l,this.endAt=u,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}};Mt=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(let[i,s]of n)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let n=this.mapKeyFn(e),i=this.inner[n];if(i===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return n.length===1?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){pr(this.inner,(t,n)=>{for(let[i,s]of n)e(i,s)})}isEmpty(){return Cv(this.inner)}size(){return this.innerSize}};Uk=new de(U.comparator);Kv=new de(U.comparator);Bk=new de(U.comparator),$k=new be(U.comparator);qk=new be(J);Gn=class{constructor(){this._=void 0}};Kn=class extends Gn{},Nr=class extends Gn{constructor(e){super(),this.elements=e}};Vr=class extends Gn{constructor(e){super(),this.elements=e}};Hn=class extends Gn{constructor(e,t){super(),this.serializer=e,this.Ie=t}};Kc=class{constructor(e,t){this.version=e,this.transformResults=t}},ur=class r{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new r}static exists(e){return new r(void 0,e)}static updateTime(e){return new r(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};Wn=class{};Lr=class extends Wn{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},yt=class extends Wn{constructor(e,t,n,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};Ca=class extends Wn{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Hc=class extends Wn{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};Wc=class{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&Qk(s,e,n[i])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=us(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=us(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=Wv();return this.mutations.forEach(i=>{let s=e.get(i.key),a=s.overlayedDocument,l=this.applyToLocalView(a,s.mutatedFields);l=t.has(i.key)?null:l;let u=eb(a,l);u!==null&&n.set(i.key,u),a.isValidDocument()||a.convertToNoDocument(z.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),W())}isEqual(e){return this.batchId===e.batchId&&Mn(this.mutations,e.mutations,(t,n)=>Gw(t,n))&&Mn(this.baseMutations,e.baseMutations,(t,n)=>Gw(t,n))}},Qc=class r{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){re(e.mutations.length===n.length);let i=function(){return Bk}(),s=e.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,n[a].version);return new r(e,t,n,i)}};Jc=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};Yc=class{constructor(e,t){this.count=e,this.unchangedNames=t}};(Y=pe||(pe={}))[Y.OK=0]="OK",Y[Y.CANCELLED=1]="CANCELLED",Y[Y.UNKNOWN=2]="UNKNOWN",Y[Y.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Y[Y.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Y[Y.NOT_FOUND=5]="NOT_FOUND",Y[Y.ALREADY_EXISTS=6]="ALREADY_EXISTS",Y[Y.PERMISSION_DENIED=7]="PERMISSION_DENIED",Y[Y.UNAUTHENTICATED=16]="UNAUTHENTICATED",Y[Y.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Y[Y.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Y[Y.ABORTED=10]="ABORTED",Y[Y.OUT_OF_RANGE=11]="OUT_OF_RANGE",Y[Y.UNIMPLEMENTED=12]="UNIMPLEMENTED",Y[Y.INTERNAL=13]="INTERNAL",Y[Y.UNAVAILABLE=14]="UNAVAILABLE",Y[Y.DATA_LOSS=15]="DATA_LOSS";Ww=null;Zk=new Dt([4294967295,4294967295],0);Xc=class r{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Cr(`Invalid padding: ${t}`);if(n<0)throw new Cr(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new Cr(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new Cr(`Invalid padding when bitmap length is 0: ${t}`);this.Ee=8*e.length-t,this.de=Dt.fromNumber(this.Ee)}Ae(e,t,n){let i=e.add(t.multiply(Dt.fromNumber(n)));return i.compare(Zk)===1&&(i=new Dt([i.getBits(0),i.getBits(1)],0)),i.modulo(this.de).toNumber()}Re(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.Ee===0)return!1;let t=Qw(e),[n,i]=Jw(t);for(let s=0;s<this.hashCount;s++){let a=this.Ae(n,i,s);if(!this.Re(a))return!1}return!0}static create(e,t,n){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new r(s,i,t);return n.forEach(l=>a.insert(l)),a}insert(e){if(this.Ee===0)return;let t=Qw(e),[n,i]=Jw(t);for(let s=0;s<this.hashCount;s++){let a=this.Ae(n,i,s);this.Ve(a)}}Ve(e){let t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}},Cr=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};ka=class r{constructor(e,t,n,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let i=new Map;return i.set(e,ps.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new r(z.min(),i,new de(J),Ft(),W())}},ps=class r{constructor(e,t,n,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new r(n,t,W(),W(),W())}};Nn=class{constructor(e,t,n,i){this.me=e,this.removedTargetIds=t,this.key=n,this.fe=i}},Da=class{constructor(e,t){this.targetId=e,this.ge=t}},Oa=class{constructor(e,t,n=De.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}},Na=class{constructor(){this.pe=0,this.ye=Yw(),this.we=De.EMPTY_BYTE_STRING,this.Se=!1,this.be=!0}get current(){return this.Se}get resumeToken(){return this.we}get De(){return this.pe!==0}get ve(){return this.be}Ce(e){e.approximateByteSize()>0&&(this.be=!0,this.we=e)}Fe(){let e=W(),t=W(),n=W();return this.ye.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:j()}}),new ps(this.we,this.Se,e,t,n)}Me(){this.be=!1,this.ye=Yw()}xe(e,t){this.be=!0,this.ye=this.ye.insert(e,t)}Oe(e){this.be=!0,this.ye=this.ye.remove(e)}Ne(){this.pe+=1}Be(){this.pe-=1,re(this.pe>=0)}Le(){this.be=!0,this.Se=!0}},Zc=class{constructor(e){this.ke=e,this.qe=new Map,this.Qe=Ft(),this.$e=ga(),this.Ke=ga(),this.Ue=new de(J)}We(e){for(let t of e.me)e.fe&&e.fe.isFoundDocument()?this.Ge(t,e.fe):this.ze(t,e.key,e.fe);for(let t of e.removedTargetIds)this.ze(t,e.key,e.fe)}je(e){this.forEachTarget(e,t=>{let n=this.He(t);switch(e.state){case 0:this.Je(t)&&n.Ce(e.resumeToken);break;case 1:n.Be(),n.De||n.Me(),n.Ce(e.resumeToken);break;case 2:n.Be(),n.De||this.removeTarget(t);break;case 3:this.Je(t)&&(n.Le(),n.Ce(e.resumeToken));break;case 4:this.Je(t)&&(this.Ye(t),n.Ce(e.resumeToken));break;default:j()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.qe.forEach((n,i)=>{this.Je(i)&&t(i)})}Ze(e){let t=e.targetId,n=e.ge.count,i=this.Xe(t);if(i){let s=i.target;if(zc(s))if(n===0){let a=new U(s.path);this.ze(t,a,it.newNoDocument(a,z.min()))}else re(n===1);else{let a=this.et(t);if(a!==n){let l=this.tt(e),u=l?this.nt(l,e,a):1;if(u!==0){this.Ye(t);let h=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ue=this.Ue.insert(t,h)}Ww==null||Ww.rt(function(f,m,g,I,C){var k,P,V,F,B,K;let X={localCacheCount:f,existenceFilterCount:m.count,databaseId:g.database,projectId:g.projectId},$=m.unchangedNames;return $&&(X.bloomFilter={applied:C===0,hashCount:(k=$==null?void 0:$.hashCount)!==null&&k!==void 0?k:0,bitmapLength:(F=(V=(P=$==null?void 0:$.bits)===null||P===void 0?void 0:P.bitmap)===null||V===void 0?void 0:V.length)!==null&&F!==void 0?F:0,padding:(K=(B=$==null?void 0:$.bits)===null||B===void 0?void 0:B.padding)!==null&&K!==void 0?K:0,mightContain:E=>{var y;return(y=I==null?void 0:I.mightContain(E))!==null&&y!==void 0&&y}}),X}(a,e.ge,this.ke.it(),l,u))}}}}tt(e){let t=e.ge.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=t,a,l;try{a=Lt(n).toUint8Array()}catch(u){if(u instanceof xa)return Ln("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{l=new Xc(a,i,s)}catch(u){return Ln(u instanceof Cr?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return l.Ee===0?null:l}nt(e,t,n){return t.ge.count===n-this.st(e,t.targetId)?0:2}st(e,t){let n=this.ke.getRemoteKeysForTarget(t),i=0;return n.forEach(s=>{let a=this.ke.it(),l=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(l)||(this.ze(t,s,null),i++)}),i}ot(e){let t=new Map;this.qe.forEach((s,a)=>{let l=this.Xe(a);if(l){if(s.current&&zc(l.target)){let u=new U(l.target.path);this._t(u).has(a)||this.ut(a,u)||this.ze(a,u,it.newNoDocument(u,e))}s.ve&&(t.set(a,s.Fe()),s.Me())}});let n=W();this.Ke.forEach((s,a)=>{let l=!0;a.forEachWhile(u=>{let h=this.Xe(u);return!h||h.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(n=n.add(s))}),this.Qe.forEach((s,a)=>a.setReadTime(e));let i=new ka(e,t,this.Ue,this.Qe,n);return this.Qe=Ft(),this.$e=ga(),this.Ke=ga(),this.Ue=new de(J),i}Ge(e,t){if(!this.Je(e))return;let n=this.ut(e,t.key)?2:0;this.He(e).xe(t.key,n),this.Qe=this.Qe.insert(t.key,t),this.$e=this.$e.insert(t.key,this._t(t.key).add(e)),this.Ke=this.Ke.insert(t.key,this.ct(t.key).add(e))}ze(e,t,n){if(!this.Je(e))return;let i=this.He(e);this.ut(e,t)?i.xe(t,1):i.Oe(t),this.Ke=this.Ke.insert(t,this.ct(t).delete(e)),this.Ke=this.Ke.insert(t,this.ct(t).add(e)),n&&(this.Qe=this.Qe.insert(t,n))}removeTarget(e){this.qe.delete(e)}et(e){let t=this.He(e).Fe();return this.ke.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ne(e){this.He(e).Ne()}He(e){let t=this.qe.get(e);return t||(t=new Na,this.qe.set(e,t)),t}ct(e){let t=this.Ke.get(e);return t||(t=new be(J),this.Ke=this.Ke.insert(e,t)),t}_t(e){let t=this.$e.get(e);return t||(t=new be(J),this.$e=this.$e.insert(e,t)),t}Je(e){let t=this.Xe(e)!==null;return t||L("WatchChangeAggregator","Detected inactive target",e),t}Xe(e){let t=this.qe.get(e);return t&&t.De?null:this.ke.lt(e)}Ye(e){this.qe.set(e,new Na),this.ke.getRemoteKeysForTarget(e).forEach(t=>{this.ze(e,t,null)})}ut(e,t){return this.ke.getRemoteKeysForTarget(e).has(t)}};eD={asc:"ASCENDING",desc:"DESCENDING"},tD={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},rD={and:"AND",or:"OR"},eh=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};ms=class r{constructor(e,t,n,i,s=z.min(),a=z.min(),l=De.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=l,this.expectedCount=u}withSequenceNumber(e){return new r(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};sh=class{constructor(e){this.Tt=e}};La=class{constructor(){}At(e,t){this.Rt(e,t),t.Vt()}Rt(e,t){if("nullValue"in e)this.ft(t,5);else if("booleanValue"in e)this.ft(t,10),t.gt(e.booleanValue?1:0);else if("integerValue"in e)this.ft(t,15),t.gt(ue(e.integerValue));else if("doubleValue"in e){let n=ue(e.doubleValue);isNaN(n)?this.ft(t,13):(this.ft(t,15),hs(n)?t.gt(0):t.gt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.ft(t,20),typeof n=="string"&&(n=Vt(n)),t.yt(`${n.seconds||""}`),t.gt(n.nanos||0)}else if("stringValue"in e)this.wt(e.stringValue,t),this.St(t);else if("bytesValue"in e)this.ft(t,30),t.bt(Lt(e.bytesValue)),this.St(t);else if("referenceValue"in e)this.Dt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.ft(t,45),t.gt(n.latitude||0),t.gt(n.longitude||0)}else"mapValue"in e?Mv(e)?this.ft(t,Number.MAX_SAFE_INTEGER):Lv(e)?this.vt(e.mapValue,t):(this.Ct(e.mapValue,t),this.St(t)):"arrayValue"in e?(this.Ft(e.arrayValue,t),this.St(t)):j()}wt(e,t){this.ft(t,25),this.Mt(e,t)}Mt(e,t){t.yt(e)}Ct(e,t){let n=e.fields||{};this.ft(t,55);for(let i of Object.keys(n))this.wt(i,t),this.Rt(n[i],t)}vt(e,t){var n,i;let s=e.fields||{};this.ft(t,53);let a=jn,l=((i=(n=s[a].arrayValue)===null||n===void 0?void 0:n.values)===null||i===void 0?void 0:i.length)||0;this.ft(t,15),t.gt(ue(l)),this.wt(a,t),this.Rt(s[a],t)}Ft(e,t){let n=e.values||[];this.ft(t,50);for(let i of n)this.Rt(i,t)}Dt(e,t){this.ft(t,37),U.fromName(e).path.forEach(n=>{this.ft(t,60),this.Mt(n,t)})}ft(e,t){e.gt(t)}St(e){e.gt(2)}};La.xt=new La;oh=class{constructor(){this.Tn=new ah}addToCollectionParentIndex(e,t){return this.Tn.add(t),D.resolve()}getCollectionParents(e,t){return D.resolve(this.Tn.getEntries(t))}addFieldIndex(e,t){return D.resolve()}deleteFieldIndex(e,t){return D.resolve()}deleteAllFieldIndexes(e){return D.resolve()}createTargetIndexes(e,t){return D.resolve()}getDocumentsMatchingTarget(e,t){return D.resolve(null)}getIndexType(e,t){return D.resolve(0)}getFieldIndexes(e,t){return D.resolve([])}getNextCollectionGroupToUpdate(e){return D.resolve(null)}getMinOffset(e,t){return D.resolve(Or.min())}getMinOffsetFromCollectionGroup(e,t){return D.resolve(Or.min())}updateCollectionGroup(e,t,n){return D.resolve()}updateIndexEntries(e,t){return D.resolve()}},ah=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new be(ge.comparator),s=!i.has(n);return this.index[t]=i.add(n),s}has(e){let t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new be(ge.comparator)).toArray()}};y$=new Uint8Array(0);Zw={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},cb=41943040,Ye=class r{static withCacheSize(e){return new r(e,r.DEFAULT_COLLECTION_PERCENTILE,r.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}};Ye.DEFAULT_COLLECTION_PERCENTILE=10,Ye.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ye.DEFAULT=new Ye(cb,Ye.DEFAULT_COLLECTION_PERCENTILE,Ye.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ye.DISABLED=new Ye(-1,0,0);gs=class r{constructor(e){this.$n=e}next(){return this.$n+=2,this.$n}static Kn(){return new r(0)}static Un(){return new r(-1)}};ev="LruGarbageCollector",yD=1048576;lh=class{constructor(e){this.Hn=e,this.buffer=new be(tv),this.Jn=0}Yn(){return++this.Jn}Zn(e){let t=[e,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(t);else{let n=this.buffer.last();tv(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}},uh=class{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(e){L(ev,`Garbage collection scheduled in ${e}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){ei(t)?L(ev,"Ignoring IndexedDB error during garbage collection: ",t):await Zn(t)}await this.er(3e5)})}},ch=class{constructor(e,t){this.tr=e,this.params=t}calculateTargetCount(e,t){return this.tr.nr(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(t===0)return D.resolve(Fn.ae);let n=new lh(t);return this.tr.forEachTarget(e,i=>n.Zn(i.sequenceNumber)).next(()=>this.tr.rr(e,i=>n.Zn(i))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.tr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.tr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(L("LruGarbageCollector","Garbage collection skipped; disabled"),D.resolve(Zw)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(L("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Zw):this.ir(e,t))}getCacheSize(e){return this.tr.getCacheSize(e)}ir(e,t){let n,i,s,a,l,u,h,f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(m=>(m>this.params.maximumSequenceNumbersToCollect?(L("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),i=this.params.maximumSequenceNumbersToCollect):i=m,a=Date.now(),this.nthSequenceNumber(e,i))).next(m=>(n=m,l=Date.now(),this.removeTargets(e,n,t))).next(m=>(s=m,u=Date.now(),this.removeOrphanedDocuments(e,n))).next(m=>(h=Date.now(),Pn()<=Q.DEBUG&&L("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${i} in `+(l-a)+`ms
	Removed ${s} targets in `+(u-l)+`ms
	Removed ${m} documents in `+(h-u)+`ms
Total Duration: ${h-f}ms`),D.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:m})))}};hh=class{constructor(){this.changes=new Mt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,it.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return n!==void 0?D.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};dh=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};fh=class{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(n!==null&&us(n.mutation,i,Xe.empty(),Ee.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,W()).next(()=>n))}getLocalViewOfDocuments(e,t,n=W()){let i=Pr();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(s=>{let a=ss();return s.forEach((l,u)=>{a=a.insert(l,u.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){let n=Pr();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,W()))}populateOverlays(e,t,n){let i=[];return n.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((a,l)=>{t.set(a,l)})})}computeViews(e,t,n,i){let s=Ft(),a=ls(),l=function(){return ls()}();return t.forEach((u,h)=>{let f=n.get(h.key);i.has(h.key)&&(f===void 0||f.mutation instanceof yt)?s=s.insert(h.key,h):f!==void 0?(a.set(h.key,f.mutation.getFieldMask()),us(f.mutation,h,f.mutation.getFieldMask(),Ee.now())):a.set(h.key,Xe.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((h,f)=>a.set(h,f)),t.forEach((h,f)=>{var m;return l.set(h,new dh(f,(m=a.get(h))!==null&&m!==void 0?m:null))}),l))}recalculateAndSaveOverlays(e,t){let n=ls(),i=new de((a,l)=>a-l),s=W();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(let l of a)l.keys().forEach(u=>{let h=t.get(u);if(h===null)return;let f=n.get(u)||Xe.empty();f=l.applyToLocalView(h,f),n.set(u,f);let m=(i.get(l.batchId)||W()).add(u);i=i.insert(l.batchId,m)})}).next(()=>{let a=[],l=i.getReverseIterator();for(;l.hasNext();){let u=l.getNext(),h=u.key,f=u.value,m=Wv();f.forEach(g=>{if(!s.has(g)){let I=eb(t.get(g),n.get(g));I!==null&&m.set(g,I),s=s.add(g)}}),a.push(this.documentOverlayCache.saveOverlays(e,h,m))}return D.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,i){return function(a){return U.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Lk(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i)}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(s=>{let a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-s.size):D.resolve(Pr()),l=cs,u=s;return a.next(h=>D.forEach(h,(f,m)=>(l<m.largestBatchId&&(l=m.largestBatchId),s.get(f)?D.resolve():this.remoteDocumentCache.getEntry(e,f).next(g=>{u=u.insert(f,g)}))).next(()=>this.populateOverlays(e,h,s)).next(()=>this.computeViews(e,u,h,W())).next(f=>({batchId:l,changes:Hv(f)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new U(t)).next(n=>{let i=ss();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){let s=t.collectionGroup,a=ss();return this.indexManager.getCollectionParents(e,s).next(l=>D.forEach(l,u=>{let h=function(m,g){return new zn(g,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)}(t,u.child(s));return this.getDocumentsMatchingCollectionQuery(e,h,n,i).next(f=>{f.forEach((m,g)=>{a=a.insert(m,g)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,i))).next(a=>{s.forEach((u,h)=>{let f=h.getKey();a.get(f)===null&&(a=a.insert(f,it.newInvalidDocument(f)))});let l=ss();return a.forEach((u,h)=>{let f=s.get(u);f!==void 0&&us(f.mutation,h,Xe.empty(),Ee.now()),ul(t,h)&&(l=l.insert(u,h))}),l})}};ph=class{constructor(e){this.serializer=e,this.dr=new Map,this.Ar=new Map}getBundleMetadata(e,t){return D.resolve(this.dr.get(t))}saveBundleMetadata(e,t){return this.dr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:ft(i.createTime)}}(t)),D.resolve()}getNamedQuery(e,t){return D.resolve(this.Ar.get(t))}saveNamedQuery(e,t){return this.Ar.set(t.name,function(i){return{name:i.name,query:gD(i.bundledQuery),readTime:ft(i.readTime)}}(t)),D.resolve()}};mh=class{constructor(){this.overlays=new de(U.comparator),this.Rr=new Map}getOverlay(e,t){return D.resolve(this.overlays.get(t))}getOverlays(e,t){let n=Pr();return D.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((i,s)=>{this.Et(e,t,s)}),D.resolve()}removeOverlaysForBatchId(e,t,n){let i=this.Rr.get(n);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Rr.delete(n)),D.resolve()}getOverlaysForCollection(e,t,n){let i=Pr(),s=t.length+1,a=new U(t.child("")),l=this.overlays.getIteratorFrom(a);for(;l.hasNext();){let u=l.getNext().value,h=u.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===s&&u.largestBatchId>n&&i.set(u.getKey(),u)}return D.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let s=new de((h,f)=>h-f),a=this.overlays.getIterator();for(;a.hasNext();){let h=a.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>n){let f=s.get(h.largestBatchId);f===null&&(f=Pr(),s=s.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}let l=Pr(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((h,f)=>l.set(h,f)),!(l.size()>=i)););return D.resolve(l)}Et(e,t,n){let i=this.overlays.get(n.key);if(i!==null){let a=this.Rr.get(i.largestBatchId).delete(n.key);this.Rr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new Jc(t,n));let s=this.Rr.get(t);s===void 0&&(s=W(),this.Rr.set(t,s)),this.Rr.set(t,s.add(n.key))}};gh=class{constructor(){this.sessionToken=De.EMPTY_BYTE_STRING}getSessionToken(e){return D.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,D.resolve()}};ys=class{constructor(){this.Vr=new be(me.mr),this.gr=new be(me.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(e,t){let n=new me(e,t);this.Vr=this.Vr.add(n),this.gr=this.gr.add(n)}yr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.wr(new me(e,t))}Sr(e,t){e.forEach(n=>this.removeReference(n,t))}br(e){let t=new U(new ge([])),n=new me(t,e),i=new me(t,e+1),s=[];return this.gr.forEachInRange([n,i],a=>{this.wr(a),s.push(a.key)}),s}Dr(){this.Vr.forEach(e=>this.wr(e))}wr(e){this.Vr=this.Vr.delete(e),this.gr=this.gr.delete(e)}vr(e){let t=new U(new ge([])),n=new me(t,e),i=new me(t,e+1),s=W();return this.gr.forEachInRange([n,i],a=>{s=s.add(a.key)}),s}containsKey(e){let t=new me(e,0),n=this.Vr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}},me=class{constructor(e,t){this.key=e,this.Cr=t}static mr(e,t){return U.comparator(e.key,t.key)||J(e.Cr,t.Cr)}static pr(e,t){return J(e.Cr,t.Cr)||U.comparator(e.key,t.key)}};yh=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Fr=1,this.Mr=new be(me.mr)}checkEmpty(e){return D.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,i){let s=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new Wc(s,t,n,i);this.mutationQueue.push(a);for(let l of i)this.Mr=this.Mr.add(new me(l.key,s)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return D.resolve(a)}lookupMutationBatch(e,t){return D.resolve(this.Or(t))}getNextMutationBatchAfterBatchId(e,t){let n=t+1,i=this.Nr(n),s=i<0?0:i;return D.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return D.resolve(this.mutationQueue.length===0?od:this.Fr-1)}getAllMutationBatches(e){return D.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new me(t,0),i=new me(t,Number.POSITIVE_INFINITY),s=[];return this.Mr.forEachInRange([n,i],a=>{let l=this.Or(a.Cr);s.push(l)}),D.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new be(J);return t.forEach(i=>{let s=new me(i,0),a=new me(i,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([s,a],l=>{n=n.add(l.Cr)})}),D.resolve(this.Br(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,i=n.length+1,s=n;U.isDocumentKey(s)||(s=s.child(""));let a=new me(new U(s),0),l=new be(J);return this.Mr.forEachWhile(u=>{let h=u.key.path;return!!n.isPrefixOf(h)&&(h.length===i&&(l=l.add(u.Cr)),!0)},a),D.resolve(this.Br(l))}Br(e){let t=[];return e.forEach(n=>{let i=this.Or(n);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){re(this.Lr(t.batchId,"removed")===0),this.mutationQueue.shift();let n=this.Mr;return D.forEach(t.mutations,i=>{let s=new me(i.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Mr=n})}qn(e){}containsKey(e,t){let n=new me(t,0),i=this.Mr.firstAfterOrEqual(n);return D.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,D.resolve()}Lr(e,t){return this.Nr(e)}Nr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Or(e){let t=this.Nr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};_h=class{constructor(e){this.kr=e,this.docs=function(){return new de(U.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,i=this.docs.get(n),s=i?i.size:0,a=this.kr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return D.resolve(n?n.document.mutableCopy():it.newInvalidDocument(t))}getEntries(e,t){let n=Ft();return t.forEach(i=>{let s=this.docs.get(i);n=n.insert(i,s?s.document.mutableCopy():it.newInvalidDocument(i))}),D.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let s=Ft(),a=t.path,l=new U(a.child("__id-9223372036854775808__")),u=this.docs.getIteratorFrom(l);for(;u.hasNext();){let{key:h,value:{document:f}}=u.getNext();if(!a.isPrefixOf(h.path))break;h.path.length>a.length+1||gk(mk(f),n)<=0||(i.has(f.key)||ul(t,f))&&(s=s.insert(f.key,f.mutableCopy()))}return D.resolve(s)}getAllFromCollectionGroup(e,t,n,i){j()}qr(e,t){return D.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new wh(this)}getSize(e){return D.resolve(this.size)}},wh=class extends hh{constructor(e){super(),this.Ir=e}applyChanges(e){let t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.Ir.addEntry(e,i)):this.Ir.removeEntry(n)}),D.waitFor(t)}getFromCache(e,t){return this.Ir.getEntry(e,t)}getAllFromCache(e,t){return this.Ir.getEntries(e,t)}};vh=class{constructor(e){this.persistence=e,this.Qr=new Mt(t=>hd(t),dd),this.lastRemoteSnapshotVersion=z.min(),this.highestTargetId=0,this.$r=0,this.Kr=new ys,this.targetCount=0,this.Ur=gs.Kn()}forEachTarget(e,t){return this.Qr.forEach((n,i)=>t(i)),D.resolve()}getLastRemoteSnapshotVersion(e){return D.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return D.resolve(this.$r)}allocateTargetId(e){return this.highestTargetId=this.Ur.next(),D.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.$r&&(this.$r=t),D.resolve()}zn(e){this.Qr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.Ur=new gs(t),this.highestTargetId=t),e.sequenceNumber>this.$r&&(this.$r=e.sequenceNumber)}addTargetData(e,t){return this.zn(t),this.targetCount+=1,D.resolve()}updateTargetData(e,t){return this.zn(t),D.resolve()}removeTargetData(e,t){return this.Qr.delete(t.target),this.Kr.br(t.targetId),this.targetCount-=1,D.resolve()}removeTargets(e,t,n){let i=0,s=[];return this.Qr.forEach((a,l)=>{l.sequenceNumber<=t&&n.get(l.targetId)===null&&(this.Qr.delete(a),s.push(this.removeMatchingKeysForTargetId(e,l.targetId)),i++)}),D.waitFor(s).next(()=>i)}getTargetCount(e){return D.resolve(this.targetCount)}getTargetData(e,t){let n=this.Qr.get(t)||null;return D.resolve(n)}addMatchingKeys(e,t,n){return this.Kr.yr(t,n),D.resolve()}removeMatchingKeys(e,t,n){this.Kr.Sr(t,n);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(a=>{s.push(i.markPotentiallyOrphaned(e,a))}),D.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Kr.br(t),D.resolve()}getMatchingKeysForTargetId(e,t){let n=this.Kr.vr(t);return D.resolve(n)}containsKey(e,t){return D.resolve(this.Kr.containsKey(t))}};Ma=class{constructor(e,t){this.Wr={},this.overlays={},this.Gr=new Fn(0),this.zr=!1,this.zr=!0,this.jr=new gh,this.referenceDelegate=e(this),this.Hr=new vh(this),this.indexManager=new oh,this.remoteDocumentCache=function(i){return new _h(i)}(n=>this.referenceDelegate.Jr(n)),this.serializer=new sh(t),this.Yr=new ph(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new mh,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Wr[e.toKey()];return n||(n=new yh(t,this.referenceDelegate),this.Wr[e.toKey()]=n),n}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(e,t,n){L("MemoryPersistence","Starting transaction:",e);let i=new bh(this.Gr.next());return this.referenceDelegate.Zr(),n(i).next(s=>this.referenceDelegate.Xr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}ei(e,t){return D.or(Object.values(this.Wr).map(n=>()=>n.containsKey(e,t)))}},bh=class extends kc{constructor(e){super(),this.currentSequenceNumber=e}},Th=class r{constructor(e){this.persistence=e,this.ti=new ys,this.ni=null}static ri(e){return new r(e)}get ii(){if(this.ni)return this.ni;throw j()}addReference(e,t,n){return this.ti.addReference(n,t),this.ii.delete(n.toString()),D.resolve()}removeReference(e,t,n){return this.ti.removeReference(n,t),this.ii.add(n.toString()),D.resolve()}markPotentiallyOrphaned(e,t){return this.ii.add(t.toString()),D.resolve()}removeTarget(e,t){this.ti.br(t.targetId).forEach(i=>this.ii.add(i.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.ii.add(s.toString()))}).next(()=>n.removeTargetData(e,t))}Zr(){this.ni=new Set}Xr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return D.forEach(this.ii,n=>{let i=U.fromPath(n);return this.si(e,i).next(s=>{s||t.removeEntry(i,z.min())})}).next(()=>(this.ni=null,t.apply(e)))}updateLimboDocument(e,t){return this.si(e,t).next(n=>{n?this.ii.delete(t.toString()):this.ii.add(t.toString())})}Jr(e){return 0}si(e,t){return D.or([()=>D.resolve(this.ti.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.ei(e,t)])}},Fa=class r{constructor(e,t){this.persistence=e,this.oi=new Mt(n=>vk(n.path),(n,i)=>n.isEqual(i)),this.garbageCollector=_D(this,t)}static ri(e,t){return new r(e,t)}Zr(){}Xr(e){return D.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}nr(e){let t=this.sr(e);return this.persistence.getTargetCache().getTargetCount(e).next(n=>t.next(i=>n+i))}sr(e){let t=0;return this.rr(e,n=>{t++}).next(()=>t)}rr(e,t){return D.forEach(this.oi,(n,i)=>this.ar(e,n,i).next(s=>s?D.resolve():t(i)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0,i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.qr(e,a=>this.ar(e,a,t).next(l=>{l||(n++,s.removeEntry(a,z.min()))})).next(()=>s.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.oi.set(t,e.currentSequenceNumber),D.resolve()}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.oi.set(n,e.currentSequenceNumber),D.resolve()}removeReference(e,t,n){return this.oi.set(n,e.currentSequenceNumber),D.resolve()}updateLimboDocument(e,t){return this.oi.set(t,e.currentSequenceNumber),D.resolve()}Jr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=_a(e.data.value)),t}ar(e,t,n){return D.or([()=>this.persistence.ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let i=this.oi.get(t);return D.resolve(i!==void 0&&i>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}};Eh=class r{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.Hi=n,this.Ji=i}static Yi(e,t){let n=W(),i=W();for(let s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new r(e,t.fromCache,n,i)}};Ih=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};Ah=class{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return iw()?8:_k(nw())>0?6:4}()}initialize(e,t){this.ns=e,this.indexManager=t,this.Zi=!0}getDocumentsMatchingQuery(e,t,n,i){let s={result:null};return this.rs(e,t).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.ss(e,t,i,n).next(a=>{s.result=a})}).next(()=>{if(s.result)return;let a=new Ih;return this._s(e,t,a).next(l=>{if(s.result=l,this.Xi)return this.us(e,t,a,l.size)})}).next(()=>s.result)}us(e,t,n,i){return n.documentReadCount<this.es?(Pn()<=Q.DEBUG&&L("QueryEngine","SDK will not create cache indexes for query:",Cn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),D.resolve()):(Pn()<=Q.DEBUG&&L("QueryEngine","Query:",Cn(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.ts*i?(Pn()<=Q.DEBUG&&L("QueryEngine","The SDK decides to create cache indexes for query:",Cn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,dt(t))):D.resolve())}rs(e,t){if(qw(t))return D.resolve(null);let n=dt(t);return this.indexManager.getIndexType(e,n).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=Gc(t,null,"F"),n=dt(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(s=>{let a=W(...s);return this.ns.getDocuments(e,a).next(l=>this.indexManager.getMinOffset(e,n).next(u=>{let h=this.cs(t,l);return this.ls(t,h,a,u.readTime)?this.rs(e,Gc(t,null,"F")):this.hs(e,h,t,u)}))})))}ss(e,t,n,i){return qw(t)||i.isEqual(z.min())?D.resolve(null):this.ns.getDocuments(e,n).next(s=>{let a=this.cs(t,s);return this.ls(t,a,n,i)?D.resolve(null):(Pn()<=Q.DEBUG&&L("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Cn(t)),this.hs(e,a,t,pk(i,cs)).next(l=>l))})}cs(e,t){let n=new be(Gv(e));return t.forEach((i,s)=>{ul(e,s)&&(n=n.add(s))}),n}ls(e,t,n,i){if(e.limit===null)return!1;if(n.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}_s(e,t,n){return Pn()<=Q.DEBUG&&L("QueryEngine","Using full collection scan to execute query:",Cn(t)),this.ns.getDocumentsMatchingQuery(e,t,Or.min(),n)}hs(e,t,n,i){return this.ns.getDocumentsMatchingQuery(e,n,i).next(s=>(t.forEach(a=>{s=s.insert(a.key,a)}),s))}};md="LocalStore",wD=3e8,xh=class{constructor(e,t,n,i){this.persistence=e,this.Ps=t,this.serializer=i,this.Ts=new de(J),this.Is=new Mt(s=>hd(s),dd),this.Es=new Map,this.ds=e.getRemoteDocumentCache(),this.Hr=e.getTargetCache(),this.Yr=e.getBundleCache(),this.As(n)}As(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new fh(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ts))}};ja=class{constructor(){this.activeTargetIds=zk()}Ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}vs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}bs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},Rh=class{constructor(){this.ho=new ja,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.ho.Ds(e),this.Po[e]||"not-current"}updateQueryState(e,t,n){this.Po[e]=t}removeLocalQueryTarget(e){this.ho.vs(e)}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){delete this.Po[e]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(e){return this.ho.activeTargetIds.has(e)}start(){return this.ho=new ja,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};Ph=class{To(e){}shutdown(){}};nv="ConnectivityMonitor",Ua=class{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(e){this.Vo.push(e)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){L(nv,"Network connectivity changed: AVAILABLE");for(let e of this.Vo)e(0)}Ro(){L(nv,"Network connectivity changed: UNAVAILABLE");for(let e of this.Vo)e(1)}static D(){return typeof window!="undefined"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};ya=null;bc="RestConnection",SD={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},kh=class{get fo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.po=t+"://"+e.host,this.yo=`projects/${n}/databases/${i}`,this.wo=this.databaseId.database===Sa?`project_id=${n}`:`project_id=${n}&database_id=${i}`}So(e,t,n,i,s){let a=Ch(),l=this.bo(e,t.toUriEncodedString());L(bc,`Sending RPC '${e}' ${a}:`,l,n);let u={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(u,i,s),this.vo(e,l,u,n).then(h=>(L(bc,`Received RPC '${e}' ${a}: `,h),h),h=>{throw Ln(bc,`RPC '${e}' ${a} failed with error: `,h,"url: ",l,"request:",n),h})}Co(e,t,n,i,s,a){return this.So(e,t,n,i,s)}Do(e,t,n){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Xn}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,s)=>e[s]=i),n&&n.headers.forEach((i,s)=>e[s]=i)}bo(e,t){let n=SD[e];return`${this.po}/v1/${t}:${n}`}terminate(){}};Dh=class{constructor(e){this.Fo=e.Fo,this.Mo=e.Mo}xo(e){this.Oo=e}No(e){this.Bo=e}Lo(e){this.ko=e}onMessage(e){this.qo=e}close(){this.Mo()}send(e){this.Fo(e)}Qo(){this.Oo()}$o(){this.Bo()}Ko(e){this.ko(e)}Uo(e){this.qo(e)}};ke="WebChannelConnection",Oh=class extends kh{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}vo(e,t,n,i){let s=Ch();return new Promise((a,l)=>{let u=new mc;u.setWithCredentials(!0),u.listenOnce(gc.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case is.NO_ERROR:let f=u.getResponseJson();L(ke,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(f)),a(f);break;case is.TIMEOUT:L(ke,`RPC '${e}' ${s} timed out`),l(new M(O.DEADLINE_EXCEEDED,"Request time out"));break;case is.HTTP_ERROR:let m=u.getStatus();if(L(ke,`RPC '${e}' ${s} failed with status:`,m,"response text:",u.getResponseText()),m>0){let g=u.getResponseJson();Array.isArray(g)&&(g=g[0]);let I=g==null?void 0:g.error;if(I&&I.status&&I.message){let C=function(P){let V=P.toLowerCase().replace(/_/g,"-");return Object.values(O).indexOf(V)>=0?V:O.UNKNOWN}(I.status);l(new M(C,I.message))}else l(new M(O.UNKNOWN,"Server responded with status "+u.getStatus()))}else l(new M(O.UNAVAILABLE,"Connection failed."));break;default:j()}}finally{L(ke,`RPC '${e}' ${s} completed.`)}});let h=JSON.stringify(i);L(ke,`RPC '${e}' ${s} sending request:`,i),u.send(t,"POST",h,n,15)})}Wo(e,t,n){let i=Ch(),s=[this.po,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=wc(),l=_c(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(u.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Do(u.initMessageHeaders,t,n),u.encodeInitMessageHeaders=!0;let f=s.join("");L(ke,`Creating RPC '${e}' stream ${i}: ${f}`,u);let m=a.createWebChannel(f,u),g=!1,I=!1,C=new Dh({Fo:P=>{I?L(ke,`Not sending because RPC '${e}' stream ${i} is closed:`,P):(g||(L(ke,`Opening RPC '${e}' stream ${i} transport.`),m.open(),g=!0),L(ke,`RPC '${e}' stream ${i} sending:`,P),m.send(P))},Mo:()=>m.close()}),k=(P,V,F)=>{P.listen(V,B=>{try{F(B)}catch(K){setTimeout(()=>{throw K},0)}})};return k(m,Rn.EventType.OPEN,()=>{I||(L(ke,`RPC '${e}' stream ${i} transport opened.`),C.Qo())}),k(m,Rn.EventType.CLOSE,()=>{I||(I=!0,L(ke,`RPC '${e}' stream ${i} transport closed`),C.Ko())}),k(m,Rn.EventType.ERROR,P=>{I||(I=!0,Ln(ke,`RPC '${e}' stream ${i} transport errored:`,P),C.Ko(new M(O.UNAVAILABLE,"The operation could not be completed")))}),k(m,Rn.EventType.MESSAGE,P=>{var V;if(!I){let F=P.data[0];re(!!F);let B=F,K=(B==null?void 0:B.error)||((V=B[0])===null||V===void 0?void 0:V.error);if(K){L(ke,`RPC '${e}' stream ${i} received error:`,K);let X=K.status,$=function(b){let T=pe[b];if(T!==void 0)return rb(T)}(X),E=K.message;$===void 0&&($=O.INTERNAL,E="Unknown error status: "+X+" with message "+K.message),I=!0,C.Ko(new M($,E)),m.close()}else L(ke,`RPC '${e}' stream ${i} received:`,F),C.Uo(F)}}),k(l,yc.STAT_EVENT,P=>{P.stat===pa.PROXY?L(ke,`RPC '${e}' stream ${i} detected buffering proxy`):P.stat===pa.NOPROXY&&L(ke,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{C.$o()},0),C}};Ba=class{constructor(e,t,n=1e3,i=1.5,s=6e4){this.Ti=e,this.timerId=t,this.Go=n,this.zo=i,this.jo=s,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(e){this.cancel();let t=Math.floor(this.Ho+this.e_()),n=Math.max(0,Date.now()-this.Yo),i=Math.max(0,t-n);i>0&&L("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ho} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,i,()=>(this.Yo=Date.now(),e())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}};iv="PersistentStream",$a=class{constructor(e,t,n,i,s,a,l,u){this.Ti=e,this.n_=n,this.r_=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=l,this.listener=u,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new Ba(e,t)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(e){this.E_(),this.stream.send(e)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(e,t){this.E_(),this.d_(),this.a_.cancel(),this.i_++,e!==4?this.a_.reset():t&&t.code===O.RESOURCE_EXHAUSTED?(Nt(t.toString()),Nt("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):t&&t.code===O.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Lo(t)}A_(){}auth(){this.state=1;let e=this.R_(this.i_),t=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.i_===t&&this.V_(n,i)},n=>{e(()=>{let i=new M(O.UNKNOWN,"Fetching auth token failed: "+n.message);return this.m_(i)})})}V_(e,t){let n=this.R_(this.i_);this.stream=this.f_(e,t),this.stream.xo(()=>{n(()=>this.listener.xo())}),this.stream.No(()=>{n(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(i=>{n(()=>this.m_(i))}),this.stream.onMessage(i=>{n(()=>++this.__==1?this.g_(i):this.onNext(i))})}l_(){this.state=5,this.a_.Xo(async()=>{this.state=0,this.start()})}m_(e){return L(iv,`close with error: ${e}`),this.stream=null,this.close(4,e)}R_(e){return t=>{this.Ti.enqueueAndForget(()=>this.i_===e?t():(L(iv,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Nh=class extends $a{constructor(e,t,n,i,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,a),this.serializer=s}f_(e,t){return this.connection.Wo("Listen",e,t)}g_(e){return this.onNext(e)}onNext(e){this.a_.reset();let t=sD(this.serializer,e),n=function(s){if(!("targetChange"in s))return z.min();let a=s.targetChange;return a.targetIds&&a.targetIds.length?z.min():a.readTime?ft(a.readTime):z.min()}(e);return this.listener.p_(t,n)}y_(e){let t={};t.database=ih(this.serializer),t.addTarget=function(s,a){let l,u=a.target;if(l=zc(u)?{documents:lD(s,u)}:{query:uD(s,u).ht},l.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){l.resumeToken=nb(s,a.resumeToken);let h=th(s,a.expectedCount);h!==null&&(l.expectedCount=h)}else if(a.snapshotVersion.compareTo(z.min())>0){l.readTime=Va(s,a.snapshotVersion.toTimestamp());let h=th(s,a.expectedCount);h!==null&&(l.expectedCount=h)}return l}(this.serializer,e);let n=hD(this.serializer,e);n&&(t.labels=n),this.I_(t)}w_(e){let t={};t.database=ih(this.serializer),t.removeTarget=e,this.I_(t)}},Vh=class extends $a{constructor(e,t,n,i,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,a),this.serializer=s}get S_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.S_&&this.b_([])}f_(e,t){return this.connection.Wo("Write",e,t)}g_(e){return re(!!e.streamToken),this.lastStreamToken=e.streamToken,re(!e.writeResults||e.writeResults.length===0),this.listener.D_()}onNext(e){re(!!e.streamToken),this.lastStreamToken=e.streamToken,this.a_.reset();let t=aD(e.writeResults,e.commitTime),n=ft(e.commitTime);return this.listener.v_(n,t)}C_(){let e={};e.database=ih(this.serializer),this.I_(e)}b_(e){let t={streamToken:this.lastStreamToken,writes:e.map(n=>oD(this.serializer,n))};this.I_(t)}};Lh=class{},Mh=class extends Lh{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.F_=!1}M_(){if(this.F_)throw new M(O.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,t,n,i){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.So(e,rh(t,n),i,s,a)).catch(s=>{throw s.name==="FirebaseError"?(s.code===O.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new M(O.UNKNOWN,s.toString())})}Co(e,t,n,i,s){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,l])=>this.connection.Co(e,rh(t,n),i,a,l,s)).catch(a=>{throw a.name==="FirebaseError"?(a.code===O.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new M(O.UNKNOWN,a.toString())})}terminate(){this.F_=!0,this.connection.terminate()}},Fh=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(e){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.L_("Offline")))}set(e){this.Q_(),this.x_=0,e==="Online"&&(this.N_=!1),this.L_(e)}L_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}k_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(Nt(t),this.N_=!1):L("OnlineStateTracker",t)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}};Mr="RemoteStore",jh=class{constructor(e,t,n,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.K_=[],this.U_=new Map,this.W_=new Set,this.G_=[],this.z_=s,this.z_.To(a=>{n.enqueueAndForget(async()=>{Fr(this)&&(L(Mr,"Restarting streams for network reachability change."),await async function(u){let h=q(u);h.W_.add(4),await As(h),h.j_.set("Unknown"),h.W_.delete(4),await hl(h)}(this))})}),this.j_=new Fh(n,i)}};Uh=class r{constructor(e,t,n,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new ct,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,s){let a=Date.now()+n,l=new r(e,t,a,i,s);return l.start(n),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new M(O.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};za=class r{static emptySet(e){return new r(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||U.comparator(t.key,n.key):(t,n)=>U.comparator(t.key,n.key),this.keyedMap=ss(),this.sortedSet=new de(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof r)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=n.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let n=new r;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}};Ga=class{constructor(){this.Z_=new de(U.comparator)}track(e){let t=e.doc.key,n=this.Z_.get(t);n?e.type!==0&&n.type===3?this.Z_=this.Z_.insert(t,e):e.type===3&&n.type!==1?this.Z_=this.Z_.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.Z_=this.Z_.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.Z_=this.Z_.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.Z_=this.Z_.remove(t):e.type===1&&n.type===2?this.Z_=this.Z_.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.Z_=this.Z_.insert(t,{type:2,doc:e.doc}):j():this.Z_=this.Z_.insert(t,e)}X_(){let e=[];return this.Z_.inorderTraversal((t,n)=>{e.push(n)}),e}},Qn=class r{constructor(e,t,n,i,s,a,l,u,h){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=l,this.excludesMetadataChanges=u,this.hasCachedResults=h}static fromInitialDocuments(e,t,n,i,s){let a=[];return t.forEach(l=>{a.push({type:0,doc:l})}),new r(e,t,za.emptySet(t),a,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ll(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}};Bh=class{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(e=>e.ra())}},$h=class{constructor(){this.queries=ov(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(t,n){let i=q(t),s=i.queries;i.queries=ov(),s.forEach((a,l)=>{for(let u of l.ta)u.onError(n)})})(this,new M(O.ABORTED,"Firestore shutting down"))}};(av=qh||(qh={}))._a="default",av.Cache="cache";Ka=class{constructor(e,t,n){this.query=e,this.aa=t,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=n||{}}oa(e){if(!this.options.includeMetadataChanges){let n=[];for(let i of e.docChanges)i.type!==3&&n.push(i);e=new Qn(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.ua?this.la(e)&&(this.aa.next(e),t=!0):this.ha(e,this.onlineState)&&(this.Pa(e),t=!0),this.ca=e,t}onError(e){this.aa.error(e)}sa(e){this.onlineState=e;let t=!1;return this.ca&&!this.ua&&this.ha(this.ca,e)&&(this.Pa(this.ca),t=!0),t}ha(e,t){if(!e.fromCache||!this.ra())return!0;let n=t!=="Offline";return(!this.options.Ta||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}la(e){if(e.docChanges.length>0)return!0;let t=this.ca&&this.ca.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}Pa(e){e=Qn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ua=!0,this.aa.next(e)}ra(){return this.options.source!==qh.Cache}};Ha=class{constructor(e){this.key=e}},Wa=class{constructor(e){this.key=e}},zh=class{constructor(e,t){this.query=e,this.fa=t,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=W(),this.mutatedKeys=W(),this.ya=Gv(e),this.wa=new za(this.ya)}get Sa(){return this.fa}ba(e,t){let n=t?t.Da:new Ga,i=t?t.wa:this.wa,s=t?t.mutatedKeys:this.mutatedKeys,a=i,l=!1,u=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,h=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((f,m)=>{let g=i.get(f),I=ul(this.query,m)?m:null,C=!!g&&this.mutatedKeys.has(g.key),k=!!I&&(I.hasLocalMutations||this.mutatedKeys.has(I.key)&&I.hasCommittedMutations),P=!1;g&&I?g.data.isEqual(I.data)?C!==k&&(n.track({type:3,doc:I}),P=!0):this.va(g,I)||(n.track({type:2,doc:I}),P=!0,(u&&this.ya(I,u)>0||h&&this.ya(I,h)<0)&&(l=!0)):!g&&I?(n.track({type:0,doc:I}),P=!0):g&&!I&&(n.track({type:1,doc:g}),P=!0,(u||h)&&(l=!0)),P&&(I?(a=a.add(I),s=k?s.add(f):s.delete(f)):(a=a.delete(f),s=s.delete(f)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),s=s.delete(f.key),n.track({type:1,doc:f})}return{wa:a,Da:n,ls:l,mutatedKeys:s}}va(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){let s=this.wa;this.wa=e.wa,this.mutatedKeys=e.mutatedKeys;let a=e.Da.X_();a.sort((f,m)=>function(I,C){let k=P=>{switch(P){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return j()}};return k(I)-k(C)}(f.type,m.type)||this.ya(f.doc,m.doc)),this.Ca(n),i=i!=null&&i;let l=t&&!i?this.Fa():[],u=this.pa.size===0&&this.current&&!i?1:0,h=u!==this.ga;return this.ga=u,a.length!==0||h?{snapshot:new Qn(this.query,e.wa,s,a,e.mutatedKeys,u===0,h,!1,!!n&&n.resumeToken.approximateByteSize()>0),Ma:l}:{Ma:l}}sa(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({wa:this.wa,Da:new Ga,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(e){return!this.fa.has(e)&&!!this.wa.has(e)&&!this.wa.get(e).hasLocalMutations}Ca(e){e&&(e.addedDocuments.forEach(t=>this.fa=this.fa.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.fa=this.fa.delete(t)),this.current=e.current)}Fa(){if(!this.current)return[];let e=this.pa;this.pa=W(),this.wa.forEach(n=>{this.xa(n.key)&&(this.pa=this.pa.add(n.key))});let t=[];return e.forEach(n=>{this.pa.has(n)||t.push(new Wa(n))}),this.pa.forEach(n=>{e.has(n)||t.push(new Ha(n))}),t}Oa(e){this.fa=e.gs,this.pa=W();let t=this.ba(e.documents);return this.applyChanges(t,!0)}Na(){return Qn.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,this.ga===0,this.hasCachedResults)}},Td="SyncEngine",Gh=class{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}},Kh=class{constructor(e){this.key=e,this.Ba=!1}},Hh=class{constructor(e,t,n,i,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.La={},this.ka=new Mt(l=>zv(l),ll),this.qa=new Map,this.Qa=new Set,this.$a=new de(U.comparator),this.Ka=new Map,this.Ua=new ys,this.Wa={},this.Ga=new Map,this.za=gs.Un(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}};Jn=class{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=cl(e.databaseInfo.databaseId),this.sharedClientState=this.Za(e),this.persistence=this.Xa(e),await this.persistence.start(),this.localStore=this.eu(e),this.gcScheduler=this.tu(e,this.localStore),this.indexBackfillerScheduler=this.nu(e,this.localStore)}tu(e,t){return null}nu(e,t){return null}eu(e){return vD(this.persistence,new Ah,e.initialUser,this.serializer)}Xa(e){return new Ma(Th.ri,this.serializer)}Za(e){return new Rh}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}};Jn.provider={build:()=>new Jn};Qh=class extends Jn{constructor(e){super(),this.cacheSizeBytes=e}tu(e,t){re(this.persistence.referenceDelegate instanceof Fa);let n=this.persistence.referenceDelegate.garbageCollector;return new uh(n,e.asyncQueue,t)}Xa(e){let t=this.cacheSizeBytes!==void 0?Ye.withCacheSize(this.cacheSizeBytes):Ye.DEFAULT;return new Ma(n=>Fa.ri(n,t),this.serializer)}},_s=class{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>lv(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=YD.bind(null,this.syncEngine),await FD(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new $h}()}createDatastore(e){let t=cl(e.databaseInfo.databaseId),n=function(s){return new Oh(s)}(e.databaseInfo);return function(s,a,l,u){return new Mh(s,a,l,u)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(n,i,s,a,l){return new jh(n,i,s,a,l)}(this.localStore,this.datastore,e.asyncQueue,t=>lv(this.syncEngine,t,0),function(){return Ua.D()?new Ua:new Ph}())}createSyncEngine(e,t){return function(i,s,a,l,u,h,f){let m=new Hh(i,s,a,l,u,h);return f&&(m.ja=!0),m}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(i){let s=q(i);L(Mr,"RemoteStore shutting down."),s.W_.add(5),await As(s),s.z_.shutdown(),s.j_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}};_s.provider={build:()=>new _s};Qa=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.iu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.iu(this.observer.error,e):Nt("Uncaught Error in snapshot listener:",e.toString()))}su(){this.muted=!0}iu(e,t){setTimeout(()=>{this.muted||e(t)},0)}};dr="FirestoreClient",Jh=class{constructor(e,t,n,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=ve.UNAUTHENTICATED,this.clientId=Ea.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,async a=>{L(dr,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(n,a=>(L(dr,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new ct;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let n=vd(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}};hv=new Map;Pb="firestore.googleapis.com",fv=!0,Ja=class{constructor(e){var t,n;if(e.host===void 0){if(e.ssl!==void 0)throw new M(O.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Pb,this.ssl=fv}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:fv;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=cb;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<yD)throw new M(O.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}i1("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Rb((n=e.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new M(O.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new M(O.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new M(O.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(n,i){return n.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},ws=class{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ja({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new M(O.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new M(O.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ja(e),e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new Ic;switch(n.type){case"firstParty":return new Rc(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new M(O.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let n=hv.get(t);n&&(L("ComponentProvider","Removing Datastore"),hv.delete(t),n.terminate())}(this),Promise.resolve()}};Ya=class r{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new r(this.firestore,e,this._query)}},Ue=class r{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new vs(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new r(this.firestore,e,this._key)}},vs=class r extends Ya{constructor(e,t,n){super(e,t,al(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new Ue(this.firestore,null,new U(e))}withConverter(e){return new r(this.firestore,e,this._path)}};pv="AsyncQueue",Xa=class{constructor(e=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new Ba(this,"async_queue_retry"),this.Su=()=>{let n=Tc();n&&L(pv,"Visibility state changed to "+n.visibilityState),this.a_.t_()},this.bu=e;let t=Tc();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Su)}get isShuttingDown(){return this.mu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Du(),this.vu(e)}enterRestrictedMode(e){if(!this.mu){this.mu=!0,this.yu=e||!1;let t=Tc();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Su)}}enqueue(e){if(this.Du(),this.mu)return new Promise(()=>{});let t=new ct;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Vu.push(e),this.Cu()))}async Cu(){if(this.Vu.length!==0){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(e){if(!ei(e))throw e;L(pv,"Operation failed with retryable error: "+e)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}}vu(e){let t=this.bu.then(()=>(this.pu=!0,e().catch(n=>{this.gu=n,this.pu=!1;let i=function(a){let l=a.message||"";return a.stack&&(l=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),l}(n);throw Nt("INTERNAL UNHANDLED ERROR: ",i),n}).then(n=>(this.pu=!1,n))));return this.bu=t,t}enqueueAfterDelay(e,t,n){this.Du(),this.wu.indexOf(e)>-1&&(t=0);let i=Uh.createAndSchedule(this,e,t,n,s=>this.Fu(s));return this.fu.push(i),i}Du(){this.gu&&j()}verifyOperationInProgress(){}async Mu(){let e;do e=this.bu,await e;while(e!==this.bu)}xu(e){for(let t of this.fu)if(t.timerId===e)return!0;return!1}Ou(e){return this.Mu().then(()=>{this.fu.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(let t of this.fu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Mu()})}Nu(e){this.wu.push(e)}Fu(e){let t=this.fu.indexOf(e);this.fu.splice(t,1)}};fr=class extends ws{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new Xa,this._persistenceKey=(i==null?void 0:i.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new Xa(e),this._firestoreClient=void 0,await e}}};bs=class r{constructor(e){this._byteString=e}static fromBase64String(e){try{return new r(De.fromBase64String(e))}catch(t){throw new M(O.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new r(De.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};Yn=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new M(O.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new He(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};Ts=class{constructor(e){this._methodName=e}};Es=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new M(O.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new M(O.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return J(this._lat,e._lat)||J(this._long,e._long)}};Is=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,i){if(n.length!==i.length)return!1;for(let s=0;s<n.length;++s)if(n[s]!==i[s])return!1;return!0}(this._values,e._values)}};a1=/^__.*__$/,Xh=class{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new yt(e,this.data,this.fieldMask,t,this.fieldTransforms):new Lr(e,this.data,t,this.fieldTransforms)}},Za=class{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new yt(e,this.data,this.fieldMask,t,this.fieldTransforms)}};Zh=class r{constructor(e,t,n,i,s,a){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,s===void 0&&this.Bu(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(e){return new r(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(e){var t;let n=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.ku({path:n,Qu:!1});return i.$u(e),i}Ku(e){var t;let n=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.ku({path:n,Qu:!1});return i.Bu(),i}Uu(e){return this.ku({path:void 0,Qu:!0})}Wu(e){return tl(e,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Bu(){if(this.path)for(let e=0;e<this.path.length;e++)this.$u(this.path.get(e))}$u(e){if(e.length===0)throw this.Wu("Document fields must not be empty");if(kb(this.Lu)&&a1.test(e))throw this.Wu('Document fields cannot begin and end with "__"')}},ed=class{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||cl(e)}ju(e,t,n,i=!1){return new Zh({Lu:e,methodName:t,zu:n,path:He.emptyPath(),Qu:!1,Gu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};el=class r extends Ts{_toFieldTransform(e){if(e.Lu!==2)throw e.Lu===1?e.Wu(`${this._methodName}() can only appear at the top level of your update data`):e.Wu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof r}};h1=new RegExp("[~\\*/\\[\\]]");rl=class{constructor(e,t,n,i,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Ue(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new rd(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(Lb("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},rd=class extends rl{data(){return super.data()}};nd=class{convertValue(e,t="none"){switch(cr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ue(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Lt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw j()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return pr(e,(i,s)=>{n[i]=this.convertValue(s,t)}),n}convertVectorValue(e){var t,n,i;let s=(i=(n=(t=e.fields)===null||t===void 0?void 0:t[jn].arrayValue)===null||n===void 0?void 0:n.values)===null||i===void 0?void 0:i.map(a=>ue(a.doubleValue));return new Is(s)}convertGeoPoint(e){return new Es(ue(e.latitude),ue(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=ol(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(ds(e));default:return null}}convertTimestamp(e){let t=Vt(e);return new Ee(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=ge.fromString(e);re(ub(n));let i=new Ra(n.get(1),n.get(3)),s=new U(n.popFirst(5));return i.isEqual(t)||Nt(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};kr=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},nl=class extends rl{constructor(e,t,n,i,s,a){super(e,t,n,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new Vn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(Lb("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}},Vn=class extends nl{data(e={}){return super.data(e)}},id=class{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new kr(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new Vn(this._firestore,this._userDataWriter,n.key,n,new kr(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new M(O.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(l=>{let u=new Vn(i._firestore,i._userDataWriter,l.doc.key,l.doc,new kr(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter);return l.doc,{type:"added",doc:u,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(l=>s||l.type!==3).map(l=>{let u=new Vn(i._firestore,i._userDataWriter,l.doc.key,l.doc,new kr(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter),h=-1,f=-1;return l.type!==0&&(h=a.indexOf(l.doc.key),a=a.delete(l.doc.key)),l.type!==1&&(a=a.add(l.doc),f=a.indexOf(l.doc.key)),{type:p1(l.type),doc:u,oldIndex:h,newIndex:f}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};il=class extends nd{constructor(e){super(),this.firestore=e}convertBytes(e){return new bs(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ue(this.firestore,null,t)}};(function(e,t=!0){(function(i){Xn=i})(bw),rs(new Ct("firestore",(n,{instanceIdentifier:i,options:s})=>{let a=n.getProvider("app").getImmediate(),l=new fr(new xc(n.getProvider("auth-internal")),new Pc(a,n.getProvider("app-check-internal")),function(h,f){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new M(O.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ra(h.options.projectId,f)}(a,i),a);return s=Object.assign({useFetchStreams:t},s),l._setSettings(s),l},"PUBLIC").setMultipleInstances(!0)),lr(Pw,Cw,e),lr(Pw,Cw,"esm2017")})()});var Pd=_(()=>{$b()});var jr={};Ir(jr,{Headers:()=>kd,Request:()=>y1,Response:()=>_1,default:()=>Cd,fetch:()=>g1});var m1,ri,g1,Cd,kd,y1,_1,mr=_(()=>{"use strict";m1=function(){if(typeof self!="undefined")return self;if(typeof window!="undefined")return window;if(typeof global!="undefined")return global;throw new Error("unable to locate global object")},ri=m1(),g1=ri.fetch,Cd=ri.fetch.bind(ri),kd=ri.Headers,y1=ri.Request,_1=ri.Response});var Nd=ot(Od=>{"use strict";Object.defineProperty(Od,"__esModule",{value:!0});var Dd=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};Od.default=Dd});var Ld=ot(Ps=>{"use strict";var zb=Ps&&Ps.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Ps,"__esModule",{value:!0});var v1=zb((mr(),C0(jr))),b1=zb(Nd()),Vd=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch=="undefined"?this.fetch=v1.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");let n=this.fetch,i=n(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async s=>{var a,l,u;let h=null,f=null,m=null,g=s.status,I=s.statusText;if(s.ok){if(this.method!=="HEAD"){let V=await s.text();V===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?f=V:f=JSON.parse(V))}let k=(a=this.headers.Prefer)===null||a===void 0?void 0:a.match(/count=(exact|planned|estimated)/),P=(l=s.headers.get("content-range"))===null||l===void 0?void 0:l.split("/");k&&P&&P.length>1&&(m=parseInt(P[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(f)&&(f.length>1?(h={code:"PGRST116",details:`Results contain ${f.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},f=null,m=null,g=406,I="Not Acceptable"):f.length===1?f=f[0]:f=null)}else{let k=await s.text();try{h=JSON.parse(k),Array.isArray(h)&&s.status===404&&(f=[],h=null,g=200,I="OK")}catch{s.status===404&&k===""?(g=204,I="No Content"):h={message:k}}if(h&&this.isMaybeSingle&&(!((u=h==null?void 0:h.details)===null||u===void 0)&&u.includes("0 rows"))&&(h=null,g=200,I="OK"),h&&this.shouldThrowOnError)throw new b1.default(h)}return{error:h,data:f,count:m,status:g,statusText:I}});return this.shouldThrowOnError||(i=i.catch(s=>{var a,l,u;return{error:{message:`${(a=s==null?void 0:s.name)!==null&&a!==void 0?a:"FetchError"}: ${s==null?void 0:s.message}`,details:`${(l=s==null?void 0:s.stack)!==null&&l!==void 0?l:""}`,hint:"",code:`${(u=s==null?void 0:s.code)!==null&&u!==void 0?u:""}`},data:null,count:null,status:0,statusText:""}})),i.then(e,t)}};Ps.default=Vd});var Fd=ot(Cs=>{"use strict";var T1=Cs&&Cs.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Cs,"__esModule",{value:!0});var E1=T1(Ld()),Md=class extends E1.default{select(e){let t=!1,n=(e!=null?e:"*").split("").map(i=>/\s/.test(i)&&!t?"":(i==='"'&&(t=!t),i)).join("");return this.url.searchParams.set("select",n),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:n,foreignTable:i,referencedTable:s=i}={}){let a=s?`${s}.order`:"order",l=this.url.searchParams.get(a);return this.url.searchParams.set(a,`${l?`${l},`:""}${e}.${t?"asc":"desc"}${n===void 0?"":n?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:n=t}={}){let i=typeof n=="undefined"?"limit":`${n}.limit`;return this.url.searchParams.set(i,`${e}`),this}range(e,t,{foreignTable:n,referencedTable:i=n}={}){let s=typeof i=="undefined"?"offset":`${i}.offset`,a=typeof i=="undefined"?"limit":`${i}.limit`;return this.url.searchParams.set(s,`${e}`),this.url.searchParams.set(a,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:n=!1,buffers:i=!1,wal:s=!1,format:a="text"}={}){var l;let u=[e?"analyze":null,t?"verbose":null,n?"settings":null,i?"buffers":null,s?"wal":null].filter(Boolean).join("|"),h=(l=this.headers.Accept)!==null&&l!==void 0?l:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${a}; for="${h}"; options=${u};`,a==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};Cs.default=Md});var wl=ot(ks=>{"use strict";var I1=ks&&ks.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(ks,"__esModule",{value:!0});var A1=I1(Fd()),jd=class extends A1.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){let n=Array.from(new Set(t)).map(i=>typeof i=="string"&&new RegExp("[,()]").test(i)?`"${i}"`:`${i}`).join(",");return this.url.searchParams.append(e,`in.(${n})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:n,type:i}={}){let s="";i==="plain"?s="pl":i==="phrase"?s="ph":i==="websearch"&&(s="w");let a=n===void 0?"":`(${n})`;return this.url.searchParams.append(e,`${s}fts${a}.${t}`),this}match(e){return Object.entries(e).forEach(([t,n])=>{this.url.searchParams.append(t,`eq.${n}`)}),this}not(e,t,n){return this.url.searchParams.append(e,`not.${t}.${n}`),this}or(e,{foreignTable:t,referencedTable:n=t}={}){let i=n?`${n}.or`:"or";return this.url.searchParams.append(i,`(${e})`),this}filter(e,t,n){return this.url.searchParams.append(e,`${t}.${n}`),this}};ks.default=jd});var Bd=ot(Os=>{"use strict";var x1=Os&&Os.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Os,"__esModule",{value:!0});var Ds=x1(wl()),Ud=class{constructor(e,{headers:t={},schema:n,fetch:i}){this.url=e,this.headers=t,this.schema=n,this.fetch=i}select(e,{head:t=!1,count:n}={}){let i=t?"HEAD":"GET",s=!1,a=(e!=null?e:"*").split("").map(l=>/\s/.test(l)&&!s?"":(l==='"'&&(s=!s),l)).join("");return this.url.searchParams.set("select",a),n&&(this.headers.Prefer=`count=${n}`),new Ds.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:n=!0}={}){let i="POST",s=[];if(this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),n||s.push("missing=default"),this.headers.Prefer=s.join(","),Array.isArray(e)){let a=e.reduce((l,u)=>l.concat(Object.keys(u)),[]);if(a.length>0){let l=[...new Set(a)].map(u=>`"${u}"`);this.url.searchParams.set("columns",l.join(","))}}return new Ds.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:n=!1,count:i,defaultToNull:s=!0}={}){let a="POST",l=[`resolution=${n?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&l.push(this.headers.Prefer),i&&l.push(`count=${i}`),s||l.push("missing=default"),this.headers.Prefer=l.join(","),Array.isArray(e)){let u=e.reduce((h,f)=>h.concat(Object.keys(f)),[]);if(u.length>0){let h=[...new Set(u)].map(f=>`"${f}"`);this.url.searchParams.set("columns",h.join(","))}}return new Ds.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){let n="PATCH",i=[];return this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),this.headers.Prefer=i.join(","),new Ds.default({method:n,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){let t="DELETE",n=[];return e&&n.push(`count=${e}`),this.headers.Prefer&&n.unshift(this.headers.Prefer),this.headers.Prefer=n.join(","),new Ds.default({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};Os.default=Ud});var Gb=ot(vl=>{"use strict";Object.defineProperty(vl,"__esModule",{value:!0});vl.version=void 0;vl.version="0.0.0-automated"});var Kb=ot(bl=>{"use strict";Object.defineProperty(bl,"__esModule",{value:!0});bl.DEFAULT_HEADERS=void 0;var S1=Gb();bl.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${S1.version}`}});var Wb=ot(Ns=>{"use strict";var Hb=Ns&&Ns.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Ns,"__esModule",{value:!0});var R1=Hb(Bd()),P1=Hb(wl()),C1=Kb(),$d=class r{constructor(e,{headers:t={},schema:n,fetch:i}={}){this.url=e,this.headers=Object.assign(Object.assign({},C1.DEFAULT_HEADERS),t),this.schemaName=n,this.fetch=i}from(e){let t=new URL(`${this.url}/${e}`);return new R1.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new r(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:n=!1,get:i=!1,count:s}={}){let a,l=new URL(`${this.url}/rpc/${e}`),u;n||i?(a=n?"HEAD":"GET",Object.entries(t).filter(([f,m])=>m!==void 0).map(([f,m])=>[f,Array.isArray(m)?`{${m.join(",")}}`:`${m}`]).forEach(([f,m])=>{l.searchParams.append(f,m)})):(a="POST",u=t);let h=Object.assign({},this.headers);return s&&(h.Prefer=`count=${s}`),new P1.default({method:a,url:l,headers:h,schema:this.schemaName,body:u,fetch:this.fetch,allowEmpty:!1})}};Ns.default=$d});var tT=ot(Ie=>{"use strict";var ni=Ie&&Ie.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Ie,"__esModule",{value:!0});Ie.PostgrestError=Ie.PostgrestBuilder=Ie.PostgrestTransformBuilder=Ie.PostgrestFilterBuilder=Ie.PostgrestQueryBuilder=Ie.PostgrestClient=void 0;var Qb=ni(Wb());Ie.PostgrestClient=Qb.default;var Jb=ni(Bd());Ie.PostgrestQueryBuilder=Jb.default;var Yb=ni(wl());Ie.PostgrestFilterBuilder=Yb.default;var Xb=ni(Fd());Ie.PostgrestTransformBuilder=Xb.default;var Zb=ni(Ld());Ie.PostgrestBuilder=Zb.default;var eT=ni(Nd());Ie.PostgrestError=eT.default;Ie.default={PostgrestClient:Qb.default,PostgrestQueryBuilder:Jb.default,PostgrestFilterBuilder:Yb.default,PostgrestTransformBuilder:Xb.default,PostgrestBuilder:Zb.default,PostgrestError:eT.default}});var cT=ot((rq,uT)=>{"use strict";uT.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}});function fO(r,e){return Object.fromEntries(Object.entries(r).sort(e||void 0).map(([t,n])=>[t,n]))}function Vl(r,e){return Array.isArray(r)?r.map(t=>Vl(t,e)):typeof r=="object"?Object.fromEntries(Object.entries(fO(r,e)).map(([t,n])=>[t,Vl(n,e)])):r}var HT=_(()=>{});var WT,QT=_(()=>{WT={id:"~date",test:r=>r instanceof Date,serialize:r=>({_:"~date",v:r.toISOString()}),deserialize:r=>new Date(r.v)}});var JT,YT=_(()=>{JT={id:"~function",test:r=>typeof r=="function",serialize:r=>({_:"~function",v:r.toString()}),deserialize:v=>eval(v.v.toString())}});var XT,ZT=_(()=>{XT={id:"~infinity",test:r=>r===1/0||r===-1/0,serialize:r=>({_:"~infinity",v:r===1/0?1:0}),deserialize:r=>r.v==1?1/0:-1/0}});var eE,tE=_(()=>{eE={id:"~nan",test:r=>Number.isNaN(r),serialize:r=>({_:"~nan"}),deserialize:r=>NaN}});var rE,nE=_(()=>{rE={id:"~regexp",test:r=>r instanceof RegExp,serialize:r=>({_:"~regexp",v:r.source,f:r.flags}),deserialize:r=>new RegExp(r.v,r.f)}});var iE,sE=_(()=>{iE={id:"~set",test:r=>r instanceof Set,serialize:r=>({_:"~set",v:Array.from(r)}),deserialize:r=>new Set(r.v)}});var oE,aE=_(()=>{oE={id:"~undefined",test:r=>r===void 0,serialize:r=>({_:"~undefined"}),deserialize:r=>{}}});var fi,Ys,lE=_(()=>{aa();HT();QT();YT();ZT();tE();nE();sE();aE();fi={settings:{stringify:!0,destringify:!0,clone:!1,depth:0,modules:[WT,JT,XT,eE,rE,iE,oE],circular:!0,symetric:!1},loadedModules:{},loadModules(r){return r.map(e=>{if(ee(e)){if(!e.id)throw new Error("Provided custom module does not expose an `id` property");return fi.loadedModules[e.id]=e}else throw new Error("Unknown module type")})},serialize(r,e){let t=oa(e,fi.settings),n=fi.loadModules(t.modules),i=t.symetric?Vl(r):t.clone?sr(r):r,s=new Map,a=(l,u)=>{let h=ee(l);if(h&&t.circular){let g=s.get(l);if(g)return or(i,u,{_:"~circular",p:g.join(".")});s.set(l,u)}let f=n.find(g=>g.test(l)),m=(!t.depth||u.length<t.depth)&&h;if(f){let g=f.serialize(l);if(f.recursive&&m){let I=Ce(l);t.symetric&&I.sort(),or(i,u,g),I.forEach(C=>a(l[C],u.concat(C)))}else u.length?or(i,u,g):i=g}else if(m){let g=Ce(l);t.symetric&&g.sort(),g.forEach(I=>a(l[I],u.concat(I)))}};return a(i,[]),t.stringify?JSON.stringify(i):i},deserialize(r,e){let t=oa(e,fi.settings),n=fi.loadModules(t.modules),i=zu(n,"id"),s=t.destringify?JSON.parse(r):t.clone?sr(r):r,a=(l,u)=>{if(ee(l)&&l._&&typeof l._=="string"&&l._.startsWith("~")&&i[l._]){let h=i[l._].deserialize(l);u.length?i[l._].recursive&&ee(h)?(or(s,u,h),Ce(h).forEach(f=>a(l[f],[...u,f]))):or(s,u,h):s=h}else t.circular&&ee(l)&&l._&&l._=="~circular"?or(s,u,Ji(s,l.p)):(!t.depth||u.length<t.depth)&&ee(l)&&Ce(l).forEach(h=>a(l[h],u.concat(h)))};return a(s,[]),s}},Ys=fi});var uE,cE=_(()=>{uE="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"});var hE,dE=_(()=>{cE();hE=(r=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(r|=0));for(;r--;)e+=uE[t[r]&63];return e}});var pi,Ll=_(()=>{pi={csv:{id:"csv",title:"Comma Seperated Values",titleShort:"CSV",ext:[".csv"],canRead:!1,canWrite:!1},endnoteXml:{id:"endnoteXml",title:"EndNoteXML",titleShort:"EndNoteXML",ext:[".xml"],canRead:!0,canWrite:!0},json:{id:"json",title:"JSON",titleShort:"JSON",ext:[".json"],canRead:!0,canWrite:!0},medline:{id:"medline",title:"MEDLINE / PubMed",titleShort:"MEDLINE",ext:[".nbib"],canRead:!0,canWrite:!0},ris:{id:"ris",title:"RIS",titleShort:"RIS",ext:[".ris",".txt",".cgi"],canRead:!0,canWrite:!0},tsv:{id:"tsv",title:"Tab Seperated Values",titleShort:"TSV",ext:[".tsv"],canRead:!1,canWrite:!1}}});function mi(r){var t;let e=(t=/^.*(?<ext>\..+?)$/.exec(r))==null?void 0:t.groups.ext.toLowerCase();return e?Object.values(pi).find(n=>n.ext.includes(e)):null}var Ml=_(()=>{Ll()});function fE(r){return{all:r=r||new Map,on:function(e,t){var n=r.get(e);n?n.push(t):r.set(e,[t])},off:function(e,t){var n=r.get(e);n&&(t?n.splice(n.indexOf(t)>>>0,1):r.set(e,[]))},emit:function(e,t){var n=r.get(e);n&&n.slice().map(function(i){i(t)}),(n=r.get("*"))&&n.slice().map(function(i){i(e,t)})}}}var pE=_(()=>{});function Me(){let r=fE();return r.mitt={},["on","off","emit"].forEach(e=>{r.mitt[e]=r[e],r[e]=(...t)=>(r.mitt[e](...t),r)}),r}var _r=_(()=>{pE()});var Xs,mE=_(()=>{_r();Xs=class r{constructor(){this.text="",this.emitter=Me(),this.recNumber=1}write(e){this.text+=e}end(){try{let e=JSON.parse(this.text);this.text="",Array.isArray(e)&&e.forEach(t=>{this.emitter.emit("data",t)}),this.emitter.emit("end")}catch(e){console.error("Error parsing final JSON:",e),this.emitter.emit("error",e)}}on(e,t){this.emitter.on(e,t)}static parse(){return new r}}});var Fl={};Ir(Fl,{readStream:()=>pO,writeStream:()=>mO});function pO(r){let e=1,t=Me();return setTimeout(()=>{if(r.on("data",()=>t.emit("progress",r.bytesRead)),typeof r.pipe=="function"){let n=Xs.parse("*");n.on("data",i=>t.emit("ref",{recNumber:e++,...i})),n.on("end",()=>t.emit("end")),n.on("error",t.emit.bind("error")),r.pipe(n)}else console.error('Error with stream, check "streamEmitter.js" if on browser')}),t}function mO(r,e){let t={lineSuffix:`
`,...e},n;return{start:()=>(r.write(`[
`),Promise.resolve()),write:i=>(n&&r.write(n+","+t.lineSuffix),n=JSON.stringify(i),Promise.resolve()),end:()=>(n&&r.write(n+t.lineSuffix),r.write("]"),new Promise((i,s)=>r.end(a=>a?s(a):i())))}}var gE=_(()=>{_r();mE()});function yE(r){return r.split(/[\s-]/).map((e,t)=>t==0?e.toLowerCase():e.substr(0,1).toUpperCase()+e.substr(1).toLowerCase()).join("")}var _E=_(()=>{});var Zs,eo,wE=_(()=>{Zs=(...r)=>{},eo=class{constructor(e){ae(this,"settings",{collect:!0,keyText:"text",keyAttrs:"attrs",keyChildren:"children",ignoreOrphanedPrefixes:!0,flattenText:!0,flattenChildren:!0,flattenChildrenSquish:!0,flattenAttrs:!0,reNextSegment:/(?<text>.*?)<(?<isClose>\/?)(?<tag>[a-z0-9-\.\_]+?)(?:\s+(?<attrs>.*?))?>/ig,reAttrSegment:/(?<key>[a-zA-Z_:][-a-zA-Z0-9_:.]*)(?:\s*=\s*(?<escape>["'])(?<val>.*?)\k<escape>)?/ig,onRoot:e=>Zs("> ROOT",e.tag),onAttr:(e,t,n)=>({[e]:isFinite(t)?+t:t==="true"||t===void 0?!0:t==="false"?!1:t}),onTagOpen:e=>Zs("> TAG OPEN",e.tag),onTagClose:e=>Zs("> TAG CLOSE",e.tag),onTagCloseMismatch:(e,t)=>Zs("TAG CLOSE",e,"(but expected",t,")")});ae(this,"buffer","");ae(this,"collected");ae(this,"stack",[]);e&&Object.assign(this.settings,e)}append(e){if(!e)throw new Error("No input to append");return this.buffer+=e.toString(),this}exec(){let e,t;for(;e=this.settings.reNextSegment.exec(this.buffer);){if(t=e.index+e[0].length,e.groups.text&&!(this.stack.length==0&&this.settings.ignoreOrphanedPrefixes)){if(this.stack.length==0)throw new Error("Attempt to set value on empty stack!");this.stack.at(-1)[this.settings.keyText]=(this.stack.at(-1)[this.settings.keyText]||"")+e.groups.text}let n=e.groups.attrs?this.parseAttrString(e.groups.attrs):null;if(e.groups.isClose==""){let i={tag:e.groups.tag,...n!==null&&{[this.settings.keyAttrs]:n}};this.stack.length==0?(this.settings.onRoot(i),this.settings.collect&&(this.collected=i)):this.stack.at(-1)[this.settings.keyChildren]?this.stack.at(-1)[this.settings.keyChildren].push(i):this.stack.at(-1)[this.settings.keyChildren]=[i],this.settings.onTagOpen(i),this.stack.push(i)}else if(e.groups.isClose=="/"){if(this.stack.length==0)throw new Error("Smashed stack!");this.settings.onTagClose(this.stack.at(-1)),this.stack.pop()}else Zs("OUT OF BAND",{match:e})}return t>0&&(this.buffer=this.buffer.slice(t)),this}parseAttrString(e){let t,n={};for(;t=this.settings.reAttrSegment.exec(e);)n={...n,...this.settings.onAttr(t.groups.key,t.groups.val,t.groups)};return n}flatten(e){let t=n=>{if(Array.isArray(n))return n.map(i=>t(i));if(typeof n=="object"&&n.tag){if(this.settings.flattenText&&n[this.settings.keyText]&&!n[this.settings.keyChildren]&&!n[this.settings.keyAttrs])return{[n.tag]:n[this.settings.keyText]};if(this.settings.flattenChildren&&n[this.settings.keyChildren]&&!n[this.settings.keyText]&&!n[this.settings.keyAttrs]){let i=t(n[this.settings.keyChildren]);return this.settings.flattenChildrenSquish&&i.length==1&&(i=i[0]),{[n.tag]:i}}else return this.settings.flattenAttrs&&n[this.settings.keyAttrs]&&!n[this.settings.keyChildren]&&!n[this.settings.keyText]?{[n.tag]:n[this.settings.keyAttrs]}:{[n.tag]:{...n[this.settings.keyText]&&{[this.settings.keyText]:n[this.settings.keyText]},...n[this.settings.keyAttrs]&&{[this.settings.keyAttrs]:n[this.settings.keyAttrs]},...n[this.settings.keyChildren]&&{[this.settings.keyChildren]:n[this.settings.keyChildren]}}}}};return e?t(e):(this.collected=t(this.collected),this)}value(){if(!this.settings.collect)throw new Error("Collect mode disabled, enable this if you want the final parsed output object");return this.settings.flatten&&this.flatten(),this.collected}}});var jl,vE=_(()=>{_r();wE();jl=class{constructor(e){this.emitter=Me(),this.parser=new eo({collect:!1,reAttrSegment:/(?<key>[a-zA-Z_:][-a-zA-Z0-9_:.]*)(?:\s*=\s*(?<escape>["'])(?<val>.*?)\k<escape>)?/ig,onTagOpen:t=>{let n=t.tag,i=t.attrs||{};this.emitter.emit("opentag",n,i)},onTagClose:t=>{let n=t.tag;t.text&&t.text.trim()&&this.emitter.emit("text",t.text.trim()),this.emitter.emit("closetag",n)},flattenText:!1,keyText:"text",keyAttrs:"attrs"}),this.emitter.on("opentag",e.onopentag),this.emitter.on("closetag",e.onclosetag),this.emitter.on("text",e.ontext),this.emitter.on("end",e.onend)}write(e){this.parser.append(e).exec()}end(){this.parser.exec();let e=this.parser.stack.at(-1);e&&e.text&&e.text.trim()&&this.emitter.emit("text",e.text.trim()),this.emitter.emit("end")}}});var Ul={};Ir(Ul,{readStream:()=>gO,setup:()=>_O,translateRawToRef:()=>bE,translations:()=>wr,writeStream:()=>yO,xmlEscape:()=>Fe,xmlUnescape:()=>Bt});function gO(r){let e=Me(),t={},n=[],i=!1,s={xmlMode:!0,decodeEntities:!1,onopentag(a,l){i=!1,n.push({name:yE(a),attrs:l})},onclosetag(a){a=="record"?(t.title&&(t.title=t.title.replace(/^.*<style.*>(.*)<\/style>.*$/m,"$1").replace(/^\s+/,"").replace(/\s+$/,"")),e.emit("ref",bE(t)),n=[],t={}):n.pop()},ontext(a){var h,f;let l=(h=n[n.length-1])==null?void 0:h.name,u=(f=n[n.length-2])==null?void 0:f.name;l=="title"?i?t.title+=a:t.title=a:l=="style"&&u=="author"?(t.authors||(t.authors=[]),i?t.authors[t.authors.length-1]+=Bt(a):t.authors.push(Bt(a))):l=="style"&&u=="keyword"?(t.keywords||(t.keywords=[]),i?t.keywords[t.keywords.length-1]+=Bt(a):t.keywords.push(Bt(a))):l=="style"?i||t[u]?t[u]+=Bt(a):t[u]=Bt(a):["recNumber","refType"].includes(l)&&(i||t[l]?t[l]+=Bt(a):t[l]=Bt(a)),i=!0},onend(){e.emit("end")}};return setTimeout(()=>{if(typeof r.pipe=="function"){let a=new jl(s);r.on("data",()=>e.emit("progress",r.bytesRead)),r.pipe(a);return}else console.error('Error with stream, check "streamEmitter.js" if on browser')}),e}function yO(r,e){let t={defaultType:"journalArticle",filePath:"c:\\",fileName:"EndNote.enl",formatDate:s=>s instanceof Date?s.toISOString().substr(0,10):s,...e},n=Fe(t.fileName),i=0;return{start:()=>(r.write('<?xml version="1.0" encoding="UTF-8" ?><xml><records>'),Promise.resolve()),write:s=>{let a=wr.types.rlMap.get(s.type||t.defaultType);a||(console.warn(`Invalid reference type: "${s.type}", defaulting to journal article`),a=wr.types.rlMap.get("journalArticle")),i++;let l=s.recNumber||i;return r.write(`<record><database name="${t.fileName}" path="${t.filePath}${t.fileName}">${n}</database><source-app name="EndNote" version="16.0">EndNote</source-app><rec-number>${l}</rec-number><foreign-keys><key app="EN" db-id="s55prpsswfsepue0xz25pxai2p909xtzszzv">${l}</key></foreign-keys><ref-type name="${a.rawText}">${a.rawId}</ref-type><contributors><authors>`+(s.authors||[]).map(u=>`<author><style face="normal" font="default" size="100%">${Fe(u)}</style></author>`)+"</authors></contributors><titles>"+(s.title?`<title><style face="normal" font="default" size="100%">${Fe(s.title)}</style></title>`:"")+(s.journal?`<secondary-title><style face="normal" font="default" size="100%">${Fe(s.journal)}</style></secondary-title>`:"")+(s.titleShort?`<short-title><style face="normal" font="default" size="100%">${Fe(s.titleShort)}</style></short-title>`:"")+(s.journalAlt?`<alt-title><style face="normal" font="default" size="100%">${Fe(s.journalAlt)}</style></alt-title>`:"")+"</titles>"+(s.periodical?`<periodical><full-title><style face="normal" font="default" size="100%">${Fe(s.periodical)}</style></full-title></periodical>`:"")+[["abstract","abstract"],["accessDate","access-date"],["accession","accession-num"],["address","auth-address"],["caption","caption"],["databaseProvider","remote-database-provider"],["database","remote-database-name"],["doi","electronic-resource-num"],["isbn","isbn"],["accessionNum","accession-num"],["label","label"],["language","language"],["notes","notes"],["number","number"],["pages","pages"],["researchNotes","research-notes"],["section","section"],["volume","volume"],["workType","work-type"],["custom1","custom1"],["custom2","custom2"],["custom3","custom3"],["custom4","custom4"],["custom5","custom5"],["custom6","custom6"],["custom7","custom7"]].filter(([u])=>s[u]).map(([u,h])=>`<${h}><style face="normal" font="default" size="100%">${Fe(s[u])}</style></${h}>`).join("")+(s.date&&s.year&&s.date instanceof Date?`<dates><year><style face="normal" font="default" size="100%">${Fe(s.year)}</style></year><pub-dates><date><style face="normal" font="default" size="100%">${t.formatDate(s.date)}</style></date></pub-dates></dates>`:s.date&&s.year?`<dates><year><style face="normal" font="default" size="100%">${Fe(s.year)}</style></year><pub-dates><date><style face="normal" font="default" size="100%">${s.date}</style></date></pub-dates></dates>`:s.date?`<dates><pub-dates><date><style face="normal" font="default" size="100%">${Fe(s.date)}</style></date></pub-dates></dates>`:s.year?`<dates><year><style face="normal" font="default" size="100%">${Fe(s.year)}</style></year></dates>`:"")+(s.urls?"<urls><related-urls>"+(s.urls||[]).map(u=>`<url><style face="normal" font="default" size="100%">${Fe(u)}</style></url>`).join("")+"</related-urls></urls>":"")+(s.keywords?"<keywords>"+(s.keywords||[]).map(u=>`<keyword><style face="normal" font="default" size="100%">${Fe(u)}</style></keyword>`).join("")+"</keywords>":"")+"</record>"),Promise.resolve()},end:()=>(r.write("</records></xml>"),new Promise((s,a)=>r.end(l=>l?a(l):s())))}}function bE(r){var t;return{...Object.fromEntries(wr.fields.collection.filter(n=>r[n.raw]).map(n=>[n.rl,r[n.raw]])),type:(t=wr.types.rawMap.get(+r.refType||17))==null?void 0:t.rl}}function Fe(r){return(""+r).replace(/&/g,"&amp;").replace(/\r/g,"&#xD;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function Bt(r){return(""+r).replace(/&amp;/g,"&").replace(/&#xD;/g,"\r").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'")}function _O(){wr.types.collection.forEach(r=>{wr.types.rlMap.set(r.rl,r),wr.types.rawMap.set(r.rawId,r)})}var wr,TE=_(()=>{_E();_r();vE();wr={fields:{collection:[{rl:"recNumber",raw:"recNumber"},{rl:"title",raw:"title"},{rl:"journal",raw:"secondaryTitle"},{rl:"address",raw:"authAddress"},{rl:"researchNotes",raw:"researchNotes"},{rl:"type",raw:"FIXME"},{rl:"authors",raw:"authors"},{rl:"pages",raw:"pages"},{rl:"volume",raw:"volume"},{rl:"number",raw:"number"},{rl:"isbn",raw:"isbn"},{rl:"accessionNum",raw:"accessionNum"},{rl:"abstract",raw:"abstract"},{rl:"label",raw:"label"},{rl:"caption",raw:"caption"},{rl:"notes",raw:"notes"},{rl:"custom1",raw:"custom1"},{rl:"custom2",raw:"custom2"},{rl:"custom3",raw:"custom3"},{rl:"custom4",raw:"custom4"},{rl:"custom5",raw:"custom5"},{rl:"custom6",raw:"custom6"},{rl:"custom7",raw:"custom7"},{rl:"doi",raw:"electronicResourceNum"},{rl:"year",raw:"year"},{rl:"date",raw:"date"},{rl:"keywords",raw:"keywords"},{rl:"urls",raw:"urls"}]},types:{collection:[{rl:"aggregatedDatabase",rawText:"Aggregated Database",rawId:55},{rl:"ancientText",rawText:"Ancient Text",rawId:51},{rl:"artwork",rawText:"Artwork",rawId:2},{rl:"audioVisualMaterial",rawText:"Audiovisual Material",rawId:3},{rl:"bill",rawText:"Bill",rawId:4},{rl:"blog",rawText:"Blog",rawId:56},{rl:"book",rawText:"Book",rawId:6},{rl:"bookSection",rawText:"Book Section",rawId:5},{rl:"case",rawText:"Case",rawId:7},{rl:"catalog",rawText:"Catalog",rawId:8},{rl:"chartOrTable",rawText:"Chart or Table",rawId:38},{rl:"classicalWork",rawText:"Classical Work",rawId:49},{rl:"computerProgram",rawText:"Computer Program",rawId:9},{rl:"conferencePaper",rawText:"Conference Paper",rawId:47},{rl:"conferenceProceedings",rawText:"Conference Proceedings",rawId:10},{rl:"dataset",rawText:"Dataset",rawId:59},{rl:"dictionary",rawText:"Dictionary",rawId:52},{rl:"editedBook",rawText:"Edited Book",rawId:28},{rl:"electronicArticle",rawText:"Electronic Article",rawId:43},{rl:"electronicBook",rawText:"Electronic Book",rawId:44},{rl:"electronicBookSection",rawText:"Electronic Book Section",rawId:60},{rl:"encyclopedia",rawText:"Encyclopedia",rawId:53},{rl:"equation",rawText:"Equation",rawId:39},{rl:"figure",rawText:"Figure",rawId:37},{rl:"filmOrBroadcast",rawText:"Film or Broadcast",rawId:21},{rl:"generic",rawText:"Generic",rawId:13},{rl:"governmentDocument",rawText:"Government Document",rawId:46},{rl:"grant",rawText:"Grant",rawId:54},{rl:"hearing",rawText:"Hearing",rawId:14},{rl:"journalArticle",rawText:"Journal Article",rawId:17},{rl:"legalRuleOrRegulation",rawText:"Legal Rule or Regulation",rawId:50},{rl:"magazineArticle",rawText:"Magazine Article",rawId:19},{rl:"manuscript",rawText:"Manuscript",rawId:36},{rl:"map",rawText:"Map",rawId:20},{rl:"music",rawText:"Music",rawId:61},{rl:"newspaperArticle",rawText:"Newspaper Article",rawId:23},{rl:"onlineDatabase",rawText:"Online Database",rawId:45},{rl:"onlineMultimedia",rawText:"Online Multimedia",rawId:48},{rl:"pamphlet",rawText:"Pamphlet",rawId:24},{rl:"patent",rawText:"Patent",rawId:25},{rl:"personalCommunication",rawText:"Personal Communication",rawId:26},{rl:"report",rawText:"Report",rawId:27},{rl:"serial",rawText:"Serial",rawId:57},{rl:"standard",rawText:"Standard",rawId:58},{rl:"statute",rawText:"Statute",rawId:31},{rl:"thesis",rawText:"Thesis",rawId:32},{rl:"unpublished",rawText:"Unpublished Work",rawId:34},{rl:"web",rawText:"Web Page",rawId:12}],rlMap:new Map,rawMap:new Map}}});var Bl={};Ir(Bl,{parseRef:()=>sf,readStream:()=>wO,setup:()=>bO,translations:()=>qe,writeStream:()=>vO});function wO(r,e){let t={defaultType:"journalArticle",delimeter:"\r",reformatAuthors:!0,journal:"long",parseAddress:!0,parseDoi:!0,parseYear:!0,fieldsReplace:[],...e};t.fieldsReplace.push({from:"type",to:"type",delete:!1,reformat:s=>qe.types.rawMap[s]||t.defaultType}),t.fieldsReplace.push({to:"authors",reformat:(s,a)=>(a.medlineAuthorsShort||a.medlineAuthorsFull||[]).map(l=>l.replace(/^(?<last>[\w-]+?) (?<initials>\w+)$/,(u,h,f)=>h&&f?h+", "+f.split("").map(m=>`${m}.`).join(" "):h||u))}),t.fieldsReplace.push({to:"journal",reformat:t.journal.long?(s,a)=>a.medlineJournalFull||a.medlineJournalShort:(s,a)=>a.medlineJournalShort||a.medlineJournalLong}),t.parseAddress&&t.fieldsReplace.push({from:"medlineAuthorsAffiliation",to:"address",delete:!1,reformat:s=>s?s.join(t.delimeter):!1}),t.parseDoi&&t.fieldsReplace.push({from:"medlineArticleID",to:"doi",delete:!1,reformat:s=>{var a;return((a=/(?<doi>[\w\.\/_]+) \[doi\]/.exec(s))==null?void 0:a.groups.doi)||!1}}),t.parseYear&&t.fieldsReplace.push({from:"date",to:"year",delete:!1,reformat:s=>{var a;return((a=/(?<year>\d{4}\b)/.exec(s))==null?void 0:a.groups.year)||!1}});let n=Me(),i="";return setTimeout(()=>{r.on("data",s=>{n.emit("progress",r.bytesRead),i+=s.toString();let a=0,l=/(\r\n|\n){2,}/g,u;for(;u=l.exec(i);){let h=sf(i.substring(a,u.index),t);n.emit("ref",h),a=u.index+u[0].length}i=i.substring(a)}).on("error",s=>n.emit("error",s)).on("end",()=>{i.replace(/\s+/,"")&&n.emit("ref",sf(i,t)),n.emit("end")})}),n}function vO(r,e){let t={defaultType:"journalArticle",delimeter:"\r",...e};return{start(){return Promise.resolve()},write:n=>{let i={type:t.defaultType,title:"<NO TITLE>",...n};return r.write(qe.fields.collectionOutput.filter(s=>i[s.rl]).flatMap(s=>s.rl=="type"?"TY  - "+(qe.types.rlMap.get(i.type)||qe.types.rlMap.get(t.defaultType)).raw:s.rl=="title"?["TI  - "+i.title,...(i.authors||[]).flatMap((a,l)=>{var u,h,f,m;return[(u=i.medlineAuthorsFull)!=null&&u[l]?`FAU - ${i.medlineAuthorsFull[l]}`:`FAU - ${i.authors[l]}`,((h=i.medlineAuthorsShort)==null?void 0:h[l])&&`AU  - ${i.medlineAuthorsShort[l]}`,((f=i.medlineAuthorsAffiliation)==null?void 0:f[l])&&`AD  - ${i.medlineAuthorsAffiliation[l]}`,((m=i.medlineAuthorsId)==null?void 0:m[l])&&`AUID- ${i.medlineAuthorsId[l]}`].filter(Boolean)})]:s.outputSkip?[]:s.outputRepeat&&Array.isArray(i[s.rl])?i[s.rl].map(a=>s.raw.padEnd(4," ")+"- "+a):Array.isArray(i[s.rl])?s.raw.padEnd(4," ")+"- "+i[s.rl].join(t.delimeter):s.raw.padEnd(4," ")+"- "+i[s.rl]).concat([`
`]).join(`
`)),Promise.resolve()},end(){return new Promise((n,i)=>r.end(s=>s?i(s):n()))}}}function sf(r,e){var i;let t={},n;return r.split(/[\r\n|\n]/).forEach(s=>{var u;let a=(u=/^\s*(?<key>[A-Z]+?)\s*-\s+(?<value>.*)$/s.exec(s))==null?void 0:u.groups;if(!a){s=s.trimStart(),s.replace(/\s+/,"")&&n&&(n.inputArray?t[n.rl].push(s):t[n.rl]+=" "+s);return}let l=qe.fields.rawMap.get(a.key);if(n!=null&&n.trimDotSuffix&&(t[n.rl]=t[n.rl].replace(/\.$/,"")),l)l.inputArray?(t[l.rl]?t[l.rl].push(a.value):t[l.rl]=[a.value],n=l):(t[l.rl]=a.value,n=l);else{n=null;return}}),((i=e.fieldsReplace)==null?void 0:i.length)>0&&e.fieldsReplace.forEach(s=>{var l;let a=s.from?t[s.from]:null;s.reformat&&(a=s.reformat(a,t),a===!1)||(t[s.to]=a,s.from&&((l=s.delete)==null||l)&&delete t[s.from])}),t}function bO(){qe.fields.collectionOutput=qe.fields.collection.filter(r=>r.sort!==!1).sort((r,e)=>{var t,n,i,s;return((t=r.sort)!=null?t:1e3)==((n=e.sort)!=null?n:1e3)?0:((i=r.sort)!=null?i:1e3)<((s=e.sort)!=null?s:1e3)?-1:1}),qe.fields.collection.forEach(r=>{qe.fields.rlMap.set(r.rl,r),qe.fields.rawMap.set(r.raw,r)}),qe.types.collection.forEach(r=>{qe.types.rlMap.set(r.rl,r),qe.types.rawMap.set(r.raw,r)})}var qe,EE=_(()=>{_r();qe={fields:{collection:[{rl:"medlinePMID",raw:"PMID",sort:0},{rl:"medlineOwner",raw:"OWN",sort:1},{rl:"medlineStatus",raw:"STAT",sort:2},{rl:"medlineDateRevised",raw:"DR",sort:3},{rl:"medlineISSN",raw:"IS",outputRepeat:!0,inputArray:!0,sort:4},{rl:"date",raw:"DP",sort:5},{rl:"title",raw:"TI",sort:6,trimDotSuffix:!0},{rl:"doi",raw:"LID",sort:7},{rl:"abstract",raw:"AB",sort:8},{rl:"medlineCopyright",raw:"CI",sort:7},{rl:"medlineAuthorsFull",raw:"FAU",sort:10,outputSkip:!0,inputArray:!0},{rl:"medlineAuthorsShort",raw:"AU",sort:10,outputSkip:!0,inputArray:!0},{rl:"medlineAuthorsAffiliation",raw:"AD",sort:10,outputSkip:!0,inputArray:!0},{rl:"medlineAuthorsId",raw:"AUID",sort:10,outputSkip:!0,inputArray:!0},{rl:"language",raw:"LA",sort:11},{rl:"medlineGrantNumber",raw:"GR",sort:12},{rl:"type",raw:"PT",sort:14},{rl:"medlineTypeSecondary",raw:"PTX"},{rl:"medlineDateElectronicPublication",raw:"DEP",sort:15},{rl:"address",raw:"PL",sort:16},{rl:"medlineJournalShort",raw:"TA",sort:17},{rl:"medlineJournalFull",raw:"JT",sort:18},{rl:"medlineNLMID",raw:"JID",sort:19},{rl:"medlineSubset",raw:"SB",sort:20},{rl:"medlineOwnerOtherTerm",raw:"OTO",sort:21},{rl:"keywords",raw:"OT",outputRepeat:!0,inputArray:!0,sort:22},{rl:"medlineEntrezDate",raw:"EDAT",sort:23},{rl:"medlineDateMesh",raw:"MHDA",sort:24},{rl:"medlinePublicationHistoryStatus",raw:"PHST",outputRepeat:!0,inputArray:!0,sort:25},{rl:"medlineArticleID",raw:"AID",sort:26},{rl:"medlineStatusPublication",raw:"PST",sort:27},{rl:"medlineSource",raw:"SO",sort:27},{rl:"notes",raw:"GN",inputArray:!0,outputRepeat:!0,sort:28},{rl:"isbn",raw:"ISBN"},{rl:"volume",raw:"VI"},{rl:"medlineVolumeTitle",raw:"VTI"},{rl:"pages",raw:"PG"},{rl:"medlineInvestigatorAffiliation",raw:"IRAD"},{rl:"medlineInvestigatorName",raw:"IR"},{rl:"medlineInvestigatorNameFull",raw:"FIR"},{rl:"medlineTitleBook",raw:"BTI"},{rl:"medlineTitleCollection",raw:"CTI"},{rl:"medlineConflictOfInterestStatement",raw:"COIS"},{rl:"medlineCorporateAuthor",raw:"CN"},{rl:"medlineDateCreate",raw:"CRDT"},{rl:"medlineDateCreated",raw:"DA"},{rl:"medlineDateCompleted",raw:"DCOM"},{rl:"medlineEdition",raw:"EN"},{rl:"medlineEditor",raw:"ED"},{rl:"medlineEditorFull",raw:"FED"},{rl:"medlineGeneSymbol",raw:"GS"},{rl:"medlineISSN",raw:"IS"},{rl:"number",raw:"IP"},{rl:"medlineManuscriptID",raw:"MID"},{rl:"medlineMeshTerms",raw:"MH",outputRepeat:!0,inputArray:!0},{rl:"medlineReferenceCount",raw:"RF"},{rl:"medlineAbstractOther",raw:"OAB"},{rl:"medlineCopyrightOther",raw:"OCI"},{rl:"medlineIDOther",raw:"OID"},{rl:"medlinePersonalName",raw:"PS"},{rl:"medlinePersonalNameFull",raw:"FPS"},{rl:"medlinePublishingModel",raw:"PUBM"},{rl:"medlinePubMedCentralID",raw:"PMC"},{rl:"medlinePubMedCentralRelease",raw:"PMCR"},{rl:"medlineRegistryNumber",raw:"RN"},{rl:"medlineSubstanceName",raw:"NM"},{rl:"medlineSecondarySource",raw:"SI"},{rl:"medlineSpaceFlightMission",raw:"SFM"},{rl:"medlineSubset",raw:"SB"},{rl:"medlineTitleTransliterated",raw:"TT",sort:6}],collectionOutput:[],rawMap:new Map,rlMap:new Map},types:{collection:[{raw:"Blog",rl:"blog"},{raw:"Case Reports",rl:"case"},{raw:"Catalog",rl:"catalog"},{raw:"Chart",rl:"chartOrTable"},{raw:"Database",rl:"aggregatedDatabase"},{raw:"Dataset",rl:"dataset"},{raw:"Dictionary",rl:"dictionary"},{raw:"Encyclopedia",rl:"encyclopedia"},{raw:"Journal Article",rl:"journalArticle"},{raw:"Legal Case",rl:"legalRuleOrRegulation"},{raw:"Manuscript",rl:"manuscript"},{raw:"Map",rl:"map"},{raw:"Newspaper Article",rl:"newspaperArticle"},{raw:"Patent",rl:"patent"},{raw:"Preprint",rl:"unpublished"},{raw:"Tables",rl:"chartOrTable"},{raw:"Technical Report",rl:"report"},{raw:"unknown",rl:"unknown"},{raw:"Unpublished Work",rl:"unpublished"},{raw:"Video-Audio Media",rl:"audioVisualMaterial"},{raw:"Web Archive",rl:"web"},{raw:"Address",rl:"personalCommunication"},{raw:"Advertisement",rl:"audioVisualMaterial"},{raw:"Almanac",rl:"book"},{raw:"Anecdotes",rl:"blog"},{raw:"Animation",rl:"filmOrBroadcast"},{raw:"Annual Report",rl:"report"},{raw:"Aphorisms and Proverbs",rl:"pamphlet"},{raw:"Architectural Drawing",rl:"figure"},{raw:"Autobiography",rl:"book"},{raw:"Bibliography",rl:"catalog"},{raw:"Biobibliography",rl:"book"},{raw:"Biography",rl:"book"},{raw:"Book Illustrations",rl:"audioVisualMaterial"},{raw:"Book Review",rl:"magazineArticle"},{raw:"Caricature",rl:"artwork"},{raw:"Cartoon",rl:"audioVisualMaterial"},{raw:"Catalog, Bookseller",rl:"catalog"},{raw:"Catalog, Commercial",rl:"catalog"},{raw:"Catalog, Drug",rl:"catalog"},{raw:"Catalog, Publisher",rl:"catalog"},{raw:"Catalog, Union",rl:"catalog"},{raw:"Chronology",rl:"book"},{raw:"Classical Article",rl:"classicalWork"},{raw:"Clinical Conference",rl:"conferenceProceedings"},{raw:"Clinical Study",rl:"dataset"},{raw:"Clinical Trial, Phase III",rl:"dataset"},{raw:"Clinical Trial, Phase II",rl:"dataset"},{raw:"Clinical Trial, Phase I",rl:"dataset"},{raw:"Clinical Trial, Phase IV",rl:"dataset"},{raw:"Clinical Trial Protocol",rl:"dataset"},{raw:"Clinical Trial",rl:"dataset"},{raw:"Clinical Trial, Veterinary",rl:"dataset"},{raw:"Consensus Development Conference, NIH",rl:"conferenceProceedings"},{raw:"Consensus Development Conference",rl:"conferenceProceedings"},{raw:"Corrected and Republished Article",rl:"journalArticle"},{raw:"Database",rl:"onlineDatabase"},{raw:"Dictionary, Chemical",rl:"dictionary"},{raw:"Dictionary, Classical",rl:"dictionary"},{raw:"Dictionary, Dental",rl:"dictionary"},{raw:"Dictionary, Medical",rl:"dictionary"},{raw:"Dictionary, Pharmaceutic",rl:"dictionary"},{raw:"Dictionary, Polyglot",rl:"dictionary"},{raw:"Documentaries and Factual Films",rl:"filmOrBroadcast"},{raw:"Drawing",rl:"audioVisualMaterial"},{raw:"Ephemera",rl:"artwork"},{raw:"Eulogy",rl:"personalCommunication"},{raw:"Formulary, Dental",rl:"dataset"},{raw:"Formulary, Homeopathic",rl:"dataset"},{raw:"Formulary, Hospital",rl:"dataset"},{raw:"Formulary",rl:"dataset"},{raw:"Funeral Sermon",rl:"personalCommunication"},{raw:"Government Publication",rl:"governmentDocument"},{raw:"Graphic Novel",rl:"artwork"},{raw:"Historical Article",rl:"ancientText"},{raw:"Incunabula",rl:"ancientText"},{raw:"Incunabula",rl:"ancientText"},{raw:"Instructional Film and Video",rl:"filmOrBroadcast"},{raw:"Introductory Journal Article",rl:"journalArticle"},{raw:"Legislation",rl:"statute"},{raw:"Letter",rl:"personalCommunication"},{raw:"Manuscript, Medical",rl:"manuscript"},{raw:"Movable Books",rl:"books"},{raw:"News",rl:"newspaperArticle"},{raw:"Pharmacopoeia, Homeopathic",rl:"book"},{raw:"Pharmacopoeia",rl:"book"},{raw:"Photograph",rl:"audioVisualMaterial"},{raw:"Pictorial Work",rl:"audioVisualMaterial"},{raw:"Poetry",rl:"artwork"},{raw:"Portrait",rl:"artwork"},{raw:"Postcard",rl:"audioVisualMaterial"},{raw:"Poster",rl:"audioVisualMaterial"},{raw:"Public Service Announcement",rl:"governmentDocument"},{raw:"Research Support, N.I.H., Extramural",rl:"grant"},{raw:"Research Support, N.I.H., Intramural",rl:"grant"},{raw:"Research Support, Non-U.S. Gov't",rl:"grant"},{raw:"Research Support, U.S. Government",rl:"grant"},{raw:"Research Support, U.S. Gov't, Non-P.H.S.",rl:"grant"},{raw:"Research Support, U.S. Gov't, P.H.S.",rl:"grant"},{raw:"Resource Guide",rl:"standard"},{raw:"Retracted Publication",rl:"journalArticle"},{raw:"Retraction of Publication",rl:"journalArticle"},{raw:"Sermon",rl:"journalArticle"},{raw:"Statistics",rl:"chartOrTable"},{raw:"Study Guide",rl:"standard"},{raw:"Terminology",rl:"catalog"},{raw:"Textbook",rl:"book"},{raw:"Unedited Footage",rl:"audioVisualMaterial"},{raw:"Webcast",rl:"web"},{raw:"Wit and Humor",rl:"artwork"},{rl:"",raw:"Abbreviations"},{rl:"",raw:"Abstracts"},{rl:"",raw:"Academic Dissertation"},{rl:"",raw:"Account Book"},{rl:"",raw:"Adaptive Clinical Trial"},{rl:"",raw:"Atlas"},{rl:"",raw:"Bookplate"},{rl:"",raw:"Broadside"},{rl:"",raw:"Calendar"},{rl:"",raw:"Collected Correspondence"},{rl:"",raw:"Collected Work"},{rl:"",raw:"Collection"},{rl:"",raw:"Comment"},{rl:"",raw:"Comparative Study"},{rl:"",raw:"Congress"},{rl:"",raw:"Controlled Clinical Trial"},{rl:"",raw:"Cookbook"},{rl:"",raw:"Diary"},{rl:"",raw:"Directory"},{rl:"",raw:"Dispensatory"},{rl:"",raw:"Duplicate Publication"},{rl:"",raw:"Editorial"},{rl:"",raw:"Electronic Supplementary Materials"},{rl:"",raw:"English Abstract"},{rl:"",raw:"Equivalence Trial"},{rl:"",raw:"Essay"},{rl:"",raw:"Evaluation Study"},{rl:"",raw:"Examination Questions"},{rl:"",raw:"Exhibition"},{rl:"",raw:"Expression of Concern"},{rl:"",raw:"Festschrift"},{rl:"",raw:"Fictional Work"},{rl:"",raw:"Form"},{rl:"",raw:"legalRuleOrRegulation"},{rl:"",raw:"Guidebook"},{rl:"",raw:"Guideline"},{rl:"",raw:"Handbook"},{rl:"",raw:"Herbal"},{rl:"",raw:"Index"},{rl:"",raw:"Interactive Tutorial"},{rl:"",raw:"Interview"},{rl:"",raw:"Juvenile Literature"},{rl:"",raw:"Laboratory Manual"},{rl:"",raw:"Lecture Note"},{rl:"",raw:"Meeting Abstract"},{rl:"",raw:"Meta-Analysis"},{rl:"",raw:"Monograph"},{rl:"",raw:"Multicenter Study"},{rl:"",raw:"Nurses Instruction"},{rl:"",raw:"Observational Study"},{rl:"",raw:"Observational Study, Veterinary"},{rl:"",raw:"Outline"},{rl:"",raw:"Overall"},{rl:"",raw:"Patient Education Handout"},{rl:"",raw:"Periodical"},{rl:"",raw:"Periodical Index"},{rl:"",raw:"Personal Narrative"},{rl:"",raw:"Phrases"},{rl:"",raw:"Popular Work"},{rl:"",raw:"Practice Guideline"},{rl:"",raw:"Pragmatic Clinical Trial"},{rl:"",raw:"Price List"},{rl:"",raw:"Problems and Exercises"},{rl:"",raw:"Program"},{rl:"",raw:"Programmed Instruction"},{rl:"",raw:"Prospectus"},{rl:"",raw:"Publication Components"},{rl:"",raw:"Publication Formats"},{rl:"",raw:"Published Erratum"},{rl:"",raw:"Randomized Controlled Trial"},{rl:"",raw:"Randomized Controlled Trial, Veterinary"},{rl:"",raw:"Research Support, American Recovery and Reinvestment Act"},{rl:"",raw:"Review"},{rl:"",raw:"Scientific Integrity Review"},{rl:"",raw:"Study Characteristics"},{rl:"",raw:"Support of Research"},{rl:"",raw:"Systematic Review"},{rl:"",raw:"Twin Study"},{rl:"",raw:"Union List"},{rl:"",raw:"Validation Study"}],rawMap:new Map,rlMap:new Map}}});var $l={};Ir($l,{parseRef:()=>of,readStream:()=>TO,setup:()=>IO,translations:()=>Qe,writeStream:()=>EO});function TO(r,e){let t={defaultType:"journalArticle",delimeter:"\r",...e},n=Me(),i="";return setTimeout(()=>{r.on("data",s=>{n.emit("progress",r.bytesRead),i+=s.toString();let a=0,l=/(\r\n|\n)ER\s+-\s*(\r\n|\n)/g,u;for(;u=l.exec(i);){let h=of(i.substring(a,u.index),t);n.emit("ref",h),a=u.index+u[0].length}i=i.substring(a)}).on("error",s=>n.emit("error",s)).on("end",()=>{i.replace(/\s+/,"")&&n.emit("ref",of(i,t)),n.emit("end")})}),n}function EO(r,e){let t={defaultType:"journalArticle",delimeter:"\r",...e};return{start(){return Promise.resolve()},write:n=>{var a;let i={type:t.defaultType,title:"<NO TITLE>",...n};if(n.pages){var s=(a=/^(?<_pageStart>.+?)(-(?<_pageEnd>.+))?$/.exec(n.pages))==null?void 0:a.groups;Object.assign(i,s),delete i.pages}return r.write(Qe.fields.collectionOutput.filter(l=>i[l.rl]).flatMap(l=>l.rl=="type"?"TY  - "+(Qe.types.rlMap[i.type]||"JOUR"):l.outputRepeat&&Array.isArray(i[l.rl])?i[l.rl].map(u=>`${l.raw}  - ${u}`):Array.isArray(i[l.rl])?`${l.raw}  - ${i[l.rl].join(t.delimeter)}`:`${l.raw}  - ${i[l.rl]}`).concat([`ER  - 

`]).join(`
`)),Promise.resolve()},end(){return new Promise((n,i)=>r.end(s=>s?i(s):n()))}}}function of(r,e){let t={},n;return r.split(/[\r\n|\n]/).forEach(i=>{var l,u;let s=(l=/^\s*(?<key>[A-Z0-9]+?)\s+-\s+(?<value>.*)$/s.exec(i))==null?void 0:l.groups;if(!s){i.replace(/\s+/,"")&&n&&(n.inputArray?t[n.rl].push(i):t[n.rl]+=e.delimeter+i);return}if(s.key=="ER")return;let a=Qe.fields.rawMap.get(s.key);if(a)a.rl=="type"?(t[a.rl]=((u=Qe.types.rawMap.get(s.value))==null?void 0:u.rl)||e.defaultType,n=a):a.inputArray?(!t[a.rl]||!Array.isArray(t[a.rl])?t[a.rl]=[s.value]:t[a.rl].push(s.value),n=a):(t[a.rl]=s.value,n=a);else{n=null;return}}),(t._pageStart||t._pageEnd)&&(t.pages=[t._pageStart,t._pageEnd].filter(Boolean).join("-"),delete t._pageStart,delete t._pageEnd),t}function IO(){Qe.fields.collectionOutput=Qe.fields.collection.filter(r=>r.sort!==!1).sort((r,e)=>{var t,n,i,s;return((t=r.sort)!=null?t:1e3)==((n=e.sort)!=null?n:1e3)?0:((i=r.sort)!=null?i:1e3)<((s=e.sort)!=null?s:1e3)?-1:1}),Qe.fields.collection.forEach(r=>{Qe.fields.rlMap.set(r.rl,r),Qe.fields.rawMap.set(r.raw,r)}),Qe.types.collection.forEach(r=>{Qe.types.rlMap.set(r.rl,r),Qe.types.rawMap.set(r.raw,r)})}var Qe,IE=_(()=>{_r();Qe={fields:{collection:[{rl:"authors",raw:"A1",sort:!1,inputArray:!0},{rl:"authors",raw:"A2",sort:!1,inputArray:!0},{rl:"authors",raw:"A3",sort:!1,inputArray:!0},{rl:"authors",raw:"A4",sort:!1,inputArray:!0},{rl:"abstract",raw:"AB"},{rl:"address",raw:"AD"},{rl:"accessionNum",raw:"AN"},{rl:"authors",raw:"AU",sort:4,outputRepeat:!0,inputArray:!0},{rl:"custom1",raw:"C1"},{rl:"custom2",raw:"C2"},{rl:"custom3",raw:"C3"},{rl:"custom4",raw:"C4"},{rl:"custom5",raw:"C5"},{rl:"custom6",raw:"C6"},{rl:"custom7",raw:"C7"},{rl:"custom8",raw:"C8"},{rl:"caption",raw:"CA"},{rl:"fallbackCity",raw:"CY"},{rl:"date",raw:"DA"},{rl:"database",raw:"DB"},{rl:"doi",raw:"DO"},{rl:"databaseProvider",raw:"DP"},{rl:"_pageEnd",raw:"EP",sort:6},{rl:"edition",raw:"ET",sort:7},{rl:"number",raw:"IS",sort:8},{rl:"journal",raw:"J1",sort:!1},{rl:"journal",raw:"JF",sort:3},{rl:"keywords",raw:"KW",outputRepeat:!0,inputArray:!0},{rl:"urls",raw:"L1",sort:!1,inputArray:!0},{rl:"urls",raw:"L2",sort:!1,inputArray:!0},{rl:"urls",raw:"L3",sort:!1,inputArray:!0},{rl:"urls",raw:"L4",sort:!1,inputArray:!0},{rl:"language",raw:"LA"},{rl:"label",raw:"LB"},{rl:"urls",raw:"LK"},{rl:"notes",raw:"N1"},{rl:"fallbackAbstract",raw:"N2"},{rl:"publisher",raw:"PB"},{rl:"year",raw:"PY"},{rl:"isbn",raw:"SN"},{rl:"_pageStart",raw:"SP",sort:5},{rl:"title",raw:"T1",sort:!1},{rl:"journal",raw:"T2",sort:!1},{rl:"title",raw:"TI",sort:1},{rl:"type",raw:"TY",sort:0},{rl:"urls",raw:"UR",outputRepeat:!0,inputArray:!0},{rl:"volume",raw:"VL"},{rl:"date",raw:"Y1"},{rl:"accessDate",raw:"Y2"},{rl:"RISID",raw:"ID"},{rl:"RISShortTitle",raw:"ST"},{rl:"RISOriginalPublication",raw:"OP"}],collectionOutput:[],rawMap:new Map,rlMap:new Map},types:{collection:[{rl:"audioVisualMaterial",raw:"ADVS"},{rl:"journalArticle",raw:"JOUR"},{rl:"personalCommunication",raw:"PCOMM"},{rl:"filmOrBroadcast",raw:"VIDEO"},{rl:"unknown",raw:"ABST"},{rl:"aggregatedDatabase",raw:"AGGR"},{rl:"ancientText",raw:"ANCIENT"},{rl:"artwork",raw:"ART"},{rl:"bill",raw:"BILL"},{rl:"blog",raw:"BLOG"},{rl:"book",raw:"BOOK"},{rl:"case",raw:"CASE"},{rl:"bookSection",raw:"CHAP"},{rl:"chartOrTable",raw:"CHART"},{rl:"classicalWork",raw:"CLSWK"},{rl:"computerProgram",raw:"COMP"},{rl:"conferenceProceedings",raw:"CONF"},{rl:"conferencePaper",raw:"CPAPER"},{rl:"catalog",raw:"CTLG"},{rl:"dataset",raw:"DATA"},{rl:"onlineDatabase",raw:"DBASE"},{rl:"dictionary",raw:"DICT"},{rl:"electronicBook",raw:"EBOOK"},{rl:"electronicBookSection",raw:"ECHAP"},{rl:"editedBook",raw:"EDBOOK"},{rl:"electronicArticle",raw:"EJOUR"},{rl:"web",raw:"ELEC"},{rl:"encyclopedia",raw:"ENCYC"},{rl:"equation",raw:"EQUA"},{rl:"figure",raw:"FIGURE"},{rl:"generic",raw:"GEN"},{rl:"governmentDocument",raw:"GOVDOC"},{rl:"grant",raw:"GRANT"},{rl:"hearing",raw:"HEARING"},{rl:"personalCommunication",raw:"ICOMM"},{rl:"newspaperArticle",raw:"INPR"},{rl:"journalArticle",raw:"JFULL"},{rl:"legalRuleOrRegulation",raw:"LEGAL"},{rl:"manuscript",raw:"MANSCPT"},{rl:"map",raw:"MAP"},{rl:"magazineArticle",raw:"MGZN"},{rl:"filmOrBroadcast",raw:"MPCT"},{rl:"onlineMultimedia",raw:"MULTI"},{rl:"music",raw:"MUSIC"},{rl:"newspaperArticle",raw:"NEWS"},{rl:"pamphlet",raw:"PAMP"},{rl:"patent",raw:"PAT"},{rl:"report",raw:"RPRT"},{rl:"serial",raw:"SER"},{rl:"audioVisualMaterial",raw:"SLIDE"},{rl:"audioVisualMaterial",raw:"SOUND"},{rl:"standard",raw:"STAND"},{rl:"statute",raw:"STAT"},{rl:"thesis",raw:"THES"},{rl:"unpublished",raw:"UNPB"}],rawMap:new Map,rlMap:new Map}}});var af={};Ir(af,{endnoteXml:()=>Ul,json:()=>Fl,medline:()=>Bl,ris:()=>$l});var AE=_(()=>{gE();TE();EE();IE()});function gi(r,e){if(!r)throw new Error("No module provided");let t={setup:!0,...e},n=af[r];if(!n)throw new Error(`Unknown module "${r}"`);return n.setup&&t.setup&&!xE.has(r)&&(xE.add(r),n.setup()),n}var xE,ql=_(()=>{AE();xE=new Set});function zl(r,e,t){if(!r)throw new Error("No module provided to parse with");if(!e)throw new Error("No stream provided to parse");return gi(r).writeStream(e,t)}var lf=_(()=>{ql()});function SE(r,e){let t={filename:"References.xml",writeStreamOptions:{},promptDownload:!0,...e};return Promise.resolve().then(()=>{let n=mi(t.filename);if(!n)throw new Error(`Unsupported Reflib filename "${t.filename}"`);return n}).then(async n=>{let i=[],a=new WritableStream({write(u){i.push(u)}}).getWriter();a.end=async u=>{await a.close(),u()};let l=await zl(n.id,a,t.writeStreamOptions);return{blobData:i,streamer:l}}).then(async({blobData:n,streamer:i})=>(await i.start(),await r.reduce((s,a)=>s.then(()=>i.write(a)),Promise.resolve()),await i.end(),n)).then(n=>new Blob(n)).then(n=>{if(!t.promptDownload)return n;let i=URL.createObjectURL(n),s=document.createElement("a");s.href=i,s.download=t.filename,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(i)})}var RE=_(()=>{Ml();lf()});function Gl(r,e,t){if(!r)throw new Error("No module provided to parse with");if(!e)throw new Error("No stream provided to parse");return gi(r).readStream(e,t)}var uf=_(()=>{ql()});function cf(r){if(r.getReader){let e=new Me;return Object.assign(e,{isBrowser:!0,bytesRead:0,reader:r.getReader(),textDecoder:new TextDecoder("utf-8"),read(){this.reader.read().then(({done:t,value:n})=>{if(t)e.emit("end"),this.pipeTarget&&this.pipeTarget.end();else if(n){let i=this.textDecoder.decode(n);this.bytesRead+=i.length,e.emit("data",i),this.pipeTarget&&this.pipeTarget.write(i),setTimeout(this.read.bind(this))}}).catch(t=>this.emit("error",t))},pipeTarget:null,pipe(t){return this.pipeTarget=t,this}}),setTimeout(()=>e.read()),e}else return r}var PE=_(()=>{_r()});function hf(r){let e={...r};if(e.file){if(!(e.file instanceof File))throw new Error('Expected "file" setting to uploadFile() to be a File type');let t=mi(e.file.name);if(!t)throw new Error(`Unidenfified file format from filename "${e.file.name}"`);let n=[];return Promise.resolve().then(()=>e.onStart&&e.onStart(e.file)).then(()=>new Promise((i,s)=>{let a=Gl(t.id,cf(e.file.stream()),{...e,size:e.file.size}).on("end",()=>i(n)).on("error",l=>s(l)).on("ref",l=>n.push(l));e.onProgress&&a.on("progress",e.onProgress)})).then(()=>e.onEnd&&e.onEnd()).then(()=>n)}else return new Promise(t=>{let n=document.createElement("div");n.style.display="none",document.body.appendChild(n);let i=document.createElement("input");i.type="file",i.accept=Object.values(pi).flatMap(s=>s.ext).join(","),i.addEventListener("change",s=>{document.body.removeChild(n),t(hf({file:s.target.files[0],...r}))}),n.appendChild(i),i.dispatchEvent(new MouseEvent("click"))})}var CE=_(()=>{Ll();Ml();uf();PE()});function kE(r){if(r.doi){let e="https://dx.doi.org/";return r.doi.startsWith(e)&&(r.doi=r.doi.slice(e.length)),r.doi}return null}var DE=_(()=>{});var OE,NE=_(()=>{RE();Ll();ql();Ml();uf();CE();lf();DE();OE={downloadFile:SE,formats:pi,getModule:gi,identifyFormat:mi,readStream:Gl,uploadFile:hf,writeStream:zl,getRefDoi:kE}});function VE(r,e=0){return(Ae[r[e+0]]+Ae[r[e+1]]+Ae[r[e+2]]+Ae[r[e+3]]+"-"+Ae[r[e+4]]+Ae[r[e+5]]+"-"+Ae[r[e+6]]+Ae[r[e+7]]+"-"+Ae[r[e+8]]+Ae[r[e+9]]+"-"+Ae[r[e+10]]+Ae[r[e+11]]+Ae[r[e+12]]+Ae[r[e+13]]+Ae[r[e+14]]+Ae[r[e+15]]).toLowerCase()}var Ae,LE=_(()=>{Ae=[];for(let r=0;r<256;++r)Ae.push((r+256).toString(16).slice(1))});function ff(){if(!df){if(typeof crypto=="undefined"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");df=crypto.getRandomValues.bind(crypto)}return df(AO)}var df,AO,ME=_(()=>{AO=new Uint8Array(16)});var xO,pf,FE=_(()=>{xO=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),pf={randomUUID:xO}});function SO(r,e,t){var i,s,a;if(pf.randomUUID&&!e&&!r)return pf.randomUUID();r=r||{};let n=(a=(s=r.random)!=null?s:(i=r.rng)==null?void 0:i.call(r))!=null?a:ff();if(n.length<16)throw new Error("Random bytes length must be >= 16");if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){if(t=t||0,t<0||t+16>e.length)throw new RangeError(`UUID byte range ${t}:${t+15} is out of buffer bounds`);for(let l=0;l<16;++l)e[t+l]=n[l];return e}return VE(n)}var mf,jE=_(()=>{FE();ME();LE();mf=SO});var UE=_(()=>{jE()});var BE={};Ir(BE,{default:()=>RO});var RO,$E=_(()=>{NE();UE();gf();RO={projects:{singular:"project",async initState({supabase:r,id:e}){let t=await _e.wrapSupabase(r.from("projects").select("data").limit(1).eq("id",e));if(t.length!==1)throw new Error(`Syncro project "${e}" not found`);let n=t[0].data;if(console.log("[MIGRATION] State of temp at start:",n.temp),!n.temp||Object.values(n.temp).every(i=>typeof i!="object"))return n;throw new Error("Project data version unsupported")},flushState({supabase:r,state:e,fsId:t}){return _e.wrapSupabase(r.rpc("syncro_merge_data",{table_name:"projects",entity_id:t,new_data:e}))}},project_libraries:{singular:"project library",initState({supabase:r,id:e,relation:t}){if(!t||!/_\*$/.test(t))throw new Error('Project library relation missing, path should resemble "project_library::${PROJECT}::${LIBRARY_FILE_ID}_*"');let n=t.replace(/_\*$/,"");return Promise.resolve().then(()=>_e.wrapSupabase(r.storage.from("projects").list(e))).then(i=>i.find(s=>s.id==n)).then(i=>i||Promise.reject(`Invalid file ID "${n}"`)).then(i=>_e.wrapSupabase(r.storage.from("projects").download(`${e}/${i.name}`)).then(s=>({blob:s,file:i}))).then(({blob:i,file:s})=>OE.uploadFile({file:new File([i],s.name.replace(/^.*[/\\]/,""))})).then(i=>Object.fromEntries(i.map(s=>[mf(),s])))},flushState({supabase:r,id:e,relation:t}){throw new Error("Flushing project_libraries::* namespace is not yet supported")}},project_namespaces:{singular:"project namespace",initState({supabase:r,id:e,relation:t}){if(!t)throw new Error('Project namespace relation missing, path should resemble "project_namespaces::${PROJECT}::${RELATION}"');return _e.wrapSupabase(r.from("project_namespaces").select("data").limit(1).eq("project",e).eq("name",t)).then(n=>n.length==1?n[0]:_e.wrapSupabase(r.from("project_namespaces").insert({project:e,name:t,data:{}}).select("data"))).then(n=>n.data)},flushState({supabase:r,state:e,id:t,relation:n}){return _e.wrapSupabase(r.from("project_namespaces").update({edited_at:new Date,data:e}).eq("project",t).eq("name",n))}},test:{singular:"test",initState({supabase:r,id:e}){return _e.wrapSupabase(r.from("test").select("data").limit(1).eq("id",e)).then(t=>t.length==1?t[0]:Promise.reject(`Syncro test item "${e}" not found`)).then(t=>t.data)},flushState({supabase:r,state:e,fsId:t}){return _e.wrapSupabase(r.rpc("syncro_merge_data",{table_name:"test",entity_id:t,new_data:e}))}},users:{singular:"user",initState({supabase:r,id:e}){return _e.wrapSupabase(r.from("users").select("data").limit(1).eq("id",e)).then(t=>t.length==1?t[0]:Promise.reject(`Syncro user "${e}" not found`)).then(t=>t.data)},flushState({supabase:r,state:e,fsId:t}){return _e.wrapSupabase(r.rpc("syncro_merge_data",{table_name:"users",entity_id:t,new_data:e}))}}}});var te,_e,qE,gf=_(()=>{aa();Pd();lE();dE();te=class te{constructor(e,t){ae(this,"path");ae(this,"docRef");ae(this,"value");ae(this,"throttle",250);ae(this,"config",{heartbeatInterval:5e4,syncroRegistryUrl:"https://tera-tools.com/api/sync",forceLocalInit:!1,context:{}});ae(this,"isDirty",!1);ae(this,"_destroyActions",[]);ae(this,"_heartbeatTimer");this.path=e,Object.assign(this,{...t,config:{...this.config,...t==null?void 0:t.config}}),te.session||(te.session=`syncro_${hE()}`)}debug(...e){}destroy(){return this.debug("Destroy!"),Promise.all(this._destroyActions.map(e=>e())).then(()=>this._destroyActions=[])}getReactive(e){console.warn("Syncro.getReactive has not been subclassed, assuming a POJO response");let t={...e};return{doc:t,setState(n){Object.entries(n||{}).forEach(([i,s])=>t[i]=s)},getState(){return sr(t)},watch(n){}}}static pathSplit(e,t){var a;let n={allowAsterisk:!1,...t},s={...(a=new RegExp("^(?<entity>\\w+?)::(?<id>[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})(?:::(?<relation>[\\w\\-"+(n.allowAsterisk?"\\*":"")+"]+?))?$").exec(e))==null?void 0:a.groups};if(!s)throw new Error(`Invalid session path syntax "${e}"`);if(te.SyncroEntiries&&!(s.entity in SyncroEntities))throw new Error(`Unsupported entity "${e}" -> Entity="${s.entity}"`);return{...s,fsCollection:s.entity,fsId:s.relation?`${s.id}::${s.relation}`:s.id}}static toFirestore(e={}){return Ys.serialize(e,{circular:!1,clone:!0,modules:[qE,...Ys.settings.modules],stringify:!1})}static fromFirestore(e={}){return Ys.deserialize(e,{circular:!1,clone:!0,modules:[qE,...Ys.settings.modules],destringify:!1})}static toFirestoreFields(e){let t={};for(let[n,i]of Object.entries(e)){let s=typeof i;s==="string"?t[n]={stringValue:i}:s==="number"?t[n]={doubleValue:i}:s==="boolean"?t[n]={booleanValue:i}:i===null?t[n]={nullValue:null}:Array.isArray(i)?t[n]={arrayValue:{values:i.map(a=>te.toFirestoreFields({item:a}).item)}}:s==="object"&&(t[n]={mapValue:{fields:te.toFirestoreFields(i)}})}return t}static fromFirestoreFields(e={}){let t={};for(let n in e){let i=e[n];if(["stringValue","booleanValue","doubleValue","integerValue","timestampValue","mapValue","arrayValue"].find(a=>a===n)){if(["stringValue","booleanValue","doubleValue","integerValue","timestampValue"].find(l=>l===n))return i;if(n=="mapValue")return te.fromFirestoreFields(i.fields||{});if(n=="arrayValue"){let l=i.values;return l?l.map(u=>te.fromFirestoreFields(u)):[]}}else t[n]=te.fromFirestoreFields(i)}return t}static getSnapshot(e){let{fsCollection:t,fsId:n}=te.pathSplit(e);return Promise.resolve().then(async()=>Rd(fl(te.firestore,t,n))).then(i=>i?te.fromFirestore(i.data()):null)}static setSnapshot(e,t,n){let i={method:"merge",...n},{fsCollection:s,fsId:a}=te.pathSplit(e);return Promise.resolve().then(()=>(i.method=="merge"?"FirestoreUpdateDoc":"FirestoreSetDoc")(fl(te.firestore,s,a),te.toFirestore(t))).then(()=>t)}static wrapSupabase(e){return Promise.resolve(e).then(t=>{var n,i;if(t!=null&&t.error)throw/JSON object requested, multiple \(or no\) rows returned$/.test(t.error.message)?(console.warn("Supabase query threw record not found against query",e.url.search),console.warn("Supabase raw error",t),new Error("NOT-FOUND")):(console.warn("Supabase query threw",t.error.message),new Error(`${((n=t.error)==null?void 0:n.code)||"UnknownError"}: ${((i=t.error)==null?void 0:i.message)||"Unknown Supabase error"}`));if(t.data)return t.data})}mount(e){let t={initialState:null,...e},{fsCollection:n,fsId:i,entity:s,id:a,relation:l}=te.pathSplit(this.path),u,h;return Promise.resolve().then(()=>this.setHeartbeat(!1)).then(async()=>{this.docRef=fl(te.firestore,n,i);let f=await this.getFirestoreState();if(u=this.getReactive(f),!u.doc||!u.setState||!u.getState||!u.watch)throw new Error("Syncro.getReactive() requires a returned `doc`, `setState()`, `getState()` + `watch()`");this.value=h=u.doc,this.debug("Initial state",{doc:h}),this._destroyActions.push(jb(this.docRef,m=>{let g=te.fromFirestore(m.data());this.debug("Incoming snapshot",{snapshotData:g}),u.setState(g)}))}).then(()=>{if($u(h))return t.initialState?(this.debug("Populate initial Syncro state (from provided initialState)"),this.setFirestoreState(t.initialState,{method:"set"})):this.config.forceLocalInit?(this.debug(`Populate initial Syncro state (from "${s}" SyncroEntities)`),Promise.resolve().then(()=>te.SyncroEntities||Promise.resolve().then(()=>($E(),BE)).then(({default:f})=>te.SyncroEntities=f)).then(()=>te.SyncroEntities[s]||Promise.reject(`Unknown Sync entity "${s}"`)).then(()=>te.SyncroEntities[s].initState({supabase:te.supabase,fsCollection:n,fsId:i,entity:s,id:a,relation:l,...this.config.context}))):(this.debug(`Populate initial Syncro state (from "${s}" Syncro worker)`),fetch(`${this.config.syncroRegistryUrl}/${this.path}`).then(f=>f.ok||Promise.reject(`Failed to check Syncro "${path}" status - ${f.statusText}`)))}).then(()=>{u.watch(Gu(f=>{this.debug("Local change",{newState:f}),this.markDirty(),this.setFirestoreState(f,{method:"merge"})},this.throttle))}).then(()=>this.setHeartbeat(!0,{immediate:!0})).then(()=>this)}setHeartbeat(e=!0,t){let n={immediate:!0,...t};clearTimeout(this._heartbeatTimer),e&&(this._heartbeatTimer=setTimeout(async()=>{await this.heartbeat(),e&&this.setHeartbeat(!0)},this.config.heartbeatInterval),n.immediate&&this.heartbeat())}async heartbeat(){this.debug("heartbeat!"),await fetch(`${this.config.syncroRegistryUrl}/${this.path}/heartbeat`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({session:te.session,...this.isDirty&&{dirty:!0}})}).then(e=>e.ok?null:console.warn(this.path,`Heartbeat failed - ${e.statusText}`,{response:e})).then(()=>this.isDirty=!1)}setFirestoreState(e,t){let n={method:"merge",...t};if(!this.docRef)throw new Error("mount() must be called before setting Firestore state");return(n.method=="set"?Mb:Fb)(this.docRef,te.toFirestore(e))}getFirestoreState(){if(!this.docRef)throw new Error("mount() must be called before getting Firestore state");return Rd(this.docRef).then(e=>te.fromFirestore(e.data()))}markDirty(){return this.isDirty=!0,this}flush(e){let t={destroy:!1,...e};return fetch(`${this.config.syncroRegistryUrl}/${this.path}/flush`+(t.destroy?"?destroy=1":"")).then(n=>n.ok?null:Promise.reject(n.statusText||"An error occured"))}};ae(te,"firebase"),ae(te,"firestore"),ae(te,"supabase"),ae(te,"session"),ae(te,"SyncroEntities");_e=te,qE={id:"~array",recursive:!0,test:r=>Array.isArray(r),serialize:r=>({_:"~array",...r}),deserialize:r=>{let e=Array.from({length:Object.keys(r).length-1});return Object.entries(r).filter(([t])=>t!=="_").forEach(([t,n])=>e[+t]=n),e}}});aa();da();da();var uk="firebase",ck="11.3.1";lr(uk,ck,"app");Pd();var qb=r=>{let e;return r?e=r:typeof fetch=="undefined"?e=(...t)=>Promise.resolve().then(()=>(mr(),jr)).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)};var Ss=class extends Error{constructor(e,t="FunctionsError",n){super(e),this.name=t,this.context=n}},ml=class extends Ss{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}},gl=class extends Ss{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}},yl=class extends Ss{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}},_l;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(_l||(_l={}));var w1=function(r,e,t,n){function i(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function l(f){try{h(n.next(f))}catch(m){a(m)}}function u(f){try{h(n.throw(f))}catch(m){a(m)}}function h(f){f.done?s(f.value):i(f.value).then(l,u)}h((n=n.apply(r,e||[])).next())})},Rs=class{constructor(e,{headers:t={},customFetch:n,region:i=_l.Any}={}){this.url=e,this.headers=t,this.region=i,this.fetch=qb(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var n;return w1(this,void 0,void 0,function*(){try{let{headers:i,method:s,body:a}=t,l={},{region:u}=t;u||(u=this.region),u&&u!=="any"&&(l["x-region"]=u);let h;a&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)&&(typeof Blob!="undefined"&&a instanceof Blob||a instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",h=a):typeof a=="string"?(l["Content-Type"]="text/plain",h=a):typeof FormData!="undefined"&&a instanceof FormData?h=a:(l["Content-Type"]="application/json",h=JSON.stringify(a)));let f=yield this.fetch(`${this.url}/${e}`,{method:s||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),i),body:h}).catch(C=>{throw new ml(C)}),m=f.headers.get("x-relay-error");if(m&&m==="true")throw new gl(f);if(!f.ok)throw new yl(f);let g=((n=f.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),I;return g==="application/json"?I=yield f.json():g==="application/octet-stream"?I=yield f.blob():g==="text/event-stream"?I=f:g==="multipart/form-data"?I=yield f.formData():I=yield f.text(),{data:I,error:null}}catch(i){return{data:null,error:i}}})}};var rT=vp(tT(),1),{PostgrestClient:nT,PostgrestQueryBuilder:M$,PostgrestFilterBuilder:F$,PostgrestTransformBuilder:j$,PostgrestBuilder:U$,PostgrestError:k1}=rT.default;var iT="2.11.2";var sT={"X-Client-Info":`realtime-js/${iT}`},oT="1.0.0",El=1e4,aT=1e3,Ur;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(Ur||(Ur={}));var Be;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(Be||(Be={}));var We;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(We||(We={}));var Tl;(function(r){r.websocket="websocket"})(Tl||(Tl={}));var gr;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(gr||(gr={}));var Vs=class{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){let t=new DataView(e),n=new TextDecoder;return this._decodeBroadcast(e,t,n)}_decodeBroadcast(e,t,n){let i=t.getUint8(1),s=t.getUint8(2),a=this.HEADER_LENGTH+2,l=n.decode(e.slice(a,a+i));a=a+i;let u=n.decode(e.slice(a,a+s));a=a+s;let h=JSON.parse(n.decode(e.slice(a,e.byteLength)));return{ref:null,topic:l,event:u,payload:h}}};var Br=class{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}};var se;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(se||(se={}));var zd=(r,e,t={})=>{var n;let i=(n=t.skipTypes)!==null&&n!==void 0?n:[];return Object.keys(e).reduce((s,a)=>(s[a]=D1(a,r,e,i),s),{})},D1=(r,e,t,n)=>{let i=e.find(l=>l.name===r),s=i==null?void 0:i.type,a=t[r];return s&&!n.includes(s)?lT(s,a):qd(a)},lT=(r,e)=>{if(r.charAt(0)==="_"){let t=r.slice(1,r.length);return L1(e,t)}switch(r){case se.bool:return O1(e);case se.float4:case se.float8:case se.int2:case se.int4:case se.int8:case se.numeric:case se.oid:return N1(e);case se.json:case se.jsonb:return V1(e);case se.timestamp:return M1(e);case se.abstime:case se.date:case se.daterange:case se.int4range:case se.int8range:case se.money:case se.reltime:case se.text:case se.time:case se.timestamptz:case se.timetz:case se.tsrange:case se.tstzrange:return qd(e);default:return qd(e)}},qd=r=>r,O1=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},N1=r=>{if(typeof r=="string"){let e=parseFloat(r);if(!Number.isNaN(e))return e}return r},V1=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},L1=(r,e)=>{if(typeof r!="string")return r;let t=r.length-1,n=r[t];if(r[0]==="{"&&n==="}"){let s,a=r.slice(1,t);try{s=JSON.parse("["+a+"]")}catch{s=a?a.split(","):[]}return s.map(l=>lT(e,l))}return r},M1=r=>typeof r=="string"?r.replace(" ","T"):r,Il=r=>{let e=r;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};var $r=class{constructor(e,t,n={},i=El){this.channel=e,this.event=t,this.payload=n,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var n;return this._hasReceived(e)&&t((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);let e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}};var Gd;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(Gd||(Gd={}));var ii=class r{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};let n=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},i=>{let{onJoin:s,onLeave:a,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=r.syncState(this.state,i,s,a),this.pendingDiffs.forEach(u=>{this.state=r.syncDiff(this.state,u,s,a)}),this.pendingDiffs=[],l()}),this.channel._on(n.diff,{},i=>{let{onJoin:s,onLeave:a,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=r.syncDiff(this.state,i,s,a),l())}),this.onJoin((i,s,a)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:s,newPresences:a})}),this.onLeave((i,s,a)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:s,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,n,i){let s=this.cloneDeep(e),a=this.transformState(t),l={},u={};return this.map(s,(h,f)=>{a[h]||(u[h]=f)}),this.map(a,(h,f)=>{let m=s[h];if(m){let g=f.map(P=>P.presence_ref),I=m.map(P=>P.presence_ref),C=f.filter(P=>I.indexOf(P.presence_ref)<0),k=m.filter(P=>g.indexOf(P.presence_ref)<0);C.length>0&&(l[h]=C),k.length>0&&(u[h]=k)}else l[h]=f}),this.syncDiff(s,{joins:l,leaves:u},n,i)}static syncDiff(e,t,n,i){let{joins:s,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return n||(n=()=>{}),i||(i=()=>{}),this.map(s,(l,u)=>{var h;let f=(h=e[l])!==null&&h!==void 0?h:[];if(e[l]=this.cloneDeep(u),f.length>0){let m=e[l].map(I=>I.presence_ref),g=f.filter(I=>m.indexOf(I.presence_ref)<0);e[l].unshift(...g)}n(l,f,u)}),this.map(a,(l,u)=>{let h=e[l];if(!h)return;let f=u.map(m=>m.presence_ref);h=h.filter(m=>f.indexOf(m.presence_ref)<0),e[l]=h,i(l,h,u),h.length===0&&delete e[l]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(n=>t(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,n)=>{let i=e[n];return"metas"in i?t[n]=i.metas.map(s=>(s.presence_ref=s.phx_ref,delete s.phx_ref,delete s.phx_ref_prev,s)):t[n]=i,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}};var Kd;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(Kd||(Kd={}));var Hd;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(Hd||(Hd={}));var _t;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(_t||(_t={}));var si=class r{constructor(e,t={config:{}},n){this.topic=e,this.params=t,this.socket=n,this.bindings={},this.state=Be.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new $r(this,We.join,this.params,this.timeout),this.rejoinTimer=new Br(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Be.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(i=>i.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Be.closed,this.socket._remove(this)}),this._onError(i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=Be.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Be.errored,this.rejoinTimer.scheduleTimeout())}),this._on(We.reply,{},(i,s)=>{this._trigger(this._replyEventName(s),i)}),this.presence=new ii(this),this.broadcastEndpointURL=Il(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var n,i;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{let{config:{broadcast:s,presence:a,private:l}}=this.params;this._onError(f=>e==null?void 0:e(_t.CHANNEL_ERROR,f)),this._onClose(()=>e==null?void 0:e(_t.CLOSED));let u={},h={broadcast:s,presence:a,postgres_changes:(i=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(f=>f.filter))!==null&&i!==void 0?i:[],private:l};this.socket.accessTokenValue&&(u.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:h},u)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:f})=>{var m;if(this.socket.setAuth(),f===void 0){e==null||e(_t.SUBSCRIBED);return}else{let g=this.bindings.postgres_changes,I=(m=g==null?void 0:g.length)!==null&&m!==void 0?m:0,C=[];for(let k=0;k<I;k++){let P=g[k],{filter:{event:V,schema:F,table:B,filter:K}}=P,X=f&&f[k];if(X&&X.event===V&&X.schema===F&&X.table===B&&X.filter===K)C.push(Object.assign(Object.assign({},P),{id:X.id}));else{this.unsubscribe(),e==null||e(_t.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=C,e&&e(_t.SUBSCRIBED);return}}).receive("error",f=>{e==null||e(_t.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(f).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(_t.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,n){return this._on(e,t,n)}async send(e,t={}){var n,i;if(!this._canPush()&&e.type==="broadcast"){let{event:s,payload:a}=e,u={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:s,payload:a,private:this.private}]})};try{let h=await this._fetchWithTimeout(this.broadcastEndpointURL,u,(n=t.timeout)!==null&&n!==void 0?n:this.timeout);return await((i=h.body)===null||i===void 0?void 0:i.cancel()),h.ok?"ok":"error"}catch(h){return h.name==="AbortError"?"timed out":"error"}}else return new Promise(s=>{var a,l,u;let h=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((u=(l=(a=this.params)===null||a===void 0?void 0:a.config)===null||l===void 0?void 0:l.broadcast)===null||u===void 0)&&u.ack)&&s("ok"),h.receive("ok",()=>s("ok")),h.receive("error",()=>s("error")),h.receive("timeout",()=>s("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Be.leaving;let t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(We.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(n=>{let i=new $r(this,We.leave,{},e);i.receive("ok",()=>{t(),n("ok")}).receive("timeout",()=>{t(),n("timed out")}).receive("error",()=>{n("error")}),i.send(),this._canPush()||i.trigger("ok",{})})}async _fetchWithTimeout(e,t,n){let i=new AbortController,s=setTimeout(()=>i.abort(),n),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:i.signal}));return clearTimeout(s),a}_push(e,t,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new $r(this,e,t,n);return this._canPush()?i.send():(i.startTimeout(),this.pushBuffer.push(i)),i}_onMessage(e,t,n){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,n){var i,s;let a=e.toLocaleLowerCase(),{close:l,error:u,leave:h,join:f}=We;if(n&&[l,u,h,f].indexOf(a)>=0&&n!==this._joinRef())return;let g=this._onMessage(a,t,n);if(t&&!g)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(I=>{var C,k,P;return((C=I.filter)===null||C===void 0?void 0:C.event)==="*"||((P=(k=I.filter)===null||k===void 0?void 0:k.event)===null||P===void 0?void 0:P.toLocaleLowerCase())===a}).map(I=>I.callback(g,n)):(s=this.bindings[a])===null||s===void 0||s.filter(I=>{var C,k,P,V,F,B;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in I){let K=I.id,X=(C=I.filter)===null||C===void 0?void 0:C.event;return K&&((k=t.ids)===null||k===void 0?void 0:k.includes(K))&&(X==="*"||(X==null?void 0:X.toLocaleLowerCase())===((P=t.data)===null||P===void 0?void 0:P.type.toLocaleLowerCase()))}else{let K=(F=(V=I==null?void 0:I.filter)===null||V===void 0?void 0:V.event)===null||F===void 0?void 0:F.toLocaleLowerCase();return K==="*"||K===((B=t==null?void 0:t.event)===null||B===void 0?void 0:B.toLocaleLowerCase())}else return I.type.toLocaleLowerCase()===a}).map(I=>{if(typeof g=="object"&&"ids"in g){let C=g.data,{schema:k,table:P,commit_timestamp:V,type:F,errors:B}=C;g=Object.assign(Object.assign({},{schema:k,table:P,commit_timestamp:V,eventType:F,new:{},old:{},errors:B}),this._getPayloadRecords(C))}I.callback(g,n)})}_isClosed(){return this.state===Be.closed}_isJoined(){return this.state===Be.joined}_isJoining(){return this.state===Be.joining}_isLeaving(){return this.state===Be.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,n){let i=e.toLocaleLowerCase(),s={type:i,filter:t,callback:n};return this.bindings[i]?this.bindings[i].push(s):this.bindings[i]=[s],this}_off(e,t){let n=e.toLocaleLowerCase();return this.bindings[n]=this.bindings[n].filter(i=>{var s;return!(((s=i.type)===null||s===void 0?void 0:s.toLocaleLowerCase())===n&&r.isEqual(i.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(let n in e)if(e[n]!==t[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(We.close,{},e)}_onError(e){this._on(We.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Be.joining,this.joinPush.resend(e))}_getPayloadRecords(e){let t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=zd(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=zd(e.columns,e.old_record)),t}};var j1=()=>{},U1=typeof WebSocket!="undefined",B1=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`,oi=class{constructor(e,t){var n;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=sT,this.params={},this.timeout=El,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=j1,this.conn=null,this.sendBuffer=[],this.serializer=new Vs,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=s=>{let a;return s?a=s:typeof fetch=="undefined"?a=(...l)=>Promise.resolve().then(()=>(mr(),jr)).then(({default:u})=>u(...l)):a=fetch,(...l)=>a(...l)},this.endPoint=`${e}/${Tl.websocket}`,this.httpEndpoint=Il(e),t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);let i=(n=t==null?void 0:t.params)===null||n===void 0?void 0:n.apikey;if(i&&(this.accessTokenValue=i,this.apiKey=i),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:s=>[1e3,2e3,5e3,1e4][s-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(s,a)=>a(JSON.stringify(s)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Br(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch),t!=null&&t.worker){if(typeof window!="undefined"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(t==null?void 0:t.worker)||!1,this.workerUrl=t==null?void 0:t.workerUrl}this.accessToken=(t==null?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(U1){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new Wd(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),Promise.resolve().then(()=>vp(cT())).then(({default:e})=>{this.conn=new e(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:oT}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t!=null?t:""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){let t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){let e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e}log(e,t,n){this.logger(e,t,n)}connectionState(){switch(this.conn&&this.conn.readyState){case Ur.connecting:return gr.Connecting;case Ur.open:return gr.Open;case Ur.closing:return gr.Closing;default:return gr.Closed}}isConnected(){return this.connectionState()===gr.Open}channel(e,t={config:{}}){let n=new si(`realtime:${e}`,t,this);return this.channels.push(n),n}push(e){let{topic:t,event:n,payload:i,ref:s}=e,a=()=>{this.encode(e,l=>{var u;(u=this.conn)===null||u===void 0||u.send(l)})};this.log("push",`${t} ${n} (${s})`,i),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(t){let n=null;try{n=JSON.parse(atob(t.split(".")[1]))}catch{}if(n&&n.exp&&!(Math.floor(Date.now()/1e3)-n.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${n.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${n.exp}`);this.accessTokenValue=t,this.channels.forEach(i=>{t&&i.updateJoinPayload({access_token:t}),i.joinedOnce&&i._isJoined()&&i._push(We.access_token,{access_token:t})})}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(aT,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:n,event:i,payload:s,ref:a}=t;a&&a===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${s.status||""} ${n} ${i} ${a&&"("+a+")"||""}`,s),this.channels.filter(l=>l._isMember(n)).forEach(l=>l._trigger(i,s,a)),this.stateChangeCallbacks.message.forEach(l=>l(t))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");let e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(We.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;let n=e.match(/\?/)?"&":"?",i=new URLSearchParams(t);return`${e}${n}${i}`}_workerObjectUrl(e){let t;if(e)t=e;else{let n=new Blob([B1],{type:"application/javascript"});t=URL.createObjectURL(n)}return t}},Wd=class{constructor(e,t,n){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=Ur.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=n.close}};var ai=class extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}};function ye(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}var Al=class extends ai{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}},qr=class extends ai{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}};var $1=function(r,e,t,n){function i(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function l(f){try{h(n.next(f))}catch(m){a(m)}}function u(f){try{h(n.throw(f))}catch(m){a(m)}}function h(f){f.done?s(f.value):i(f.value).then(l,u)}h((n=n.apply(r,e||[])).next())})},Sl=r=>{let e;return r?e=r:typeof fetch=="undefined"?e=(...t)=>Promise.resolve().then(()=>(mr(),jr)).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},hT=()=>$1(void 0,void 0,void 0,function*(){return typeof Response=="undefined"?(yield Promise.resolve().then(()=>(mr(),jr))).Response:Response}),xl=r=>{if(Array.isArray(r))return r.map(t=>xl(t));if(typeof r=="function"||r!==Object(r))return r;let e={};return Object.entries(r).forEach(([t,n])=>{let i=t.replace(/([-_][a-z])/gi,s=>s.toUpperCase().replace(/[-_]/g,""));e[i]=xl(n)}),e};var zr=function(r,e,t,n){function i(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function l(f){try{h(n.next(f))}catch(m){a(m)}}function u(f){try{h(n.throw(f))}catch(m){a(m)}}function h(f){f.done?s(f.value):i(f.value).then(l,u)}h((n=n.apply(r,e||[])).next())})},Qd=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),q1=(r,e,t)=>zr(void 0,void 0,void 0,function*(){let n=yield hT();r instanceof n&&!(t!=null&&t.noResolveJson)?r.json().then(i=>{e(new Al(Qd(i),r.status||500))}).catch(i=>{e(new qr(Qd(i),i))}):e(new qr(Qd(r),r))}),z1=(r,e,t,n)=>{let i={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),n&&(i.body=JSON.stringify(n)),Object.assign(Object.assign({},i),t))};function Ls(r,e,t,n,i,s){return zr(this,void 0,void 0,function*(){return new Promise((a,l)=>{r(t,z1(e,n,i,s)).then(u=>{if(!u.ok)throw u;return n!=null&&n.noResolveJson?u:u.json()}).then(u=>a(u)).catch(u=>q1(u,l,n))})})}function li(r,e,t,n){return zr(this,void 0,void 0,function*(){return Ls(r,"GET",e,t,n)})}function wt(r,e,t,n,i){return zr(this,void 0,void 0,function*(){return Ls(r,"POST",e,n,i,t)})}function dT(r,e,t,n,i){return zr(this,void 0,void 0,function*(){return Ls(r,"PUT",e,n,i,t)})}function fT(r,e,t,n){return zr(this,void 0,void 0,function*(){return Ls(r,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),n)})}function Rl(r,e,t,n,i){return zr(this,void 0,void 0,function*(){return Ls(r,"DELETE",e,n,i,t)})}var $e=function(r,e,t,n){function i(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function l(f){try{h(n.next(f))}catch(m){a(m)}}function u(f){try{h(n.throw(f))}catch(m){a(m)}}function h(f){f.done?s(f.value):i(f.value).then(l,u)}h((n=n.apply(r,e||[])).next())})},G1={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},pT={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1},Ms=class{constructor(e,t={},n,i){this.url=e,this.headers=t,this.bucketId=n,this.fetch=Sl(i)}uploadOrUpdate(e,t,n,i){return $e(this,void 0,void 0,function*(){try{let s,a=Object.assign(Object.assign({},pT),i),l=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(a.upsert)}),u=a.metadata;typeof Blob!="undefined"&&n instanceof Blob?(s=new FormData,s.append("cacheControl",a.cacheControl),u&&s.append("metadata",this.encodeMetadata(u)),s.append("",n)):typeof FormData!="undefined"&&n instanceof FormData?(s=n,s.append("cacheControl",a.cacheControl),u&&s.append("metadata",this.encodeMetadata(u))):(s=n,l["cache-control"]=`max-age=${a.cacheControl}`,l["content-type"]=a.contentType,u&&(l["x-metadata"]=this.toBase64(this.encodeMetadata(u)))),i!=null&&i.headers&&(l=Object.assign(Object.assign({},l),i.headers));let h=this._removeEmptyFolders(t),f=this._getFinalPath(h),m=yield this.fetch(`${this.url}/object/${f}`,Object.assign({method:e,body:s,headers:l},a!=null&&a.duplex?{duplex:a.duplex}:{})),g=yield m.json();return m.ok?{data:{path:h,id:g.Id,fullPath:g.Key},error:null}:{data:null,error:g}}catch(s){if(ye(s))return{data:null,error:s};throw s}})}upload(e,t,n){return $e(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,n)})}uploadToSignedUrl(e,t,n,i){return $e(this,void 0,void 0,function*(){let s=this._removeEmptyFolders(e),a=this._getFinalPath(s),l=new URL(this.url+`/object/upload/sign/${a}`);l.searchParams.set("token",t);try{let u,h=Object.assign({upsert:pT.upsert},i),f=Object.assign(Object.assign({},this.headers),{"x-upsert":String(h.upsert)});typeof Blob!="undefined"&&n instanceof Blob?(u=new FormData,u.append("cacheControl",h.cacheControl),u.append("",n)):typeof FormData!="undefined"&&n instanceof FormData?(u=n,u.append("cacheControl",h.cacheControl)):(u=n,f["cache-control"]=`max-age=${h.cacheControl}`,f["content-type"]=h.contentType);let m=yield this.fetch(l.toString(),{method:"PUT",body:u,headers:f}),g=yield m.json();return m.ok?{data:{path:s,fullPath:g.Key},error:null}:{data:null,error:g}}catch(u){if(ye(u))return{data:null,error:u};throw u}})}createSignedUploadUrl(e,t){return $e(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),i=Object.assign({},this.headers);t!=null&&t.upsert&&(i["x-upsert"]="true");let s=yield wt(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:i}),a=new URL(this.url+s.url),l=a.searchParams.get("token");if(!l)throw new ai("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:l},error:null}}catch(n){if(ye(n))return{data:null,error:n};throw n}})}update(e,t,n){return $e(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,n)})}move(e,t,n){return $e(this,void 0,void 0,function*(){try{return{data:yield wt(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers}),error:null}}catch(i){if(ye(i))return{data:null,error:i};throw i}})}copy(e,t,n){return $e(this,void 0,void 0,function*(){try{return{data:{path:(yield wt(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers})).Key},error:null}}catch(i){if(ye(i))return{data:null,error:i};throw i}})}createSignedUrl(e,t,n){return $e(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e),s=yield wt(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:t},n!=null&&n.transform?{transform:n.transform}:{}),{headers:this.headers}),a=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return s={signedUrl:encodeURI(`${this.url}${s.signedURL}${a}`)},{data:s,error:null}}catch(i){if(ye(i))return{data:null,error:i};throw i}})}createSignedUrls(e,t,n){return $e(this,void 0,void 0,function*(){try{let i=yield wt(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),s=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return{data:i.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${s}`):null})),error:null}}catch(i){if(ye(i))return{data:null,error:i};throw i}})}download(e,t){return $e(this,void 0,void 0,function*(){let i=typeof(t==null?void 0:t.transform)!="undefined"?"render/image/authenticated":"object",s=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),a=s?`?${s}`:"";try{let l=this._getFinalPath(e);return{data:yield(yield li(this.fetch,`${this.url}/${i}/${l}${a}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(l){if(ye(l))return{data:null,error:l};throw l}})}info(e){return $e(this,void 0,void 0,function*(){let t=this._getFinalPath(e);try{let n=yield li(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:xl(n),error:null}}catch(n){if(ye(n))return{data:null,error:n};throw n}})}exists(e){return $e(this,void 0,void 0,function*(){let t=this._getFinalPath(e);try{return yield fT(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(ye(n)&&n instanceof qr){let i=n.originalError;if([400,404].includes(i==null?void 0:i.status))return{data:!1,error:n}}throw n}})}getPublicUrl(e,t){let n=this._getFinalPath(e),i=[],s=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";s!==""&&i.push(s);let l=typeof(t==null?void 0:t.transform)!="undefined"?"render/image":"object",u=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});u!==""&&i.push(u);let h=i.join("&");return h!==""&&(h=`?${h}`),{data:{publicUrl:encodeURI(`${this.url}/${l}/public/${n}${h}`)}}}remove(e){return $e(this,void 0,void 0,function*(){try{return{data:yield Rl(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(ye(t))return{data:null,error:t};throw t}})}list(e,t,n){return $e(this,void 0,void 0,function*(){try{let i=Object.assign(Object.assign(Object.assign({},G1),t),{prefix:e||""});return{data:yield wt(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},n),error:null}}catch(i){if(ye(i))return{data:null,error:i};throw i}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer!="undefined"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){let t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}};var mT="2.7.1";var gT={"X-Client-Info":`storage-js/${mT}`};var ui=function(r,e,t,n){function i(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function l(f){try{h(n.next(f))}catch(m){a(m)}}function u(f){try{h(n.throw(f))}catch(m){a(m)}}function h(f){f.done?s(f.value):i(f.value).then(l,u)}h((n=n.apply(r,e||[])).next())})},Fs=class{constructor(e,t={},n){this.url=e,this.headers=Object.assign(Object.assign({},gT),t),this.fetch=Sl(n)}listBuckets(){return ui(this,void 0,void 0,function*(){try{return{data:yield li(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(ye(e))return{data:null,error:e};throw e}})}getBucket(e){return ui(this,void 0,void 0,function*(){try{return{data:yield li(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(ye(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return ui(this,void 0,void 0,function*(){try{return{data:yield wt(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(ye(n))return{data:null,error:n};throw n}})}updateBucket(e,t){return ui(this,void 0,void 0,function*(){try{return{data:yield dT(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(ye(n))return{data:null,error:n};throw n}})}emptyBucket(e){return ui(this,void 0,void 0,function*(){try{return{data:yield wt(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(ye(t))return{data:null,error:t};throw t}})}deleteBucket(e){return ui(this,void 0,void 0,function*(){try{return{data:yield Rl(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(ye(t))return{data:null,error:t};throw t}})}};var js=class extends Fs{constructor(e,t={},n){super(e,t,n)}from(e){return new Ms(this.url,this.headers,e,this.fetch)}};var yT="2.48.1";var Us="";typeof Deno!="undefined"?Us="deno":typeof document!="undefined"?Us="web":typeof navigator!="undefined"&&navigator.product==="ReactNative"?Us="react-native":Us="node";var K1={"X-Client-Info":`supabase-js-${Us}/${yT}`},_T={headers:K1},wT={schema:"public"},vT={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},bT={};mr();var H1=function(r,e,t,n){function i(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function l(f){try{h(n.next(f))}catch(m){a(m)}}function u(f){try{h(n.throw(f))}catch(m){a(m)}}function h(f){f.done?s(f.value):i(f.value).then(l,u)}h((n=n.apply(r,e||[])).next())})},W1=r=>{let e;return r?e=r:typeof fetch=="undefined"?e=Cd:e=fetch,(...t)=>e(...t)},Q1=()=>typeof Headers=="undefined"?kd:Headers,TT=(r,e,t)=>{let n=W1(t),i=Q1();return(s,a)=>H1(void 0,void 0,void 0,function*(){var l;let u=(l=yield e())!==null&&l!==void 0?l:r,h=new i(a==null?void 0:a.headers);return h.has("apikey")||h.set("apikey",r),h.has("Authorization")||h.set("Authorization",`Bearer ${u}`),n(s,Object.assign(Object.assign({},a),{headers:h}))})};var J1=function(r,e,t,n){function i(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function l(f){try{h(n.next(f))}catch(m){a(m)}}function u(f){try{h(n.throw(f))}catch(m){a(m)}}function h(f){f.done?s(f.value):i(f.value).then(l,u)}h((n=n.apply(r,e||[])).next())})};function ET(r){return r.replace(/\/$/,"")}function IT(r,e){let{db:t,auth:n,realtime:i,global:s}=r,{db:a,auth:l,realtime:u,global:h}=e,f={db:Object.assign(Object.assign({},a),t),auth:Object.assign(Object.assign({},l),n),realtime:Object.assign(Object.assign({},u),i),global:Object.assign(Object.assign({},h),s),accessToken:()=>J1(this,void 0,void 0,function*(){return""})};return r.accessToken?f.accessToken=r.accessToken:delete f.accessToken,f}var Pl="2.67.3";var AT="http://localhost:9999",xT="supabase.auth.token";var ST={"X-Client-Info":`gotrue-js/${Pl}`},Jd=10;var Bs="X-Supabase-Api-Version",Yd={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function RT(r){return Math.round(Date.now()/1e3)+r}function PT(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){let e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}var st=()=>typeof window!="undefined"&&typeof document!="undefined",Gr={tested:!1,writable:!1},yr=()=>{if(!st())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Gr.tested)return Gr.writable;let r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),Gr.tested=!0,Gr.writable=!0}catch{Gr.tested=!0,Gr.writable=!1}return Gr.writable};function CT(r){let e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((i,s)=>{e[s]=i})}catch{}return t.searchParams.forEach((n,i)=>{e[i]=n}),e}var Cl=r=>{let e;return r?e=r:typeof fetch=="undefined"?e=(...t)=>Promise.resolve().then(()=>(mr(),jr)).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},kT=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",Xd=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},qs=async(r,e)=>{let t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},zs=async(r,e)=>{await r.removeItem(e)};function Y1(r){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t="",n,i,s,a,l,u,h,f=0;for(r=r.replace("-","+").replace("_","/");f<r.length;)a=e.indexOf(r.charAt(f++)),l=e.indexOf(r.charAt(f++)),u=e.indexOf(r.charAt(f++)),h=e.indexOf(r.charAt(f++)),n=a<<2|l>>4,i=(l&15)<<4|u>>2,s=(u&3)<<6|h,t=t+String.fromCharCode(n),u!=64&&i!=0&&(t=t+String.fromCharCode(i)),h!=64&&s!=0&&(t=t+String.fromCharCode(s));return t}var $s=class r{constructor(){this.promise=new r.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}};$s.promiseConstructor=Promise;function Zd(r){let e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,t=r.split(".");if(t.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");let n=t[1];return JSON.parse(Y1(n))}async function DT(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function OT(r,e){return new Promise((n,i)=>{(async()=>{for(let s=0;s<1/0;s++)try{let a=await r(s);if(!e(s,null,a)){n(a);return}}catch(a){if(!e(s,a)){i(a);return}}})()})}function X1(r){return("0"+r.toString(16)).substr(-2)}function Z1(){let e=new Uint32Array(56);if(typeof crypto=="undefined"){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=t.length,i="";for(let s=0;s<56;s++)i+=t.charAt(Math.floor(Math.random()*n));return i}return crypto.getRandomValues(e),Array.from(e,X1).join("")}async function eO(r){let t=new TextEncoder().encode(r),n=await crypto.subtle.digest("SHA-256",t),i=new Uint8Array(n);return Array.from(i).map(s=>String.fromCharCode(s)).join("")}function tO(r){return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function rO(r){if(!(typeof crypto!="undefined"&&typeof crypto.subtle!="undefined"&&typeof TextEncoder!="undefined"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;let t=await eO(r);return tO(t)}async function Kr(r,e,t=!1){let n=Z1(),i=n;t&&(i+="/PASSWORD_RECOVERY"),await Xd(r,`${e}-code-verifier`,i);let s=await rO(n);return[s,n===s?"plain":"s256"]}var nO=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function NT(r){let e=r.headers.get(Bs);if(!e||!e.match(nO))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}var Gs=class extends Error{constructor(e,t,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=n}};function G(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}var kl=class extends Gs{constructor(e,t,n){super(e,t,n),this.name="AuthApiError",this.status=t,this.code=n}};function VT(r){return G(r)&&r.name==="AuthApiError"}var ci=class extends Gs{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}},jt=class extends Gs{constructor(e,t,n,i){super(e,n,i),this.name=t,this.status=n}},Ze=class extends jt{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}};function LT(r){return G(r)&&r.name==="AuthSessionMissingError"}var hi=class extends jt{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}},Hr=class extends jt{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}},Wr=class extends jt{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}};function MT(r){return G(r)&&r.name==="AuthImplicitGrantRedirectError"}var Ks=class extends jt{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}},di=class extends jt{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}};function Dl(r){return G(r)&&r.name==="AuthRetryableFetchError"}var Hs=class extends jt{constructor(e,t,n){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=n}};var iO=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t},Qr=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),sO=[502,503,504];async function FT(r){var e;if(!kT(r))throw new di(Qr(r),0);if(sO.includes(r.status))throw new di(Qr(r),r.status);let t;try{t=await r.json()}catch(s){throw new ci(Qr(s),s)}let n,i=NT(r);if(i&&i.getTime()>=Yd["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?n=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(n=t.error_code),n){if(n==="weak_password")throw new Hs(Qr(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(n==="session_not_found")throw new Ze}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((s,a)=>s&&typeof a=="string",!0))throw new Hs(Qr(t),r.status,t.weak_password.reasons);throw new kl(Qr(t),r.status||500,n)}var oO=(r,e,t,n)=>{let i={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),i.body=JSON.stringify(n),Object.assign(Object.assign({},i),t))};async function H(r,e,t,n){var i;let s=Object.assign({},n==null?void 0:n.headers);s[Bs]||(s[Bs]=Yd["2024-01-01"].name),n!=null&&n.jwt&&(s.Authorization=`Bearer ${n.jwt}`);let a=(i=n==null?void 0:n.query)!==null&&i!==void 0?i:{};n!=null&&n.redirectTo&&(a.redirect_to=n.redirectTo);let l=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",u=await aO(r,e,t+l,{headers:s,noResolveJson:n==null?void 0:n.noResolveJson},{},n==null?void 0:n.body);return n!=null&&n.xform?n==null?void 0:n.xform(u):{data:Object.assign({},u),error:null}}async function aO(r,e,t,n,i,s){let a=oO(e,n,i,s),l;try{l=await r(t,Object.assign({},a))}catch(u){throw console.error(u),new di(Qr(u),0)}if(l.ok||await FT(l),n!=null&&n.noResolveJson)return l;try{return await l.json()}catch(u){await FT(u)}}function Ut(r){var e;let t=null;lO(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=RT(r.expires_in)));let n=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:n},error:null}}function ef(r){let e=Ut(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,n)=>t&&typeof n=="string",!0)&&(e.data.weak_password=r.weak_password),e}function vt(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function jT(r){return{data:r,error:null}}function UT(r){let{action_link:e,email_otp:t,hashed_token:n,redirect_to:i,verification_type:s}=r,a=iO(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:e,email_otp:t,hashed_token:n,redirect_to:i,verification_type:s},u=Object.assign({},a);return{data:{properties:l,user:u},error:null}}function BT(r){return r}function lO(r){return r.access_token&&r.refresh_token&&r.expires_in}var uO=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t},Jr=class{constructor({url:e="",headers:t={},fetch:n}){this.url=e,this.headers=t,this.fetch=Cl(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await H(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(G(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,t={}){try{return await H(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:vt})}catch(n){if(G(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{let{options:t}=e,n=uO(e,["options"]),i=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(i.new_email=n==null?void 0:n.newEmail,delete i.newEmail),await H(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:UT,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(G(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await H(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:vt})}catch(t){if(G(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,n,i,s,a,l,u;try{let h={nextPage:null,lastPage:0,total:0},f=await H(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:"",per_page:(s=(i=e==null?void 0:e.perPage)===null||i===void 0?void 0:i.toString())!==null&&s!==void 0?s:""},xform:BT});if(f.error)throw f.error;let m=await f.json(),g=(a=f.headers.get("x-total-count"))!==null&&a!==void 0?a:0,I=(u=(l=f.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&u!==void 0?u:[];return I.length>0&&(I.forEach(C=>{let k=parseInt(C.split(";")[0].split("=")[1].substring(0,1)),P=JSON.parse(C.split(";")[1].split("=")[1]);h[`${P}Page`]=k}),h.total=parseInt(g)),{data:Object.assign(Object.assign({},m),h),error:null}}catch(h){if(G(h))return{data:{users:[]},error:h};throw h}}async getUserById(e){try{return await H(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:vt})}catch(t){if(G(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await H(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:vt})}catch(n){if(G(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,t=!1){try{return await H(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:vt})}catch(n){if(G(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){try{let{data:t,error:n}=await H(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:t,error:n}}catch(t){if(G(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await H(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(G(t))return{data:null,error:t};throw t}}};var $T={getItem:r=>yr()?globalThis.localStorage.getItem(r):null,setItem:(r,e)=>{yr()&&globalThis.localStorage.setItem(r,e)},removeItem:r=>{yr()&&globalThis.localStorage.removeItem(r)}};function tf(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}function qT(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self!="undefined"&&(self.globalThis=self)}}var Yr={debug:!!(globalThis&&yr()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")},Ws=class extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}},Ol=class extends Ws{};async function rf(r,e,t){Yr.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);let n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),Yr.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async i=>{if(i){Yr.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,i.name);try{return await t()}finally{Yr.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,i.name)}}else{if(e===0)throw Yr.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new Ol(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(Yr.debug)try{let s=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(s,null,"  "))}catch(s){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",s)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}qT();var cO={url:AT,storageKey:xT,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:ST,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1},Qs=30*1e3,zT=3;async function GT(r,e,t){return await t()}var Xr=class r{constructor(e){var t,n;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=r.nextInstanceID,r.nextInstanceID+=1,this.instanceID>0&&st()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");let i=Object.assign(Object.assign({},cO),e);if(this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new Jr({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=Cl(i.fetch),this.lock=i.lock||GT,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,i.lock?this.lock=i.lock:st()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=rf:this.lock=GT,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?i.storage?this.storage=i.storage:yr()?this.storage=$T:(this.memoryStorage={},this.storage=tf(this.memoryStorage)):(this.memoryStorage={},this.storage=tf(this.memoryStorage)),st()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async s=>{this._debug("received broadcast notification from other tab or client",s),await this._notifyAllSubscribers(s.data.event,s.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Pl}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let t=CT(window.location.href),n="none";if(this._isImplicitGrantCallback(t)?n="implicit":await this._isPKCECallback(t)&&(n="pkce"),st()&&this.detectSessionInUrl&&n!=="none"){let{data:i,error:s}=await this._getSessionFromURL(t,n);if(s){if(this._debug("#_initialize()","error detecting session from URL",s),MT(s)){let u=(e=s.details)===null||e===void 0?void 0:e.code;if(u==="identity_already_exists"||u==="identity_not_found"||u==="single_identity_not_deletable")return{error:s}}return await this._removeSession(),{error:s}}let{session:a,redirectType:l}=i;return this._debug("#_initialize()","detected session in URL",a,"redirect type",l),await this._saveSession(a),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return G(t)?{error:t}:{error:new ci("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,n,i;try{let s=await H(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(i=e==null?void 0:e.options)===null||i===void 0?void 0:i.captchaToken}},xform:Ut}),{data:a,error:l}=s;if(l||!a)return{data:{user:null,session:null},error:l};let u=a.session,h=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",u)),{data:{user:h,session:u},error:null}}catch(s){if(G(s))return{data:{user:null,session:null},error:s};throw s}}async signUp(e){var t,n,i;try{let s;if("email"in e){let{email:f,password:m,options:g}=e,I=null,C=null;this.flowType==="pkce"&&([I,C]=await Kr(this.storage,this.storageKey)),s=await H(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:g==null?void 0:g.emailRedirectTo,body:{email:f,password:m,data:(t=g==null?void 0:g.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:g==null?void 0:g.captchaToken},code_challenge:I,code_challenge_method:C},xform:Ut})}else if("phone"in e){let{phone:f,password:m,options:g}=e;s=await H(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:f,password:m,data:(n=g==null?void 0:g.data)!==null&&n!==void 0?n:{},channel:(i=g==null?void 0:g.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:g==null?void 0:g.captchaToken}},xform:Ut})}else throw new Hr("You must provide either an email or phone number and a password");let{data:a,error:l}=s;if(l||!a)return{data:{user:null,session:null},error:l};let u=a.session,h=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",u)),{data:{user:h,session:u},error:null}}catch(s){if(G(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithPassword(e){try{let t;if("email"in e){let{email:s,password:a,options:l}=e;t=await H(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:a,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:ef})}else if("phone"in e){let{phone:s,password:a,options:l}=e;t=await H(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:a,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:ef})}else throw new Hr("You must provide either an email or phone number and a password");let{data:n,error:i}=t;return i?{data:{user:null,session:null},error:i}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new hi}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:i})}catch(t){if(G(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,n,i,s;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(s=e.options)===null||s===void 0?void 0:s.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){let t=await qs(this.storage,`${this.storageKey}-code-verifier`),[n,i]=(t!=null?t:"").split("/");try{let{data:s,error:a}=await H(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:Ut});if(await zs(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return!s||!s.session||!s.user?{data:{user:null,session:null,redirectType:null},error:new hi}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign(Object.assign({},s),{redirectType:i!=null?i:null}),error:a})}catch(s){if(G(s))return{data:{user:null,session:null,redirectType:null},error:s};throw s}}async signInWithIdToken(e){try{let{options:t,provider:n,token:i,access_token:s,nonce:a}=e,l=await H(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:i,access_token:s,nonce:a,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:Ut}),{data:u,error:h}=l;return h?{data:{user:null,session:null},error:h}:!u||!u.session||!u.user?{data:{user:null,session:null},error:new hi}:(u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",u.session)),{data:u,error:h})}catch(t){if(G(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,n,i,s,a;try{if("email"in e){let{email:l,options:u}=e,h=null,f=null;this.flowType==="pkce"&&([h,f]=await Kr(this.storage,this.storageKey));let{error:m}=await H(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(t=u==null?void 0:u.data)!==null&&t!==void 0?t:{},create_user:(n=u==null?void 0:u.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken},code_challenge:h,code_challenge_method:f},redirectTo:u==null?void 0:u.emailRedirectTo});return{data:{user:null,session:null},error:m}}if("phone"in e){let{phone:l,options:u}=e,{data:h,error:f}=await H(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(i=u==null?void 0:u.data)!==null&&i!==void 0?i:{},create_user:(s=u==null?void 0:u.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken},channel:(a=u==null?void 0:u.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:h==null?void 0:h.message_id},error:f}}throw new Hr("You must provide either an email or phone number.")}catch(l){if(G(l))return{data:{user:null,session:null},error:l};throw l}}async verifyOtp(e){var t,n;try{let i,s;"options"in e&&(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo,s=(n=e.options)===null||n===void 0?void 0:n.captchaToken);let{data:a,error:l}=await H(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:s}}),redirectTo:i,xform:Ut});if(l)throw l;if(!a)throw new Error("An error occurred on token verification.");let u=a.session,h=a.user;return u!=null&&u.access_token&&(await this._saveSession(u),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",u)),{data:{user:h,session:u},error:null}}catch(i){if(G(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(e){var t,n,i;try{let s=null,a=null;return this.flowType==="pkce"&&([s,a]=await Kr(this.storage,this.storageKey)),await H(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&n!==void 0?n:void 0}),!((i=e==null?void 0:e.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:s,code_challenge_method:a}),headers:this.headers,xform:jT})}catch(s){if(G(s))return{data:null,error:s};throw s}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{let{data:{session:t},error:n}=e;if(n)throw n;if(!t)throw new Ze;let{error:i}=await H(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:i}})}catch(e){if(G(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{let t=`${this.url}/resend`;if("email"in e){let{email:n,type:i,options:s}=e,{error:a}=await H(this.fetch,"POST",t,{headers:this.headers,body:{email:n,type:i,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}},redirectTo:s==null?void 0:s.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){let{phone:n,type:i,options:s}=e,{data:a,error:l}=await H(this.fetch,"POST",t,{headers:this.headers,body:{phone:n,type:i,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}}});return{data:{user:null,session:null,messageId:a==null?void 0:a.message_id},error:l}}throw new Hr("You must provide either an email or phone number and a type")}catch(t){if(G(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){let n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await n,await t()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;let n=t();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){let i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{let t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null,t=await qs(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};let n=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.storage.isServer){let a=this.suppressGetSessionWarning;e=new Proxy(e,{get:(u,h,f)=>(!a&&h==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),a=!0,this.suppressGetSessionWarning=!0),Reflect.get(u,h,f))})}return{data:{session:e},error:null}}let{session:i,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{session:null},error:s}:{data:{session:i},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await H(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:vt}):await this._useSession(async t=>{var n,i,s;let{data:a,error:l}=t;if(l)throw l;return!(!((n=a.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Ze}:await H(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(s=(i=a.session)===null||i===void 0?void 0:i.access_token)!==null&&s!==void 0?s:void 0,xform:vt})})}catch(t){if(G(t))return LT(t)&&(await this._removeSession(),await zs(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async n=>{let{data:i,error:s}=n;if(s)throw s;if(!i.session)throw new Ze;let a=i.session,l=null,u=null;this.flowType==="pkce"&&e.email!=null&&([l,u]=await Kr(this.storage,this.storageKey));let{data:h,error:f}=await H(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:l,code_challenge_method:u}),jwt:a.access_token,xform:vt});if(f)throw f;return a.user=h.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(n){if(G(n))return{data:{user:null},error:n};throw n}}_decodeJWT(e){return Zd(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Ze;let t=Date.now()/1e3,n=t,i=!0,s=null,a=Zd(e.access_token);if(a.exp&&(n=a.exp,i=n<=t),i){let{session:l,error:u}=await this._callRefreshToken(e.refresh_token);if(u)return{data:{user:null,session:null},error:u};if(!l)return{data:{user:null,session:null},error:null};s=l}else{let{data:l,error:u}=await this._getUser(e.access_token);if(u)throw u;s={access_token:e.access_token,refresh_token:e.refresh_token,user:l.user,token_type:"bearer",expires_in:n-t,expires_at:n},await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)}return{data:{user:s.user,session:s},error:null}}catch(t){if(G(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var n;if(!e){let{data:a,error:l}=t;if(l)throw l;e=(n=a.session)!==null&&n!==void 0?n:void 0}if(!(e!=null&&e.refresh_token))throw new Ze;let{session:i,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{user:null,session:null},error:s}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(G(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!st())throw new Wr("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Wr(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Ks("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Wr("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Ks("No code detected.");let{data:F,error:B}=await this._exchangeCodeForSession(e.code);if(B)throw B;let K=new URL(window.location.href);return K.searchParams.delete("code"),window.history.replaceState(window.history.state,"",K.toString()),{data:{session:F.session,redirectType:null},error:null}}let{provider_token:n,provider_refresh_token:i,access_token:s,refresh_token:a,expires_in:l,expires_at:u,token_type:h}=e;if(!s||!l||!a||!h)throw new Wr("No session defined in URL");let f=Math.round(Date.now()/1e3),m=parseInt(l),g=f+m;u&&(g=parseInt(u));let I=g-f;I*1e3<=Qs&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${I}s, should have been closer to ${m}s`);let C=g-m;f-C>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",C,g,f):f-C<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",C,g,f);let{data:k,error:P}=await this._getUser(s);if(P)throw P;let V={provider_token:n,provider_refresh_token:i,access_token:s,expires_in:m,expires_at:g,refresh_token:a,token_type:h,user:k.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:V,redirectType:e.type},error:null}}catch(n){if(G(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){let t=await qs(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var n;let{data:i,error:s}=t;if(s)return{error:s};let a=(n=i.session)===null||n===void 0?void 0:n.access_token;if(a){let{error:l}=await this.admin.signOut(a,e);if(l&&!(VT(l)&&(l.status===404||l.status===401||l.status===403)))return{error:l}}return e!=="others"&&(await this._removeSession(),await zs(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){let t=PT(),n={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async t=>{var n,i;try{let{data:{session:s},error:a}=t;if(a)throw a;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(s){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}})}async resetPasswordForEmail(e,t={}){let n=null,i=null;this.flowType==="pkce"&&([n,i]=await Kr(this.storage,this.storageKey,!0));try{return await H(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:i,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(s){if(G(s))return{data:null,error:s};throw s}}async getUserIdentities(){var e;try{let{data:t,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(G(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{let{data:n,error:i}=await this._useSession(async s=>{var a,l,u,h,f;let{data:m,error:g}=s;if(g)throw g;let I=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(l=e.options)===null||l===void 0?void 0:l.scopes,queryParams:(u=e.options)===null||u===void 0?void 0:u.queryParams,skipBrowserRedirect:!0});return await H(this.fetch,"GET",I,{headers:this.headers,jwt:(f=(h=m.session)===null||h===void 0?void 0:h.access_token)!==null&&f!==void 0?f:void 0})});if(i)throw i;return st()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(n==null?void 0:n.url),{data:{provider:e.provider,url:n==null?void 0:n.url},error:null}}catch(n){if(G(n))return{data:{provider:e.provider,url:null},error:n};throw n}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var n,i;let{data:s,error:a}=t;if(a)throw a;return await H(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(n=s.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0})})}catch(t){if(G(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){let t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{let n=Date.now();return await OT(async i=>(i>0&&await DT(200*Math.pow(2,i-1)),this._debug(t,"refreshing attempt",i),await H(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Ut})),(i,s)=>{let a=200*Math.pow(2,i);return s&&Dl(s)&&Date.now()+a-n<Qs})}catch(n){if(this._debug(t,"error",n),G(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){let n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",n),st()&&!t.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e;let t="#_recoverAndRefresh()";this._debug(t,"begin");try{let n=await qs(this.storage,this.storageKey);if(this._debug(t,"session from storage",n),!this._isValidSession(n)){this._debug(t,"session is not valid"),n!==null&&await this._removeSession();return}let i=Math.round(Date.now()/1e3),s=((e=n.expires_at)!==null&&e!==void 0?e:1/0)<i+Jd;if(this._debug(t,`session has${s?"":" not"} expired with margin of ${Jd}s`),s){if(this.autoRefreshToken&&n.refresh_token){let{error:a}=await this._callRefreshToken(n.refresh_token);a&&(console.error(a),Dl(a)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(t,"error",n),console.error(n);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,n;if(!e)throw new Ze;if(this.refreshingDeferred)return this.refreshingDeferred.promise;let i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new $s;let{data:s,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!s.session)throw new Ze;await this._saveSession(s.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",s.session);let l={session:s.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(s){if(this._debug(i,"error",s),G(s)){let a={session:null,error:s};return Dl(s)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(a),a}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(s),s}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,t,n=!0){let i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",t,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:t});let s=[],a=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(e,t)}catch(u){s.push(u)}});if(await Promise.all(a),s.length>0){for(let l=0;l<s.length;l+=1)console.error(s[l]);throw s[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Xd(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await zs(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");let e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&st()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");let e=setInterval(()=>this._autoRefreshTokenTick(),Qs);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno!="undefined"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");let e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{let e=Date.now();try{return await this._useSession(async t=>{let{data:{session:n}}=t;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}let i=Math.floor((n.expires_at*1e3-e)/Qs);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${Qs}ms, refresh threshold is ${zT} ticks`),i<=zT&&await this._callRefreshToken(n.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Ws)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!st()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){let t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,n){let i=[`provider=${encodeURIComponent(t)}`];if(n!=null&&n.redirectTo&&i.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n!=null&&n.scopes&&i.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){let[s,a]=await Kr(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(s)}`,code_challenge_method:`${encodeURIComponent(a)}`});i.push(l.toString())}if(n!=null&&n.queryParams){let s=new URLSearchParams(n.queryParams);i.push(s.toString())}return n!=null&&n.skipBrowserRedirect&&i.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var n;let{data:i,error:s}=t;return s?{data:null,error:s}:await H(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=i==null?void 0:i.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(G(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var n,i;let{data:s,error:a}=t;if(a)return{data:null,error:a};let l=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:u,error:h}=await H(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token});return h?{data:null,error:h}:(e.factorType==="totp"&&(!((i=u==null?void 0:u.totp)===null||i===void 0)&&i.qr_code)&&(u.totp.qr_code=`data:image/svg+xml;utf-8,${u.totp.qr_code}`),{data:u,error:null})})}catch(t){if(G(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;let{data:i,error:s}=t;if(s)return{data:null,error:s};let{data:a,error:l}=await H(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(n=i==null?void 0:i.session)===null||n===void 0?void 0:n.access_token});return l?{data:null,error:l}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:l})})}catch(t){if(G(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;let{data:i,error:s}=t;return s?{data:null,error:s}:await H(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(n=i==null?void 0:i.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(G(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){let{data:t,error:n}=await this._challenge({factorId:e.factorId});return n?{data:null,error:n}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){let{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};let n=(e==null?void 0:e.factors)||[],i=n.filter(a=>a.factor_type==="totp"&&a.status==="verified"),s=n.filter(a=>a.factor_type==="phone"&&a.status==="verified");return{data:{all:n,totp:i,phone:s},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,n;let{data:{session:i},error:s}=e;if(s)return{data:null,error:s};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};let a=this._decodeJWT(i.access_token),l=null;a.aal&&(l=a.aal);let u=l;((n=(t=i.user.factors)===null||t===void 0?void 0:t.filter(m=>m.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(u="aal2");let f=a.amr||[];return{data:{currentLevel:l,nextLevel:u,currentAuthenticationMethods:f},error:null}}))}};Xr.nextInstanceID=0;var hO=Xr,nf=hO;var Nl=class extends nf{constructor(e){super(e)}};var dO=function(r,e,t,n){function i(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function l(f){try{h(n.next(f))}catch(m){a(m)}}function u(f){try{h(n.throw(f))}catch(m){a(m)}}function h(f){f.done?s(f.value):i(f.value).then(l,u)}h((n=n.apply(r,e||[])).next())})},Js=class{constructor(e,t,n){var i,s,a;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");let l=ET(e);this.realtimeUrl=`${l}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${l}/auth/v1`,this.storageUrl=`${l}/storage/v1`,this.functionsUrl=`${l}/functions/v1`;let u=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,h={db:wT,realtime:bT,auth:Object.assign(Object.assign({},vT),{storageKey:u}),global:_T},f=IT(n!=null?n:{},h);this.storageKey=(i=f.auth.storageKey)!==null&&i!==void 0?i:"",this.headers=(s=f.global.headers)!==null&&s!==void 0?s:{},f.accessToken?(this.accessToken=f.accessToken,this.auth=new Proxy({},{get:(m,g)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(g)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((a=f.auth)!==null&&a!==void 0?a:{},this.headers,f.global.fetch),this.fetch=TT(t,this._getAccessToken.bind(this),f.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},f.realtime)),this.rest=new nT(`${l}/rest/v1`,{headers:this.headers,schema:f.db.schema,fetch:this.fetch}),f.accessToken||this._listenForAuthEvents()}get functions(){return new Rs(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new js(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},n={}){return this.rest.rpc(e,t,n)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return dO(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();let{data:n}=yield this.auth.getSession();return(t=(e=n.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:i,storageKey:s,flowType:a,lock:l,debug:u},h,f){let m={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Nl({url:this.authUrl,headers:Object.assign(Object.assign({},m),h),storageKey:s,autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:i,flowType:a,lock:l,debug:u,fetch:f,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new oi(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,n)=>{this._handleTokenChanged(t,"CLIENT",n==null?void 0:n.access_token)})}_handleTokenChanged(e,t,n){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==n?this.changedAccessToken=n:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};var KT=(r,e,t)=>new Js(r,e,t);gf();var to=class{init(){}constructor(e,t){}};var ro=class extends to{constructor(){super(...arguments);ae(this,"syncros",{})}async init(t){let n={firebaseApiKey:null,firebaseAuthDomain:null,firebaseProjectId:null,firebaseAppId:null,supabaseUrl:null,supabaseKey:null,...await this.getCredentials(),...t},i=Object.keys(n).filter(s=>s===null);if(i.length>0)throw new Error("Firebase plugin requires mandatory options: "+i.join(", "));_e.firebase=fc({apiKey:n.firebaseApiKey,authDomain:n.firebaseAuthDomain,projectId:n.firebaseProjectId,appId:n.firebaseAppId}),_e.firestore=Cb(this.firebase),_e.supabase=KT(n.supabaseUrl,n.supabaseKey)}_mountNamespace(t){let n;return Promise.resolve().then(()=>this.requireProject()).then(i=>{let s=t=="_PROJECT"?`projects::${i.id}`:`project_namespaces::${i.id}::${t}`;return n=this.syncros[t]=new _e(s,{debug:(...a)=>this.debug(`SYNCRO://${s}`,...a),getReactive:this.getReactive}),n.mount()}).then(()=>{this.namespaces[t]=n.value})}_unmountNamespace(t){let n=this.syncros[t];return delete this.namespaces[t],delete this.syncros[t],n.destroy()}};var yf=class extends ro{constructor(){super(...arguments);ae(this,"Vue");ae(this,"project",null);ae(this,"reactiveId",1001)}async init(t){let n={app:null,Vue:null,globalName:"$tera",...t};if(!n.Vue)throw new Error("Vue instance to use must be specified in init options as `Vue`");if(this.Vue=n.Vue,!n.app)throw new Error("Vue Root / App instance to use must be specified in init options as `app`");this.app=n.app,n.globalName&&(this.Vue.prototype[n.globalName]=this),await super.init(n),this.project=await this.mountNamespace("_PROJECT")}getReactive(t){let n=this.Vue.observable(t),i=`_teraFy_${this.reactiveId++}`;return this.app[i]=n,{doc:n,setState(s){Object.entries(s||{}).filter(([a])=>!qu(n[a],s[a])).forEach(([a,l])=>n[a]=l)},getState(){return sr(n)},watch:s=>{this.app.$watch(i,s,{deep:!0})}}}};export{yf as default};
/*! Bundled license information:

lodash-es/lodash.js:
  (**
   * @license
   * Lodash (Custom Build) <https://lodash.com/>
   * Build: `lodash modularize exports="es" -o ./`
   * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
   * Released under MIT license <https://lodash.com/license>
   * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
   * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
   *)

@firebase/util/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/component/dist/esm/index.esm2017.js:
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/logger/dist/esm/index.esm2017.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/app/dist/esm/index.esm2017.js:
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2023 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/webchannel-wrapper/dist/bloom-blob/esm/bloom_blob_es2018.js:
  (** @license
  Copyright The Closure Library Authors.
  SPDX-License-Identifier: Apache-2.0
  *)
  (** @license
  
   Copyright The Closure Library Authors.
   SPDX-License-Identifier: Apache-2.0
  *)

@firebase/webchannel-wrapper/dist/webchannel-blob/esm/webchannel_blob_es2018.js:
  (** @license
  Copyright The Closure Library Authors.
  SPDX-License-Identifier: Apache-2.0
  *)
  (** @license
  
   Copyright The Closure Library Authors.
   SPDX-License-Identifier: Apache-2.0
  *)

@firebase/firestore/dist/index.esm2017.js:
  (**
  * @license
  * Copyright 2020 Google LLC
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
  * You may obtain a copy of the License at
  *
  *   http://www.apache.org/licenses/LICENSE-2.0
  *
  * Unless required by applicable law or agreed to in writing, software
  * distributed under the License is distributed on an "AS IS" BASIS,
  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  * See the License for the specific language governing permissions and
  * limitations under the License.
  *)
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2018 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2023 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law | agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

firebase/app/dist/esm/index.esm.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
*/
