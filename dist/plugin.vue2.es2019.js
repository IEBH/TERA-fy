var pr=Object.defineProperty;var ir=(t,e,r)=>e in t?pr(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var k=(t,e,r)=>ir(t,typeof e!="symbol"?e+"":e,r);var nr=typeof global=="object"&&global&&global.Object===Object&&global,H=nr;var ur=typeof self=="object"&&self&&self.Object===Object&&self,mr=H||ur||Function("return this")(),u=mr;var lr=u.Symbol,h=lr;var At=Object.prototype,dr=At.hasOwnProperty,cr=At.toString,K=h?h.toStringTag:void 0;function xr(t){var e=dr.call(t,K),r=t[K];try{t[K]=void 0;var o=!0}catch{}var f=cr.call(t);return o&&(e?t[K]=r:delete t[K]),f}var wt=xr;var gr=Object.prototype,hr=gr.toString;function br(t){return hr.call(t)}var St=br;var yr="[object Null]",jr="[object Undefined]",It=h?h.toStringTag:void 0;function vr(t){return t==null?t===void 0?jr:yr:It&&It in Object(t)?wt(t):St(t)}var x=vr;function Tr(t){return t!=null&&typeof t=="object"}var d=Tr;var Or=Array.isArray,C=Or;function _r(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var g=_r;var Ar="[object AsyncFunction]",wr="[object Function]",Sr="[object GeneratorFunction]",Ir="[object Proxy]";function Pr(t){if(!g(t))return!1;var e=x(t);return e==wr||e==Sr||e==Ar||e==Ir}var $=Pr;var Cr=u["__core-js_shared__"],J=Cr;var Pt=function(){var t=/[^.]+$/.exec(J&&J.keys&&J.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function Er(t){return!!Pt&&Pt in t}var Ct=Er;var Lr=Function.prototype,Br=Lr.toString;function Mr(t){if(t!=null){try{return Br.call(t)}catch{}try{return t+""}catch{}}return""}var b=Mr;var Fr=/[\\^$.*+?()[\]{}|]/g,Nr=/^\[object .+?Constructor\]$/,Dr=Function.prototype,Rr=Object.prototype,Ur=Dr.toString,Gr=Rr.hasOwnProperty,Vr=RegExp("^"+Ur.call(Gr).replace(Fr,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Wr(t){if(!g(t)||Ct(t))return!1;var e=$(t)?Vr:Nr;return e.test(b(t))}var Et=Wr;function Kr(t,e){return t==null?void 0:t[e]}var Lt=Kr;function zr(t,e){var r=Lt(t,e);return Et(r)?r:void 0}var l=zr;var qr=l(u,"WeakMap"),Y=qr;var Bt=Object.create,kr=function(){function t(){}return function(e){if(!g(e))return{};if(Bt)return Bt(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}(),Mt=kr;function Hr(t,e){var r=-1,o=t.length;for(e||(e=Array(o));++r<o;)e[r]=t[r];return e}var Ft=Hr;var $r=function(){try{var t=l(Object,"defineProperty");return t({},"",{}),t}catch{}}(),ct=$r;function Jr(t,e){for(var r=-1,o=t==null?0:t.length;++r<o&&e(t[r],r,t)!==!1;);return t}var Nt=Jr;var Yr=9007199254740991,Xr=/^(?:0|[1-9]\d*)$/;function Zr(t,e){var r=typeof t;return e=e==null?Yr:e,!!e&&(r=="number"||r!="symbol"&&Xr.test(t))&&t>-1&&t%1==0&&t<e}var Dt=Zr;function Qr(t,e,r){e=="__proto__"&&ct?ct(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}var X=Qr;function to(t,e){return t===e||t!==t&&e!==e}var Z=to;var eo=Object.prototype,ro=eo.hasOwnProperty;function oo(t,e,r){var o=t[e];(!(ro.call(t,e)&&Z(o,r))||r===void 0&&!(e in t))&&X(t,e,r)}var Q=oo;function ao(t,e,r,o){var f=!r;r||(r={});for(var a=-1,s=e.length;++a<s;){var n=e[a],m=o?o(r[n],t[n],n,r,t):void 0;m===void 0&&(m=t[n]),f?X(r,n,m):Q(r,n,m)}return r}var T=ao;var fo=9007199254740991;function so(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=fo}var tt=so;function po(t){return t!=null&&tt(t.length)&&!$(t)}var et=po;var io=Object.prototype;function no(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||io;return t===r}var E=no;function uo(t,e){for(var r=-1,o=Array(t);++r<t;)o[r]=e(r);return o}var Rt=uo;var mo="[object Arguments]";function lo(t){return d(t)&&x(t)==mo}var xt=lo;var Ut=Object.prototype,co=Ut.hasOwnProperty,xo=Ut.propertyIsEnumerable,go=xt(function(){return arguments}())?xt:function(t){return d(t)&&co.call(t,"callee")&&!xo.call(t,"callee")},Gt=go;function ho(){return!1}var Vt=ho;var zt=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Wt=zt&&typeof module=="object"&&module&&!module.nodeType&&module,bo=Wt&&Wt.exports===zt,Kt=bo?u.Buffer:void 0,yo=Kt?Kt.isBuffer:void 0,jo=yo||Vt,rt=jo;var vo="[object Arguments]",To="[object Array]",Oo="[object Boolean]",_o="[object Date]",Ao="[object Error]",wo="[object Function]",So="[object Map]",Io="[object Number]",Po="[object Object]",Co="[object RegExp]",Eo="[object Set]",Lo="[object String]",Bo="[object WeakMap]",Mo="[object ArrayBuffer]",Fo="[object DataView]",No="[object Float32Array]",Do="[object Float64Array]",Ro="[object Int8Array]",Uo="[object Int16Array]",Go="[object Int32Array]",Vo="[object Uint8Array]",Wo="[object Uint8ClampedArray]",Ko="[object Uint16Array]",zo="[object Uint32Array]",i={};i[No]=i[Do]=i[Ro]=i[Uo]=i[Go]=i[Vo]=i[Wo]=i[Ko]=i[zo]=!0;i[vo]=i[To]=i[Mo]=i[Oo]=i[Fo]=i[_o]=i[Ao]=i[wo]=i[So]=i[Io]=i[Po]=i[Co]=i[Eo]=i[Lo]=i[Bo]=!1;function qo(t){return d(t)&&tt(t.length)&&!!i[x(t)]}var qt=qo;function ko(t){return function(e){return t(e)}}var L=ko;var kt=typeof exports=="object"&&exports&&!exports.nodeType&&exports,z=kt&&typeof module=="object"&&module&&!module.nodeType&&module,Ho=z&&z.exports===kt,gt=Ho&&H.process,$o=function(){try{var t=z&&z.require&&z.require("util").types;return t||gt&&gt.binding&&gt.binding("util")}catch{}}(),y=$o;var Ht=y&&y.isTypedArray,Jo=Ht?L(Ht):qt,$t=Jo;var Yo=Object.prototype,Xo=Yo.hasOwnProperty;function Zo(t,e){var r=C(t),o=!r&&Gt(t),f=!r&&!o&&rt(t),a=!r&&!o&&!f&&$t(t),s=r||o||f||a,n=s?Rt(t.length,String):[],m=n.length;for(var c in t)(e||Xo.call(t,c))&&!(s&&(c=="length"||f&&(c=="offset"||c=="parent")||a&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||Dt(c,m)))&&n.push(c);return n}var ot=Zo;function Qo(t,e){return function(r){return t(e(r))}}var at=Qo;var ta=at(Object.keys,Object),Jt=ta;var ea=Object.prototype,ra=ea.hasOwnProperty;function oa(t){if(!E(t))return Jt(t);var e=[];for(var r in Object(t))ra.call(t,r)&&r!="constructor"&&e.push(r);return e}var Yt=oa;function aa(t){return et(t)?ot(t):Yt(t)}var B=aa;function fa(t){var e=[];if(t!=null)for(var r in Object(t))e.push(r);return e}var Xt=fa;var sa=Object.prototype,pa=sa.hasOwnProperty;function ia(t){if(!g(t))return Xt(t);var e=E(t),r=[];for(var o in t)o=="constructor"&&(e||!pa.call(t,o))||r.push(o);return r}var Zt=ia;function na(t){return et(t)?ot(t,!0):Zt(t)}var M=na;var ua=l(Object,"create"),j=ua;function ma(){this.__data__=j?j(null):{},this.size=0}var Qt=ma;function la(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var te=la;var da="__lodash_hash_undefined__",ca=Object.prototype,xa=ca.hasOwnProperty;function ga(t){var e=this.__data__;if(j){var r=e[t];return r===da?void 0:r}return xa.call(e,t)?e[t]:void 0}var ee=ga;var ha=Object.prototype,ba=ha.hasOwnProperty;function ya(t){var e=this.__data__;return j?e[t]!==void 0:ba.call(e,t)}var re=ya;var ja="__lodash_hash_undefined__";function va(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=j&&e===void 0?ja:e,this}var oe=va;function F(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}F.prototype.clear=Qt;F.prototype.delete=te;F.prototype.get=ee;F.prototype.has=re;F.prototype.set=oe;var ht=F;function Ta(){this.__data__=[],this.size=0}var ae=Ta;function Oa(t,e){for(var r=t.length;r--;)if(Z(t[r][0],e))return r;return-1}var O=Oa;var _a=Array.prototype,Aa=_a.splice;function wa(t){var e=this.__data__,r=O(e,t);if(r<0)return!1;var o=e.length-1;return r==o?e.pop():Aa.call(e,r,1),--this.size,!0}var fe=wa;function Sa(t){var e=this.__data__,r=O(e,t);return r<0?void 0:e[r][1]}var se=Sa;function Ia(t){return O(this.__data__,t)>-1}var pe=Ia;function Pa(t,e){var r=this.__data__,o=O(r,t);return o<0?(++this.size,r.push([t,e])):r[o][1]=e,this}var ie=Pa;function N(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}N.prototype.clear=ae;N.prototype.delete=fe;N.prototype.get=se;N.prototype.has=pe;N.prototype.set=ie;var _=N;var Ca=l(u,"Map"),A=Ca;function Ea(){this.size=0,this.__data__={hash:new ht,map:new(A||_),string:new ht}}var ne=Ea;function La(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}var ue=La;function Ba(t,e){var r=t.__data__;return ue(e)?r[typeof e=="string"?"string":"hash"]:r.map}var w=Ba;function Ma(t){var e=w(this,t).delete(t);return this.size-=e?1:0,e}var me=Ma;function Fa(t){return w(this,t).get(t)}var le=Fa;function Na(t){return w(this,t).has(t)}var de=Na;function Da(t,e){var r=w(this,t),o=r.size;return r.set(t,e),this.size+=r.size==o?0:1,this}var ce=Da;function D(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}D.prototype.clear=ne;D.prototype.delete=me;D.prototype.get=le;D.prototype.has=de;D.prototype.set=ce;var xe=D;function Ra(t,e){for(var r=-1,o=e.length,f=t.length;++r<o;)t[f+r]=e[r];return t}var ft=Ra;var Ua=at(Object.getPrototypeOf,Object),R=Ua;var Ga="[object Object]",Va=Function.prototype,Wa=Object.prototype,ge=Va.toString,Ka=Wa.hasOwnProperty,za=ge.call(Object);function qa(t){if(!d(t)||x(t)!=Ga)return!1;var e=R(t);if(e===null)return!0;var r=Ka.call(e,"constructor")&&e.constructor;return typeof r=="function"&&r instanceof r&&ge.call(r)==za}var bt=qa;function ka(){this.__data__=new _,this.size=0}var he=ka;function Ha(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}var be=Ha;function $a(t){return this.__data__.get(t)}var ye=$a;function Ja(t){return this.__data__.has(t)}var je=Ja;var Ya=200;function Xa(t,e){var r=this.__data__;if(r instanceof _){var o=r.__data__;if(!A||o.length<Ya-1)return o.push([t,e]),this.size=++r.size,this;r=this.__data__=new xe(o)}return r.set(t,e),this.size=r.size,this}var ve=Xa;function U(t){var e=this.__data__=new _(t);this.size=e.size}U.prototype.clear=he;U.prototype.delete=be;U.prototype.get=ye;U.prototype.has=je;U.prototype.set=ve;var Te=U;function Za(t,e){return t&&T(e,B(e),t)}var Oe=Za;function Qa(t,e){return t&&T(e,M(e),t)}var _e=Qa;var Ie=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Ae=Ie&&typeof module=="object"&&module&&!module.nodeType&&module,tf=Ae&&Ae.exports===Ie,we=tf?u.Buffer:void 0,Se=we?we.allocUnsafe:void 0;function ef(t,e){if(e)return t.slice();var r=t.length,o=Se?Se(r):new t.constructor(r);return t.copy(o),o}var Pe=ef;function rf(t,e){for(var r=-1,o=t==null?0:t.length,f=0,a=[];++r<o;){var s=t[r];e(s,r,t)&&(a[f++]=s)}return a}var Ce=rf;function of(){return[]}var st=of;var af=Object.prototype,ff=af.propertyIsEnumerable,Ee=Object.getOwnPropertySymbols,sf=Ee?function(t){return t==null?[]:(t=Object(t),Ce(Ee(t),function(e){return ff.call(t,e)}))}:st,G=sf;function pf(t,e){return T(t,G(t),e)}var Le=pf;var nf=Object.getOwnPropertySymbols,uf=nf?function(t){for(var e=[];t;)ft(e,G(t)),t=R(t);return e}:st,pt=uf;function mf(t,e){return T(t,pt(t),e)}var Be=mf;function lf(t,e,r){var o=e(t);return C(t)?o:ft(o,r(t))}var it=lf;function df(t){return it(t,B,G)}var Me=df;function cf(t){return it(t,M,pt)}var Fe=cf;var xf=l(u,"DataView"),nt=xf;var gf=l(u,"Promise"),ut=gf;var hf=l(u,"Set"),mt=hf;var Ne="[object Map]",bf="[object Object]",De="[object Promise]",Re="[object Set]",Ue="[object WeakMap]",Ge="[object DataView]",yf=b(nt),jf=b(A),vf=b(ut),Tf=b(mt),Of=b(Y),I=x;(nt&&I(new nt(new ArrayBuffer(1)))!=Ge||A&&I(new A)!=Ne||ut&&I(ut.resolve())!=De||mt&&I(new mt)!=Re||Y&&I(new Y)!=Ue)&&(I=function(t){var e=x(t),r=e==bf?t.constructor:void 0,o=r?b(r):"";if(o)switch(o){case yf:return Ge;case jf:return Ne;case vf:return De;case Tf:return Re;case Of:return Ue}return e});var V=I;var _f=Object.prototype,Af=_f.hasOwnProperty;function wf(t){var e=t.length,r=new t.constructor(e);return e&&typeof t[0]=="string"&&Af.call(t,"index")&&(r.index=t.index,r.input=t.input),r}var Ve=wf;var Sf=u.Uint8Array,yt=Sf;function If(t){var e=new t.constructor(t.byteLength);return new yt(e).set(new yt(t)),e}var W=If;function Pf(t,e){var r=e?W(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}var We=Pf;var Cf=/\w*$/;function Ef(t){var e=new t.constructor(t.source,Cf.exec(t));return e.lastIndex=t.lastIndex,e}var Ke=Ef;var ze=h?h.prototype:void 0,qe=ze?ze.valueOf:void 0;function Lf(t){return qe?Object(qe.call(t)):{}}var ke=Lf;function Bf(t,e){var r=e?W(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}var He=Bf;var Mf="[object Boolean]",Ff="[object Date]",Nf="[object Map]",Df="[object Number]",Rf="[object RegExp]",Uf="[object Set]",Gf="[object String]",Vf="[object Symbol]",Wf="[object ArrayBuffer]",Kf="[object DataView]",zf="[object Float32Array]",qf="[object Float64Array]",kf="[object Int8Array]",Hf="[object Int16Array]",$f="[object Int32Array]",Jf="[object Uint8Array]",Yf="[object Uint8ClampedArray]",Xf="[object Uint16Array]",Zf="[object Uint32Array]";function Qf(t,e,r){var o=t.constructor;switch(e){case Wf:return W(t);case Mf:case Ff:return new o(+t);case Kf:return We(t,r);case zf:case qf:case kf:case Hf:case $f:case Jf:case Yf:case Xf:case Zf:return He(t,r);case Nf:return new o;case Df:case Gf:return new o(t);case Rf:return Ke(t);case Uf:return new o;case Vf:return ke(t)}}var $e=Qf;function ts(t){return typeof t.constructor=="function"&&!E(t)?Mt(R(t)):{}}var Je=ts;var es="[object Map]";function rs(t){return d(t)&&V(t)==es}var Ye=rs;var Xe=y&&y.isMap,os=Xe?L(Xe):Ye,Ze=os;var as="[object Set]";function fs(t){return d(t)&&V(t)==as}var Qe=fs;var tr=y&&y.isSet,ss=tr?L(tr):Qe,er=ss;var ps=1,is=2,ns=4,rr="[object Arguments]",us="[object Array]",ms="[object Boolean]",ls="[object Date]",ds="[object Error]",or="[object Function]",cs="[object GeneratorFunction]",xs="[object Map]",gs="[object Number]",ar="[object Object]",hs="[object RegExp]",bs="[object Set]",ys="[object String]",js="[object Symbol]",vs="[object WeakMap]",Ts="[object ArrayBuffer]",Os="[object DataView]",_s="[object Float32Array]",As="[object Float64Array]",ws="[object Int8Array]",Ss="[object Int16Array]",Is="[object Int32Array]",Ps="[object Uint8Array]",Cs="[object Uint8ClampedArray]",Es="[object Uint16Array]",Ls="[object Uint32Array]",p={};p[rr]=p[us]=p[Ts]=p[Os]=p[ms]=p[ls]=p[_s]=p[As]=p[ws]=p[Ss]=p[Is]=p[xs]=p[gs]=p[ar]=p[hs]=p[bs]=p[ys]=p[js]=p[Ps]=p[Cs]=p[Es]=p[Ls]=!0;p[ds]=p[or]=p[vs]=!1;function lt(t,e,r,o,f,a){var s,n=e&ps,m=e&is,c=e&ns;if(r&&(s=f?r(t,o,f,a):r(t)),s!==void 0)return s;if(!g(t))return t;var vt=C(t);if(vt){if(s=Ve(t),!n)return Ft(t,s)}else{var P=V(t),Tt=P==or||P==cs;if(rt(t))return Pe(t,n);if(P==ar||P==rr||Tt&&!f){if(s=m||Tt?{}:Je(t),!n)return m?Be(t,_e(s,t)):Le(t,Oe(s,t))}else{if(!p[P])return f?t:{};s=$e(t,P,n)}}a||(a=new Te);var Ot=a.get(t);if(Ot)return Ot;a.set(t,s),er(t)?t.forEach(function(v){s.add(lt(v,e,r,v,t,a))}):Ze(t)&&t.forEach(function(v,S){s.set(S,lt(v,e,r,S,t,a))});var sr=c?m?Fe:Me:m?M:B,_t=vt?void 0:sr(t);return Nt(_t||t,function(v,S){_t&&(S=v,v=t[S]),Q(s,S,lt(v,e,r,S,t,a))}),s}var fr=lt;var Bs=1,Ms=4;function Fs(t){return fr(t,Bs|Ms)}var dt=Fs;var q=class{init(){}constructor(e,r){}};var jt=class extends q{constructor(){super(...arguments);k(this,"Vue");k(this,"projects");k(this,"state",null)}bindProjectState(r){let o={component:null,componentKey:null,autoRequire:!0,write:!0,...r};return Promise.resolve().then(()=>Promise.all([this.getProjectState({autoRequire:o.autoRequire}),(()=>{if(!o.componentKey){for(let f=0;f<50;f++){let a=`terafy_${f}`;if(!Object.hasOwnProperty(o.component,a)){o.componentKey=a;return}}throw new Error("Unable to find unique key to allocate against Vue2 component")}})()])).then(([f])=>{this.debug("INFO",2,"Got project snapshot",f);let a=this.Vue.observable(f);o.component[o.componentKey]=a;let s=0;if(o.read&&this.events.on(`update:projects/${a.id}`,n=>{s++,this.debug("INFO",5,"Update Vue2 Remote->Local",{new:n,old:a}),this.merge(a,n)}),o.write){if(!o.component)throw new Error("bindProjectState requires a VueComponent specified as `component`");let n=dt(f);o.component.$watch(o.componentKey,m=>{if(s>0){s--;return}this.debug("INFO",5,"Update Vue2 Local->Remote",{new:m,old:n}),this.createProjectStatePatch(m,n),n=dt(f)},{deep:!0})}return a})}merge(r,...o){return o.forEach(f=>Object.keys(f).forEach(a=>{bt(f[a])?(a in r||this.Vue.set(r,a,{}),this.merge(r[a],f[a])):this.Vue.set(r,a,f[a])})),r}init(r){let o={app:null,Vue:null,globalName:"$tera",requireProject:!0,subscribeState:!0,subscribeProjects:!0,stateOptions:{read:!0,write:!0},...r};if(!o.Vue)throw new Error("Vue instance to use must be specified in init options as `Vue`");if(this.Vue=r.Vue,!this.settings.app)throw new Error("Need to specify the root level Vue2 app during init");return o.stateOptions.app=this.settings.app,this.projects=this.Vue.observable([]),o.globalName&&(this.Vue.prototype[o.globalName]=this),this.state=null,Promise.resolve().then(()=>o.requireProject&&this.requireProject()).then(()=>Promise.all([o.subscribeState&&this.bindProjectState({...o.stateOptions,component:this.settings.app.$root}).then(f=>this.state=f).then(()=>this.debug("INFO",1,"Loaded initial project state",this.state)),o.subscribeProjects&&this.getProjects().then(f=>this.projects=this.Vue.observable(f)).then(()=>this.debug("INFO",2,"Loaded project list",this.projects))])).then(()=>this.debug("INFO",1,"Ready"))}};export{jt as default};
/*! Bundled license information:

lodash-es/lodash.js:
  (**
   * @license
   * Lodash (Custom Build) <https://lodash.com/>
   * Build: `lodash modularize exports="es" -o ./`
   * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
   * Released under MIT license <https://lodash.com/license>
   * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
   * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
   *)
*/
