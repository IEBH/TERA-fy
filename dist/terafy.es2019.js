var bo=Object.defineProperty;var vo=(t,e,r)=>e in t?bo(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var c=(t,e,r)=>(vo(t,typeof e!="symbol"?e+"":e,r),r),Jt=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)};var lt=(t,e,r)=>(Jt(t,e,"read from private field"),r?r.call(t):e.get(t)),Xt=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},Qt=(t,e,r,o)=>(Jt(t,e,"write to private field"),o?o.call(t,r):e.set(t,r),r);function te(t,e,r){if(!t||typeof t!="object"||!e||typeof e!="object")throw new Error("both arguments must be objects or arrays");r||(r=function(i){return i});function o({obj1:i,obj2:f,basePath:m,basePathForRemoves:x,diffs:v}){var j=Object.keys(i),O=j.length,y=Object.keys(f),_=y.length,b,p=i.length-f.length;if(To(i,f)){for(var u=0;u<O;u++){var l=Array.isArray(i)?Number(j[u]):j[u];l in f||(b=x.concat(l),v.remove.push({op:"remove",path:r(b)}))}for(var u=0;u<_;u++){var l=Array.isArray(f)?Number(y[u]):y[u];s({key:l,obj1:i,obj2:f,path:m.concat(l),pathForRemoves:m.concat(l),diffs:v})}}else{for(var u=0;u<p;u++)b=x.concat(u),v.remove.push({op:"remove",path:r(b)});for(var E=i.slice(p),u=0;u<_;u++)s({key:u,obj1:E,obj2:f,path:m.concat(u),pathForRemoves:m.concat(u+p),diffs:v})}}var a={remove:[],replace:[],add:[]};return o({obj1:t,obj2:e,basePath:[],basePathForRemoves:[],diffs:a}),a.remove.reverse().concat(a.replace).concat(a.add);function s({key:i,obj1:f,obj2:m,path:x,pathForRemoves:v,diffs:j}){var O=f[i],y=m[i];if(!(i in f)&&i in m){var _=y;j.add.push({op:"add",path:r(x),value:_})}else O!==y&&(Object(O)!==O||Object(y)!==y||wo(O,y)||!Object.keys(O).length&&!Object.keys(y).length&&String(O)!=String(y)?n(x,j,y):o({obj1:f[i],obj2:m[i],basePath:x,basePathForRemoves:v,diffs:j}))}function n(i,f,m){f.replace.push({op:"replace",path:r(i),value:m})}}function ee(t){return[""].concat(t).join("/")}function wo(t,e){return Object.prototype.toString.call(t)!=Object.prototype.toString.call(e)}function To(t,e){var r=t.length-e.length;if(Array.isArray(t)&&Array.isArray(e)&&r>0){for(var o=0,a=0,s=0;s<e.length&&String(t[s])===String(e[s]);s++)o++;for(var n=e.length;n>0&&String(t[n+r])===String(e[n]);n--)a++;return o>=a}return!0}var Oo=typeof global=="object"&&global&&global.Object===Object&&global,ht=Oo;var So=typeof self=="object"&&self&&self.Object===Object&&self,jo=ht||So||Function("return this")(),g=jo;var Ao=g.Symbol,T=Ao;var re=Object.prototype,Po=re.hasOwnProperty,Io=re.toString,mt=T?T.toStringTag:void 0;function _o(t){var e=Po.call(t,mt),r=t[mt];try{t[mt]=void 0;var o=!0}catch{}var a=Io.call(t);return o&&(e?t[mt]=r:delete t[mt]),a}var oe=_o;var Eo=Object.prototype,Co=Eo.toString;function Fo(t){return Co.call(t)}var ae=Fo;var Mo="[object Null]",No="[object Undefined]",ie=T?T.toStringTag:void 0;function Ro(t){return t==null?t===void 0?No:Mo:ie&&ie in Object(t)?oe(t):ae(t)}var I=Ro;function Bo(t){return t!=null&&typeof t=="object"}var P=Bo;var Lo="[object Symbol]";function Do(t){return typeof t=="symbol"||P(t)&&I(t)==Lo}var G=Do;function Uo(t,e){for(var r=-1,o=t==null?0:t.length,a=Array(o);++r<o;)a[r]=e(t[r],r,t);return a}var se=Uo;var ko=Array.isArray,w=ko;var zo=1/0,ne=T?T.prototype:void 0,fe=ne?ne.toString:void 0;function pe(t){if(typeof t=="string")return t;if(w(t))return se(t,pe)+"";if(G(t))return fe?fe.call(t):"";var e=t+"";return e=="0"&&1/t==-zo?"-0":e}var le=pe;function Ko(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var A=Ko;function Go(t){return t}var me=Go;var Wo="[object AsyncFunction]",$o="[object Function]",Ho="[object GeneratorFunction]",qo="[object Proxy]";function Yo(t){if(!A(t))return!1;var e=I(t);return e==$o||e==Ho||e==Wo||e==qo}var xt=Yo;var Vo=g["__core-js_shared__"],gt=Vo;var ue=function(){var t=/[^.]+$/.exec(gt&&gt.keys&&gt.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function Zo(t){return!!ue&&ue in t}var de=Zo;var Jo=Function.prototype,Xo=Jo.toString;function Qo(t){if(t!=null){try{return Xo.call(t)}catch{}try{return t+""}catch{}}return""}var C=Qo;var ta=/[\\^$.*+?()[\]{}|]/g,ea=/^\[object .+?Constructor\]$/,ra=Function.prototype,oa=Object.prototype,aa=ra.toString,ia=oa.hasOwnProperty,sa=RegExp("^"+aa.call(ia).replace(ta,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function na(t){if(!A(t)||de(t))return!1;var e=xt(t)?sa:ea;return e.test(C(t))}var ce=na;function fa(t,e){return t==null?void 0:t[e]}var he=fa;function pa(t,e){var r=he(t,e);return ce(r)?r:void 0}var S=pa;var la=S(g,"WeakMap"),yt=la;var xe=Object.create,ma=function(){function t(){}return function(e){if(!A(e))return{};if(xe)return xe(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}(),ge=ma;function ua(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}var ye=ua;function da(t,e){var r=-1,o=t.length;for(e||(e=Array(o));++r<o;)e[r]=t[r];return e}var be=da;var ca=800,ha=16,xa=Date.now;function ga(t){var e=0,r=0;return function(){var o=xa(),a=ha-(o-r);if(r=o,a>0){if(++e>=ca)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}var ve=ga;function ya(t){return function(){return t}}var we=ya;var ba=function(){try{var t=S(Object,"defineProperty");return t({},"",{}),t}catch{}}(),W=ba;var va=W?function(t,e){return W(t,"toString",{configurable:!0,enumerable:!1,value:we(e),writable:!0})}:me,Te=va;var wa=ve(Te),Oe=wa;function Ta(t,e){for(var r=-1,o=t==null?0:t.length;++r<o&&e(t[r],r,t)!==!1;);return t}var Se=Ta;var Oa=9007199254740991,Sa=/^(?:0|[1-9]\d*)$/;function ja(t,e){var r=typeof t;return e=e==null?Oa:e,!!e&&(r=="number"||r!="symbol"&&Sa.test(t))&&t>-1&&t%1==0&&t<e}var $=ja;function Aa(t,e,r){e=="__proto__"&&W?W(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}var bt=Aa;function Pa(t,e){return t===e||t!==t&&e!==e}var vt=Pa;var Ia=Object.prototype,_a=Ia.hasOwnProperty;function Ea(t,e,r){var o=t[e];(!(_a.call(t,e)&&vt(o,r))||r===void 0&&!(e in t))&&bt(t,e,r)}var H=Ea;function Ca(t,e,r,o){var a=!r;r||(r={});for(var s=-1,n=e.length;++s<n;){var i=e[s],f=o?o(r[i],t[i],i,r,t):void 0;f===void 0&&(f=t[i]),a?bt(r,i,f):H(r,i,f)}return r}var N=Ca;var je=Math.max;function Fa(t,e,r){return e=je(e===void 0?t.length-1:e,0),function(){for(var o=arguments,a=-1,s=je(o.length-e,0),n=Array(s);++a<s;)n[a]=o[e+a];a=-1;for(var i=Array(e+1);++a<e;)i[a]=o[a];return i[e]=r(n),ye(t,this,i)}}var Ae=Fa;var Ma=9007199254740991;function Na(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=Ma}var q=Na;function Ra(t){return t!=null&&q(t.length)&&!xt(t)}var wt=Ra;var Ba=Object.prototype;function La(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||Ba;return t===r}var Y=La;function Da(t,e){for(var r=-1,o=Array(t);++r<t;)o[r]=e(r);return o}var Pe=Da;var Ua="[object Arguments]";function ka(t){return P(t)&&I(t)==Ua}var Rt=ka;var Ie=Object.prototype,za=Ie.hasOwnProperty,Ka=Ie.propertyIsEnumerable,Ga=Rt(function(){return arguments}())?Rt:function(t){return P(t)&&za.call(t,"callee")&&!Ka.call(t,"callee")},V=Ga;function Wa(){return!1}var _e=Wa;var Fe=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Ee=Fe&&typeof module=="object"&&module&&!module.nodeType&&module,$a=Ee&&Ee.exports===Fe,Ce=$a?g.Buffer:void 0,Ha=Ce?Ce.isBuffer:void 0,qa=Ha||_e,Tt=qa;var Ya="[object Arguments]",Va="[object Array]",Za="[object Boolean]",Ja="[object Date]",Xa="[object Error]",Qa="[object Function]",ti="[object Map]",ei="[object Number]",ri="[object Object]",oi="[object RegExp]",ai="[object Set]",ii="[object String]",si="[object WeakMap]",ni="[object ArrayBuffer]",fi="[object DataView]",pi="[object Float32Array]",li="[object Float64Array]",mi="[object Int8Array]",ui="[object Int16Array]",di="[object Int32Array]",ci="[object Uint8Array]",hi="[object Uint8ClampedArray]",xi="[object Uint16Array]",gi="[object Uint32Array]",h={};h[pi]=h[li]=h[mi]=h[ui]=h[di]=h[ci]=h[hi]=h[xi]=h[gi]=!0;h[Ya]=h[Va]=h[ni]=h[Za]=h[fi]=h[Ja]=h[Xa]=h[Qa]=h[ti]=h[ei]=h[ri]=h[oi]=h[ai]=h[ii]=h[si]=!1;function yi(t){return P(t)&&q(t.length)&&!!h[I(t)]}var Me=yi;function bi(t){return function(e){return t(e)}}var Z=bi;var Ne=typeof exports=="object"&&exports&&!exports.nodeType&&exports,ut=Ne&&typeof module=="object"&&module&&!module.nodeType&&module,vi=ut&&ut.exports===Ne,Bt=vi&&ht.process,wi=function(){try{var t=ut&&ut.require&&ut.require("util").types;return t||Bt&&Bt.binding&&Bt.binding("util")}catch{}}(),F=wi;var Re=F&&F.isTypedArray,Ti=Re?Z(Re):Me,Be=Ti;var Oi=Object.prototype,Si=Oi.hasOwnProperty;function ji(t,e){var r=w(t),o=!r&&V(t),a=!r&&!o&&Tt(t),s=!r&&!o&&!a&&Be(t),n=r||o||a||s,i=n?Pe(t.length,String):[],f=i.length;for(var m in t)(e||Si.call(t,m))&&!(n&&(m=="length"||a&&(m=="offset"||m=="parent")||s&&(m=="buffer"||m=="byteLength"||m=="byteOffset")||$(m,f)))&&i.push(m);return i}var Ot=ji;function Ai(t,e){return function(r){return t(e(r))}}var St=Ai;var Pi=St(Object.keys,Object),Le=Pi;var Ii=Object.prototype,_i=Ii.hasOwnProperty;function Ei(t){if(!Y(t))return Le(t);var e=[];for(var r in Object(t))_i.call(t,r)&&r!="constructor"&&e.push(r);return e}var De=Ei;function Ci(t){return wt(t)?Ot(t):De(t)}var J=Ci;function Fi(t){var e=[];if(t!=null)for(var r in Object(t))e.push(r);return e}var Ue=Fi;var Mi=Object.prototype,Ni=Mi.hasOwnProperty;function Ri(t){if(!A(t))return Ue(t);var e=Y(t),r=[];for(var o in t)o=="constructor"&&(e||!Ni.call(t,o))||r.push(o);return r}var ke=Ri;function Bi(t){return wt(t)?Ot(t,!0):ke(t)}var X=Bi;var Li=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Di=/^\w*$/;function Ui(t,e){if(w(t))return!1;var r=typeof t;return r=="number"||r=="symbol"||r=="boolean"||t==null||G(t)?!0:Di.test(t)||!Li.test(t)||e!=null&&t in Object(e)}var ze=Ui;var ki=S(Object,"create"),M=ki;function zi(){this.__data__=M?M(null):{},this.size=0}var Ke=zi;function Ki(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var Ge=Ki;var Gi="__lodash_hash_undefined__",Wi=Object.prototype,$i=Wi.hasOwnProperty;function Hi(t){var e=this.__data__;if(M){var r=e[t];return r===Gi?void 0:r}return $i.call(e,t)?e[t]:void 0}var We=Hi;var qi=Object.prototype,Yi=qi.hasOwnProperty;function Vi(t){var e=this.__data__;return M?e[t]!==void 0:Yi.call(e,t)}var $e=Vi;var Zi="__lodash_hash_undefined__";function Ji(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=M&&e===void 0?Zi:e,this}var He=Ji;function Q(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}Q.prototype.clear=Ke;Q.prototype.delete=Ge;Q.prototype.get=We;Q.prototype.has=$e;Q.prototype.set=He;var Lt=Q;function Xi(){this.__data__=[],this.size=0}var qe=Xi;function Qi(t,e){for(var r=t.length;r--;)if(vt(t[r][0],e))return r;return-1}var R=Qi;var ts=Array.prototype,es=ts.splice;function rs(t){var e=this.__data__,r=R(e,t);if(r<0)return!1;var o=e.length-1;return r==o?e.pop():es.call(e,r,1),--this.size,!0}var Ye=rs;function os(t){var e=this.__data__,r=R(e,t);return r<0?void 0:e[r][1]}var Ve=os;function as(t){return R(this.__data__,t)>-1}var Ze=as;function is(t,e){var r=this.__data__,o=R(r,t);return o<0?(++this.size,r.push([t,e])):r[o][1]=e,this}var Je=is;function tt(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}tt.prototype.clear=qe;tt.prototype.delete=Ye;tt.prototype.get=Ve;tt.prototype.has=Ze;tt.prototype.set=Je;var B=tt;var ss=S(g,"Map"),L=ss;function ns(){this.size=0,this.__data__={hash:new Lt,map:new(L||B),string:new Lt}}var Xe=ns;function fs(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}var Qe=fs;function ps(t,e){var r=t.__data__;return Qe(e)?r[typeof e=="string"?"string":"hash"]:r.map}var D=ps;function ls(t){var e=D(this,t).delete(t);return this.size-=e?1:0,e}var tr=ls;function ms(t){return D(this,t).get(t)}var er=ms;function us(t){return D(this,t).has(t)}var rr=us;function ds(t,e){var r=D(this,t),o=r.size;return r.set(t,e),this.size+=r.size==o?0:1,this}var or=ds;function et(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}et.prototype.clear=Xe;et.prototype.delete=tr;et.prototype.get=er;et.prototype.has=rr;et.prototype.set=or;var dt=et;var cs="Expected a function";function Dt(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(cs);var r=function(){var o=arguments,a=e?e.apply(this,o):o[0],s=r.cache;if(s.has(a))return s.get(a);var n=t.apply(this,o);return r.cache=s.set(a,n)||s,n};return r.cache=new(Dt.Cache||dt),r}Dt.Cache=dt;var ar=Dt;var hs=500;function xs(t){var e=ar(t,function(o){return r.size===hs&&r.clear(),o}),r=e.cache;return e}var ir=xs;var gs=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ys=/\\(\\)?/g,bs=ir(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(gs,function(r,o,a,s){e.push(a?s.replace(ys,"$1"):o||r)}),e}),sr=bs;function vs(t){return t==null?"":le(t)}var nr=vs;function ws(t,e){return w(t)?t:ze(t,e)?[t]:sr(nr(t))}var U=ws;var Ts=1/0;function Os(t){if(typeof t=="string"||G(t))return t;var e=t+"";return e=="0"&&1/t==-Ts?"-0":e}var rt=Os;function Ss(t,e){e=U(e,t);for(var r=0,o=e.length;t!=null&&r<o;)t=t[rt(e[r++])];return r&&r==o?t:void 0}var fr=Ss;function js(t,e){for(var r=-1,o=e.length,a=t.length;++r<o;)t[a+r]=e[r];return t}var ot=js;var pr=T?T.isConcatSpreadable:void 0;function As(t){return w(t)||V(t)||!!(pr&&t&&t[pr])}var lr=As;function mr(t,e,r,o,a){var s=-1,n=t.length;for(r||(r=lr),a||(a=[]);++s<n;){var i=t[s];e>0&&r(i)?e>1?mr(i,e-1,r,o,a):ot(a,i):o||(a[a.length]=i)}return a}var ur=mr;function Ps(t){var e=t==null?0:t.length;return e?ur(t,1):[]}var dr=Ps;function Is(t){return Oe(Ae(t,void 0,dr),t+"")}var cr=Is;var _s=St(Object.getPrototypeOf,Object),jt=_s;function Es(){this.__data__=new B,this.size=0}var hr=Es;function Cs(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}var xr=Cs;function Fs(t){return this.__data__.get(t)}var gr=Fs;function Ms(t){return this.__data__.has(t)}var yr=Ms;var Ns=200;function Rs(t,e){var r=this.__data__;if(r instanceof B){var o=r.__data__;if(!L||o.length<Ns-1)return o.push([t,e]),this.size=++r.size,this;r=this.__data__=new dt(o)}return r.set(t,e),this.size=r.size,this}var br=Rs;function at(t){var e=this.__data__=new B(t);this.size=e.size}at.prototype.clear=hr;at.prototype.delete=xr;at.prototype.get=gr;at.prototype.has=yr;at.prototype.set=br;var vr=at;function Bs(t,e){return t&&N(e,J(e),t)}var wr=Bs;function Ls(t,e){return t&&N(e,X(e),t)}var Tr=Ls;var Ar=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Or=Ar&&typeof module=="object"&&module&&!module.nodeType&&module,Ds=Or&&Or.exports===Ar,Sr=Ds?g.Buffer:void 0,jr=Sr?Sr.allocUnsafe:void 0;function Us(t,e){if(e)return t.slice();var r=t.length,o=jr?jr(r):new t.constructor(r);return t.copy(o),o}var Pr=Us;function ks(t,e){for(var r=-1,o=t==null?0:t.length,a=0,s=[];++r<o;){var n=t[r];e(n,r,t)&&(s[a++]=n)}return s}var Ir=ks;function zs(){return[]}var At=zs;var Ks=Object.prototype,Gs=Ks.propertyIsEnumerable,_r=Object.getOwnPropertySymbols,Ws=_r?function(t){return t==null?[]:(t=Object(t),Ir(_r(t),function(e){return Gs.call(t,e)}))}:At,it=Ws;function $s(t,e){return N(t,it(t),e)}var Er=$s;var Hs=Object.getOwnPropertySymbols,qs=Hs?function(t){for(var e=[];t;)ot(e,it(t)),t=jt(t);return e}:At,Pt=qs;function Ys(t,e){return N(t,Pt(t),e)}var Cr=Ys;function Vs(t,e,r){var o=e(t);return w(t)?o:ot(o,r(t))}var It=Vs;function Zs(t){return It(t,J,it)}var Fr=Zs;function Js(t){return It(t,X,Pt)}var Mr=Js;var Xs=S(g,"DataView"),_t=Xs;var Qs=S(g,"Promise"),Et=Qs;var tn=S(g,"Set"),Ct=tn;var Nr="[object Map]",en="[object Object]",Rr="[object Promise]",Br="[object Set]",Lr="[object WeakMap]",Dr="[object DataView]",rn=C(_t),on=C(L),an=C(Et),sn=C(Ct),nn=C(yt),z=I;(_t&&z(new _t(new ArrayBuffer(1)))!=Dr||L&&z(new L)!=Nr||Et&&z(Et.resolve())!=Rr||Ct&&z(new Ct)!=Br||yt&&z(new yt)!=Lr)&&(z=function(t){var e=I(t),r=e==en?t.constructor:void 0,o=r?C(r):"";if(o)switch(o){case rn:return Dr;case on:return Nr;case an:return Rr;case sn:return Br;case nn:return Lr}return e});var st=z;var fn=Object.prototype,pn=fn.hasOwnProperty;function ln(t){var e=t.length,r=new t.constructor(e);return e&&typeof t[0]=="string"&&pn.call(t,"index")&&(r.index=t.index,r.input=t.input),r}var Ur=ln;var mn=g.Uint8Array,Ut=mn;function un(t){var e=new t.constructor(t.byteLength);return new Ut(e).set(new Ut(t)),e}var nt=un;function dn(t,e){var r=e?nt(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}var kr=dn;var cn=/\w*$/;function hn(t){var e=new t.constructor(t.source,cn.exec(t));return e.lastIndex=t.lastIndex,e}var zr=hn;var Kr=T?T.prototype:void 0,Gr=Kr?Kr.valueOf:void 0;function xn(t){return Gr?Object(Gr.call(t)):{}}var Wr=xn;function gn(t,e){var r=e?nt(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}var $r=gn;var yn="[object Boolean]",bn="[object Date]",vn="[object Map]",wn="[object Number]",Tn="[object RegExp]",On="[object Set]",Sn="[object String]",jn="[object Symbol]",An="[object ArrayBuffer]",Pn="[object DataView]",In="[object Float32Array]",_n="[object Float64Array]",En="[object Int8Array]",Cn="[object Int16Array]",Fn="[object Int32Array]",Mn="[object Uint8Array]",Nn="[object Uint8ClampedArray]",Rn="[object Uint16Array]",Bn="[object Uint32Array]";function Ln(t,e,r){var o=t.constructor;switch(e){case An:return nt(t);case yn:case bn:return new o(+t);case Pn:return kr(t,r);case In:case _n:case En:case Cn:case Fn:case Mn:case Nn:case Rn:case Bn:return $r(t,r);case vn:return new o;case wn:case Sn:return new o(t);case Tn:return zr(t);case On:return new o;case jn:return Wr(t)}}var Hr=Ln;function Dn(t){return typeof t.constructor=="function"&&!Y(t)?ge(jt(t)):{}}var qr=Dn;var Un="[object Map]";function kn(t){return P(t)&&st(t)==Un}var Yr=kn;var Vr=F&&F.isMap,zn=Vr?Z(Vr):Yr,Zr=zn;var Kn="[object Set]";function Gn(t){return P(t)&&st(t)==Kn}var Jr=Gn;var Xr=F&&F.isSet,Wn=Xr?Z(Xr):Jr,Qr=Wn;var $n=1,Hn=2,qn=4,to="[object Arguments]",Yn="[object Array]",Vn="[object Boolean]",Zn="[object Date]",Jn="[object Error]",eo="[object Function]",Xn="[object GeneratorFunction]",Qn="[object Map]",tf="[object Number]",ro="[object Object]",ef="[object RegExp]",rf="[object Set]",of="[object String]",af="[object Symbol]",sf="[object WeakMap]",nf="[object ArrayBuffer]",ff="[object DataView]",pf="[object Float32Array]",lf="[object Float64Array]",mf="[object Int8Array]",uf="[object Int16Array]",df="[object Int32Array]",cf="[object Uint8Array]",hf="[object Uint8ClampedArray]",xf="[object Uint16Array]",gf="[object Uint32Array]",d={};d[to]=d[Yn]=d[nf]=d[ff]=d[Vn]=d[Zn]=d[pf]=d[lf]=d[mf]=d[uf]=d[df]=d[Qn]=d[tf]=d[ro]=d[ef]=d[rf]=d[of]=d[af]=d[cf]=d[hf]=d[xf]=d[gf]=!0;d[Jn]=d[eo]=d[sf]=!1;function Ft(t,e,r,o,a,s){var n,i=e&$n,f=e&Hn,m=e&qn;if(r&&(n=a?r(t,o,a,s):r(t)),n!==void 0)return n;if(!A(t))return t;var x=w(t);if(x){if(n=Ur(t),!i)return be(t,n)}else{var v=st(t),j=v==eo||v==Xn;if(Tt(t))return Pr(t,i);if(v==ro||v==to||j&&!a){if(n=f||j?{}:qr(t),!i)return f?Cr(t,Tr(n,t)):Er(t,wr(n,t))}else{if(!d[v])return a?t:{};n=Hr(t,v,i)}}s||(s=new vr);var O=s.get(t);if(O)return O;s.set(t,n),Qr(t)?t.forEach(function(b){n.add(Ft(b,e,r,b,t,s))}):Zr(t)&&t.forEach(function(b,p){n.set(p,Ft(b,e,r,p,t,s))});var y=m?f?Mr:Fr:f?X:J,_=x?void 0:y(t);return Se(_||t,function(b,p){_&&(p=b,b=t[p]),H(n,p,Ft(b,e,r,p,t,s))}),n}var oo=Ft;var yf=1,bf=4;function vf(t){return oo(t,yf|bf)}var kt=vf;function wf(t,e){return t!=null&&e in Object(t)}var ao=wf;function Tf(t,e,r){e=U(e,t);for(var o=-1,a=e.length,s=!1;++o<a;){var n=rt(e[o]);if(!(s=t!=null&&r(t,n)))break;t=t[n]}return s||++o!=a?s:(a=t==null?0:t.length,!!a&&q(a)&&$(n,a)&&(w(t)||V(t)))}var io=Tf;function Of(t,e){return t!=null&&io(t,e,ao)}var so=Of;function Sf(t,e,r,o){if(!A(t))return t;e=U(e,t);for(var a=-1,s=e.length,n=s-1,i=t;i!=null&&++a<s;){var f=rt(e[a]),m=r;if(f==="__proto__"||f==="constructor"||f==="prototype")return t;if(a!=n){var x=i[f];m=o?o(x,f,i):void 0,m===void 0&&(m=A(x)?x:$(e[a+1])?[]:{})}H(i,f,m),i=i[f]}return t}var no=Sf;function jf(t,e,r){for(var o=-1,a=e.length,s={};++o<a;){var n=e[o],i=fr(t,n);r(i,n)&&no(s,U(n,t),i)}return s}var fo=jf;function Af(t,e){return fo(t,e,function(r,o){return so(t,o)})}var po=Af;var Pf=cr(function(t,e){return t==null?{}:po(t,e)}),Mt=Pf;function lo(t){return{all:t=t||new Map,on:function(e,r){var o=t.get(e);o?o.push(r):t.set(e,[r])},off:function(e,r){var o=t.get(e);o&&(r?o.splice(o.indexOf(r)>>>0,1):t.set(e,[]))},emit:function(e,r){var o=t.get(e);o&&o.slice().map(function(a){a(r)}),(o=t.get("*"))&&o.slice().map(function(a){a(e,r)})}}}var zt=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,r)=>(r&=63,r<36?e+=r.toString(36):r<62?e+=(r-26).toString(36).toUpperCase():r>62?e+="-":e+="_",e),"");var If="array",_f="bit",mo="bits",Ef="byte",uo="bytes",ft="",Cf="exponent",Ff="function",co="iec",Mf="Invalid number",Nf="Invalid rounding method",Kt="jedec",Rf="object",ho=".",Bf="round",Lf="s",Df="si",Uf="kbit",kf="kB",zf=" ",Kf="string",Gf="0",Gt={symbol:{iec:{bits:["bit","Kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],bytes:["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"]},jedec:{bits:["bit","Kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],bytes:["B","KB","MB","GB","TB","PB","EB","ZB","YB"]}},fullform:{iec:["","kibi","mebi","gibi","tebi","pebi","exbi","zebi","yobi"],jedec:["","kilo","mega","giga","tera","peta","exa","zetta","yotta"]}};function xo(t,{bits:e=!1,pad:r=!1,base:o=-1,round:a=2,locale:s=ft,localeOptions:n={},separator:i=ft,spacer:f=zf,symbols:m={},standard:x=ft,output:v=Kf,fullform:j=!1,fullforms:O=[],exponent:y=-1,roundingMethod:_=Bf,precision:b=0}={}){let p=y,u=Number(t),l=[],E=0,Nt=ft;x===Df?(o=10,x=Kt):x===co||x===Kt?o=2:o===2?x=co:(o=10,x=Kt);let ct=o===10?1e3:1024,go=j===!0,Ht=u<0,qt=Math[_];if(typeof t!="bigint"&&isNaN(t))throw new TypeError(Mf);if(typeof qt!==Ff)throw new TypeError(Nf);if(Ht&&(u=-u),(p===-1||isNaN(p))&&(p=Math.floor(Math.log(u)/Math.log(ct)),p<0&&(p=0)),p>8&&(b>0&&(b+=8-p),p=8),v===Cf)return p;if(u===0)l[0]=0,Nt=l[1]=Gt.symbol[x][e?mo:uo][p];else{E=u/(o===2?Math.pow(2,p*10):Math.pow(1e3,p)),e&&(E=E*8,E>=ct&&p<8&&(E=E/ct,p++));let pt=Math.pow(10,p>0?a:0);l[0]=qt(E*pt)/pt,l[0]===ct&&p<8&&y===-1&&(l[0]=1,p++),Nt=l[1]=o===10&&p===1?e?Uf:kf:Gt.symbol[x][e?mo:uo][p]}if(Ht&&(l[0]=-l[0]),b>0&&(l[0]=l[0].toPrecision(b)),l[1]=m[l[1]]||l[1],s===!0?l[0]=l[0].toLocaleString():s.length>0?l[0]=l[0].toLocaleString(s,n):i.length>0&&(l[0]=l[0].toString().replace(ho,i)),r&&Number.isInteger(l[0])===!1&&a>0){let pt=i||ho,Yt=l[0].toString().split(pt),Vt=Yt[1]||ft,Zt=Vt.length,yo=a-Zt;l[0]=`${Yt[0]}${pt}${Vt.padEnd(Zt+yo,Gf)}`}return go&&(l[1]=O[p]?O[p]:Gt.fullform[x][p]+(e?_f:Ef)+(l[0]===1?ft:Lf)),v===If?l:v===Rf?{value:l[0],symbol:l[1],exponent:p,unit:Nt}:l.join(f)}var k,Wt=class Wt{constructor(e){Xt(this,k,void 0);c(this,"id");c(this,"name");c(this,"icon");c(this,"path");c(this,"url");c(this,"teraUrl");c(this,"parsedName");c(this,"created");c(this,"createdFormatted");c(this,"modified");c(this,"modifiedFormatted");c(this,"accessed");c(this,"accessedFormatted");c(this,"size");c(this,"sizeFormatted");c(this,"mime");c(this,"meta",{});if(!e.tera)throw new Error("Basic file requires a `tera` key to access the Tera instance");Object.assign(this,e),delete this.tera,Qt(this,k,e.tera),this.teraUrl=this.url.replace(/^https:\/\/tera-tools.com\/projects\/(?:.+?)\/(.+)$/,"/project/$1"),this.sizeFormatted=xo(this.size||0,{spacer:""}),this.createdFormatted=this.created?this.created.toLocaleDateString():"Unknown created date",this.modifiedFormatted=this.modified?this.modified.toLocaleDateString():"Unknown modified date",this.accessedFormatted=this.accessed?this.accessed.toLocaleDateString():"Unknown access date"}getContents(){return lt(this,k).getProjectFile(this.id)}setContents(e){return lt(this,k).setProjectFile(this.id,e)}getRefs(){return lt(this,k).getProjectLibrary(this.id)}setRefs(e){return lt(this,k).setProjectLibrary(this.id,e)}serialize(){return Mt(this,["id","name","icon","path","url","parsedName","created","modified","accessed","size","mime","meta"])}static deserialize(e){return new Wt(Mt(e,["tera","id","name","icon","path","url","parsedName","created","modified","accessed","size","mime","meta"]))}};k=new WeakMap;var K=Wt;var $t=class{constructor(e){c(this,"settings",{devMode:!0,verbosity:1,mode:"detect",modeTimeout:300,modeFallback:"child",siteUrl:"https://tera-tools.com/embed",restrictOrigin:"*",frameSandbox:["allow-forms","allow-modals","allow-orientation-lock","allow-pointer-lock","allow-popups","allow-popups-to-escape-sandbox","allow-presentation","allow-same-origin","allow-scripts","allow-top-navigation"],handshakeInterval:1e3});c(this,"events",lo());c(this,"dom",{el:null,iframe:null,popup:null,stylesheet:null});c(this,"methods",["handshake","getUser","requireUser","bindProject","getProject","getProjects","setActiveProject","requireProject","selectProject","getProjectState","setProjectState","setProjectStateDefaults","setProjectStateFlush","setProjectStateRefresh","saveProjectState","replaceProjectState","applyProjectStatePatch","setProjectFile","selectProjectLibrary","getProjectLibrary","setProjectLibrary","projectLog","setPageUrl","setPageTitle","uiAlert","uiSplat","uiWindow"]);c(this,"plugins",[]);c(this,"acceptPostboxes",{});e&&this.set(e)}send(e){let r=zt();return this.acceptPostboxes[r]={},this.acceptPostboxes[r].promise=new Promise((o,a)=>{Object.assign(this.acceptPostboxes[r],{resolve:o,reject:a}),this.sendRaw({id:r,...e})}),this.acceptPostboxes[r].promise}sendRaw(e){let r;try{if(r={TERA:1,id:e.id||zt(),...kt(e)},this.settings.mode=="parent")window.parent.postMessage(r,this.settings.restrictOrigin);else if(this.settings.mode=="child")this.dom.iframe.contentWindow.postMessage(r,this.settings.restrictOrigin);else if(this.settings.mode=="popup")this.dom.popup.postMessage(r,this.settings.restrictOrigin);else throw this.settings.mode=="detect"?new Error("Call init() or detectMode() before trying to send data to determine the mode"):new Error(`Unknown TERA communication mode "${this.settings.mode}"`)}catch(o){throw this.debug("ERROR",1,"Message compose client->server:",o),this.debug("ERROR",1,"Attempted to dispatch payload client->server",r),o}}rpc(e,...r){return this.send({action:"rpc",method:e,args:r})}acceptMessage(e){if(e.origin==window.location.origin)return;let r=e.data;if(!(!r.TERA||!r.id))if(this.debug("INFO",3,"Recieved message",r),(r==null?void 0:r.action)=="response"&&this.acceptPostboxes[r.id])r.isError===!0?this.acceptPostboxes[r.id].reject(r.response):this.acceptPostboxes[r.id].resolve(r.response);else{if((r==null?void 0:r.action)=="rpc")return Promise.resolve().then(()=>this[r.method].apply(this,r.args)).then(o=>this.sendRaw({id:r.id,action:"response",response:o})).catch(o=>{console.warn(`TERA-FY client threw on RPC:${r.method}:`,o),this.sendRaw({id:r.id,action:"response",isError:!0,response:o&&o.toString()})});if((r==null?void 0:r.action)=="event")return Promise.resolve().then(()=>this.events.emit(r.event,...r.payload)).catch(o=>{throw console.warn(`TERA-FY client threw while handling emitted event "${r.event}"`,{message:r}),o});r!=null&&r.id?this.debug("INFO",3,`Ignoring message ID ${r.id} - was meant for someone else?`):this.debug("INFO",3,"Unexpected incoming TERA-FY CLIENT message",{message:r})}}createProjectStatePatch(e,r){let o=te(r,e,ee);return this.debug("INFO",3,"Created project patch",{newState:e,oldState:r}),this.applyProjectStatePatch(o)}applyProjectStatePatchLocal(e){throw new Error("applyProjectStatePatchLocal() has not been sub-classed by a plugin")}init(e){if(e&&this.set(e),this.init.promise)return this.init.promise;window.addEventListener("message",this.acceptMessage.bind(this));let r=this;return this.init.promise=Promise.resolve().then(()=>this.debug("INFO",4,"[0/5] Init using server",this.settings.siteUrl)).then(()=>this.detectMode()).then(o=>{this.debug("INFO",4,"[1/5] Setting client mode to",o),this.settings.mode=o}).then(()=>this.debug("INFO",4,"[2/5] Injecting comms + styles + methods")).then(()=>Promise.all([this.injectComms(),this.injectStylesheet(),this.injectMethods()])).then(()=>this.debug("INFO",4,"[3/5] Set server mode")).then(()=>this.rpc("setServerMode",this.settings.mode=="child"?"embedded":this.settings.mode=="parent"?"frame":this.settings.mode=="popup"?"popup":(()=>{throw`Unknown server mode "${this.settings.mode}"`})())).then(()=>this.debug("INFO",4,"[4/5] Run client plugins")).then(()=>Promise.all(this.plugins.map(o=>o.init.call(r,this.settings)))).then(()=>this.debug("INFO",4,"[5/5] Init complete")).catch(o=>this.debug("WARN",0,"Init caught error",o))}detectMode(){return this.settings.mode!="detect"?Promise.resolve(this.settings.mode):window.self===window.parent?Promise.resolve(this.settings.modeFallback):Promise.resolve().then(()=>this.settings.mode="parent").then(()=>new Promise((e,r)=>{let o=setTimeout(()=>r(),this.settings.modeTimeout);this.rpc("handshake").then(()=>clearTimeout(o)).then(()=>e())})).then(()=>"parent").catch(()=>this.settings.modeFallback)}injectComms(){return new Promise(e=>{switch(this.settings.mode){case"child":this.debug("INFO",2,"Injecting TERA site as iFrame child"),this.dom.el=document.createElement("div"),this.dom.el.id="tera-fy",this.dom.el.classList.toggle("dev-mode",this.settings.devMode),document.body.append(this.dom.el),this.dom.iframe=document.createElement("iframe"),this.dom.iframe.setAttribute("sandbox",this.settings.frameSandbox.join(" ")),this.dom.iframe.addEventListener("load",()=>{this.debug("INFO",2,"Embeded iframe ready"),e()}),this.dom.iframe.src=this.settings.siteUrl,this.dom.el.append(this.dom.iframe);break;case"parent":this.debug("INFO",2,"Using TERA window parent"),e();break;case"popup":this.debug("INFO",2,"Injecting TERA site as a popup window"),this.dom.popup=window.open(this.settings.siteUrl,"_blank","popup=1, location=0, menubar=0, status=0, scrollbars=0, width=500, height=600"),(()=>{let r=0,o,a=()=>{this.debug("INFO",3,"Trying handshake",++r),clearTimeout(o),o=setTimeout(a,this.settings.handshakeInterval),this.rpc("handshake").then(()=>{clearTimeout(o),this.debug("INFO",3,"Popup window accepted handshake"),e()})};a()})();break;default:throw new Error(`Unsupported mode "${this.settings.mode}" when calling injectComms()`)}})}injectStylesheet(){switch(this.settings.mode){case"child":this.dom.stylesheet=document.createElement("style"),this.dom.stylesheet.innerHTML=[":root {","--TERA-accent: #4d659c;","}","#tera-fy {","display: none;","position: fixed;","right: 50px;","bottom: 50px;","width: 300px;","height: 150px;","background: transparent;","&.dev-mode {","display: flex;","border: 5px solid var(--TERA-accent);","background: #FFF;","}","& > iframe {","width: 100%;","height: 100%;","}","}","body.tera-fy-focus {","overflow: hidden;","& #tera-fy {","display: flex !important;","position: fixed !important;","top: 0px !important;","width: 100vw !important;","height: 100vh !important;","left: 0px !important;","z-index: 10000 !important;","}","}"].join(`
`),document.head.appendChild(this.dom.stylesheet);break;case"parent":case"popup":break;default:throw new Error(`Unsupported mode "${this.settings.mode}" when injectStylesheet()`)}return Promise.resolve()}injectMethods(){this.methods.forEach(e=>this[e]=this.rpc.bind(this,e))}debug(...e){if(!this.settings.devMode||this.settings.verbosity<1)return;let r="log",o=1;typeof e[0]=="string"&&["INFO","LOG","WARN","ERROR"].includes(e[0])&&(r=e.shift().toLowerCase()),typeof e[0]=="number"&&(o=e[0],e.shift()),!(this.settings.verbosity<o)&&console[r]("%c[TERA-FY CLIENT]","font-weight: bold; color: #ff5722;",...e)}set(e,r){return typeof e=="string"?this.settings[e]=r:Object.assign(this.settings,e),this.toggleDevMode(this.settings.devMode)}setIfDev(e,r){return!this.settings.devMode||r===void 0?this:this.set(e,r)}use(e,r){if(typeof e!="function")throw new Error("Expected use() call to be provided with a class initalizer");let o=new e(this,r);return this.mixin(this,o),this.plugins.push(o),this}mixin(e,r){Object.getOwnPropertyNames(Object.getPrototypeOf(r)).filter(o=>!["constructor","prototype","name"].includes(o)).filter(o=>o!="init").forEach(o=>{Object.defineProperty(e,o,{value:r[o].bind(e),enumerable:!1})})}toggleDevMode(e="toggle"){return this.settings.devMode=e==="toggle"?!this.settings.devMode:e,this.dom.el&&this.dom.el.classList.toggle("dev-mode",this.settings.devMode),this}toggleFocus(e="toggle"){this.debug("INFO",2,"Request focus",{isFocused:e}),globalThis.document.body.classList.toggle("tera-fy-focus",e==="toggle"?void 0:e)}selectProjectFile(e){return this.rpc("selectProjectFile",e).then(r=>r&&new K({tera:this,...r}))}getProjectFiles(e){return this.rpc("getProjectFiles",e).then(r=>r.map(o=>new K({tera:this,...o})))}getProjectFile(e){return this.rpc("getProjectFile",e).then(r=>r&&new K({tera:this,...r}))}};export{$t as default};
/*! Bundled license information:

lodash-es/lodash.js:
  (**
   * @license
   * Lodash (Custom Build) <https://lodash.com/>
   * Build: `lodash modularize exports="es" -o ./`
   * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
   * Released under MIT license <https://lodash.com/license>
   * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
   * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
   *)

filesize/dist/filesize.esm.js:
  (**
   * filesize
   *
   * @copyright 2024 Jason Mulligan <jason.mulligan@avoidwork.com>
   * @license BSD-3-Clause
   * @version 10.1.1
   *)
*/
